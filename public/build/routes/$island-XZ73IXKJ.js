import{a as Ee,b as Wp,c as Yb,i as Wb,l as a_}from"/_static/build/_shared/chunk-HTIHDIN4.js";import{c as YT,d as _e}from"/_static/build/_shared/chunk-NPMEYKEH.js";var Of=_e(Ee(),1);var Jb=_e(Ee(),1);function WT(){return()=>{}}function Kb(){return(0,Jb.useSyncExternalStore)(WT,()=>!0,()=>!1)}function Qb({children:i,fallback:s=null}){return Kb()?Of.createElement(Of.Fragment,null,i()):Of.createElement(Of.Fragment,null,s)}var Jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function l_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var m1={exports:{}};(function(i,s){(function(u,d){i.exports=d()})(Jp,function(){var u=function(D,U){var ct={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},vt={on:function(Lt,Rt,fe){if(ct[Lt]===void 0)throw new Error("Invalid event type: "+Lt);ct[Lt].push({selector:Rt,fn:fe})},render:function(Lt){U.store.featureChanged(Lt)}},At=function(Lt,Rt){for(var fe=ct[Lt],ve=fe.length;ve--;){var Ce=fe[ve];if(Ce.selector(Rt)){Ce.fn.call(vt,Rt)||U.store.render(),U.ui.updateMapClasses();break}}};return D.start.call(vt),{render:D.render,stop:function(){D.stop&&D.stop()},trash:function(){D.trash&&(D.trash(),U.store.render())},combineFeatures:function(){D.combineFeatures&&D.combineFeatures()},uncombineFeatures:function(){D.uncombineFeatures&&D.uncombineFeatures()},drag:function(Lt){At("drag",Lt)},click:function(Lt){At("click",Lt)},mousemove:function(Lt){At("mousemove",Lt)},mousedown:function(Lt){At("mousedown",Lt)},mouseup:function(Lt){At("mouseup",Lt)},mouseout:function(Lt){At("mouseout",Lt)},keydown:function(Lt){At("keydown",Lt)},keyup:function(Lt){At("keyup",Lt)},touchstart:function(Lt){At("touchstart",Lt)},touchmove:function(Lt){At("touchmove",Lt)},touchend:function(Lt){At("touchend",Lt)},tap:function(Lt){At("tap",Lt)}}};function d(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}function _(D){if(D.__esModule)return D;var U=D.default;if(typeof U=="function"){var ct=function vt(){if(this instanceof vt){var At=[null];At.push.apply(At,arguments);var Lt=Function.bind.apply(U,At);return new Lt}return U.apply(this,arguments)};ct.prototype=U.prototype}else ct={};return Object.defineProperty(ct,"__esModule",{value:!0}),Object.keys(D).forEach(function(vt){var At=Object.getOwnPropertyDescriptor(D,vt);Object.defineProperty(ct,vt,At.get?At:{enumerable:!0,get:function(){return D[vt]}})}),ct}var b={},C={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},l=C;function V(D){var U=0;if(D&&D.length>0){U+=Math.abs(R(D[0]));for(var ct=1;ct<D.length;ct++)U-=Math.abs(R(D[ct]))}return U}function R(D){var U,ct,vt,At,Lt,Rt,fe=0,ve=D.length;if(ve>2){for(Rt=0;Rt<ve;Rt++)Rt===ve-2?(vt=ve-2,At=ve-1,Lt=0):Rt===ve-1?(vt=ve-1,At=0,Lt=1):(vt=Rt,At=Rt+1,Lt=Rt+2),U=D[vt],ct=D[At],fe+=(et(D[Lt][0])-et(U[0]))*Math.sin(et(ct[1]));fe=fe*l.RADIUS*l.RADIUS/2}return fe}function et(D){return D*Math.PI/180}b.geometry=function D(U){var ct,vt=0;switch(U.type){case"Polygon":return V(U.coordinates);case"MultiPolygon":for(ct=0;ct<U.coordinates.length;ct++)vt+=V(U.coordinates[ct]);return vt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ct=0;ct<U.geometries.length;ct++)vt+=D(U.geometries[ct]);return vt}},b.ring=R;var at={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},st={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},yt={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},xt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},It={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Pt={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},qt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Qt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},se={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},le={ACTIVE:"true",INACTIVE:"false"},Ue=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ke=-85,er=Object.freeze({__proto__:null,classes:at,sources:st,cursors:yt,types:xt,geojsonTypes:It,modes:Pt,events:qt,updateActions:Qt,meta:se,activeStates:le,interactions:Ue,LAT_MIN:-90,LAT_RENDERED_MIN:ke,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Le={Point:0,LineString:1,MultiLineString:1,Polygon:2};function lr(D,U){var ct=Le[D.geometry.type]-Le[U.geometry.type];return ct===0&&D.geometry.type===It.POLYGON?D.area-U.area:ct}function je(D){return D.map(function(U){return U.geometry.type===It.POLYGON&&(U.area=b.geometry({type:It.FEATURE,property:{},geometry:U.geometry})),U}).sort(lr).map(function(U){return delete U.area,U})}function zr(D,U){return U===void 0&&(U=0),[[D.point.x-U,D.point.y-U],[D.point.x+U,D.point.y+U]]}function nr(D){if(this._items={},this._nums={},this._length=D?D.length:0,D)for(var U=0,ct=D.length;U<ct;U++)this.add(D[U]),D[U]!==void 0&&(typeof D[U]=="string"?this._items[D[U]]=U:this._nums[D[U]]=U)}nr.prototype.add=function(D){return this.has(D)||(this._length++,typeof D=="string"?this._items[D]=this._length:this._nums[D]=this._length),this},nr.prototype.delete=function(D){return this.has(D)===!1||(this._length--,delete this._items[D],delete this._nums[D]),this},nr.prototype.has=function(D){return(typeof D=="string"||typeof D=="number")&&(this._items[D]!==void 0||this._nums[D]!==void 0)},nr.prototype.values=function(){var D=this,U=[];return Object.keys(this._items).forEach(function(ct){U.push({k:ct,v:D._items[ct]})}),Object.keys(this._nums).forEach(function(ct){U.push({k:JSON.parse(ct),v:D._nums[ct]})}),U.sort(function(ct,vt){return ct.v-vt.v}).map(function(ct){return ct.k})},nr.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var fn=[se.FEATURE,se.MIDPOINT,se.VERTEX],de={click:function(D,U,ct){return Ke(D,U,ct,ct.options.clickBuffer)},touch:function(D,U,ct){return Ke(D,U,ct,ct.options.touchBuffer)}};function Ke(D,U,ct,vt){if(ct.map===null)return[];var At=D?zr(D,vt):U,Lt={};ct.options.styles&&(Lt.layers=ct.options.styles.map(function(Ce){return Ce.id}).filter(function(Ce){return ct.map.getLayer(Ce)!=null}));var Rt=ct.map.queryRenderedFeatures(At,Lt).filter(function(Ce){return fn.indexOf(Ce.properties.meta)!==-1}),fe=new nr,ve=[];return Rt.forEach(function(Ce){var Ae=Ce.properties.id;fe.has(Ae)||(fe.add(Ae),ve.push(Ce))}),je(ve)}function Er(D,U){var ct=de.click(D,null,U),vt={mouse:yt.NONE};return ct[0]&&(vt.mouse=ct[0].properties.active===le.ACTIVE?yt.MOVE:yt.POINTER,vt.feature=ct[0].properties.meta),U.events.currentModeName().indexOf("draw")!==-1&&(vt.mouse=yt.ADD),U.ui.queueMapClasses(vt),U.ui.updateMapClasses(),ct[0]}function Ar(D,U){var ct=D.x-U.x,vt=D.y-U.y;return Math.sqrt(ct*ct+vt*vt)}function xn(D,U,ct){ct===void 0&&(ct={});var vt=ct.fineTolerance!=null?ct.fineTolerance:4,At=ct.grossTolerance!=null?ct.grossTolerance:12,Lt=ct.interval!=null?ct.interval:500;D.point=D.point||U.point,D.time=D.time||U.time;var Rt=Ar(D.point,U.point);return Rt<vt||Rt<At&&U.time-D.time<Lt}function pi(D,U,ct){ct===void 0&&(ct={});var vt=ct.tolerance!=null?ct.tolerance:25,At=ct.interval!=null?ct.interval:250;return D.point=D.point||U.point,D.time=D.time||U.time,Ar(D.point,U.point)<vt&&U.time-D.time<At}var Qo={exports:{}},Ri=Qo.exports=function(D,U){if(U||(U=16),D===void 0&&(D=128),D<=0)return"0";for(var ct=Math.log(Math.pow(2,D))/Math.log(U),vt=2;ct===1/0;vt*=2)ct=Math.log(Math.pow(2,D/vt))/Math.log(U)*vt;var At=ct-Math.floor(ct),Lt="";for(vt=0;vt<Math.floor(ct);vt++)Lt=Math.floor(Math.random()*U).toString(U)+Lt;if(At){var Rt=Math.pow(U,At);Lt=Math.floor(Math.random()*Rt).toString(U)+Lt}var fe=parseInt(Lt,U);return fe!==1/0&&fe>=Math.pow(2,D)?Ri(D,U):Lt};Ri.rack=function(D,U,ct){var vt=function(Lt){var Rt=0;do{if(Rt++>10){if(!ct)throw new Error("too many ID collisions, use more bits");D+=ct}var fe=Ri(D,U)}while(Object.hasOwnProperty.call(At,fe));return At[fe]=Lt,fe},At=vt.hats={};return vt.get=function(Lt){return vt.hats[Lt]},vt.set=function(Lt,Rt){return vt.hats[Lt]=Rt,vt},vt.bits=D||128,vt.base=U||16,vt};var Sn=d(Qo.exports),Ne=function(D,U){this.ctx=D,this.properties=U.properties||{},this.coordinates=U.geometry.coordinates,this.id=U.id||Sn(),this.type=U.geometry.type};Ne.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Ne.prototype.incomingCoords=function(D){this.setCoordinates(D)},Ne.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},Ne.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Ne.prototype.setProperty=function(D,U){this.properties[D]=U},Ne.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:It.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Ne.prototype.internal=function(D){var U={id:this.id,meta:se.FEATURE,"meta:type":this.type,active:le.INACTIVE,mode:D};if(this.ctx.options.userProperties)for(var ct in this.properties)U["user_"+ct]=this.properties[ct];return{type:It.FEATURE,properties:U,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var qr=function(D,U){Ne.call(this,D,U)};(qr.prototype=Object.create(Ne.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},qr.prototype.updateCoordinate=function(D,U,ct){this.coordinates=arguments.length===3?[U,ct]:[D,U],this.changed()},qr.prototype.getCoordinate=function(){return this.getCoordinates()};var zn=function(D,U){Ne.call(this,D,U)};(zn.prototype=Object.create(Ne.prototype)).isValid=function(){return this.coordinates.length>1},zn.prototype.addCoordinate=function(D,U,ct){this.changed();var vt=parseInt(D,10);this.coordinates.splice(vt,0,[U,ct])},zn.prototype.getCoordinate=function(D){var U=parseInt(D,10);return JSON.parse(JSON.stringify(this.coordinates[U]))},zn.prototype.removeCoordinate=function(D){this.changed(),this.coordinates.splice(parseInt(D,10),1)},zn.prototype.updateCoordinate=function(D,U,ct){var vt=parseInt(D,10);this.coordinates[vt]=[U,ct],this.changed()};var Ci=function(D,U){Ne.call(this,D,U),this.coordinates=this.coordinates.map(function(ct){return ct.slice(0,-1)})};(Ci.prototype=Object.create(Ne.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(D){return D.length>2})},Ci.prototype.incomingCoords=function(D){this.coordinates=D.map(function(U){return U.slice(0,-1)}),this.changed()},Ci.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},Ci.prototype.addCoordinate=function(D,U,ct){this.changed();var vt=D.split(".").map(function(At){return parseInt(At,10)});this.coordinates[vt[0]].splice(vt[1],0,[U,ct])},Ci.prototype.removeCoordinate=function(D){this.changed();var U=D.split(".").map(function(vt){return parseInt(vt,10)}),ct=this.coordinates[U[0]];ct&&(ct.splice(U[1],1),ct.length<3&&this.coordinates.splice(U[0],1))},Ci.prototype.getCoordinate=function(D){var U=D.split(".").map(function(vt){return parseInt(vt,10)}),ct=this.coordinates[U[0]];return JSON.parse(JSON.stringify(ct[U[1]]))},Ci.prototype.getCoordinates=function(){return this.coordinates.map(function(D){return D.concat([D[0]])})},Ci.prototype.updateCoordinate=function(D,U,ct){this.changed();var vt=D.split("."),At=parseInt(vt[0],10),Lt=parseInt(vt[1],10);this.coordinates[At]===void 0&&(this.coordinates[At]=[]),this.coordinates[At][Lt]=[U,ct]};var Os={MultiPoint:qr,MultiLineString:zn,MultiPolygon:Ci},oo=function(D,U,ct,vt,At){var Lt=ct.split("."),Rt=parseInt(Lt[0],10),fe=Lt[1]?Lt.slice(1).join("."):null;return D[Rt][U](fe,vt,At)},ln=function(D,U){if(Ne.call(this,D,U),delete this.coordinates,this.model=Os[U.geometry.type],this.model===void 0)throw new TypeError(U.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(U.geometry.coordinates)};function Qe(D){this.map=D.map,this.drawConfig=JSON.parse(JSON.stringify(D.options||{})),this._ctx=D}(ln.prototype=Object.create(Ne.prototype))._coordinatesToFeatures=function(D){var U=this,ct=this.model.bind(this);return D.map(function(vt){return new ct(U.ctx,{id:Sn(),type:It.FEATURE,properties:{},geometry:{coordinates:vt,type:U.type.replace("Multi","")}})})},ln.prototype.isValid=function(){return this.features.every(function(D){return D.isValid()})},ln.prototype.setCoordinates=function(D){this.features=this._coordinatesToFeatures(D),this.changed()},ln.prototype.getCoordinate=function(D){return oo(this.features,"getCoordinate",D)},ln.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(D){return D.type===It.POLYGON?D.getCoordinates():D.coordinates})))},ln.prototype.updateCoordinate=function(D,U,ct){oo(this.features,"updateCoordinate",D,U,ct),this.changed()},ln.prototype.addCoordinate=function(D,U,ct){oo(this.features,"addCoordinate",D,U,ct),this.changed()},ln.prototype.removeCoordinate=function(D){oo(this.features,"removeCoordinate",D),this.changed()},ln.prototype.getFeatures=function(){return this.features},Qe.prototype.setSelected=function(D){return this._ctx.store.setSelected(D)},Qe.prototype.setSelectedCoordinates=function(D){var U=this;this._ctx.store.setSelectedCoordinates(D),D.reduce(function(ct,vt){return ct[vt.feature_id]===void 0&&(ct[vt.feature_id]=!0,U._ctx.store.get(vt.feature_id).changed()),ct},{})},Qe.prototype.getSelected=function(){return this._ctx.store.getSelected()},Qe.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Qe.prototype.isSelected=function(D){return this._ctx.store.isSelected(D)},Qe.prototype.getFeature=function(D){return this._ctx.store.get(D)},Qe.prototype.select=function(D){return this._ctx.store.select(D)},Qe.prototype.deselect=function(D){return this._ctx.store.deselect(D)},Qe.prototype.deleteFeature=function(D,U){return U===void 0&&(U={}),this._ctx.store.delete(D,U)},Qe.prototype.addFeature=function(D){return this._ctx.store.add(D)},Qe.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Qe.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Qe.prototype.setActionableState=function(D){D===void 0&&(D={});var U={trash:D.trash||!1,combineFeatures:D.combineFeatures||!1,uncombineFeatures:D.uncombineFeatures||!1};return this._ctx.events.actionable(U)},Qe.prototype.changeMode=function(D,U,ct){return U===void 0&&(U={}),ct===void 0&&(ct={}),this._ctx.events.changeMode(D,U,ct)},Qe.prototype.updateUIClasses=function(D){return this._ctx.ui.queueMapClasses(D)},Qe.prototype.activateUIButton=function(D){return this._ctx.ui.setActiveButton(D)},Qe.prototype.featuresAt=function(D,U,ct){if(ct===void 0&&(ct="click"),ct!=="click"&&ct!=="touch")throw new Error("invalid buffer type");return de[ct](D,U,this._ctx)},Qe.prototype.newFeature=function(D){var U=D.geometry.type;return U===It.POINT?new qr(this._ctx,D):U===It.LINE_STRING?new zn(this._ctx,D):U===It.POLYGON?new Ci(this._ctx,D):new ln(this._ctx,D)},Qe.prototype.isInstanceOf=function(D,U){if(D===It.POINT)return U instanceof qr;if(D===It.LINE_STRING)return U instanceof zn;if(D===It.POLYGON)return U instanceof Ci;if(D==="MultiFeature")return U instanceof ln;throw new Error("Unknown feature class: "+D)},Qe.prototype.doRender=function(D){return this._ctx.store.featureChanged(D)},Qe.prototype.onSetup=function(){},Qe.prototype.onDrag=function(){},Qe.prototype.onClick=function(){},Qe.prototype.onMouseMove=function(){},Qe.prototype.onMouseDown=function(){},Qe.prototype.onMouseUp=function(){},Qe.prototype.onMouseOut=function(){},Qe.prototype.onKeyUp=function(){},Qe.prototype.onKeyDown=function(){},Qe.prototype.onTouchStart=function(){},Qe.prototype.onTouchMove=function(){},Qe.prototype.onTouchEnd=function(){},Qe.prototype.onTap=function(){},Qe.prototype.onStop=function(){},Qe.prototype.onTrash=function(){},Qe.prototype.onCombineFeature=function(){},Qe.prototype.onUncombineFeature=function(){},Qe.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var na={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Fo=Object.keys(na);function ba(D){var U=Object.keys(D);return function(ct,vt){vt===void 0&&(vt={});var At={},Lt=U.reduce(function(Rt,fe){return Rt[fe]=D[fe],Rt},new Qe(ct));return{start:function(){var Rt=this;At=Lt.onSetup(vt),Fo.forEach(function(fe){var ve,Ce=na[fe],Ae=function(){return!1};D[Ce]&&(Ae=function(){return!0}),Rt.on(fe,Ae,(ve=Ce,function(Ie){return Lt[ve](At,Ie)}))})},stop:function(){Lt.onStop(At)},trash:function(){Lt.onTrash(At)},combineFeatures:function(){Lt.onCombineFeatures(At)},uncombineFeatures:function(){Lt.onUncombineFeatures(At)},render:function(Rt,fe){Lt.toDisplayFeatures(At,Rt,fe)}}}}function Oi(D){return[].concat(D).filter(function(U){return U!==void 0})}function Fs(){var D=this;if(!(D.ctx.map&&D.ctx.map.getSource(st.HOT)!==void 0))return ve();var U=D.ctx.events.currentModeName();D.ctx.ui.queueMapClasses({mode:U});var ct=[],vt=[];D.isDirty?vt=D.getAllIds():(ct=D.getChangedIds().filter(function(Ce){return D.get(Ce)!==void 0}),vt=D.sources.hot.filter(function(Ce){return Ce.properties.id&&ct.indexOf(Ce.properties.id)===-1&&D.get(Ce.properties.id)!==void 0}).map(function(Ce){return Ce.properties.id})),D.sources.hot=[];var At=D.sources.cold.length;D.sources.cold=D.isDirty?[]:D.sources.cold.filter(function(Ce){var Ae=Ce.properties.id||Ce.properties.parent;return ct.indexOf(Ae)===-1});var Lt=At!==D.sources.cold.length||vt.length>0;function Rt(Ce,Ae){var Ie=D.get(Ce).internal(U);D.ctx.events.currentModeRender(Ie,function(dr){D.sources[Ae].push(dr)})}if(ct.forEach(function(Ce){return Rt(Ce,"hot")}),vt.forEach(function(Ce){return Rt(Ce,"cold")}),Lt&&D.ctx.map.getSource(st.COLD).setData({type:It.FEATURE_COLLECTION,features:D.sources.cold}),D.ctx.map.getSource(st.HOT).setData({type:It.FEATURE_COLLECTION,features:D.sources.hot}),D._emitSelectionChange&&(D.ctx.map.fire(qt.SELECTION_CHANGE,{features:D.getSelected().map(function(Ce){return Ce.toGeoJSON()}),points:D.getSelectedCoordinates().map(function(Ce){return{type:It.FEATURE,properties:{},geometry:{type:It.POINT,coordinates:Ce.coordinates}}})}),D._emitSelectionChange=!1),D._deletedFeaturesToEmit.length){var fe=D._deletedFeaturesToEmit.map(function(Ce){return Ce.toGeoJSON()});D._deletedFeaturesToEmit=[],D.ctx.map.fire(qt.DELETE,{features:fe})}function ve(){D.isDirty=!1,D.clearChangedIds()}ve(),D.ctx.map.fire(qt.RENDER,{})}function Zr(D){var U,ct=this;this._features={},this._featureIds=new nr,this._selectedFeatureIds=new nr,this._selectedCoordinates=[],this._changedFeatureIds=new nr,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=D,this.sources={hot:[],cold:[]},this.render=function(){U||(U=requestAnimationFrame(function(){U=null,Fs.call(ct)}))},this.isDirty=!1}function Mo(D,U){var ct=D._selectedCoordinates.filter(function(vt){return D._selectedFeatureIds.has(vt.feature_id)});D._selectedCoordinates.length===ct.length||U.silent||(D._emitSelectionChange=!0),D._selectedCoordinates=ct}Zr.prototype.createRenderBatch=function(){var D=this,U=this.render,ct=0;return this.render=function(){ct++},function(){D.render=U,ct>0&&D.render()}},Zr.prototype.setDirty=function(){return this.isDirty=!0,this},Zr.prototype.featureChanged=function(D){return this._changedFeatureIds.add(D),this},Zr.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Zr.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Zr.prototype.getAllIds=function(){return this._featureIds.values()},Zr.prototype.add=function(D){return this.featureChanged(D.id),this._features[D.id]=D,this._featureIds.add(D.id),this},Zr.prototype.delete=function(D,U){var ct=this;return U===void 0&&(U={}),Oi(D).forEach(function(vt){ct._featureIds.has(vt)&&(ct._featureIds.delete(vt),ct._selectedFeatureIds.delete(vt),U.silent||ct._deletedFeaturesToEmit.indexOf(ct._features[vt])===-1&&ct._deletedFeaturesToEmit.push(ct._features[vt]),delete ct._features[vt],ct.isDirty=!0)}),Mo(this,U),this},Zr.prototype.get=function(D){return this._features[D]},Zr.prototype.getAll=function(){var D=this;return Object.keys(this._features).map(function(U){return D._features[U]})},Zr.prototype.select=function(D,U){var ct=this;return U===void 0&&(U={}),Oi(D).forEach(function(vt){ct._selectedFeatureIds.has(vt)||(ct._selectedFeatureIds.add(vt),ct._changedFeatureIds.add(vt),U.silent||(ct._emitSelectionChange=!0))}),this},Zr.prototype.deselect=function(D,U){var ct=this;return U===void 0&&(U={}),Oi(D).forEach(function(vt){ct._selectedFeatureIds.has(vt)&&(ct._selectedFeatureIds.delete(vt),ct._changedFeatureIds.add(vt),U.silent||(ct._emitSelectionChange=!0))}),Mo(this,U),this},Zr.prototype.clearSelected=function(D){return D===void 0&&(D={}),this.deselect(this._selectedFeatureIds.values(),{silent:D.silent}),this},Zr.prototype.setSelected=function(D,U){var ct=this;return U===void 0&&(U={}),D=Oi(D),this.deselect(this._selectedFeatureIds.values().filter(function(vt){return D.indexOf(vt)===-1}),{silent:U.silent}),this.select(D.filter(function(vt){return!ct._selectedFeatureIds.has(vt)}),{silent:U.silent}),this},Zr.prototype.setSelectedCoordinates=function(D){return this._selectedCoordinates=D,this._emitSelectionChange=!0,this},Zr.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Zr.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Zr.prototype.getSelected=function(){var D=this;return this._selectedFeatureIds.values().map(function(U){return D.get(U)})},Zr.prototype.getSelectedCoordinates=function(){var D=this;return this._selectedCoordinates.map(function(U){return{coordinates:D.get(U.feature_id).getCoordinate(U.coord_path)}})},Zr.prototype.isSelected=function(D){return this._selectedFeatureIds.has(D)},Zr.prototype.setFeatureProperty=function(D,U,ct){this.get(D).setProperty(U,ct),this.featureChanged(D)},Zr.prototype.storeMapConfig=function(){var D=this;Ue.forEach(function(U){D.ctx.map[U]&&(D._mapInitialConfig[U]=D.ctx.map[U].isEnabled())})},Zr.prototype.restoreMapConfig=function(){var D=this;Object.keys(this._mapInitialConfig).forEach(function(U){D._mapInitialConfig[U]?D.ctx.map[U].enable():D.ctx.map[U].disable()})},Zr.prototype.getInitialConfigValue=function(D){return this._mapInitialConfig[D]===void 0||this._mapInitialConfig[D]};var No=function(){for(var D=arguments,U={},ct=0;ct<arguments.length;ct++){var vt=D[ct];for(var At in vt)ls.call(vt,At)&&(U[At]=vt[At])}return U},ls=Object.prototype.hasOwnProperty,_t=d(No),Vn=["mode","feature","mouse"];function fi(D){var U=null,ct=null,vt={onRemove:function(){return D.map.off("load",vt.connect),clearInterval(ct),vt.removeLayers(),D.store.restoreMapConfig(),D.ui.removeButtons(),D.events.removeEventListeners(),D.ui.clearMapClasses(),D.boxZoomInitial&&D.map.boxZoom.enable(),D.map=null,D.container=null,D.store=null,U&&U.parentNode&&U.parentNode.removeChild(U),U=null,this},connect:function(){D.map.off("load",vt.connect),clearInterval(ct),vt.addLayers(),D.store.storeMapConfig(),D.events.addEventListeners()},onAdd:function(At){var Lt=At.fire;return At.fire=function(Rt,fe){var ve=arguments;return Lt.length===1&&arguments.length!==1&&(ve=[_t({},{type:Rt},fe)]),Lt.apply(At,ve)},D.map=At,D.events=function(Rt){var fe=Object.keys(Rt.options.modes).reduce(function(ce,Xe){return ce[Xe]=ba(Rt.options.modes[Xe]),ce},{}),ve={},Ce={},Ae={},Ie=null,dr=null;Ae.drag=function(ce,Xe){Xe({point:ce.point,time:new Date().getTime()})?(Rt.ui.queueMapClasses({mouse:yt.DRAG}),dr.drag(ce)):ce.originalEvent.stopPropagation()},Ae.mousedrag=function(ce){Ae.drag(ce,function(Xe){return!xn(ve,Xe)})},Ae.touchdrag=function(ce){Ae.drag(ce,function(Xe){return!pi(Ce,Xe)})},Ae.mousemove=function(ce){if((ce.originalEvent.buttons!==void 0?ce.originalEvent.buttons:ce.originalEvent.which)===1)return Ae.mousedrag(ce);var Xe=Er(ce,Rt);ce.featureTarget=Xe,dr.mousemove(ce)},Ae.mousedown=function(ce){ve={time:new Date().getTime(),point:ce.point};var Xe=Er(ce,Rt);ce.featureTarget=Xe,dr.mousedown(ce)},Ae.mouseup=function(ce){var Xe=Er(ce,Rt);ce.featureTarget=Xe,xn(ve,{point:ce.point,time:new Date().getTime()})?dr.click(ce):dr.mouseup(ce)},Ae.mouseout=function(ce){dr.mouseout(ce)},Ae.touchstart=function(ce){if(Rt.options.touchEnabled){Ce={time:new Date().getTime(),point:ce.point};var Xe=de.touch(ce,null,Rt)[0];ce.featureTarget=Xe,dr.touchstart(ce)}},Ae.touchmove=function(ce){if(Rt.options.touchEnabled)return dr.touchmove(ce),Ae.touchdrag(ce)},Ae.touchend=function(ce){if(ce.originalEvent.preventDefault(),Rt.options.touchEnabled){var Xe=de.touch(ce,null,Rt)[0];ce.featureTarget=Xe,pi(Ce,{time:new Date().getTime(),point:ce.point})?dr.tap(ce):dr.touchend(ce)}};var ri=function(ce){return!(ce===8||ce===46||ce>=48&&ce<=57)};function fr(ce,Xe,cn){cn===void 0&&(cn={}),dr.stop();var wn=fe[ce];if(wn===void 0)throw new Error(ce+" is not valid");Ie=ce;var Qn=wn(Rt,Xe);dr=u(Qn,Rt),cn.silent||Rt.map.fire(qt.MODE_CHANGE,{mode:ce}),Rt.store.setDirty(),Rt.store.render()}Ae.keydown=function(ce){(ce.srcElement||ce.target).classList.contains("mapboxgl-canvas")&&(ce.keyCode!==8&&ce.keyCode!==46||!Rt.options.controls.trash?ri(ce.keyCode)?dr.keydown(ce):ce.keyCode===49&&Rt.options.controls.point?fr(Pt.DRAW_POINT):ce.keyCode===50&&Rt.options.controls.line_string?fr(Pt.DRAW_LINE_STRING):ce.keyCode===51&&Rt.options.controls.polygon&&fr(Pt.DRAW_POLYGON):(ce.preventDefault(),dr.trash()))},Ae.keyup=function(ce){ri(ce.keyCode)&&dr.keyup(ce)},Ae.zoomend=function(){Rt.store.changeZoom()},Ae.data=function(ce){if(ce.dataType==="style"){var Xe=Rt.setup,cn=Rt.map,wn=Rt.options,Qn=Rt.store;wn.styles.some(function(ni){return cn.getLayer(ni.id)})||(Xe.addLayers(),Qn.setDirty(),Qn.render())}};var Mi={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Ie=Rt.options.defaultMode,dr=u(fe[Ie](Rt),Rt)},changeMode:fr,actionable:function(ce){var Xe=!1;Object.keys(ce).forEach(function(cn){if(Mi[cn]===void 0)throw new Error("Invalid action type");Mi[cn]!==ce[cn]&&(Xe=!0),Mi[cn]=ce[cn]}),Xe&&Rt.map.fire(qt.ACTIONABLE,{actions:Mi})},currentModeName:function(){return Ie},currentModeRender:function(ce,Xe){return dr.render(ce,Xe)},fire:function(ce,Xe){Ae[ce]&&Ae[ce](Xe)},addEventListeners:function(){Rt.map.on("mousemove",Ae.mousemove),Rt.map.on("mousedown",Ae.mousedown),Rt.map.on("mouseup",Ae.mouseup),Rt.map.on("data",Ae.data),Rt.map.on("touchmove",Ae.touchmove),Rt.map.on("touchstart",Ae.touchstart),Rt.map.on("touchend",Ae.touchend),Rt.container.addEventListener("mouseout",Ae.mouseout),Rt.options.keybindings&&(Rt.container.addEventListener("keydown",Ae.keydown),Rt.container.addEventListener("keyup",Ae.keyup))},removeEventListeners:function(){Rt.map.off("mousemove",Ae.mousemove),Rt.map.off("mousedown",Ae.mousedown),Rt.map.off("mouseup",Ae.mouseup),Rt.map.off("data",Ae.data),Rt.map.off("touchmove",Ae.touchmove),Rt.map.off("touchstart",Ae.touchstart),Rt.map.off("touchend",Ae.touchend),Rt.container.removeEventListener("mouseout",Ae.mouseout),Rt.options.keybindings&&(Rt.container.removeEventListener("keydown",Ae.keydown),Rt.container.removeEventListener("keyup",Ae.keyup))},trash:function(ce){dr.trash(ce)},combineFeatures:function(){dr.combineFeatures()},uncombineFeatures:function(){dr.uncombineFeatures()},getMode:function(){return Ie}}}(D),D.ui=function(Rt){var fe={},ve=null,Ce={mode:null,feature:null,mouse:null},Ae={mode:null,feature:null,mouse:null};function Ie(ce){Ae=_t(Ae,ce)}function dr(){var ce,Xe;if(Rt.container){var cn=[],wn=[];Vn.forEach(function(Qn){Ae[Qn]!==Ce[Qn]&&(cn.push(Qn+"-"+Ce[Qn]),Ae[Qn]!==null&&wn.push(Qn+"-"+Ae[Qn]))}),cn.length>0&&(ce=Rt.container.classList).remove.apply(ce,cn),wn.length>0&&(Xe=Rt.container.classList).add.apply(Xe,wn),Ce=_t(Ce,Ae)}}function ri(ce,Xe){Xe===void 0&&(Xe={});var cn=document.createElement("button");return cn.className=at.CONTROL_BUTTON+" "+Xe.className,cn.setAttribute("title",Xe.title),Xe.container.appendChild(cn),cn.addEventListener("click",function(wn){if(wn.preventDefault(),wn.stopPropagation(),wn.target===ve)return fr(),void Xe.onDeactivate();Mi(ce),Xe.onActivate()},!0),cn}function fr(){ve&&(ve.classList.remove(at.ACTIVE_BUTTON),ve=null)}function Mi(ce){fr();var Xe=fe[ce];Xe&&Xe&&ce!=="trash"&&(Xe.classList.add(at.ACTIVE_BUTTON),ve=Xe)}return{setActiveButton:Mi,queueMapClasses:Ie,updateMapClasses:dr,clearMapClasses:function(){Ie({mode:null,feature:null,mouse:null}),dr()},addButtons:function(){var ce=Rt.options.controls,Xe=document.createElement("div");return Xe.className=at.CONTROL_GROUP+" "+at.CONTROL_BASE,ce&&(ce[xt.LINE]&&(fe[xt.LINE]=ri(xt.LINE,{container:Xe,className:at.CONTROL_BUTTON_LINE,title:"LineString tool "+(Rt.options.keybindings?"(l)":""),onActivate:function(){return Rt.events.changeMode(Pt.DRAW_LINE_STRING)},onDeactivate:function(){return Rt.events.trash()}})),ce[xt.POLYGON]&&(fe[xt.POLYGON]=ri(xt.POLYGON,{container:Xe,className:at.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Rt.options.keybindings?"(p)":""),onActivate:function(){return Rt.events.changeMode(Pt.DRAW_POLYGON)},onDeactivate:function(){return Rt.events.trash()}})),ce[xt.POINT]&&(fe[xt.POINT]=ri(xt.POINT,{container:Xe,className:at.CONTROL_BUTTON_POINT,title:"Marker tool "+(Rt.options.keybindings?"(m)":""),onActivate:function(){return Rt.events.changeMode(Pt.DRAW_POINT)},onDeactivate:function(){return Rt.events.trash()}})),ce.trash&&(fe.trash=ri("trash",{container:Xe,className:at.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Rt.events.trash()}})),ce.combine_features&&(fe.combine_features=ri("combineFeatures",{container:Xe,className:at.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Rt.events.combineFeatures()}})),ce.uncombine_features&&(fe.uncombine_features=ri("uncombineFeatures",{container:Xe,className:at.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Rt.events.uncombineFeatures()}}))),Xe},removeButtons:function(){Object.keys(fe).forEach(function(ce){var Xe=fe[ce];Xe.parentNode&&Xe.parentNode.removeChild(Xe),delete fe[ce]})}}}(D),D.container=At.getContainer(),D.store=new Zr(D),U=D.ui.addButtons(),D.options.boxSelect&&(D.boxZoomInitial=At.boxZoom.isEnabled(),At.boxZoom.disable(),At.dragPan.disable(),At.dragPan.enable()),At.loaded()?vt.connect():(At.on("load",vt.connect),ct=setInterval(function(){At.loaded()&&vt.connect()},16)),D.events.start(),U},addLayers:function(){D.map.addSource(st.COLD,{data:{type:It.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.map.addSource(st.HOT,{data:{type:It.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.options.styles.forEach(function(At){D.map.addLayer(At)}),D.store.setDirty(!0),D.store.render()},removeLayers:function(){D.options.styles.forEach(function(At){D.map.getLayer(At.id)&&D.map.removeLayer(At.id)}),D.map.getSource(st.COLD)&&D.map.removeSource(st.COLD),D.map.getSource(st.HOT)&&D.map.removeSource(st.HOT)}};return D.setup=vt,vt}var ar=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Ze(D){return function(U){var ct=U.featureTarget;return!!ct&&!!ct.properties&&ct.properties.meta===D}}function ji(D){return!!D.originalEvent&&!!D.originalEvent.shiftKey&&D.originalEvent.button===0}function ho(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===le.ACTIVE&&D.featureTarget.properties.meta===se.FEATURE}function Zi(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===le.INACTIVE&&D.featureTarget.properties.meta===se.FEATURE}function ia(D){return D.featureTarget===void 0}function us(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.meta===se.FEATURE}function Xi(D){var U=D.featureTarget;return!!U&&!!U.properties&&U.properties.meta===se.VERTEX}function Do(D){return!!D.originalEvent&&D.originalEvent.shiftKey===!0}function Ot(D){return D.keyCode===27}function Pi(D){return D.keyCode===13}var Cr=Object.freeze({__proto__:null,isOfMetaType:Ze,isShiftMousedown:ji,isActiveFeature:ho,isInactiveFeature:Zi,noTarget:ia,isFeature:us,isVertex:Xi,isShiftDown:Do,isEscapeKey:Ot,isEnterKey:Pi,isTrue:function(){return!0}}),cs=Ai;function Ai(D,U){this.x=D,this.y=U}Ai.prototype={clone:function(){return new Ai(this.x,this.y)},add:function(D){return this.clone()._add(D)},sub:function(D){return this.clone()._sub(D)},multByPoint:function(D){return this.clone()._multByPoint(D)},divByPoint:function(D){return this.clone()._divByPoint(D)},mult:function(D){return this.clone()._mult(D)},div:function(D){return this.clone()._div(D)},rotate:function(D){return this.clone()._rotate(D)},rotateAround:function(D,U){return this.clone()._rotateAround(D,U)},matMult:function(D){return this.clone()._matMult(D)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(D){return this.x===D.x&&this.y===D.y},dist:function(D){return Math.sqrt(this.distSqr(D))},distSqr:function(D){var U=D.x-this.x,ct=D.y-this.y;return U*U+ct*ct},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(D){return Math.atan2(this.y-D.y,this.x-D.x)},angleWith:function(D){return this.angleWithSep(D.x,D.y)},angleWithSep:function(D,U){return Math.atan2(this.x*U-this.y*D,this.x*D+this.y*U)},_matMult:function(D){var U=D[0]*this.x+D[1]*this.y,ct=D[2]*this.x+D[3]*this.y;return this.x=U,this.y=ct,this},_add:function(D){return this.x+=D.x,this.y+=D.y,this},_sub:function(D){return this.x-=D.x,this.y-=D.y,this},_mult:function(D){return this.x*=D,this.y*=D,this},_div:function(D){return this.x/=D,this.y/=D,this},_multByPoint:function(D){return this.x*=D.x,this.y*=D.y,this},_divByPoint:function(D){return this.x/=D.x,this.y/=D.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var D=this.y;return this.y=this.x,this.x=-D,this},_rotate:function(D){var U=Math.cos(D),ct=Math.sin(D),vt=U*this.x-ct*this.y,At=ct*this.x+U*this.y;return this.x=vt,this.y=At,this},_rotateAround:function(D,U){var ct=Math.cos(D),vt=Math.sin(D),At=U.x+ct*(this.x-U.x)-vt*(this.y-U.y),Lt=U.y+vt*(this.x-U.x)+ct*(this.y-U.y);return this.x=At,this.y=Lt,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ai.convert=function(D){return D instanceof Ai?D:Array.isArray(D)?new Ai(D[0],D[1]):D};var Nt=d(cs);function Se(D,U){var ct=U.getBoundingClientRect();return new Nt(D.clientX-ct.left-(U.clientLeft||0),D.clientY-ct.top-(U.clientTop||0))}function ge(D,U,ct,vt){return{type:It.FEATURE,properties:{meta:se.VERTEX,parent:D,coord_path:ct,active:vt?le.ACTIVE:le.INACTIVE},geometry:{type:It.POINT,coordinates:U}}}function bn(D,U,ct){var vt=U.geometry.coordinates,At=ct.geometry.coordinates;if(vt[1]>85||vt[1]<ke||At[1]>85||At[1]<ke)return null;var Lt={lng:(vt[0]+At[0])/2,lat:(vt[1]+At[1])/2};return{type:It.FEATURE,properties:{meta:se.MIDPOINT,parent:D,lng:Lt.lng,lat:Lt.lat,coord_path:ct.properties.coord_path},geometry:{type:It.POINT,coordinates:[Lt.lng,Lt.lat]}}}function Li(D,U,ct){U===void 0&&(U={}),ct===void 0&&(ct=null);var vt,At=D.geometry,Lt=At.type,Rt=At.coordinates,fe=D.properties&&D.properties.id,ve=[];function Ce(Ie,dr){var ri="",fr=null;Ie.forEach(function(Mi,ce){var Xe=dr!=null?dr+"."+ce:String(ce),cn=ge(fe,Mi,Xe,Ae(Xe));if(U.midpoints&&fr){var wn=bn(fe,fr,cn);wn&&ve.push(wn)}fr=cn;var Qn=JSON.stringify(Mi);ri!==Qn&&ve.push(cn),ce===0&&(ri=Qn)})}function Ae(Ie){return!!U.selectedPaths&&U.selectedPaths.indexOf(Ie)!==-1}return Lt===It.POINT?ve.push(ge(fe,Rt,ct,Ae(ct))):Lt===It.POLYGON?Rt.forEach(function(Ie,dr){Ce(Ie,ct!==null?ct+"."+dr:String(dr))}):Lt===It.LINE_STRING?Ce(Rt,ct):Lt.indexOf(It.MULTI_PREFIX)===0&&(vt=Lt.replace(It.MULTI_PREFIX,""),Rt.forEach(function(Ie,dr){var ri={type:It.FEATURE,properties:D.properties,geometry:{type:vt,coordinates:Ie}};ve=ve.concat(Li(ri,U,dr))})),ve}var ye={enable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D._ctx&&D._ctx.store&&D._ctx.store.getInitialConfigValue&&D._ctx.store.getInitialConfigValue("doubleClickZoom")&&D.map.doubleClickZoom.enable()},0)},disable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D.map.doubleClickZoom.disable()},0)}},Gi={exports:{}},X=function(D){if(!D||!D.type)return null;var U=k[D.type];if(!U)return null;if(U==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:D}]};if(U==="feature")return{type:"FeatureCollection",features:[D]};if(U==="featurecollection")return D},k={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},O=d(X),j=Object.freeze({__proto__:null,default:function D(U){switch(U&&U.type||null){case"FeatureCollection":return U.features=U.features.reduce(function(ct,vt){return ct.concat(D(vt))},[]),U;case"Feature":return U.geometry?D(U.geometry).map(function(ct){var vt={type:"Feature",properties:JSON.parse(JSON.stringify(U.properties)),geometry:ct};return U.id!==void 0&&(vt.id=U.id),vt}):[U];case"MultiPoint":return U.coordinates.map(function(ct){return{type:"Point",coordinates:ct}});case"MultiPolygon":return U.coordinates.map(function(ct){return{type:"Polygon",coordinates:ct}});case"MultiLineString":return U.coordinates.map(function(ct){return{type:"LineString",coordinates:ct}});case"GeometryCollection":return U.geometries.map(D).reduce(function(ct,vt){return ct.concat(vt)},[]);case"Point":case"Polygon":case"LineString":return[U]}}}),Y=X,J=_(j),ht=function(D){return function U(ct){return Array.isArray(ct)&&ct.length&&typeof ct[0]=="number"?[ct]:ct.reduce(function(vt,At){return Array.isArray(At)&&Array.isArray(At[0])?vt.concat(U(At)):(vt.push(At),vt)},[])}(D)};J instanceof Function||(J=J.default);var nt={exports:{}},tt=nt.exports=function(D){return new it(D)};function it(D){this.value=D}function bt(D,U,ct){var vt=[],At=[],Lt=!0;return function Rt(fe){var ve=ct?wt(fe):fe,Ce={},Ae=!0,Ie={node:ve,node_:fe,path:[].concat(vt),parent:At[At.length-1],parents:At,key:vt.slice(-1)[0],isRoot:vt.length===0,level:vt.length,circular:null,update:function(fr,Mi){Ie.isRoot||(Ie.parent.node[Ie.key]=fr),Ie.node=fr,Mi&&(Ae=!1)},delete:function(fr){delete Ie.parent.node[Ie.key],fr&&(Ae=!1)},remove:function(fr){me(Ie.parent.node)?Ie.parent.node.splice(Ie.key,1):delete Ie.parent.node[Ie.key],fr&&(Ae=!1)},keys:null,before:function(fr){Ce.before=fr},after:function(fr){Ce.after=fr},pre:function(fr){Ce.pre=fr},post:function(fr){Ce.post=fr},stop:function(){Lt=!1},block:function(){Ae=!1}};if(!Lt)return Ie;function dr(){if(typeof Ie.node=="object"&&Ie.node!==null){Ie.keys&&Ie.node_===Ie.node||(Ie.keys=Tt(Ie.node)),Ie.isLeaf=Ie.keys.length==0;for(var fr=0;fr<At.length;fr++)if(At[fr].node_===fe){Ie.circular=At[fr];break}}else Ie.isLeaf=!0,Ie.keys=null;Ie.notLeaf=!Ie.isLeaf,Ie.notRoot=!Ie.isRoot}dr();var ri=U.call(Ie,Ie.node);return ri!==void 0&&Ie.update&&Ie.update(ri),Ce.before&&Ce.before.call(Ie,Ie.node),Ae&&(typeof Ie.node!="object"||Ie.node===null||Ie.circular||(At.push(Ie),dr(),Kt(Ie.keys,function(fr,Mi){vt.push(fr),Ce.pre&&Ce.pre.call(Ie,Ie.node[fr],fr);var ce=Rt(Ie.node[fr]);ct&&ae.call(Ie.node,fr)&&(Ie.node[fr]=ce.node),ce.isLast=Mi==Ie.keys.length-1,ce.isFirst=Mi==0,Ce.post&&Ce.post.call(Ie,ce),vt.pop()}),At.pop()),Ce.after&&Ce.after.call(Ie,Ie.node)),Ie}(D).node}function wt(D){if(typeof D=="object"&&D!==null){var U;if(me(D))U=[];else if(oe(D)==="[object Date]")U=new Date(D.getTime?D.getTime():D);else if(function(At){return oe(At)==="[object RegExp]"}(D))U=new RegExp(D);else if(function(At){return oe(At)==="[object Error]"}(D))U={message:D.message};else if(function(At){return oe(At)==="[object Boolean]"}(D))U=new Boolean(D);else if(function(At){return oe(At)==="[object Number]"}(D))U=new Number(D);else if(function(At){return oe(At)==="[object String]"}(D))U=new String(D);else if(Object.create&&Object.getPrototypeOf)U=Object.create(Object.getPrototypeOf(D));else if(D.constructor===Object)U={};else{var ct=D.constructor&&D.constructor.prototype||D.__proto__||{},vt=function(){};vt.prototype=ct,U=new vt}return Kt(Tt(D),function(At){U[At]=D[At]}),U}return D}it.prototype.get=function(D){for(var U=this.value,ct=0;ct<D.length;ct++){var vt=D[ct];if(!U||!ae.call(U,vt)){U=void 0;break}U=U[vt]}return U},it.prototype.has=function(D){for(var U=this.value,ct=0;ct<D.length;ct++){var vt=D[ct];if(!U||!ae.call(U,vt))return!1;U=U[vt]}return!0},it.prototype.set=function(D,U){for(var ct=this.value,vt=0;vt<D.length-1;vt++){var At=D[vt];ae.call(ct,At)||(ct[At]={}),ct=ct[At]}return ct[D[vt]]=U,U},it.prototype.map=function(D){return bt(this.value,D,!0)},it.prototype.forEach=function(D){return this.value=bt(this.value,D,!1),this.value},it.prototype.reduce=function(D,U){var ct=arguments.length===1,vt=ct?this.value:U;return this.forEach(function(At){this.isRoot&&ct||(vt=D.call(this,vt,At))}),vt},it.prototype.paths=function(){var D=[];return this.forEach(function(U){D.push(this.path)}),D},it.prototype.nodes=function(){var D=[];return this.forEach(function(U){D.push(this.node)}),D},it.prototype.clone=function(){var D=[],U=[];return function ct(vt){for(var At=0;At<D.length;At++)if(D[At]===vt)return U[At];if(typeof vt=="object"&&vt!==null){var Lt=wt(vt);return D.push(vt),U.push(Lt),Kt(Tt(vt),function(Rt){Lt[Rt]=ct(vt[Rt])}),D.pop(),U.pop(),Lt}return vt}(this.value)};var Tt=Object.keys||function(D){var U=[];for(var ct in D)U.push(ct);return U};function oe(D){return Object.prototype.toString.call(D)}var me=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"},Kt=function(D,U){if(D.forEach)return D.forEach(U);for(var ct=0;ct<D.length;ct++)U(D[ct],ct,D)};Kt(Tt(it.prototype),function(D){tt[D]=function(U){var ct=[].slice.call(arguments,1),vt=new it(U);return vt[D].apply(vt,ct)}});var ae=Object.hasOwnProperty||function(D,U){return U in D},xe=nt.exports,We=qe;function qe(D){if(!(this instanceof qe))return new qe(D);this._bbox=D||[1/0,1/0,-1/0,-1/0],this._valid=!!D}qe.prototype.include=function(D){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],D[0]),this._bbox[1]=Math.min(this._bbox[1],D[1]),this._bbox[2]=Math.max(this._bbox[2],D[0]),this._bbox[3]=Math.max(this._bbox[3],D[1]),this},qe.prototype.equals=function(D){var U;return U=D instanceof qe?D.bbox():D,this._bbox[0]==U[0]&&this._bbox[1]==U[1]&&this._bbox[2]==U[2]&&this._bbox[3]==U[3]},qe.prototype.center=function(D){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},qe.prototype.union=function(D){var U;return this._valid=!0,U=D instanceof qe?D.bbox():D,this._bbox[0]=Math.min(this._bbox[0],U[0]),this._bbox[1]=Math.min(this._bbox[1],U[1]),this._bbox[2]=Math.max(this._bbox[2],U[2]),this._bbox[3]=Math.max(this._bbox[3],U[3]),this},qe.prototype.bbox=function(){return this._valid?this._bbox:null},qe.prototype.contains=function(D){if(!D)return this._fastContains();if(!this._valid)return null;var U=D[0],ct=D[1];return this._bbox[0]<=U&&this._bbox[1]<=ct&&this._bbox[2]>=U&&this._bbox[3]>=ct},qe.prototype.intersect=function(D){return this._valid?(U=D instanceof qe?D.bbox():D,!(this._bbox[0]>U[2]||this._bbox[2]<U[0]||this._bbox[3]<U[1]||this._bbox[1]>U[3])):null;var U},qe.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var D="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",D)},qe.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var $e=function(D){if(!D)return[];var U=J(Y(D)),ct=[];return U.features.forEach(function(vt){vt.geometry&&(ct=ct.concat(ht(vt.geometry.coordinates)))}),ct},Ge=xe,mn=We,hr={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Vr=Object.keys(hr);function Kr(D){for(var U=mn(),ct=$e(D),vt=0;vt<ct.length;vt++)U.include(ct[vt]);return U}Gi.exports=function(D){return Kr(D).bbox()},Gi.exports.polygon=function(D){return Kr(D).polygon()},Gi.exports.bboxify=function(D){return Ge(D).map(function(U){U&&Vr.some(function(ct){return!!U[ct]&&hr[ct].indexOf(U.type)!==-1})&&(U.bbox=Kr(U).bbox(),this.update(U))})};var mi=d(Gi.exports),Ul=-90;function hs(D,U){var ct=Ul,vt=90,At=Ul,Lt=90,Rt=270,fe=-270;D.forEach(function(Ce){var Ae=mi(Ce),Ie=Ae[1],dr=Ae[3],ri=Ae[0],fr=Ae[2];Ie>ct&&(ct=Ie),dr<vt&&(vt=dr),dr>At&&(At=dr),Ie<Lt&&(Lt=Ie),ri<Rt&&(Rt=ri),fr>fe&&(fe=fr)});var ve=U;return ct+ve.lat>85&&(ve.lat=85-ct),At+ve.lat>90&&(ve.lat=90-At),vt+ve.lat<-85&&(ve.lat=-85-vt),Lt+ve.lat<Ul&&(ve.lat=Ul-Lt),Rt+ve.lng<=-270&&(ve.lng+=360*Math.ceil(Math.abs(ve.lng)/360)),fe+ve.lng>=270&&(ve.lng-=360*Math.ceil(Math.abs(ve.lng)/360)),ve}function ps(D,U){var ct=hs(D.map(function(vt){return vt.toGeoJSON()}),U);D.forEach(function(vt){var At,Lt=vt.getCoordinates(),Rt=function(ve){var Ce={lng:ve[0]+ct.lng,lat:ve[1]+ct.lat};return[Ce.lng,Ce.lat]},fe=function(ve){return ve.map(function(Ce){return Rt(Ce)})};vt.type===It.POINT?At=Rt(Lt):vt.type===It.LINE_STRING||vt.type===It.MULTI_POINT?At=Lt.map(Rt):vt.type===It.POLYGON||vt.type===It.MULTI_LINE_STRING?At=Lt.map(fe):vt.type===It.MULTI_POLYGON&&(At=Lt.map(function(ve){return ve.map(function(Ce){return fe(Ce)})})),vt.incomingCoords(At)})}var Hi={onSetup:function(D){var U=this,ct={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:D.featureIds||[]};return this.setSelected(ct.initiallySelectedFeatureIds.filter(function(vt){return U.getFeature(vt)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),ct},fireUpdate:function(){this.map.fire(qt.UPDATE,{action:Qt.MOVE,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(){var D=this,U=this.getSelected(),ct=U.filter(function(fe){return D.isInstanceOf("MultiFeature",fe)}),vt=!1;if(U.length>1){vt=!0;var At=U[0].type.replace("Multi","");U.forEach(function(fe){fe.type.replace("Multi","")!==At&&(vt=!1)})}var Lt=ct.length>0,Rt=U.length>0;this.setActionableState({combineFeatures:vt,uncombineFeatures:Lt,trash:Rt})},getUniqueIds:function(D){return D.length?D.map(function(U){return U.properties.id}).filter(function(U){return U!==void 0}).reduce(function(U,ct){return U.add(ct),U},new nr).values():[]},stopExtendedInteractions:function(D){D.boxSelectElement&&(D.boxSelectElement.parentNode&&D.boxSelectElement.parentNode.removeChild(D.boxSelectElement),D.boxSelectElement=null),this.map.dragPan.enable(),D.boxSelecting=!1,D.canBoxSelect=!1,D.dragMoving=!1,D.canDragMove=!1},onStop:function(){ye.enable(this)},onMouseMove:function(D,U){return us(U)&&D.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(D),!0},onMouseOut:function(D){return!D.dragMoving||this.fireUpdate()}};Hi.onTap=Hi.onClick=function(D,U){return ia(U)?this.clickAnywhere(D,U):Ze(se.VERTEX)(U)?this.clickOnVertex(D,U):us(U)?this.clickOnFeature(D,U):void 0},Hi.clickAnywhere=function(D){var U=this,ct=this.getSelectedIds();ct.length&&(this.clearSelectedFeatures(),ct.forEach(function(vt){return U.doRender(vt)})),ye.enable(this),this.stopExtendedInteractions(D)},Hi.clickOnVertex=function(D,U){this.changeMode(Pt.DIRECT_SELECT,{featureId:U.featureTarget.properties.parent,coordPath:U.featureTarget.properties.coord_path,startPos:U.lngLat}),this.updateUIClasses({mouse:yt.MOVE})},Hi.startOnActiveFeature=function(D,U){this.stopExtendedInteractions(D),this.map.dragPan.disable(),this.doRender(U.featureTarget.properties.id),D.canDragMove=!0,D.dragMoveLocation=U.lngLat},Hi.clickOnFeature=function(D,U){var ct=this;ye.disable(this),this.stopExtendedInteractions(D);var vt=Do(U),At=this.getSelectedIds(),Lt=U.featureTarget.properties.id,Rt=this.isSelected(Lt);if(!vt&&Rt&&this.getFeature(Lt).type!==It.POINT)return this.changeMode(Pt.DIRECT_SELECT,{featureId:Lt});Rt&&vt?(this.deselect(Lt),this.updateUIClasses({mouse:yt.POINTER}),At.length===1&&ye.enable(this)):!Rt&&vt?(this.select(Lt),this.updateUIClasses({mouse:yt.MOVE})):Rt||vt||(At.forEach(function(fe){return ct.doRender(fe)}),this.setSelected(Lt),this.updateUIClasses({mouse:yt.MOVE})),this.doRender(Lt)},Hi.onMouseDown=function(D,U){return ho(U)?this.startOnActiveFeature(D,U):this.drawConfig.boxSelect&&ji(U)?this.startBoxSelect(D,U):void 0},Hi.startBoxSelect=function(D,U){this.stopExtendedInteractions(D),this.map.dragPan.disable(),D.boxSelectStartLocation=Se(U.originalEvent,this.map.getContainer()),D.canBoxSelect=!0},Hi.onTouchStart=function(D,U){if(ho(U))return this.startOnActiveFeature(D,U)},Hi.onDrag=function(D,U){return D.canDragMove?this.dragMove(D,U):this.drawConfig.boxSelect&&D.canBoxSelect?this.whileBoxSelect(D,U):void 0},Hi.whileBoxSelect=function(D,U){D.boxSelecting=!0,this.updateUIClasses({mouse:yt.ADD}),D.boxSelectElement||(D.boxSelectElement=document.createElement("div"),D.boxSelectElement.classList.add(at.BOX_SELECT),this.map.getContainer().appendChild(D.boxSelectElement));var ct=Se(U.originalEvent,this.map.getContainer()),vt=Math.min(D.boxSelectStartLocation.x,ct.x),At=Math.max(D.boxSelectStartLocation.x,ct.x),Lt=Math.min(D.boxSelectStartLocation.y,ct.y),Rt=Math.max(D.boxSelectStartLocation.y,ct.y),fe="translate("+vt+"px, "+Lt+"px)";D.boxSelectElement.style.transform=fe,D.boxSelectElement.style.WebkitTransform=fe,D.boxSelectElement.style.width=At-vt+"px",D.boxSelectElement.style.height=Rt-Lt+"px"},Hi.dragMove=function(D,U){D.dragMoving=!0,U.originalEvent.stopPropagation();var ct={lng:U.lngLat.lng-D.dragMoveLocation.lng,lat:U.lngLat.lat-D.dragMoveLocation.lat};ps(this.getSelected(),ct),D.dragMoveLocation=U.lngLat},Hi.onTouchEnd=Hi.onMouseUp=function(D,U){var ct=this;if(D.dragMoving)this.fireUpdate();else if(D.boxSelecting){var vt=[D.boxSelectStartLocation,Se(U.originalEvent,this.map.getContainer())],At=this.featuresAt(null,vt,"click"),Lt=this.getUniqueIds(At).filter(function(Rt){return!ct.isSelected(Rt)});Lt.length&&(this.select(Lt),Lt.forEach(function(Rt){return ct.doRender(Rt)}),this.updateUIClasses({mouse:yt.MOVE}))}this.stopExtendedInteractions(D)},Hi.toDisplayFeatures=function(D,U,ct){U.properties.active=this.isSelected(U.properties.id)?le.ACTIVE:le.INACTIVE,ct(U),this.fireActionable(),U.properties.active===le.ACTIVE&&U.geometry.type!==It.POINT&&Li(U).forEach(ct)},Hi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Hi.onCombineFeatures=function(){var D=this.getSelected();if(!(D.length===0||D.length<2)){for(var U=[],ct=[],vt=D[0].type.replace("Multi",""),At=0;At<D.length;At++){var Lt=D[At];if(Lt.type.replace("Multi","")!==vt)return;Lt.type.includes("Multi")?Lt.getCoordinates().forEach(function(fe){U.push(fe)}):U.push(Lt.getCoordinates()),ct.push(Lt.toGeoJSON())}if(ct.length>1){var Rt=this.newFeature({type:It.FEATURE,properties:ct[0].properties,geometry:{type:"Multi"+vt,coordinates:U}});this.addFeature(Rt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Rt.id]),this.map.fire(qt.COMBINE_FEATURES,{createdFeatures:[Rt.toGeoJSON()],deletedFeatures:ct})}this.fireActionable()}},Hi.onUncombineFeatures=function(){var D=this,U=this.getSelected();if(U.length!==0){for(var ct=[],vt=[],At=function(Rt){var fe=U[Rt];D.isInstanceOf("MultiFeature",fe)&&(fe.getFeatures().forEach(function(ve){D.addFeature(ve),ve.properties=fe.properties,ct.push(ve.toGeoJSON()),D.select([ve.id])}),D.deleteFeature(fe.id,{silent:!0}),vt.push(fe.toGeoJSON()))},Lt=0;Lt<U.length;Lt++)At(Lt);ct.length>1&&this.map.fire(qt.UNCOMBINE_FEATURES,{createdFeatures:ct,deletedFeatures:vt}),this.fireActionable()}};var tr=Ze(se.VERTEX),jl=Ze(se.MIDPOINT),ts={fireUpdate:function(){this.map.fire(qt.UPDATE,{action:Qt.CHANGE_COORDINATES,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(D){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:D.selectedCoordPaths.length>0})},startDragging:function(D,U){this.map.dragPan.disable(),D.canDragMove=!0,D.dragMoveLocation=U.lngLat},stopDragging:function(D){this.map.dragPan.enable(),D.dragMoving=!1,D.canDragMove=!1,D.dragMoveLocation=null},onVertex:function(D,U){this.startDragging(D,U);var ct=U.featureTarget.properties,vt=D.selectedCoordPaths.indexOf(ct.coord_path);Do(U)||vt!==-1?Do(U)&&vt===-1&&D.selectedCoordPaths.push(ct.coord_path):D.selectedCoordPaths=[ct.coord_path];var At=this.pathsToCoordinates(D.featureId,D.selectedCoordPaths);this.setSelectedCoordinates(At)},onMidpoint:function(D,U){this.startDragging(D,U);var ct=U.featureTarget.properties;D.feature.addCoordinate(ct.coord_path,ct.lng,ct.lat),this.fireUpdate(),D.selectedCoordPaths=[ct.coord_path]},pathsToCoordinates:function(D,U){return U.map(function(ct){return{feature_id:D,coord_path:ct}})},onFeature:function(D,U){D.selectedCoordPaths.length===0?this.startDragging(D,U):this.stopDragging(D)},dragFeature:function(D,U,ct){ps(this.getSelected(),ct),D.dragMoveLocation=U.lngLat},dragVertex:function(D,U,ct){for(var vt=D.selectedCoordPaths.map(function(fe){return D.feature.getCoordinate(fe)}),At=hs(vt.map(function(fe){return{type:It.FEATURE,properties:{},geometry:{type:It.POINT,coordinates:fe}}}),ct),Lt=0;Lt<vt.length;Lt++){var Rt=vt[Lt];D.feature.updateCoordinate(D.selectedCoordPaths[Lt],Rt[0]+At.lng,Rt[1]+At.lat)}},clickNoTarget:function(){this.changeMode(Pt.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Pt.SIMPLE_SELECT)},clickActiveFeature:function(D){D.selectedCoordPaths=[],this.clearSelectedCoordinates(),D.feature.changed()},onSetup:function(D){var U=D.featureId,ct=this.getFeature(U);if(!ct)throw new Error("You must provide a featureId to enter direct_select mode");if(ct.type===It.POINT)throw new TypeError("direct_select mode doesn't handle point features");var vt={featureId:U,feature:ct,dragMoveLocation:D.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:D.coordPath?[D.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(U,vt.selectedCoordPaths)),this.setSelected(U),ye.disable(this),this.setActionableState({trash:!0}),vt},onStop:function(){ye.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(D,U,ct){D.featureId===U.properties.id?(U.properties.active=le.ACTIVE,ct(U),Li(U,{map:this.map,midpoints:!0,selectedPaths:D.selectedCoordPaths}).forEach(ct)):(U.properties.active=le.INACTIVE,ct(U)),this.fireActionable(D)},onTrash:function(D){D.selectedCoordPaths.sort(function(U,ct){return ct.localeCompare(U,"en",{numeric:!0})}).forEach(function(U){return D.feature.removeCoordinate(U)}),this.fireUpdate(),D.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(D),D.feature.isValid()===!1&&(this.deleteFeature([D.featureId]),this.changeMode(Pt.SIMPLE_SELECT,{}))},onMouseMove:function(D,U){var ct=ho(U),vt=tr(U),At=jl(U),Lt=D.selectedCoordPaths.length===0;return ct&&Lt||vt&&!Lt?this.updateUIClasses({mouse:yt.MOVE}):this.updateUIClasses({mouse:yt.NONE}),(vt||ct||At)&&D.dragMoving&&this.fireUpdate(),this.stopDragging(D),!0},onMouseOut:function(D){return D.dragMoving&&this.fireUpdate(),!0}};ts.onTouchStart=ts.onMouseDown=function(D,U){return tr(U)?this.onVertex(D,U):ho(U)?this.onFeature(D,U):jl(U)?this.onMidpoint(D,U):void 0},ts.onDrag=function(D,U){if(D.canDragMove===!0){D.dragMoving=!0,U.originalEvent.stopPropagation();var ct={lng:U.lngLat.lng-D.dragMoveLocation.lng,lat:U.lngLat.lat-D.dragMoveLocation.lat};D.selectedCoordPaths.length>0?this.dragVertex(D,U,ct):this.dragFeature(D,U,ct),D.dragMoveLocation=U.lngLat}},ts.onClick=function(D,U){return ia(U)?this.clickNoTarget(D,U):ho(U)?this.clickActiveFeature(D,U):Zi(U)?this.clickInactive(D,U):void this.stopDragging(D)},ts.onTap=function(D,U){return ia(U)?this.clickNoTarget(D,U):ho(U)?this.clickActiveFeature(D,U):Zi(U)?this.clickInactive(D,U):void 0},ts.onTouchEnd=ts.onMouseUp=function(D){D.dragMoving&&this.fireUpdate(),this.stopDragging(D)};var Br={};function Rn(D,U){return!!D.lngLat&&D.lngLat.lng===U[0]&&D.lngLat.lat===U[1]}Br.onSetup=function(){var D=this.newFeature({type:It.FEATURE,properties:{},geometry:{type:It.POINT,coordinates:[]}});return this.addFeature(D),this.clearSelectedFeatures(),this.updateUIClasses({mouse:yt.ADD}),this.activateUIButton(xt.POINT),this.setActionableState({trash:!0}),{point:D}},Br.stopDrawingAndRemove=function(D){this.deleteFeature([D.point.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT)},Br.onTap=Br.onClick=function(D,U){this.updateUIClasses({mouse:yt.MOVE}),D.point.updateCoordinate("",U.lngLat.lng,U.lngLat.lat),this.map.fire(qt.CREATE,{features:[D.point.toGeoJSON()]}),this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.point.id]})},Br.onStop=function(D){this.activateUIButton(),D.point.getCoordinate().length||this.deleteFeature([D.point.id],{silent:!0})},Br.toDisplayFeatures=function(D,U,ct){var vt=U.properties.id===D.point.id;if(U.properties.active=vt?le.ACTIVE:le.INACTIVE,!vt)return ct(U)},Br.onTrash=Br.stopDrawingAndRemove,Br.onKeyUp=function(D,U){if(Ot(U)||Pi(U))return this.stopDrawingAndRemove(D,U)};var ul={onSetup:function(){var D=this.newFeature({type:It.FEATURE,properties:{},geometry:{type:It.POLYGON,coordinates:[[]]}});return this.addFeature(D),this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:yt.ADD}),this.activateUIButton(xt.POLYGON),this.setActionableState({trash:!0}),{polygon:D,currentVertexPosition:0}},clickAnywhere:function(D,U){if(D.currentVertexPosition>0&&Rn(U,D.polygon.coordinates[0][D.currentVertexPosition-1]))return this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.polygon.id]});this.updateUIClasses({mouse:yt.ADD}),D.polygon.updateCoordinate("0."+D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),D.currentVertexPosition++,D.polygon.updateCoordinate("0."+D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},onMouseMove:function(D,U){D.polygon.updateCoordinate("0."+D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),Xi(U)&&this.updateUIClasses({mouse:yt.POINTER})}};ul.onTap=ul.onClick=function(D,U){return Xi(U)?this.clickOnVertex(D,U):this.clickAnywhere(D,U)},ul.onKeyUp=function(D,U){Ot(U)?(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT)):Pi(U)&&this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},ul.onStop=function(D){this.updateUIClasses({mouse:yt.NONE}),ye.enable(this),this.activateUIButton(),this.getFeature(D.polygon.id)!==void 0&&(D.polygon.removeCoordinate("0."+D.currentVertexPosition),D.polygon.isValid()?this.map.fire(qt.CREATE,{features:[D.polygon.toGeoJSON()]}):(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT,{},{silent:!0})))},ul.toDisplayFeatures=function(D,U,ct){var vt=U.properties.id===D.polygon.id;if(U.properties.active=vt?le.ACTIVE:le.INACTIVE,!vt)return ct(U);if(U.geometry.coordinates.length!==0){var At=U.geometry.coordinates[0].length;if(!(At<3)){if(U.properties.meta=se.FEATURE,ct(ge(D.polygon.id,U.geometry.coordinates[0][0],"0.0",!1)),At>3){var Lt=U.geometry.coordinates[0].length-3;ct(ge(D.polygon.id,U.geometry.coordinates[0][Lt],"0."+Lt,!1))}if(At<=4){var Rt=[[U.geometry.coordinates[0][0][0],U.geometry.coordinates[0][0][1]],[U.geometry.coordinates[0][1][0],U.geometry.coordinates[0][1][1]]];if(ct({type:It.FEATURE,properties:U.properties,geometry:{coordinates:Rt,type:It.LINE_STRING}}),At===3)return}return ct(U)}}},ul.onTrash=function(D){this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT)};var En={onSetup:function(D){var U,ct,vt=(D=D||{}).featureId,At="forward";if(vt){if(!(U=this.getFeature(vt)))throw new Error("Could not find a feature with the provided featureId");var Lt=D.from;if(Lt&&Lt.type==="Feature"&&Lt.geometry&&Lt.geometry.type==="Point"&&(Lt=Lt.geometry),Lt&&Lt.type==="Point"&&Lt.coordinates&&Lt.coordinates.length===2&&(Lt=Lt.coordinates),!Lt||!Array.isArray(Lt))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Rt=U.coordinates.length-1;if(U.coordinates[Rt][0]===Lt[0]&&U.coordinates[Rt][1]===Lt[1])ct=Rt+1,U.addCoordinate.apply(U,[ct].concat(U.coordinates[Rt]));else{if(U.coordinates[0][0]!==Lt[0]||U.coordinates[0][1]!==Lt[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");At="backwards",ct=0,U.addCoordinate.apply(U,[ct].concat(U.coordinates[0]))}}else U=this.newFeature({type:It.FEATURE,properties:{},geometry:{type:It.LINE_STRING,coordinates:[]}}),ct=0,this.addFeature(U);return this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:yt.ADD}),this.activateUIButton(xt.LINE),this.setActionableState({trash:!0}),{line:U,currentVertexPosition:ct,direction:At}},clickAnywhere:function(D,U){if(D.currentVertexPosition>0&&Rn(U,D.line.coordinates[D.currentVertexPosition-1])||D.direction==="backwards"&&Rn(U,D.line.coordinates[D.currentVertexPosition+1]))return this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.line.id]});this.updateUIClasses({mouse:yt.ADD}),D.line.updateCoordinate(D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),D.direction==="forward"?(D.currentVertexPosition++,D.line.updateCoordinate(D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat)):D.line.addCoordinate(0,U.lngLat.lng,U.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.line.id]})},onMouseMove:function(D,U){D.line.updateCoordinate(D.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),Xi(U)&&this.updateUIClasses({mouse:yt.POINTER})}};En.onTap=En.onClick=function(D,U){if(Xi(U))return this.clickOnVertex(D,U);this.clickAnywhere(D,U)},En.onKeyUp=function(D,U){Pi(U)?this.changeMode(Pt.SIMPLE_SELECT,{featureIds:[D.line.id]}):Ot(U)&&(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT))},En.onStop=function(D){ye.enable(this),this.activateUIButton(),this.getFeature(D.line.id)!==void 0&&(D.line.removeCoordinate(""+D.currentVertexPosition),D.line.isValid()?this.map.fire(qt.CREATE,{features:[D.line.toGeoJSON()]}):(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT,{},{silent:!0})))},En.onTrash=function(D){this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Pt.SIMPLE_SELECT)},En.toDisplayFeatures=function(D,U,ct){var vt=U.properties.id===D.line.id;if(U.properties.active=vt?le.ACTIVE:le.INACTIVE,!vt)return ct(U);U.geometry.coordinates.length<2||(U.properties.meta=se.FEATURE,ct(ge(D.line.id,U.geometry.coordinates[D.direction==="forward"?U.geometry.coordinates.length-2:1],""+(D.direction==="forward"?U.geometry.coordinates.length-2:1),!1)),ct(U))};var un={simple_select:Hi,direct_select:ts,draw_point:Br,draw_polygon:ul,draw_line_string:En},cl={defaultMode:Pt.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ar,modes:un,controls:{},userProperties:!1},Ns={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},br={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function He(D,U){return D.map(function(ct){return ct.source?ct:_t(ct,{id:ct.id+"."+U,source:U==="hot"?st.HOT:st.COLD})})}var Bo={exports:{}};(function(D,U){var ct="__lodash_hash_undefined__",vt=9007199254740991,At="[object Arguments]",Lt="[object Array]",Rt="[object Boolean]",fe="[object Date]",ve="[object Error]",Ce="[object Function]",Ae="[object Map]",Ie="[object Number]",dr="[object Object]",ri="[object Promise]",fr="[object RegExp]",Mi="[object Set]",ce="[object String]",Xe="[object Symbol]",cn="[object WeakMap]",wn="[object ArrayBuffer]",Qn="[object DataView]",ni=/^\[object .+?Constructor\]$/,hl=/^(?:0|[1-9]\d*)$/,gn={};gn["[object Float32Array]"]=gn["[object Float64Array]"]=gn["[object Int8Array]"]=gn["[object Int16Array]"]=gn["[object Int32Array]"]=gn["[object Uint8Array]"]=gn["[object Uint8ClampedArray]"]=gn["[object Uint16Array]"]=gn["[object Uint32Array]"]=!0,gn[At]=gn[Lt]=gn[wn]=gn[Rt]=gn[Qn]=gn[fe]=gn[ve]=gn[Ce]=gn[Ae]=gn[Ie]=gn[dr]=gn[fr]=gn[Mi]=gn[ce]=gn[cn]=!1;var oa=typeof Jp=="object"&&Jp&&Jp.Object===Object&&Jp,pl=typeof self=="object"&&self&&self.Object===Object&&self,Yi=oa||pl||Function("return this")(),ko=U&&!U.nodeType&&U,Oe=ko&&D&&!D.nodeType&&D,Ua=Oe&&Oe.exports===ko,Un=Ua&&oa.process,ti=function(){try{return Un&&Un.binding&&Un.binding("util")}catch{}}(),ql=ti&&ti.isTypedArray;function dl(kt,Wt){for(var we=-1,rr=kt==null?0:kt.length;++we<rr;)if(Wt(kt[we],we,kt))return!0;return!1}function fl(kt){var Wt=-1,we=Array(kt.size);return kt.forEach(function(rr,jn){we[++Wt]=[jn,rr]}),we}function vu(kt){var Wt=-1,we=Array(kt.size);return kt.forEach(function(rr){we[++Wt]=rr}),we}var $l,ja,Zl,xu=Array.prototype,ml=Function.prototype,Xl=Object.prototype,bu=Yi["__core-js_shared__"],Ss=ml.toString,sa=Xl.hasOwnProperty,Mh=($l=/[^.]+$/.exec(bu&&bu.keys&&bu.keys.IE_PROTO||""))?"Symbol(src)_1."+$l:"",Dh=Xl.toString,np=RegExp("^"+Ss.call(sa).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kh=Ua?Yi.Buffer:void 0,ec=Yi.Symbol,Hl=Yi.Uint8Array,Ga=Xl.propertyIsEnumerable,wu=xu.splice,Bs=ec?ec.toStringTag:void 0,Es=Object.getOwnPropertySymbols,Ic=kh?kh.isBuffer:void 0,Cc=(ja=Object.keys,Zl=Object,function(kt){return ja(Zl(kt))}),gl=Za(Yi,"DataView"),po=Za(Yi,"Map"),Su=Za(Yi,"Promise"),fo=Za(Yi,"Set"),ds=Za(Yi,"WeakMap"),yl=Za(Object,"create"),Eu=Ta(gl),Ye=Ta(po),wr=Ta(Su),ip=Ta(fo),Be=Ta(ds),es=ec?ec.prototype:void 0,gr=es?es.valueOf:void 0;function ur(kt){var Wt=-1,we=kt==null?0:kt.length;for(this.clear();++Wt<we;){var rr=kt[Wt];this.set(rr[0],rr[1])}}function mo(kt){var Wt=-1,we=kt==null?0:kt.length;for(this.clear();++Wt<we;){var rr=kt[Wt];this.set(rr[0],rr[1])}}function wa(kt){var Wt=-1,we=kt==null?0:kt.length;for(this.clear();++Wt<we;){var rr=kt[Wt];this.set(rr[0],rr[1])}}function qa(kt){var Wt=-1,we=kt==null?0:kt.length;for(this.__data__=new wa;++Wt<we;)this.add(kt[Wt])}function rs(kt){var Wt=this.__data__=new mo(kt);this.size=Wt.size}function _l(kt,Wt){var we=ua(kt),rr=!we&&xl(kt),jn=!we&&!rr&&Tu(kt),$r=!we&&!rr&&!jn&&ca(kt),yi=we||rr||jn||$r,Di=yi?function(Mr,so){for(var Us=-1,go=Array(Mr);++Us<Mr;)go[Us]=so(Us);return go}(kt.length,String):[],Tn=Di.length;for(var Gn in kt)!Wt&&!sa.call(kt,Gn)||yi&&(Gn=="length"||jn&&(Gn=="offset"||Gn=="parent")||$r&&(Gn=="buffer"||Gn=="byteLength"||Gn=="byteOffset")||Pc(Gn,Tn))||Di.push(Gn);return Di}function $a(kt,Wt){for(var we=kt.length;we--;)if(la(kt[we][0],Wt))return we;return-1}function Vs(kt){return kt==null?kt===void 0?"[object Undefined]":"[object Null]":Bs&&Bs in Object(kt)?function(Wt){var we=sa.call(Wt,Bs),rr=Wt[Bs];try{Wt[Bs]=void 0;var jn=!0}catch{}var $r=Dh.call(Wt);return jn&&(we?Wt[Bs]=rr:delete Wt[Bs]),$r}(kt):function(Wt){return Dh.call(Wt)}(kt)}function Yl(kt){return Uo(kt)&&Vs(kt)==At}function aa(kt,Wt,we,rr,jn){return kt===Wt||(kt==null||Wt==null||!Uo(kt)&&!Uo(Wt)?kt!=kt&&Wt!=Wt:function($r,yi,Di,Tn,Gn,Mr){var so=ua($r),Us=ua(yi),go=so?Lt:Ts($r),js=Us?Lt:Ts(yi),ki=(go=go==At?dr:go)==dr,Jl=(js=js==At?dr:js)==dr,Fn=go==js;if(Fn&&Tu($r)){if(!Tu(yi))return!1;so=!0,ki=!1}if(Fn&&!ki)return Mr||(Mr=new rs),so||ca($r)?zh($r,yi,Di,Tn,Gn,Mr):function(qn,hn,Kl,is,fs,Nn,Ht){switch(Kl){case Qn:if(qn.byteLength!=hn.byteLength||qn.byteOffset!=hn.byteOffset)return!1;qn=qn.buffer,hn=hn.buffer;case wn:return!(qn.byteLength!=hn.byteLength||!Nn(new Hl(qn),new Hl(hn)));case Rt:case fe:case Ie:return la(+qn,+hn);case ve:return qn.name==hn.name&&qn.message==hn.message;case fr:case ce:return qn==hn+"";case Ae:var os=fl;case Mi:var Wi=1&is;if(os||(os=vu),qn.size!=hn.size&&!Wi)return!1;var ss=Ht.get(qn);if(ss)return ss==hn;is|=2,Ht.set(qn,hn);var Ha=zh(os(qn),os(hn),is,fs,Nn,Ht);return Ht.delete(qn),Ha;case Xe:if(gr)return gr.call(qn)==gr.call(hn)}return!1}($r,yi,go,Di,Tn,Gn,Mr);if(!(1&Di)){var Fi=ki&&sa.call($r,"__wrapped__"),Xa=Jl&&sa.call(yi,"__wrapped__");if(Fi||Xa){var yo=Fi?$r.value():$r,_o=Xa?yi.value():yi;return Mr||(Mr=new rs),Gn(yo,_o,Di,Tn,Mr)}}return Fn?(Mr||(Mr=new rs),function(qn,hn,Kl,is,fs,Nn){var Ht=1&Kl,os=Wl(qn),Wi=os.length,ss=Wl(hn).length;if(Wi!=ss&&!Ht)return!1;for(var Ha=Wi;Ha--;){var Gt=os[Ha];if(!(Ht?Gt in hn:sa.call(hn,Gt)))return!1}var Ql=Nn.get(qn);if(Ql&&Nn.get(hn))return Ql==hn;var Ya=!0;Nn.set(qn,hn),Nn.set(hn,qn);for(var Ac=Ht;++Ha<Wi;){var Wa=qn[Gt=os[Ha]],tu=hn[Gt];if(is)var nc=Ht?is(tu,Wa,Gt,hn,qn,Nn):is(Wa,tu,Gt,qn,hn,Nn);if(!(nc===void 0?Wa===tu||fs(Wa,tu,Kl,is,Nn):nc)){Ya=!1;break}Ac||(Ac=Gt=="constructor")}if(Ya&&!Ac){var eu=qn.constructor,ic=hn.constructor;eu==ic||!("constructor"in qn)||!("constructor"in hn)||typeof eu=="function"&&eu instanceof eu&&typeof ic=="function"&&ic instanceof ic||(Ya=!1)}return Nn.delete(qn),Nn.delete(hn),Ya}($r,yi,Di,Tn,Gn,Mr)):!1}(kt,Wt,we,rr,aa,jn))}function Sa(kt){return!(!On(kt)||function(Wt){return!!Mh&&Mh in Wt}(kt))&&(Ir(kt)?np:ni).test(Ta(kt))}function Ea(kt){if(we=(Wt=kt)&&Wt.constructor,rr=typeof we=="function"&&we.prototype||Xl,Wt!==rr)return Cc(kt);var Wt,we,rr,jn=[];for(var $r in Object(kt))sa.call(kt,$r)&&$r!="constructor"&&jn.push($r);return jn}function zh(kt,Wt,we,rr,jn,$r){var yi=1&we,Di=kt.length,Tn=Wt.length;if(Di!=Tn&&!(yi&&Tn>Di))return!1;var Gn=$r.get(kt);if(Gn&&$r.get(Wt))return Gn==Wt;var Mr=-1,so=!0,Us=2&we?new qa:void 0;for($r.set(kt,Wt),$r.set(Wt,kt);++Mr<Di;){var go=kt[Mr],js=Wt[Mr];if(rr)var ki=yi?rr(js,go,Mr,Wt,kt,$r):rr(go,js,Mr,kt,Wt,$r);if(ki!==void 0){if(ki)continue;so=!1;break}if(Us){if(!dl(Wt,function(Jl,Fn){if(Fi=Fn,!Us.has(Fi)&&(go===Jl||jn(go,Jl,we,rr,$r)))return Us.push(Fn);var Fi})){so=!1;break}}else if(go!==js&&!jn(go,js,we,rr,$r)){so=!1;break}}return $r.delete(kt),$r.delete(Wt),so}function Wl(kt){return function(Wt,we,rr){var jn=we(Wt);return ua(Wt)?jn:function($r,yi){for(var Di=-1,Tn=yi.length,Gn=$r.length;++Di<Tn;)$r[Gn+Di]=yi[Di];return $r}(jn,rr(Wt))}(kt,bl,vl)}function rc(kt,Wt){var we,rr,jn=kt.__data__;return((rr=typeof(we=Wt))=="string"||rr=="number"||rr=="symbol"||rr=="boolean"?we!=="__proto__":we===null)?jn[typeof Wt=="string"?"string":"hash"]:jn.map}function Za(kt,Wt){var we=function(rr,jn){return rr?.[jn]}(kt,Wt);return Sa(we)?we:void 0}ur.prototype.clear=function(){this.__data__=yl?yl(null):{},this.size=0},ur.prototype.delete=function(kt){var Wt=this.has(kt)&&delete this.__data__[kt];return this.size-=Wt?1:0,Wt},ur.prototype.get=function(kt){var Wt=this.__data__;if(yl){var we=Wt[kt];return we===ct?void 0:we}return sa.call(Wt,kt)?Wt[kt]:void 0},ur.prototype.has=function(kt){var Wt=this.__data__;return yl?Wt[kt]!==void 0:sa.call(Wt,kt)},ur.prototype.set=function(kt,Wt){var we=this.__data__;return this.size+=this.has(kt)?0:1,we[kt]=yl&&Wt===void 0?ct:Wt,this},mo.prototype.clear=function(){this.__data__=[],this.size=0},mo.prototype.delete=function(kt){var Wt=this.__data__,we=$a(Wt,kt);return!(we<0)&&(we==Wt.length-1?Wt.pop():wu.call(Wt,we,1),--this.size,!0)},mo.prototype.get=function(kt){var Wt=this.__data__,we=$a(Wt,kt);return we<0?void 0:Wt[we][1]},mo.prototype.has=function(kt){return $a(this.__data__,kt)>-1},mo.prototype.set=function(kt,Wt){var we=this.__data__,rr=$a(we,kt);return rr<0?(++this.size,we.push([kt,Wt])):we[rr][1]=Wt,this},wa.prototype.clear=function(){this.size=0,this.__data__={hash:new ur,map:new(po||mo),string:new ur}},wa.prototype.delete=function(kt){var Wt=rc(this,kt).delete(kt);return this.size-=Wt?1:0,Wt},wa.prototype.get=function(kt){return rc(this,kt).get(kt)},wa.prototype.has=function(kt){return rc(this,kt).has(kt)},wa.prototype.set=function(kt,Wt){var we=rc(this,kt),rr=we.size;return we.set(kt,Wt),this.size+=we.size==rr?0:1,this},qa.prototype.add=qa.prototype.push=function(kt){return this.__data__.set(kt,ct),this},qa.prototype.has=function(kt){return this.__data__.has(kt)},rs.prototype.clear=function(){this.__data__=new mo,this.size=0},rs.prototype.delete=function(kt){var Wt=this.__data__,we=Wt.delete(kt);return this.size=Wt.size,we},rs.prototype.get=function(kt){return this.__data__.get(kt)},rs.prototype.has=function(kt){return this.__data__.has(kt)},rs.prototype.set=function(kt,Wt){var we=this.__data__;if(we instanceof mo){var rr=we.__data__;if(!po||rr.length<199)return rr.push([kt,Wt]),this.size=++we.size,this;we=this.__data__=new wa(rr)}return we.set(kt,Wt),this.size=we.size,this};var vl=Es?function(kt){return kt==null?[]:(kt=Object(kt),function(Wt,we){for(var rr=-1,jn=Wt==null?0:Wt.length,$r=0,yi=[];++rr<jn;){var Di=Wt[rr];we(Di,rr,Wt)&&(yi[$r++]=Di)}return yi}(Es(kt),function(Wt){return Ga.call(kt,Wt)}))}:function(){return[]},Ts=Vs;function Pc(kt,Wt){return!!(Wt=Wt??vt)&&(typeof kt=="number"||hl.test(kt))&&kt>-1&&kt%1==0&&kt<Wt}function Ta(kt){if(kt!=null){try{return Ss.call(kt)}catch{}try{return kt+""}catch{}}return""}function la(kt,Wt){return kt===Wt||kt!=kt&&Wt!=Wt}(gl&&Ts(new gl(new ArrayBuffer(1)))!=Qn||po&&Ts(new po)!=Ae||Su&&Ts(Su.resolve())!=ri||fo&&Ts(new fo)!=Mi||ds&&Ts(new ds)!=cn)&&(Ts=function(kt){var Wt=Vs(kt),we=Wt==dr?kt.constructor:void 0,rr=we?Ta(we):"";if(rr)switch(rr){case Eu:return Qn;case Ye:return Ae;case wr:return ri;case ip:return Mi;case Be:return cn}return Wt});var xl=Yl(function(){return arguments}())?Yl:function(kt){return Uo(kt)&&sa.call(kt,"callee")&&!Ga.call(kt,"callee")},ua=Array.isArray,Tu=Ic||function(){return!1};function Ir(kt){if(!On(kt))return!1;var Wt=Vs(kt);return Wt==Ce||Wt=="[object GeneratorFunction]"||Wt=="[object AsyncFunction]"||Wt=="[object Proxy]"}function ns(kt){return typeof kt=="number"&&kt>-1&&kt%1==0&&kt<=vt}function On(kt){var Wt=typeof kt;return kt!=null&&(Wt=="object"||Wt=="function")}function Uo(kt){return kt!=null&&typeof kt=="object"}var ca=ql?function(kt){return function(Wt){return kt(Wt)}}(ql):function(kt){return Uo(kt)&&ns(kt.length)&&!!gn[Vs(kt)]};function bl(kt){return(Wt=kt)!=null&&ns(Wt.length)&&!Ir(Wt)?_l(kt):Ea(kt);var Wt}D.exports=function(kt,Wt){return aa(kt,Wt)}})(Bo,Bo.exports);var Tr=d(Bo.exports);function Va(D,U){return D.length===U.length&&JSON.stringify(D.map(function(ct){return ct}).sort())===JSON.stringify(U.map(function(ct){return ct}).sort())}var gi={Polygon:Ci,LineString:zn,Point:qr,MultiPolygon:ln,MultiLineString:ln,MultiPoint:ln},_u=Object.freeze({__proto__:null,CommonSelectors:Cr,constrainFeatureMovement:hs,createMidPoint:bn,createSupplementaryPoints:Li,createVertex:ge,doubleClickZoom:ye,euclideanDistance:Ar,featuresAt:de,getFeatureAtAndSetCursors:Er,isClick:xn,isEventAtCoordinates:Rn,isTap:pi,mapEventToBoundingBox:zr,ModeHandler:u,moveFeatures:ps,sortFeatures:je,stringSetsAreEqual:Va,StringSet:nr,theme:ar,toDenseArray:Oi}),Vo=function(D,U){var ct={options:D=function(At){At===void 0&&(At={});var Lt=_t(At);return At.controls||(Lt.controls={}),At.displayControlsDefault===!1?Lt.controls=_t(br,At.controls):Lt.controls=_t(Ns,At.controls),(Lt=_t(cl,Lt)).styles=He(Lt.styles,"cold").concat(He(Lt.styles,"hot")),Lt}(D)};U=function(At,Lt){return Lt.modes=Pt,Lt.getFeatureIdsAt=function(Rt){return de.click({point:Rt},null,At).map(function(fe){return fe.properties.id})},Lt.getSelectedIds=function(){return At.store.getSelectedIds()},Lt.getSelected=function(){return{type:It.FEATURE_COLLECTION,features:At.store.getSelectedIds().map(function(Rt){return At.store.get(Rt)}).map(function(Rt){return Rt.toGeoJSON()})}},Lt.getSelectedPoints=function(){return{type:It.FEATURE_COLLECTION,features:At.store.getSelectedCoordinates().map(function(Rt){return{type:It.FEATURE,properties:{},geometry:{type:It.POINT,coordinates:Rt.coordinates}}})}},Lt.set=function(Rt){if(Rt.type===void 0||Rt.type!==It.FEATURE_COLLECTION||!Array.isArray(Rt.features))throw new Error("Invalid FeatureCollection");var fe=At.store.createRenderBatch(),ve=At.store.getAllIds().slice(),Ce=Lt.add(Rt),Ae=new nr(Ce);return(ve=ve.filter(function(Ie){return!Ae.has(Ie)})).length&&Lt.delete(ve),fe(),Ce},Lt.add=function(Rt){var fe=JSON.parse(JSON.stringify(O(Rt))).features.map(function(ve){if(ve.id=ve.id||Sn(),ve.geometry===null)throw new Error("Invalid geometry: null");if(At.store.get(ve.id)===void 0||At.store.get(ve.id).type!==ve.geometry.type){var Ce=gi[ve.geometry.type];if(Ce===void 0)throw new Error("Invalid geometry type: "+ve.geometry.type+".");var Ae=new Ce(At,ve);At.store.add(Ae)}else{var Ie=At.store.get(ve.id);Ie.properties=ve.properties,Tr(Ie.properties,ve.properties)||At.store.featureChanged(Ie.id),Tr(Ie.getCoordinates(),ve.geometry.coordinates)||Ie.incomingCoords(ve.geometry.coordinates)}return ve.id});return At.store.render(),fe},Lt.get=function(Rt){var fe=At.store.get(Rt);if(fe)return fe.toGeoJSON()},Lt.getAll=function(){return{type:It.FEATURE_COLLECTION,features:At.store.getAll().map(function(Rt){return Rt.toGeoJSON()})}},Lt.delete=function(Rt){return At.store.delete(Rt,{silent:!0}),Lt.getMode()!==Pt.DIRECT_SELECT||At.store.getSelectedIds().length?At.store.render():At.events.changeMode(Pt.SIMPLE_SELECT,void 0,{silent:!0}),Lt},Lt.deleteAll=function(){return At.store.delete(At.store.getAllIds(),{silent:!0}),Lt.getMode()===Pt.DIRECT_SELECT?At.events.changeMode(Pt.SIMPLE_SELECT,void 0,{silent:!0}):At.store.render(),Lt},Lt.changeMode=function(Rt,fe){return fe===void 0&&(fe={}),Rt===Pt.SIMPLE_SELECT&&Lt.getMode()===Pt.SIMPLE_SELECT?(Va(fe.featureIds||[],At.store.getSelectedIds())||(At.store.setSelected(fe.featureIds,{silent:!0}),At.store.render()),Lt):(Rt===Pt.DIRECT_SELECT&&Lt.getMode()===Pt.DIRECT_SELECT&&fe.featureId===At.store.getSelectedIds()[0]||At.events.changeMode(Rt,fe,{silent:!0}),Lt)},Lt.getMode=function(){return At.events.getMode()},Lt.trash=function(){return At.events.trash({silent:!0}),Lt},Lt.combineFeatures=function(){return At.events.combineFeatures({silent:!0}),Lt},Lt.uncombineFeatures=function(){return At.events.uncombineFeatures({silent:!0}),Lt},Lt.setFeatureProperty=function(Rt,fe,ve){return At.store.setFeatureProperty(Rt,fe,ve),Lt},Lt}(ct,U),ct.api=U;var vt=fi(ct);return U.onAdd=vt.onAdd,U.onRemove=vt.onRemove,U.types=xt,U.options=D,U};function Gl(D){Vo(D,this)}return Gl.modes=un,Gl.constants=er,Gl.lib=_u,Gl})})(m1);var JT=m1.exports,Ff=l_(JT);var d_=_e(Ee(),1);var _w=_e(Ee(),1);var Nf=_e(Ee(),1),Nu=_e(Ee(),1);var tw=_e(Ee(),1);var ew=tw.createContext(null);function rw(i,s){let u=Array.isArray(i)?i[0]:i?i.x:0,d=Array.isArray(i)?i[1]:i?i.y:0,_=Array.isArray(s)?s[0]:s?s.x:0,b=Array.isArray(s)?s[1]:s?s.y:0;return u===_&&d===b}function ha(i,s){if(i===s)return!0;if(!i||!s)return!1;if(Array.isArray(i)){if(!Array.isArray(s)||i.length!==s.length)return!1;for(let u=0;u<i.length;u++)if(!ha(i[u],s[u]))return!1;return!0}else if(Array.isArray(s))return!1;if(typeof i=="object"&&typeof s=="object"){let u=Object.keys(i),d=Object.keys(s);if(u.length!==d.length)return!1;for(let _ of u)if(!s.hasOwnProperty(_)||!ha(i[_],s[_]))return!1;return!0}return!1}function nw(i){let s=i.clone();return s.pixelsToGLUnits=i.pixelsToGLUnits,s}function g1(i,s){if(!i.getProjection)return;let u=i.getProjection(),d=s.getProjection();ha(u,d)||s.setProjection(u)}function y1(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function _1(i,s){let u=s.viewState||s,d=!1;if("longitude"in u&&"latitude"in u){let _=i.center;i.center=new _.constructor(u.longitude,u.latitude),d=d||_!==i.center}if("zoom"in u){let _=i.zoom;i.zoom=u.zoom,d=d||_!==i.zoom}if("bearing"in u){let _=i.bearing;i.bearing=u.bearing,d=d||_!==i.bearing}if("pitch"in u){let _=i.pitch;i.pitch=u.pitch,d=d||_!==i.pitch}return u.padding&&!i.isPaddingEqual(u.padding)&&(d=!0,i.padding=u.padding),d}var KT=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function v1(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;let s={};for(let d of i.layers)s[d.id]=d;let u=i.layers.map(d=>{let _=null;"interactive"in d&&(_=Object.assign({},d),delete _.interactive);let b=s[d.ref];if(b){_=_||Object.assign({},d),delete _.ref;for(let C of KT)C in b&&(_[C]=b[C])}return _||d});return{...i,layers:u}}var iw={version:8,sources:{},layers:[]},ow={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},x1={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},sw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},QT=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],tI=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"],kp=class{constructor(s,u,d){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=_=>{let b=this.props[sw[_.type]];b?b(_):_.type==="error"&&console.error(_.error)},this._onPointerEvent=_=>{(_.type==="mousemove"||_.type==="mouseout")&&this._updateHover(_);let b=this.props[ow[_.type]];b&&(this.props.interactiveLayerIds&&_.type!=="mouseover"&&_.type!=="mouseout"&&(_.features=this._hoveredFeatures||this._queryRenderedFeatures(_.point)),b(_),delete _.features)},this._onCameraEvent=_=>{if(!this._internalUpdate){let b=this.props[x1[_.type]];b&&b(_)}_.type in this._deferredEvents&&(this._deferredEvents[_.type]=!1)},this._MapClass=s,this.props=u,this._initialize(d)}get map(){return this._map}get transform(){return this._renderTransform}setProps(s){let u=this.props;this.props=s;let d=this._updateSettings(s,u);d&&this._createShadowTransform(this._map);let _=this._updateSize(s),b=this._updateViewState(s,!0);this._updateStyle(s,u),this._updateStyleComponents(s,u),this._updateHandlers(s,u),(d||_||b&&!this._map.isMoving())&&this.redraw()}static reuse(s,u){let d=kp.savedMaps.pop();if(!d)return null;let _=d.map,b=_.getContainer();for(u.className=b.className;b.childNodes.length>0;)u.appendChild(b.childNodes[0]);_._container=u;let C=_._resizeObserver;C&&(C.disconnect(),C.observe(u)),d.setProps({...s,styleDiffing:!1}),_.resize();let{initialViewState:l}=s;return l&&(l.bounds?_.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):d._updateViewState(l,!1)),_.isStyleLoaded()?_.fire("load"):_.once("styledata",()=>_.fire("load")),_._update(),d}_initialize(s){let{props:u}=this,{mapStyle:d=iw}=u,_={...u,...u.initialViewState,accessToken:u.mapboxAccessToken||eI()||null,container:s,style:v1(d)},b=_.initialViewState||_.viewState||_;if(Object.assign(_,{center:[b.longitude||0,b.latitude||0],zoom:b.zoom||0,pitch:b.pitch||0,bearing:b.bearing||0}),u.gl){let et=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=et,u.gl)}let C=new this._MapClass(_);b.padding&&C.setPadding(b.padding),u.cursor&&(C.getCanvas().style.cursor=u.cursor),this._createShadowTransform(C);let l=C._render;C._render=et=>{this._inRender=!0,l.call(C,et),this._inRender=!1};let V=C._renderTaskQueue.run;C._renderTaskQueue.run=et=>{V.call(C._renderTaskQueue,et),this._onBeforeRepaint()},C.on("render",()=>this._onAfterRepaint());let R=C.fire;C.fire=this._fireEvent.bind(this,R),C.on("resize",()=>{this._renderTransform.resize(C.transform.width,C.transform.height)}),C.on("styledata",()=>{this._updateStyleComponents(this.props,{}),g1(C.transform,this._renderTransform)}),C.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(let et in ow)C.on(et,this._onPointerEvent);for(let et in x1)C.on(et,this._onCameraEvent);for(let et in sw)C.on(et,this._onEvent);this._map=C}recycle(){let s=this.map.getContainer().querySelector("[mapboxgl-children]");s?.remove(),kp.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){let s=this._map;!this._inRender&&s.style&&(s._frame&&(s._frame.cancel(),s._frame=null),s._render())}_createShadowTransform(s){let u=nw(s.transform);s.painter.transform=u,this._renderTransform=u}_updateSize(s){let{viewState:u}=s;if(u){let d=this._map;if(u.width!==d.transform.width||u.height!==d.transform.height)return d.resize(),!0}return!1}_updateViewState(s,u){if(this._internalUpdate)return!1;let d=this._map,_=this._renderTransform,{zoom:b,pitch:C,bearing:l}=_,V=d.isMoving();V&&(_.cameraElevationReference="sea");let R=_1(_,{...y1(d.transform),...s});if(V&&(_.cameraElevationReference="ground"),R&&u){let et=this._deferredEvents;et.move=!0,et.zoom||(et.zoom=b!==_.zoom),et.rotate||(et.rotate=l!==_.bearing),et.pitch||(et.pitch=C!==_.pitch)}return V||_1(d.transform,s),R}_updateSettings(s,u){let d=this._map,_=!1;for(let b of QT)if(b in s&&!ha(s[b],u[b])){_=!0;let C=d[`set${b[0].toUpperCase()}${b.slice(1)}`];C?.call(d,s[b])}return _}_updateStyle(s,u){if(s.cursor!==u.cursor&&(this._map.getCanvas().style.cursor=s.cursor||""),s.mapStyle!==u.mapStyle){let{mapStyle:d=iw,styleDiffing:_=!0}=s,b={diff:_};return"localIdeographFontFamily"in s&&(b.localIdeographFontFamily=s.localIdeographFontFamily),this._map.setStyle(v1(d),b),!0}return!1}_updateStyleComponents(s,u){let d=this._map,_=!1;return d.isStyleLoaded()&&("light"in s&&d.setLight&&!ha(s.light,u.light)&&(_=!0,d.setLight(s.light)),"fog"in s&&d.setFog&&!ha(s.fog,u.fog)&&(_=!0,d.setFog(s.fog)),"terrain"in s&&d.setTerrain&&!ha(s.terrain,u.terrain)&&(!s.terrain||d.getSource(s.terrain.source))&&(_=!0,d.setTerrain(s.terrain))),_}_updateHandlers(s,u){var d,_;let b=this._map,C=!1;for(let l of tI){let V=(d=s[l])!==null&&d!==void 0?d:!0,R=(_=u[l])!==null&&_!==void 0?_:!0;ha(V,R)||(C=!0,V?b[l].enable(V):b[l].disable())}return C}_queryRenderedFeatures(s){let u=this._map,d=u.transform,{interactiveLayerIds:_=[]}=this.props;try{return u.transform=this._renderTransform,u.queryRenderedFeatures(s,{layers:_.filter(u.getLayer.bind(u))})}catch{return[]}finally{u.transform=d}}_updateHover(s){var u;let{props:d}=this;if(d.interactiveLayerIds&&(d.onMouseMove||d.onMouseEnter||d.onMouseLeave)){let _=s.type,b=((u=this._hoveredFeatures)===null||u===void 0?void 0:u.length)>0,C=this._queryRenderedFeatures(s.point),l=C.length>0;!l&&b&&(s.type="mouseleave",this._onPointerEvent(s)),this._hoveredFeatures=C,l&&!b&&(s.type="mouseenter",this._onPointerEvent(s)),s.type=_}else this._hoveredFeatures=null}_fireEvent(s,u,d){let _=this._map,b=_.transform,C=typeof u=="string"?u:u.type;return C==="move"&&this._updateViewState(this.props,!1),C in x1&&(typeof u=="object"&&(u.viewState=y1(b)),this._map.isMoving())?(_.transform=this._renderTransform,s.call(_,u,d),_.transform=b,_):(s.call(_,u,d),_)}_onBeforeRepaint(){let s=this._map;this._internalUpdate=!0;for(let d in this._deferredEvents)this._deferredEvents[d]&&s.fire(d);this._internalUpdate=!1;let u=this._map.transform;s.transform=this._renderTransform,this._onAfterRepaint=()=>{g1(this._renderTransform,u),s.transform=u}}};kp.savedMaps=[];function eI(){let i=null;if(typeof location<"u"){let s=/access_token=([^&\/]*)/.exec(location.search);i=s&&s[1]}try{i=i||process.env.MapboxAccessToken}catch{}try{i=i||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return i}var rI=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function aw(i){if(!i)return null;let s=i.map,u={getMap:()=>s,getCenter:()=>i.transform.center,getZoom:()=>i.transform.zoom,getBearing:()=>i.transform.bearing,getPitch:()=>i.transform.pitch,getPadding:()=>i.transform.padding,getBounds:()=>i.transform.getBounds(),project:d=>{let _=s.transform;s.transform=i.transform;let b=s.project(d);return s.transform=_,b},unproject:d=>{let _=s.transform;s.transform=i.transform;let b=s.unproject(d);return s.transform=_,b},queryTerrainElevation:(d,_)=>{let b=s.transform;s.transform=i.transform;let C=s.queryTerrainElevation(d,_);return s.transform=b,C},queryRenderedFeatures:(d,_)=>{let b=s.transform;s.transform=i.transform;let C=s.queryRenderedFeatures(d,_);return s.transform=b,C}};for(let d of nI(s))!(d in u)&&!rI.includes(d)&&(u[d]=s[d].bind(s));return u}function nI(i){let s=new Set,u=i;for(;u;){for(let d of Object.getOwnPropertyNames(u))d[0]!=="_"&&typeof i[d]=="function"&&d!=="fire"&&d!=="setEventedParent"&&s.add(d);u=Object.getPrototypeOf(u)}return Array.from(s)}var u_=_e(Ee(),1),lw=typeof document<"u"?u_.useLayoutEffect:u_.useEffect;var iI=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function uw(i,s){for(let d of iI)d in s&&(i[d]=s[d]);let{RTLTextPlugin:u="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=s;u&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"&&i.setRTLTextPlugin(u,d=>{d&&console.error(d)},!0)}var uh=Nf.createContext(null);function cw(i,s,u){let d=(0,Nu.useContext)(ew),[_,b]=(0,Nu.useState)(null),C=(0,Nu.useRef)(),{current:l}=(0,Nu.useRef)({mapLib:null,map:null});(0,Nu.useEffect)(()=>{let et=i.mapLib,at=!0,st;return Promise.resolve(et||u).then(yt=>{if(!at)return;if(!yt)throw new Error("Invalid mapLib");let xt="Map"in yt?yt:yt.default;if(!xt.Map)throw new Error("Invalid mapLib");if(uw(xt,i),!xt.supported||xt.supported(i))i.reuseMaps&&(st=kp.reuse(i,C.current)),st||(st=new kp(xt.Map,i,C.current)),l.map=aw(st),l.mapLib=xt,b(st),d?.onMapMount(l.map,i.id);else throw new Error("Map is not supported by this browser")}).catch(yt=>{let{onError:xt}=i;xt?xt({type:"error",target:null,originalEvent:null,error:yt}):console.error(yt)}),()=>{at=!1,st&&(d?.onMapUnmount(i.id),i.reuseMaps?st.recycle():st.destroy())}},[]),lw(()=>{_&&_.setProps(i)}),(0,Nu.useImperativeHandle)(s,()=>l.map,[_]);let V=(0,Nu.useMemo)(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]),R={height:"100%"};return Nf.createElement("div",{id:i.id,ref:C,style:V},_&&Nf.createElement(uh.Provider,{value:l},Nf.createElement("div",{"mapboxgl-children":"",style:R},i.children)))}var hw=_e(Ee(),1),Dl=_e(Ee(),1),pw=_e(Wp(),1);var oI=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ru(i,s){if(!i||!s)return;let u=i.style;for(let d in s){let _=s[d];Number.isFinite(_)&&!oI.test(d)?u[d]=`${_}px`:u[d]=_}}function sI(i,s){let{map:u,mapLib:d}=(0,Dl.useContext)(uh),_=(0,Dl.useRef)({props:i});_.current.props=i;let b=(0,Dl.useMemo)(()=>{let It=!1;hw.Children.forEach(i.children,Qt=>{Qt&&(It=!0)});let Pt={...i,element:It?document.createElement("div"):null},qt=new d.Marker(Pt);return qt.setLngLat([i.longitude,i.latitude]),qt.getElement().addEventListener("click",Qt=>{var se,le;(le=(se=_.current.props).onClick)===null||le===void 0||le.call(se,{type:"click",target:qt,originalEvent:Qt})}),qt.on("dragstart",Qt=>{var se,le;let Ue=Qt;Ue.lngLat=b.getLngLat(),(le=(se=_.current.props).onDragStart)===null||le===void 0||le.call(se,Ue)}),qt.on("drag",Qt=>{var se,le;let Ue=Qt;Ue.lngLat=b.getLngLat(),(le=(se=_.current.props).onDrag)===null||le===void 0||le.call(se,Ue)}),qt.on("dragend",Qt=>{var se,le;let Ue=Qt;Ue.lngLat=b.getLngLat(),(le=(se=_.current.props).onDragEnd)===null||le===void 0||le.call(se,Ue)}),qt},[]);(0,Dl.useEffect)(()=>(b.addTo(u.getMap()),()=>{b.remove()}),[]);let{longitude:C,latitude:l,offset:V,style:R,draggable:et=!1,popup:at=null,rotation:st=0,rotationAlignment:yt="auto",pitchAlignment:xt="auto"}=i;return(0,Dl.useEffect)(()=>{ru(b.getElement(),R)},[R]),(0,Dl.useImperativeHandle)(s,()=>b,[]),(b.getLngLat().lng!==C||b.getLngLat().lat!==l)&&b.setLngLat([C,l]),V&&!rw(b.getOffset(),V)&&b.setOffset(V),b.isDraggable()!==et&&b.setDraggable(et),b.getRotation()!==st&&b.setRotation(st),b.getRotationAlignment()!==yt&&b.setRotationAlignment(yt),b.getPitchAlignment()!==xt&&b.setPitchAlignment(xt),b.getPopup()!==at&&b.setPopup(at),(0,pw.createPortal)(i.children,b.getElement())}(0,Dl.memo)((0,Dl.forwardRef)(sI));var fw=_e(Wp(),1),Ja=_e(Ee(),1);function dw(i){return new Set(i?i.trim().split(/\s+/):[])}function aI(i,s){let{map:u,mapLib:d}=(0,Ja.useContext)(uh),_=(0,Ja.useMemo)(()=>document.createElement("div"),[]),b=(0,Ja.useRef)({props:i});b.current.props=i;let C=(0,Ja.useMemo)(()=>{let l={...i},V=new d.Popup(l);return V.setLngLat([i.longitude,i.latitude]),V.once("open",R=>{var et,at;(at=(et=b.current.props).onOpen)===null||at===void 0||at.call(et,R)}),V},[]);if((0,Ja.useEffect)(()=>{let l=V=>{var R,et;(et=(R=b.current.props).onClose)===null||et===void 0||et.call(R,V)};return C.on("close",l),C.setDOMContent(_).addTo(u.getMap()),()=>{C.off("close",l),C.isOpen()&&C.remove()}},[]),(0,Ja.useEffect)(()=>{ru(C.getElement(),i.style)},[i.style]),(0,Ja.useImperativeHandle)(s,()=>C,[]),C.isOpen()&&((C.getLngLat().lng!==i.longitude||C.getLngLat().lat!==i.latitude)&&C.setLngLat([i.longitude,i.latitude]),i.offset&&!ha(C.options.offset,i.offset)&&C.setOffset(i.offset),(C.options.anchor!==i.anchor||C.options.maxWidth!==i.maxWidth)&&(C.options.anchor=i.anchor,C.setMaxWidth(i.maxWidth)),C.options.className!==i.className)){let l=dw(C.options.className),V=dw(i.className);for(let R of l)V.has(R)||C.removeClassName(R);for(let R of V)l.has(R)||C.addClassName(R);C.options.className=i.className}return(0,fw.createPortal)(i.children,_)}(0,Ja.memo)((0,Ja.forwardRef)(aI));var c_=_e(Ee(),1);var Bf=_e(Ee(),1);function nu(i,s,u,d){let _=(0,Bf.useContext)(uh),b=(0,Bf.useMemo)(()=>i(_),[]);return(0,Bf.useEffect)(()=>{let C=d||u||s,l=typeof s=="function"&&typeof u=="function"?s:null,V=typeof u=="function"?u:typeof s=="function"?s:null,{map:R}=_;return R.hasControl(b)||(R.addControl(b,C?.position),l&&l(_)),()=>{V&&V(_),R.hasControl(b)&&R.removeControl(b)}},[]),b}function lI(i){let s=nu(({mapLib:u})=>new u.AttributionControl(i),{position:i.position});return(0,c_.useEffect)(()=>{ru(s._container,i.style)},[i.style]),null}(0,c_.memo)(lI);var h_=_e(Ee(),1);function uI(i){let s=nu(({mapLib:u})=>new u.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return(0,h_.useEffect)(()=>{ru(s._controlContainer,i.style)},[i.style]),null}(0,h_.memo)(uI);var Rh=_e(Ee(),1);function cI(i,s){let u=(0,Rh.useRef)({props:i}),d=nu(({mapLib:_})=>{let b=new _.GeolocateControl(i),C=b._setupUI;return b._setupUI=l=>{b._container.hasChildNodes()||C(l)},b.on("geolocate",l=>{var V,R;(R=(V=u.current.props).onGeolocate)===null||R===void 0||R.call(V,l)}),b.on("error",l=>{var V,R;(R=(V=u.current.props).onError)===null||R===void 0||R.call(V,l)}),b.on("outofmaxbounds",l=>{var V,R;(R=(V=u.current.props).onOutOfMaxBounds)===null||R===void 0||R.call(V,l)}),b.on("trackuserlocationstart",l=>{var V,R;(R=(V=u.current.props).onTrackUserLocationStart)===null||R===void 0||R.call(V,l)}),b.on("trackuserlocationend",l=>{var V,R;(R=(V=u.current.props).onTrackUserLocationEnd)===null||R===void 0||R.call(V,l)}),b},{position:i.position});return u.current.props=i,(0,Rh.useImperativeHandle)(s,()=>d,[]),(0,Rh.useEffect)(()=>{ru(d._container,i.style)},[i.style]),null}(0,Rh.memo)((0,Rh.forwardRef)(cI));var p_=_e(Ee(),1);function hI(i){let s=nu(({mapLib:u})=>new u.NavigationControl(i),{position:i.position});return(0,p_.useEffect)(()=>{ru(s._container,i.style)},[i.style]),null}(0,p_.memo)(hI);var Vf=_e(Ee(),1);function pI(i){let s=nu(({mapLib:b})=>new b.ScaleControl(i),{position:i.position}),u=(0,Vf.useRef)(i),d=u.current;u.current=i;let{style:_}=i;return i.maxWidth!==void 0&&i.maxWidth!==d.maxWidth&&(s.options.maxWidth=i.maxWidth),i.unit!==void 0&&i.unit!==d.unit&&s.setUnit(i.unit),(0,Vf.useEffect)(()=>{ru(s._container,_)},[_]),null}(0,Vf.memo)(pI);var Oh=_e(Ee(),1);function Uf(i,s){if(!i)throw new Error(s)}function dI(i,s,u,d){if(Uf(u.id===d.id,"layer id changed"),Uf(u.type===d.type,"layer type changed"),u.type==="custom"||d.type==="custom")return;let{layout:_={},paint:b={},filter:C,minzoom:l,maxzoom:V,beforeId:R}=u;if(R!==d.beforeId&&i.moveLayer(s,R),_!==d.layout){let et=d.layout||{};for(let at in _)ha(_[at],et[at])||i.setLayoutProperty(s,at,_[at]);for(let at in et)_.hasOwnProperty(at)||i.setLayoutProperty(s,at,void 0)}if(b!==d.paint){let et=d.paint||{};for(let at in b)ha(b[at],et[at])||i.setPaintProperty(s,at,b[at]);for(let at in et)b.hasOwnProperty(at)||i.setPaintProperty(s,at,void 0)}ha(C,d.filter)||i.setFilter(s,C),(l!==d.minzoom||V!==d.maxzoom)&&i.setLayerZoomRange(s,l,V)}function fI(i,s,u){if(i.style&&i.style._loaded&&(!("source"in u)||i.getSource(u.source))){let d={...u,id:s};delete d.beforeId,i.addLayer(d,u.beforeId)}}var mI=0;function mw(i){let s=(0,Oh.useContext)(uh).map.getMap(),u=(0,Oh.useRef)(i),[,d]=(0,Oh.useState)(0),_=(0,Oh.useMemo)(()=>i.id||`jsx-layer-${mI++}`,[]);if((0,Oh.useEffect)(()=>{if(s){let b=()=>d(C=>C+1);return s.on("styledata",b),b(),()=>{s.off("styledata",b),s.style&&s.style._loaded&&s.getLayer(_)&&s.removeLayer(_)}}},[s]),s&&s.style&&s.getLayer(_))try{dI(s,_,i,u.current)}catch(b){console.warn(b)}else fI(s,_,i);return u.current=i,null}var gw=_e(Ee(),1),oc=_e(Ee(),1);var gI=0;function yI(i,s,u){if(i.style&&i.style._loaded){let d={...u};return delete d.id,delete d.children,i.addSource(s,d),i.getSource(s)}return null}function _I(i,s,u){Uf(s.id===u.id,"source id changed"),Uf(s.type===u.type,"source type changed");let d="",_=0;for(let C in s)C!=="children"&&C!=="id"&&!ha(u[C],s[C])&&(d=C,_++);if(!_)return;let b=s.type;if(b==="geojson")i.setData(s.data);else if(b==="image")i.updateImage({url:s.url,coordinates:s.coordinates});else if("setCoordinates"in i&&_===1&&d==="coordinates")i.setCoordinates(s.coordinates);else if("setUrl"in i)switch(d){case"url":i.setUrl(s.url);break;case"tiles":i.setTiles(s.tiles);break}else console.warn(`Unable to update <Source> prop: ${d}`)}function yw(i){let s=(0,oc.useContext)(uh).map.getMap(),u=(0,oc.useRef)(i),[,d]=(0,oc.useState)(0),_=(0,oc.useMemo)(()=>i.id||`jsx-source-${gI++}`,[]);(0,oc.useEffect)(()=>{if(s){let C=()=>setTimeout(()=>d(l=>l+1),0);return s.on("styledata",C),C(),()=>{var l;if(s.off("styledata",C),s.style&&s.style._loaded&&s.getSource(_)){let V=(l=s.getStyle())===null||l===void 0?void 0:l.layers;if(V)for(let R of V)R.source===_&&s.removeLayer(R.id);s.removeSource(_)}}}},[s]);let b=s&&s.style&&s.getSource(_);return b?_I(b,i,u.current):b=yI(s,_,i),u.current=i,b&&gw.Children.map(i.children,C=>C&&(0,oc.cloneElement)(C,{source:_}))||null}var vI=import("/_static/build/_shared/index.es164-VCC2W2U5.js").then(i=>i.i),vw=_w.forwardRef(function(i,s){return cw(i,s,vI)}),b1=mw,w1=yw;var S1=(0,d_.forwardRef)((i,s)=>{let u=nu(()=>new Ff(i),({map:d})=>{d.on("draw.create",i.onCreate),d.on("draw.update",i.onUpdate),d.on("draw.delete",i.onDelete)},({map:d})=>{d.off("draw.create",i.onCreate),d.off("draw.update",i.onUpdate),d.off("draw.delete",i.onDelete)},{position:i.position});return(0,d_.useImperativeHandle)(s,()=>u,[u]),null});var E1={exports:{}};var jf={};var bw=_e(Ee(),1),xw;function ww(){if(xw)return jf;xw=1;var i=bw.default,s=Symbol.for("react.element"),u=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,_=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function C(l,V,R){var et,at={},st=null,yt=null;R!==void 0&&(st=""+R),V.key!==void 0&&(st=""+V.key),V.ref!==void 0&&(yt=V.ref);for(et in V)d.call(V,et)&&!b.hasOwnProperty(et)&&(at[et]=V[et]);if(l&&l.defaultProps)for(et in V=l.defaultProps,V)at[et]===void 0&&(at[et]=V[et]);return{$$typeof:s,type:l,key:st,ref:yt,props:at,_owner:_.current}}return jf.Fragment=u,jf.jsx=C,jf.jsxs=C,jf}var hM=_e(Ee(),1);E1.exports=ww();var Xo=E1.exports;var o0=_e(Ee(),1);var q1={};YT(q1,{VERSION:()=>f_,after:()=>v2,all:()=>j1,allKeys:()=>Nh,any:()=>G1,assign:()=>cf,before:()=>j_,bind:()=>V_,bindAll:()=>p2,chain:()=>h2,chunk:()=>$2,clone:()=>Kw,collect:()=>Vu,compact:()=>F2,compose:()=>_2,constant:()=>E_,contains:()=>su,countBy:()=>M2,create:()=>Jw,debounce:()=>g2,default:()=>Yr,defaults:()=>D_,defer:()=>f2,delay:()=>U_,detect:()=>Sy,difference:()=>n0,drop:()=>tm,each:()=>Qa,escape:()=>i2,every:()=>j1,extend:()=>M_,extendOwn:()=>cf,filter:()=>ch,find:()=>Sy,findIndex:()=>Kf,findKey:()=>G_,findLastIndex:()=>$_,findWhere:()=>w2,first:()=>r0,flatten:()=>N2,foldl:()=>W_,foldr:()=>U1,forEach:()=>Qa,functions:()=>xy,get:()=>z_,groupBy:()=>A2,has:()=>t2,head:()=>r0,identity:()=>Yf,include:()=>su,includes:()=>su,indexBy:()=>L2,indexOf:()=>H_,initial:()=>e0,inject:()=>W_,intersection:()=>U2,invert:()=>L_,invoke:()=>E2,isArguments:()=>$f,isArray:()=>ou,isArrayBuffer:()=>b_,isBoolean:()=>__,isDataView:()=>lf,isDate:()=>Dw,isElement:()=>Mw,isEmpty:()=>Nw,isEqual:()=>Uw,isError:()=>zw,isFinite:()=>Ow,isFunction:()=>ro,isMap:()=>Zw,isMatch:()=>A_,isNaN:()=>S_,isNull:()=>Lw,isNumber:()=>v_,isObject:()=>iu,isRegExp:()=>kw,isSet:()=>Hw,isString:()=>Gf,isSymbol:()=>x_,isTypedArray:()=>C_,isUndefined:()=>y_,isWeakMap:()=>Xw,isWeakSet:()=>Yw,iteratee:()=>by,keys:()=>Jn,last:()=>O2,lastIndexOf:()=>b2,map:()=>Vu,mapObject:()=>e2,matcher:()=>Rp,matches:()=>Rp,max:()=>J_,memoize:()=>d2,methods:()=>xy,min:()=>I2,mixin:()=>i0,negate:()=>Jf,noop:()=>O_,now:()=>Kp,object:()=>G2,omit:()=>R2,once:()=>x2,pairs:()=>Ww,partial:()=>Uh,partition:()=>D2,pick:()=>t0,pluck:()=>Qf,property:()=>Wf,propertyOf:()=>r2,random:()=>wy,range:()=>q2,reduce:()=>W_,reduceRight:()=>U1,reject:()=>S2,rest:()=>tm,restArguments:()=>eo,result:()=>u2,sample:()=>Q_,select:()=>ch,shuffle:()=>C2,size:()=>k2,some:()=>G1,sortBy:()=>P2,sortedIndex:()=>Z_,tail:()=>tm,take:()=>r0,tap:()=>Qw,template:()=>l2,templateSettings:()=>a2,throttle:()=>m2,times:()=>n2,toArray:()=>K_,toPath:()=>B1,transpose:()=>Ty,unescape:()=>s2,union:()=>V2,uniq:()=>Ey,unique:()=>Ey,uniqueId:()=>c2,unzip:()=>Ty,values:()=>sc,where:()=>T2,without:()=>B2,wrap:()=>y2,zip:()=>j2});var f_="1.13.6",T1=typeof self=="object"&&self.self===self&&self||typeof globalThis=="object"&&globalThis.global===globalThis&&globalThis||Function("return this")()||{},vy=Array.prototype,m_=Object.prototype,I1=typeof Symbol<"u"?Symbol.prototype:null,Sw=vy.push,Fh=vy.slice,zp=m_.toString,Ew=m_.hasOwnProperty,C1=typeof ArrayBuffer<"u",Tw=typeof DataView<"u",Iw=Array.isArray,P1=Object.keys,A1=Object.create,L1=C1&&ArrayBuffer.isView,Cw=isNaN,Pw=isFinite,g_=!{toString:null}.propertyIsEnumerable("toString"),M1=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Aw=Math.pow(2,53)-1;function eo(i,s){return s=s==null?i.length-1:+s,function(){for(var u=Math.max(arguments.length-s,0),d=Array(u),_=0;_<u;_++)d[_]=arguments[_+s];switch(s){case 0:return i.call(this,d);case 1:return i.call(this,arguments[0],d);case 2:return i.call(this,arguments[0],arguments[1],d)}var b=Array(s+1);for(_=0;_<s;_++)b[_]=arguments[_];return b[s]=d,i.apply(this,b)}}function iu(i){var s=typeof i;return s==="function"||s==="object"&&!!i}function Lw(i){return i===null}function y_(i){return i===void 0}function __(i){return i===!0||i===!1||zp.call(i)==="[object Boolean]"}function Mw(i){return!!(i&&i.nodeType===1)}function di(i){var s="[object "+i+"]";return function(u){return zp.call(u)===s}}var Gf=di("String");var v_=di("Number");var Dw=di("Date");var kw=di("RegExp");var zw=di("Error");var x_=di("Symbol");var b_=di("ArrayBuffer");var Rw=di("Function"),xI=T1.document&&T1.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof xI!="function"&&(Rw=function(i){return typeof i=="function"||!1});var ro=Rw;var D1=di("Object");var w_=Tw&&D1(new DataView(new ArrayBuffer(8))),qf=typeof Map<"u"&&D1(new Map);var bI=di("DataView");function wI(i){return i!=null&&ro(i.getInt8)&&b_(i.buffer)}var lf=w_?wI:bI;var ou=Iw||di("Array");function Ka(i,s){return i!=null&&Ew.call(i,s)}var k1=di("Arguments");(function(){k1(arguments)||(k1=function(i){return Ka(i,"callee")})})();var $f=k1;function Ow(i){return!x_(i)&&Pw(i)&&!isNaN(parseFloat(i))}function S_(i){return v_(i)&&Cw(i)}function E_(i){return function(){return i}}function T_(i){return function(s){var u=i(s);return typeof u=="number"&&u>=0&&u<=Aw}}function I_(i){return function(s){return s?.[i]}}var uf=I_("byteLength");var Fw=T_(uf);var SI=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function EI(i){return L1?L1(i)&&!lf(i):Fw(i)&&SI.test(zp.call(i))}var C_=C1?EI:E_(!1);var ao=I_("length");function TI(i){for(var s={},u=i.length,d=0;d<u;++d)s[i[d]]=!0;return{contains:function(_){return s[_]===!0},push:function(_){return s[_]=!0,i.push(_)}}}function P_(i,s){s=TI(s);var u=M1.length,d=i.constructor,_=ro(d)&&d.prototype||m_,b="constructor";for(Ka(i,b)&&!s.contains(b)&&s.push(b);u--;)b=M1[u],b in i&&i[b]!==_[b]&&!s.contains(b)&&s.push(b)}function Jn(i){if(!iu(i))return[];if(P1)return P1(i);var s=[];for(var u in i)Ka(i,u)&&s.push(u);return g_&&P_(i,s),s}function Nw(i){if(i==null)return!0;var s=ao(i);return typeof s=="number"&&(ou(i)||Gf(i)||$f(i))?s===0:ao(Jn(i))===0}function A_(i,s){var u=Jn(s),d=u.length;if(i==null)return!d;for(var _=Object(i),b=0;b<d;b++){var C=u[b];if(s[C]!==_[C]||!(C in _))return!1}return!0}function Yr(i){if(i instanceof Yr)return i;if(!(this instanceof Yr))return new Yr(i);this._wrapped=i}Yr.VERSION=f_;Yr.prototype.value=function(){return this._wrapped};Yr.prototype.valueOf=Yr.prototype.toJSON=Yr.prototype.value;Yr.prototype.toString=function(){return String(this._wrapped)};function z1(i){return new Uint8Array(i.buffer||i,i.byteOffset||0,uf(i))}var Bw="[object DataView]";function R1(i,s,u,d){if(i===s)return i!==0||1/i===1/s;if(i==null||s==null)return!1;if(i!==i)return s!==s;var _=typeof i;return _!=="function"&&_!=="object"&&typeof s!="object"?!1:Vw(i,s,u,d)}function Vw(i,s,u,d){i instanceof Yr&&(i=i._wrapped),s instanceof Yr&&(s=s._wrapped);var _=zp.call(i);if(_!==zp.call(s))return!1;if(w_&&_=="[object Object]"&&lf(i)){if(!lf(s))return!1;_=Bw}switch(_){case"[object RegExp]":case"[object String]":return""+i==""+s;case"[object Number]":return+i!=+i?+s!=+s:+i==0?1/+i===1/s:+i==+s;case"[object Date]":case"[object Boolean]":return+i==+s;case"[object Symbol]":return I1.valueOf.call(i)===I1.valueOf.call(s);case"[object ArrayBuffer]":case Bw:return Vw(z1(i),z1(s),u,d)}var b=_==="[object Array]";if(!b&&C_(i)){var C=uf(i);if(C!==uf(s))return!1;if(i.buffer===s.buffer&&i.byteOffset===s.byteOffset)return!0;b=!0}if(!b){if(typeof i!="object"||typeof s!="object")return!1;var l=i.constructor,V=s.constructor;if(l!==V&&!(ro(l)&&l instanceof l&&ro(V)&&V instanceof V)&&"constructor"in i&&"constructor"in s)return!1}u=u||[],d=d||[];for(var R=u.length;R--;)if(u[R]===i)return d[R]===s;if(u.push(i),d.push(s),b){if(R=i.length,R!==s.length)return!1;for(;R--;)if(!R1(i[R],s[R],u,d))return!1}else{var et=Jn(i),at;if(R=et.length,Jn(s).length!==R)return!1;for(;R--;)if(at=et[R],!(Ka(s,at)&&R1(i[at],s[at],u,d)))return!1}return u.pop(),d.pop(),!0}function Uw(i,s){return R1(i,s)}function Nh(i){if(!iu(i))return[];var s=[];for(var u in i)s.push(u);return g_&&P_(i,s),s}function Zf(i){var s=ao(i);return function(u){if(u==null)return!1;var d=Nh(u);if(ao(d))return!1;for(var _=0;_<s;_++)if(!ro(u[i[_]]))return!1;return i!==N1||!ro(u[O1])}}var O1="forEach",jw="has",F1=["clear","delete"],Gw=["get",jw,"set"],qw=F1.concat(O1,Gw),N1=F1.concat(Gw),$w=["add"].concat(F1,O1,jw);var Zw=qf?Zf(qw):di("Map");var Xw=qf?Zf(N1):di("WeakMap");var Hw=qf?Zf($w):di("Set");var Yw=di("WeakSet");function sc(i){for(var s=Jn(i),u=s.length,d=Array(u),_=0;_<u;_++)d[_]=i[s[_]];return d}function Ww(i){for(var s=Jn(i),u=s.length,d=Array(u),_=0;_<u;_++)d[_]=[s[_],i[s[_]]];return d}function L_(i){for(var s={},u=Jn(i),d=0,_=u.length;d<_;d++)s[i[u[d]]]=u[d];return s}function xy(i){var s=[];for(var u in i)ro(i[u])&&s.push(u);return s.sort()}function Xf(i,s){return function(u){var d=arguments.length;if(s&&(u=Object(u)),d<2||u==null)return u;for(var _=1;_<d;_++)for(var b=arguments[_],C=i(b),l=C.length,V=0;V<l;V++){var R=C[V];(!s||u[R]===void 0)&&(u[R]=b[R])}return u}}var M_=Xf(Nh);var cf=Xf(Jn);var D_=Xf(Nh,!0);function II(){return function(){}}function k_(i){if(!iu(i))return{};if(A1)return A1(i);var s=II();s.prototype=i;var u=new s;return s.prototype=null,u}function Jw(i,s){var u=k_(i);return s&&cf(u,s),u}function Kw(i){return iu(i)?ou(i)?i.slice():M_({},i):i}function Qw(i,s){return s(i),i}function B1(i){return ou(i)?i:[i]}Yr.toPath=B1;function Bh(i){return Yr.toPath(i)}function Hf(i,s){for(var u=s.length,d=0;d<u;d++){if(i==null)return;i=i[s[d]]}return u?i:void 0}function z_(i,s,u){var d=Hf(i,Bh(s));return y_(d)?u:d}function t2(i,s){s=Bh(s);for(var u=s.length,d=0;d<u;d++){var _=s[d];if(!Ka(i,_))return!1;i=i[_]}return!!u}function Yf(i){return i}function Rp(i){return i=cf({},i),function(s){return A_(s,i)}}function Wf(i){return i=Bh(i),function(s){return Hf(s,i)}}function Vh(i,s,u){if(s===void 0)return i;switch(u??3){case 1:return function(d){return i.call(s,d)};case 3:return function(d,_,b){return i.call(s,d,_,b)};case 4:return function(d,_,b,C){return i.call(s,d,_,b,C)}}return function(){return i.apply(s,arguments)}}function R_(i,s,u){return i==null?Yf:ro(i)?Vh(i,s,u):iu(i)&&!ou(i)?Rp(i):Wf(i)}function by(i,s){return R_(i,s,1/0)}Yr.iteratee=by;function qi(i,s,u){return Yr.iteratee!==by?Yr.iteratee(i,s):R_(i,s,u)}function e2(i,s,u){s=qi(s,u);for(var d=Jn(i),_=d.length,b={},C=0;C<_;C++){var l=d[C];b[l]=s(i[l],l,i)}return b}function O_(){}function r2(i){return i==null?O_:function(s){return z_(i,s)}}function n2(i,s,u){var d=Array(Math.max(0,i));s=Vh(s,u,1);for(var _=0;_<i;_++)d[_]=s(_);return d}function wy(i,s){return s==null&&(s=i,i=0),i+Math.floor(Math.random()*(s-i+1))}var Kp=Date.now||function(){return new Date().getTime()};function F_(i){var s=function(b){return i[b]},u="(?:"+Jn(i).join("|")+")",d=RegExp(u),_=RegExp(u,"g");return function(b){return b=b==null?"":""+b,d.test(b)?b.replace(_,s):b}}var N_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var i2=F_(N_);var o2=L_(N_);var s2=F_(o2);var a2=Yr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V1=/(.)^/,CI={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},PI=/\\|'|\r|\n|\u2028|\u2029/g;function AI(i){return"\\"+CI[i]}var LI=/^\s*(\w|\$)+\s*$/;function l2(i,s,u){!s&&u&&(s=u),s=D_({},s,Yr.templateSettings);var d=RegExp([(s.escape||V1).source,(s.interpolate||V1).source,(s.evaluate||V1).source].join("|")+"|$","g"),_=0,b="__p+='";i.replace(d,function(R,et,at,st,yt){return b+=i.slice(_,yt).replace(PI,AI),_=yt+R.length,et?b+=`'+
((__t=(`+et+`))==null?'':_.escape(__t))+
'`:at?b+=`'+
((__t=(`+at+`))==null?'':__t)+
'`:st&&(b+=`';
`+st+`
__p+='`),R}),b+=`';
`;var C=s.variable;if(C){if(!LI.test(C))throw new Error("variable is not a bare identifier: "+C)}else b=`with(obj||{}){
`+b+`}
`,C="obj";b=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+b+`return __p;
`;var l;try{l=new Function(C,"_",b)}catch(R){throw R.source=b,R}var V=function(R){return l.call(this,R,Yr)};return V.source="function("+C+`){
`+b+"}",V}function u2(i,s,u){s=Bh(s);var d=s.length;if(!d)return ro(u)?u.call(i):u;for(var _=0;_<d;_++){var b=i?.[s[_]];b===void 0&&(b=u,_=d),i=ro(b)?b.call(i):b}return i}var MI=0;function c2(i){var s=++MI+"";return i?i+s:s}function h2(i){var s=Yr(i);return s._chain=!0,s}function B_(i,s,u,d,_){if(!(d instanceof s))return i.apply(u,_);var b=k_(i.prototype),C=i.apply(b,_);return iu(C)?C:b}var Uh=eo(function(i,s){var u=Uh.placeholder,d=function(){for(var _=0,b=s.length,C=Array(b),l=0;l<b;l++)C[l]=s[l]===u?arguments[_++]:s[l];for(;_<arguments.length;)C.push(arguments[_++]);return B_(i,d,this,this,C)};return d});Uh.placeholder=Yr;var V_=eo(function(i,s,u){if(!ro(i))throw new TypeError("Bind must be called on a function");var d=eo(function(_){return B_(i,d,s,this,u.concat(_))});return d});var lo=T_(ao);function Bu(i,s,u,d){if(d=d||[],!s&&s!==0)s=1/0;else if(s<=0)return d.concat(i);for(var _=d.length,b=0,C=ao(i);b<C;b++){var l=i[b];if(lo(l)&&(ou(l)||$f(l)))if(s>1)Bu(l,s-1,u,d),_=d.length;else for(var V=0,R=l.length;V<R;)d[_++]=l[V++];else u||(d[_++]=l)}return d}var p2=eo(function(i,s){s=Bu(s,!1,!1);var u=s.length;if(u<1)throw new Error("bindAll must be passed function names");for(;u--;){var d=s[u];i[d]=V_(i[d],i)}return i});function d2(i,s){var u=function(d){var _=u.cache,b=""+(s?s.apply(this,arguments):d);return Ka(_,b)||(_[b]=i.apply(this,arguments)),_[b]};return u.cache={},u}var U_=eo(function(i,s,u){return setTimeout(function(){return i.apply(null,u)},s)});var f2=Uh(U_,Yr,1);function m2(i,s,u){var d,_,b,C,l=0;u||(u={});var V=function(){l=u.leading===!1?0:Kp(),d=null,C=i.apply(_,b),d||(_=b=null)},R=function(){var et=Kp();!l&&u.leading===!1&&(l=et);var at=s-(et-l);return _=this,b=arguments,at<=0||at>s?(d&&(clearTimeout(d),d=null),l=et,C=i.apply(_,b),d||(_=b=null)):!d&&u.trailing!==!1&&(d=setTimeout(V,at)),C};return R.cancel=function(){clearTimeout(d),l=0,d=_=b=null},R}function g2(i,s,u){var d,_,b,C,l,V=function(){var et=Kp()-_;s>et?d=setTimeout(V,s-et):(d=null,u||(C=i.apply(l,b)),d||(b=l=null))},R=eo(function(et){return l=this,b=et,_=Kp(),d||(d=setTimeout(V,s),u&&(C=i.apply(l,b))),C});return R.cancel=function(){clearTimeout(d),d=b=l=null},R}function y2(i,s){return Uh(s,i)}function Jf(i){return function(){return!i.apply(this,arguments)}}function _2(){var i=arguments,s=i.length-1;return function(){for(var u=s,d=i[s].apply(this,arguments);u--;)d=i[u].call(this,d);return d}}function v2(i,s){return function(){if(--i<1)return s.apply(this,arguments)}}function j_(i,s){var u;return function(){return--i>0&&(u=s.apply(this,arguments)),i<=1&&(s=null),u}}var x2=Uh(j_,2);function G_(i,s,u){s=qi(s,u);for(var d=Jn(i),_,b=0,C=d.length;b<C;b++)if(_=d[b],s(i[_],_,i))return _}function q_(i){return function(s,u,d){u=qi(u,d);for(var _=ao(s),b=i>0?0:_-1;b>=0&&b<_;b+=i)if(u(s[b],b,s))return b;return-1}}var Kf=q_(1);var $_=q_(-1);function Z_(i,s,u,d){u=qi(u,d,1);for(var _=u(s),b=0,C=ao(i);b<C;){var l=Math.floor((b+C)/2);u(i[l])<_?b=l+1:C=l}return b}function X_(i,s,u){return function(d,_,b){var C=0,l=ao(d);if(typeof b=="number")i>0?C=b>=0?b:Math.max(b+l,C):l=b>=0?Math.min(b+1,l):b+l+1;else if(u&&b&&l)return b=u(d,_),d[b]===_?b:-1;if(_!==_)return b=s(Fh.call(d,C,l),S_),b>=0?b+C:-1;for(b=i>0?C:l-1;b>=0&&b<l;b+=i)if(d[b]===_)return b;return-1}}var H_=X_(1,Kf,Z_);var b2=X_(-1,$_);function Sy(i,s,u){var d=lo(i)?Kf:G_,_=d(i,s,u);if(_!==void 0&&_!==-1)return i[_]}function w2(i,s){return Sy(i,Rp(s))}function Qa(i,s,u){s=Vh(s,u);var d,_;if(lo(i))for(d=0,_=i.length;d<_;d++)s(i[d],d,i);else{var b=Jn(i);for(d=0,_=b.length;d<_;d++)s(i[b[d]],b[d],i)}return i}function Vu(i,s,u){s=qi(s,u);for(var d=!lo(i)&&Jn(i),_=(d||i).length,b=Array(_),C=0;C<_;C++){var l=d?d[C]:C;b[C]=s(i[l],l,i)}return b}function Y_(i){var s=function(u,d,_,b){var C=!lo(u)&&Jn(u),l=(C||u).length,V=i>0?0:l-1;for(b||(_=u[C?C[V]:V],V+=i);V>=0&&V<l;V+=i){var R=C?C[V]:V;_=d(_,u[R],R,u)}return _};return function(u,d,_,b){var C=arguments.length>=3;return s(u,Vh(d,b,4),_,C)}}var W_=Y_(1);var U1=Y_(-1);function ch(i,s,u){var d=[];return s=qi(s,u),Qa(i,function(_,b,C){s(_,b,C)&&d.push(_)}),d}function S2(i,s,u){return ch(i,Jf(qi(s)),u)}function j1(i,s,u){s=qi(s,u);for(var d=!lo(i)&&Jn(i),_=(d||i).length,b=0;b<_;b++){var C=d?d[b]:b;if(!s(i[C],C,i))return!1}return!0}function G1(i,s,u){s=qi(s,u);for(var d=!lo(i)&&Jn(i),_=(d||i).length,b=0;b<_;b++){var C=d?d[b]:b;if(s(i[C],C,i))return!0}return!1}function su(i,s,u,d){return lo(i)||(i=sc(i)),(typeof u!="number"||d)&&(u=0),H_(i,s,u)>=0}var E2=eo(function(i,s,u){var d,_;return ro(s)?_=s:(s=Bh(s),d=s.slice(0,-1),s=s[s.length-1]),Vu(i,function(b){var C=_;if(!C){if(d&&d.length&&(b=Hf(b,d)),b==null)return;C=b[s]}return C==null?C:C.apply(b,u)})});function Qf(i,s){return Vu(i,Wf(s))}function T2(i,s){return ch(i,Rp(s))}function J_(i,s,u){var d=-1/0,_=-1/0,b,C;if(s==null||typeof s=="number"&&typeof i[0]!="object"&&i!=null){i=lo(i)?i:sc(i);for(var l=0,V=i.length;l<V;l++)b=i[l],b!=null&&b>d&&(d=b)}else s=qi(s,u),Qa(i,function(R,et,at){C=s(R,et,at),(C>_||C===-1/0&&d===-1/0)&&(d=R,_=C)});return d}function I2(i,s,u){var d=1/0,_=1/0,b,C;if(s==null||typeof s=="number"&&typeof i[0]!="object"&&i!=null){i=lo(i)?i:sc(i);for(var l=0,V=i.length;l<V;l++)b=i[l],b!=null&&b<d&&(d=b)}else s=qi(s,u),Qa(i,function(R,et,at){C=s(R,et,at),(C<_||C===1/0&&d===1/0)&&(d=R,_=C)});return d}var DI=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function K_(i){return i?ou(i)?Fh.call(i):Gf(i)?i.match(DI):lo(i)?Vu(i,Yf):sc(i):[]}function Q_(i,s,u){if(s==null||u)return lo(i)||(i=sc(i)),i[wy(i.length-1)];var d=K_(i),_=ao(d);s=Math.max(Math.min(s,_),0);for(var b=_-1,C=0;C<s;C++){var l=wy(C,b),V=d[C];d[C]=d[l],d[l]=V}return d.slice(0,s)}function C2(i){return Q_(i,1/0)}function P2(i,s,u){var d=0;return s=qi(s,u),Qf(Vu(i,function(_,b,C){return{value:_,index:d++,criteria:s(_,b,C)}}).sort(function(_,b){var C=_.criteria,l=b.criteria;if(C!==l){if(C>l||C===void 0)return 1;if(C<l||l===void 0)return-1}return _.index-b.index}),"value")}function Qp(i,s){return function(u,d,_){var b=s?[[],[]]:{};return d=qi(d,_),Qa(u,function(C,l){var V=d(C,l,u);i(b,C,V)}),b}}var A2=Qp(function(i,s,u){Ka(i,u)?i[u].push(s):i[u]=[s]});var L2=Qp(function(i,s,u){i[u]=s});var M2=Qp(function(i,s,u){Ka(i,u)?i[u]++:i[u]=1});var D2=Qp(function(i,s,u){i[u?0:1].push(s)},!0);function k2(i){return i==null?0:lo(i)?i.length:Jn(i).length}function z2(i,s,u){return s in u}var t0=eo(function(i,s){var u={},d=s[0];if(i==null)return u;ro(d)?(s.length>1&&(d=Vh(d,s[1])),s=Nh(i)):(d=z2,s=Bu(s,!1,!1),i=Object(i));for(var _=0,b=s.length;_<b;_++){var C=s[_],l=i[C];d(l,C,i)&&(u[C]=l)}return u});var R2=eo(function(i,s){var u=s[0],d;return ro(u)?(u=Jf(u),s.length>1&&(d=s[1])):(s=Vu(Bu(s,!1,!1),String),u=function(_,b){return!su(s,b)}),t0(i,u,d)});function e0(i,s,u){return Fh.call(i,0,Math.max(0,i.length-(s==null||u?1:s)))}function r0(i,s,u){return i==null||i.length<1?s==null||u?void 0:[]:s==null||u?i[0]:e0(i,i.length-s)}function tm(i,s,u){return Fh.call(i,s==null||u?1:s)}function O2(i,s,u){return i==null||i.length<1?s==null||u?void 0:[]:s==null||u?i[i.length-1]:tm(i,Math.max(0,i.length-s))}function F2(i){return ch(i,Boolean)}function N2(i,s){return Bu(i,s,!1)}var n0=eo(function(i,s){return s=Bu(s,!0,!0),ch(i,function(u){return!su(s,u)})});var B2=eo(function(i,s){return n0(i,s)});function Ey(i,s,u,d){__(s)||(d=u,u=s,s=!1),u!=null&&(u=qi(u,d));for(var _=[],b=[],C=0,l=ao(i);C<l;C++){var V=i[C],R=u?u(V,C,i):V;s&&!u?((!C||b!==R)&&_.push(V),b=R):u?su(b,R)||(b.push(R),_.push(V)):su(_,V)||_.push(V)}return _}var V2=eo(function(i){return Ey(Bu(i,!0,!0))});function U2(i){for(var s=[],u=arguments.length,d=0,_=ao(i);d<_;d++){var b=i[d];if(!su(s,b)){var C;for(C=1;C<u&&su(arguments[C],b);C++);C===u&&s.push(b)}}return s}function Ty(i){for(var s=i&&J_(i,ao).length||0,u=Array(s),d=0;d<s;d++)u[d]=Qf(i,d);return u}var j2=eo(Ty);function G2(i,s){for(var u={},d=0,_=ao(i);d<_;d++)s?u[i[d]]=s[d]:u[i[d][0]]=i[d][1];return u}function q2(i,s,u){s==null&&(s=i||0,i=0),u||(u=s<i?-1:1);for(var d=Math.max(Math.ceil((s-i)/u),0),_=Array(d),b=0;b<d;b++,i+=u)_[b]=i;return _}function $2(i,s){if(s==null||s<1)return[];for(var u=[],d=0,_=i.length;d<_;)u.push(Fh.call(i,d,d+=s));return u}function Iy(i,s){return i._chain?Yr(s).chain():s}function i0(i){return Qa(xy(i),function(s){var u=Yr[s]=i[s];Yr.prototype[s]=function(){var d=[this._wrapped];return Sw.apply(d,arguments),Iy(this,u.apply(Yr,d))}}),Yr}Qa(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var s=vy[i];Yr.prototype[i]=function(){var u=this._wrapped;return u!=null&&(s.apply(u,arguments),(i==="shift"||i==="splice")&&u.length===0&&delete u[0]),Iy(this,u)}});Qa(["concat","join","slice"],function(i){var s=vy[i];Yr.prototype[i]=function(){var u=this._wrapped;return u!=null&&(u=s.apply(u,arguments)),Iy(this,u)}});var tl=i0(q1);tl._=tl;var pa=_e(Ee(),1);var em=_e(Ee(),1);var $1=_e(Ee(),1),Z1={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},X1=$1.default.createContext&&$1.default.createContext(Z1);var kI=["attr","size","title"];function zI(i,s){if(i==null)return{};var u=RI(i,s),d,_;if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(i);for(_=0;_<b.length;_++)d=b[_],!(s.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(i,d)&&(u[d]=i[d])}return u}function RI(i,s){if(i==null)return{};var u={},d=Object.keys(i),_,b;for(b=0;b<d.length;b++)_=d[b],!(s.indexOf(_)>=0)&&(u[_]=i[_]);return u}function s0(){return s0=Object.assign?Object.assign.bind():function(i){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(i[d]=u[d])}return i},s0.apply(this,arguments)}function Z2(i,s){var u=Object.keys(i);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);s&&(d=d.filter(function(_){return Object.getOwnPropertyDescriptor(i,_).enumerable})),u.push.apply(u,d)}return u}function a0(i){for(var s=1;s<arguments.length;s++){var u=arguments[s]!=null?arguments[s]:{};s%2?Z2(Object(u),!0).forEach(function(d){OI(i,d,u[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(u)):Z2(Object(u)).forEach(function(d){Object.defineProperty(i,d,Object.getOwnPropertyDescriptor(u,d))})}return i}function OI(i,s,u){return s=FI(s),s in i?Object.defineProperty(i,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[s]=u,i}function FI(i){var s=NI(i,"string");return typeof s=="symbol"?s:String(s)}function NI(i,s){if(typeof i!="object"||i===null)return i;var u=i[Symbol.toPrimitive];if(u!==void 0){var d=u.call(i,s||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(i)}function X2(i){return i&&i.map((s,u)=>em.default.createElement(s.tag,a0({key:u},s.attr),X2(s.child)))}function l0(i){return s=>em.default.createElement(BI,s0({attr:a0({},i.attr)},s),X2(i.child))}function BI(i){var s=u=>{var{attr:d,size:_,title:b}=i,C=zI(i,kI),l=_||u.size||"1em",V;return u.className&&(V=u.className),i.className&&(V=(V?V+" ":"")+i.className),em.default.createElement("svg",s0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},u.attr,d,C,{className:V,style:a0(a0({color:i.color||u.color},u.style),i.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),b&&em.default.createElement("title",null,b),i.children)};return X1!==void 0?em.default.createElement(X1.Consumer,null,u=>s(u)):s(Z1)}function H2(i){return l0({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"m14.12 10.163 1.715.858c.22.11.22.424 0 .534L8.267 15.34a.598.598 0 0 1-.534 0L.165 11.555a.299.299 0 0 1 0-.534l1.716-.858 5.317 2.659c.505.252 1.1.252 1.604 0l5.317-2.66zM7.733.063a.598.598 0 0 1 .534 0l7.568 3.784a.3.3 0 0 1 0 .535L8.267 8.165a.598.598 0 0 1-.534 0L.165 4.382a.299.299 0 0 1 0-.535L7.733.063z"},child:[]},{tag:"path",attr:{d:"m14.12 6.576 1.715.858c.22.11.22.424 0 .534l-7.568 3.784a.598.598 0 0 1-.534 0L.165 7.968a.299.299 0 0 1 0-.534l1.716-.858 5.317 2.659c.505.252 1.1.252 1.604 0l5.317-2.659z"},child:[]}]})(i)}function Y2(i){return l0({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M416 128 192 384l-96-96"},child:[]}]})(i)}var H1={exports:{}};(function(i,s){(function(u,d){i.exports=d()})(Jp,function(){var u,d,_;function b(l,V){if(!u)u=V;else if(!d)d=V;else{var R="var sharedChunk = {}; ("+u+")(sharedChunk); ("+d+")(sharedChunk);",et={};u(et),_=V(et),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}b(["exports"],function(l){function V(r,t,n,a){return new(n||(n=Promise))(function(h,g){function y(T){try{S(a.next(T))}catch(P){g(P)}}function v(T){try{S(a.throw(T))}catch(P){g(P)}}function S(T){var P;T.done?h(T.value):(P=T.value,P instanceof n?P:new n(function(M){M(P)})).then(y,v)}S((a=a.apply(r,t||[])).next())})}function R(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var et=at;function at(r,t){this.x=r,this.y=t}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,t){var n=Math.cos(r),a=Math.sin(r),h=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(r){return r instanceof at?r:Array.isArray(r)?new at(r[0],r[1]):r};var st=R(et),yt=xt;function xt(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}xt.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var h=this.sampleCurveX(n)-r;if(Math.abs(h)<t)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=r,a=0;a<20&&(h=this.sampleCurveX(n),!(Math.abs(h-r)<t));a++)r>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var It=R(yt);let Pt,qt;function Qt(){return Pt==null&&(Pt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pt}function se(){if(qt==null&&(qt=!1,Qt())){let r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let n=0;n<5*5;n++){let a=4*n;r.fillStyle=`rgb(${a},${a+1},${a+2})`,r.fillRect(n%5,Math.floor(n/5),1,1)}let t=r.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!=3&&t[n]!==n){qt=!0;break}}}return qt||!1}function le(r,t,n,a){let h=new It(r,t,n,a);return function(g){return h.solve(g)}}let Ue=le(.25,.1,.25,1);function ke(r,t,n){return Math.min(n,Math.max(t,r))}function er(r,t,n){let a=n-t,h=((r-t)%a+a)%a+t;return h===t?n:h}function Le(r,...t){for(let n of t)for(let a in n)r[a]=n[a];return r}let lr=1;function je(r,t,n){let a={};for(let h in r)a[h]=t.call(n||this,r[h],h,r);return a}function zr(r,t,n){let a={};for(let h in r)t.call(n||this,r[h],h,r)&&(a[h]=r[h]);return a}function nr(r){return Array.isArray(r)?r.map(nr):typeof r=="object"&&r?je(r,nr):r}let fn={};function de(r){fn[r]||(typeof console<"u"&&console.warn(r),fn[r]=!0)}function Ke(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Er(r){let t=0;for(let n,a,h=0,g=r.length,y=g-1;h<g;y=h++)n=r[h],a=r[y],t+=(a.x-n.x)*(n.y+a.y);return t}function Ar(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let xn=null;function pi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}let Qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ri(r,t,n,a,h){return V(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let g=new VideoFrame(r,{timestamp:0});try{let y=g?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let v=y.startsWith("BGR"),S=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(S,function(T,P,M,z,N){let B=4*Math.max(-P,0),q=(Math.max(0,M)-M)*z*4+B,W=4*z,Q=Math.max(0,P),ut=Math.max(0,M);return{rect:{x:Q,y:ut,width:Math.min(T.width,P+z)-Q,height:Math.min(T.height,M+N)-ut},layout:[{offset:q,stride:W}]}}(r,t,n,a,h)),v)for(let T=0;T<S.length;T+=4){let P=S[T];S[T]=S[T+2],S[T+2]=P}return S}finally{g.close()}})}let Sn,Ne,qr,zn,Ci={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){let t=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(r,t=0){return this.getImageCanvasContext(r).getImageData(-t,-t,r.width+2*t,r.height+2*t)},getImageCanvasContext(r){let t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=r.width,t.height=r.height,n.drawImage(r,0,0,r.width,r.height),n},resolveURL:r=>(qr||(qr=document.createElement("a")),qr.href=r,qr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(zn==null&&(zn=matchMedia("(prefers-reduced-motion: reduce)")),zn.matches)}},Os={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class oo extends Error{constructor(t,n,a,h){super(`AJAXError: ${n} (${t}): ${a}`),this.status=t,this.statusText=n,this.url=a,this.body=h}}let ln=Ar()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=r=>Os.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function na(r,t){let n=new AbortController,a=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:ln(),signal:n.signal}),h=!1,g=!1;return r.type==="json"&&a.headers.set("Accept","application/json"),g||fetch(a).then(y=>y.ok?(v=>{(r.type==="arrayBuffer"||r.type==="image"?v.arrayBuffer():r.type==="json"?v.json():v.text()).then(S=>{g||(h=!0,t(null,S,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(S=>{g||t(new Error(S.message))})})(y):y.blob().then(v=>t(new oo(y.status,y.statusText,r.url,v)))).catch(y=>{y.code!==20&&t(new Error(y.message))}),{cancel:()=>{g=!0,h||n.abort()}}}let Fo=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t);if(!Ar())return(Qe(r.url)||na)(r,t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(ln())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return na(r,t);if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t,void 0,!0)}var n;return function(a,h){let g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(g.responseType="arraybuffer");for(let y in a.headers)g.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(a.type==="json")try{y=JSON.parse(g.response)}catch(v){return h(v)}h(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{let y=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});h(new oo(g.status,g.statusText,a.url,y))}},g.send(a.body),{cancel:()=>g.abort()}}(r,t)},ba=function(r,t){return Fo(Le(r,{type:"arrayBuffer"}),t)};function Oi(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;let t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Fs(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Zr(r,t,n){if(n&&n[r]){let a=n[r].indexOf(t);a!==-1&&n[r].splice(a,1)}}class Mo{constructor(t,n={}){Le(this,n),this.type=t}}class No extends Mo{constructor(t,n={}){super("error",Le({error:t},n))}}class ls{on(t,n){return this._listeners=this._listeners||{},Fs(t,n,this._listeners),this}off(t,n){return Zr(t,n,this._listeners),Zr(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Fs(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){typeof t=="string"&&(t=new Mo(t,n||{}));let a=t.type;if(this.listens(a)){t.target=this;let h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let v of h)v.call(this,t);let g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let v of g)Zr(a,v,this._oneTimeListeners),v.call(this,t);let y=this._eventedParent;y&&(Le(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof No&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var _t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fi(r,t){let n={};for(let a in r)a!=="ref"&&(n[a]=r[a]);return Vn.forEach(a=>{a in t&&(n[a]=t[a])}),n}function ar(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!ar(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(let n in r)if(!ar(r[n],t[n]))return!1;return!0}return r===t}let Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ji(r,t,n){n.push({command:Ze.addSource,args:[r,t[r]]})}function ho(r,t,n){t.push({command:Ze.removeSource,args:[r]}),n[r]=!0}function Zi(r,t,n,a){ho(r,n,a),ji(r,t,n)}function ia(r,t,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!ar(r[n][a],t[n][a]))return!1;for(a in t[n])if(Object.prototype.hasOwnProperty.call(t[n],a)&&a!=="data"&&!ar(r[n][a],t[n][a]))return!1;return!0}function us(r,t,n,a,h,g){let y;for(y in t=t||{},r=r||{})Object.prototype.hasOwnProperty.call(r,y)&&(ar(r[y],t[y])||n.push({command:g,args:[a,y,t[y],h]}));for(y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(ar(r[y],t[y])||n.push({command:g,args:[a,y,t[y],h]}))}function Xi(r){return r.id}function Do(r,t){return r[t.id]=t,r}class Ot{constructor(t,n,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function Pi(r,...t){for(let n of t)for(let a in n)r[a]=n[a];return r}class Cr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class cs{constructor(t,n=[]){this.parent=t,this.bindings={};for(let[a,h]of n)this.bindings[a]=h}concat(t){return new cs(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Ai={kind:"null"},Nt={kind:"number"},Se={kind:"string"},ge={kind:"boolean"},bn={kind:"color"},Li={kind:"object"},ye={kind:"value"},Gi={kind:"collator"},X={kind:"formatted"},k={kind:"padding"},O={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function Y(r,t){return{kind:"array",itemType:r,N:t}}function J(r){if(r.kind==="array"){let t=J(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}let ht=[Ai,Nt,Se,ge,bn,X,Li,Y(ye),k,O,j];function nt(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!nt(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(let n of ht)if(!nt(n,t))return null}}return`Expected ${J(r)} but found ${J(t)} instead.`}function tt(r,t){return t.some(n=>n.kind===r.kind)}function it(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function bt(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}let wt=.96422,Tt=.82521,oe=4/29,me=6/29,Kt=3*me*me,ae=me*me*me,xe=Math.PI/180,We=180/Math.PI;function qe(r){return(r%=360)<0&&(r+=360),r}function $e([r,t,n,a]){let h,g,y=mn((.2225045*(r=Ge(r))+.7168786*(t=Ge(t))+.0606169*(n=Ge(n)))/1);r===t&&t===n?h=g=y:(h=mn((.4360747*r+.3850649*t+.1430804*n)/wt),g=mn((.0139322*r+.0971045*t+.7141733*n)/Tt));let v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),a]}function Ge(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function mn(r){return r>ae?Math.pow(r,1/3):r/Kt+oe}function hr([r,t,n,a]){let h=(r+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(n)?h:h-n/200;return h=1*Kr(h),g=wt*Kr(g),y=Tt*Kr(y),[Vr(3.1338561*g-1.6168667*h-.4906146*y),Vr(-.9787684*g+1.9161415*h+.033454*y),Vr(.0719453*g-.2289914*h+1.4052427*y),a]}function Vr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Kr(r){return r>me?r*r*r:Kt*(r-oe)}function mi(r){return parseInt(r.padEnd(2,r),16)/255}function Ul(r,t){return hs(t?r/100:r,0,1)}function hs(r,t,n){return Math.min(Math.max(t,r),n)}function ps(r){return!r.some(Number.isNaN)}let Hi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class tr{constructor(t,n,a,h=1,g=!0){this.r=t,this.g=n,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,a,h]))}static parse(t){if(t instanceof tr)return t;if(typeof t!="string")return;let n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let h=Hi[a];if(h){let[y,v,S]=h;return[y/255,v/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let y=a.length<6?1:2,v=1;return[mi(a.slice(v,v+=y)),mi(a.slice(v,v+=y)),mi(a.slice(v,v+=y)),mi(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){let y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[v,S,T,P,M,z,N,B,q,W,Q,ut]=y,rt=[P||" ",N||" ",W].join("");if(rt==="  "||rt==="  /"||rt===",,"||rt===",,,"){let pt=[T,z,q].join(""),ft=pt==="%%%"?100:pt===""?255:0;if(ft){let Et=[hs(+S/ft,0,1),hs(+M/ft,0,1),hs(+B/ft,0,1),Q?Ul(+Q,ut):1];if(ps(Et))return Et}}return}}let g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){let[y,v,S,T,P,M,z,N,B]=g,q=[S||" ",P||" ",z].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){let W=[+v,hs(+T,0,100),hs(+M,0,100),N?Ul(+N,B):1];if(ps(W))return function([Q,ut,rt,pt]){function ft(Et){let Zt=(Et+Q/30)%12,ee=ut*Math.min(rt,1-rt);return rt-ee*Math.max(-1,Math.min(Zt-3,9-Zt,1))}return Q=qe(Q),ut/=100,rt/=100,[ft(0),ft(8),ft(4),pt]}(W)}}}(t);return n?new tr(...n,!1):void 0}get rgb(){let{r:t,g:n,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,n/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){let[n,a,h,g]=$e(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?qe(Math.atan2(h,a)*We):NaN,y,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$e(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){let[t,n,a,h]=this.rgb;return`rgba(${[t,n,a].map(g=>Math.round(255*g)).join(",")},${h})`}}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1);class jl{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ts{constructor(t,n,a,h,g){this.text=t,this.image=n,this.scale=a,this.fontStack=h,this.textColor=g}}class Br{constructor(t){this.sections=t}static fromString(t){return new Br([new ts(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Br?t:Br.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Rn(t)}}toString(){return JSON.stringify(this.values)}}let ul=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class En{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof En)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){let a=t[n],h=t[n+1];if(typeof a!="string"||!ul.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new En(t)}}toString(){return JSON.stringify(this.values)}}class un{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new un({name:t,available:!1}):null}}function cl(r,t,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,n,a]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof tr||r instanceof jl||r instanceof Br||r instanceof Rn||r instanceof En||r instanceof un)return!0;if(Array.isArray(r)){for(let t of r)if(!Ns(t))return!1;return!0}if(typeof r=="object"){for(let t in r)if(!Ns(r[t]))return!1;return!0}return!1}function br(r){if(r===null)return Ai;if(typeof r=="string")return Se;if(typeof r=="boolean")return ge;if(typeof r=="number")return Nt;if(r instanceof tr)return bn;if(r instanceof jl)return Gi;if(r instanceof Br)return X;if(r instanceof Rn)return k;if(r instanceof En)return j;if(r instanceof un)return O;if(Array.isArray(r)){let t=r.length,n;for(let a of r){let h=br(a);if(n){if(n===h)continue;n=ye;break}n=h}return Y(n||ye,t)}return Li}function He(r){let t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof tr||r instanceof Br||r instanceof Rn||r instanceof En||r instanceof un?r.toString():JSON.stringify(r)}class Bo{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ns(t[1]))return n.error("invalid value");let a=t[1],h=br(a),g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Bo(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Tr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let Va={string:Se,number:Nt,boolean:ge,object:Li};class gi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,h=1,g=t[0];if(g==="array"){let v,S;if(t.length>2){let T=t[1];if(typeof T!="string"||!(T in Va)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Va[T],h++}else v=ye;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}a=Y(v,S)}else{if(!Va[g])throw new Error(`Types doesn't contain name = ${g}`);a=Va[g]}let y=[];for(;h<t.length;h++){let v=n.parse(t[h],h,ye);if(!v)return null;y.push(v)}return new gi(a,y)}evaluate(t){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(t);if(!nt(this.type,br(a)))return a;if(n===this.args.length-1)throw new Tr(`Expected value to be of type ${J(this.type)}, but found ${J(br(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let _u={"to-boolean":ge,"to-color":bn,"to-number":Nt,"to-string":Se};class Vo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a=t[0];if(!_u[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");let h=_u[a],g=[];for(let y=1;y<t.length;y++){let v=n.parse(t[y],y,ye);if(!v)return null;g.push(v)}return new Vo(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,a;for(let h of this.args){if(n=h.evaluate(t),a=null,n instanceof tr)return n;if(typeof n=="string"){let g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:cl(n[0],n[1],n[2],n[3]),!a))return new tr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Tr(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(let a of this.args){n=a.evaluate(t);let h=Rn.parse(n);if(h)return h}throw new Tr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(let a of this.args){n=a.evaluate(t);let h=En.parse(n);if(h)return h}throw new Tr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(let a of this.args){if(n=a.evaluate(t),n===null)return 0;let h=Number(n);if(!isNaN(h))return h}throw new Tr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Br.fromString(He(this.args[0].evaluate(t)));case"resolvedImage":return un.fromString(He(this.args[0].evaluate(t)));default:return He(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let Gl=["Unknown","Point","LineString","Polygon"];class D{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=tr.parse(t)),n}}class U{constructor(t,n,a=[],h,g=new cs,y=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=n}parse(t,n,a,h,g={}){return n?this.concat(n,a,h)._parse(t,g):this._parse(t,g)}_parse(t,n){function a(h,g,y){return y==="assert"?new gi(g,[h]):y==="coerce"?new Vo(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){let v=this.expectedType,S=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(v.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(v,S))return null}else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"assert")}if(!(y instanceof Bo)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let v=new D;try{y=new Bo(y.type,y.evaluate(v))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){let h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new U(this.registry,this._isConstant,h,n||null,g,this.errors)}error(t,...n){let a=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Cr(a,t))}checkSubtype(t,n){let a=nt(t,n);return a&&this.error(a),a}}class ct{constructor(t,n,a){this.type=Gi,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let h=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ge);if(!h)return null;let g=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ge);if(!g)return null;let y=null;return a.locale&&(y=n.parse(a.locale,1,Se),!y)?null:new ct(h,g,y)}evaluate(t){return new jl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}let vt=8192;function At(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Lt(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Rt(r,t){let n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*vt),Math.round(a*h*vt)]}function fe(r,t,n){let a=r[0]-t[0],h=r[1]-t[1],g=r[0]-n[0],y=r[1]-n[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function ve(r,t){let n=!1;for(let y=0,v=t.length;y<v;y++){let S=t[y];for(let T=0,P=S.length;T<P-1;T++){if(fe(r,S[T],S[T+1]))return!1;(h=S[T])[1]>(a=r)[1]!=(g=S[T+1])[1]>a[1]&&a[0]<(g[0]-h[0])*(a[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var a,h,g;return n}function Ce(r,t){for(let n=0;n<t.length;n++)if(ve(r,t[n]))return!0;return!1}function Ae(r,t,n,a){let h=a[0]-n[0],g=a[1]-n[1],y=(r[0]-n[0])*g-h*(r[1]-n[1]),v=(t[0]-n[0])*g-h*(t[1]-n[1]);return y>0&&v<0||y<0&&v>0}function Ie(r,t,n){for(let T of n)for(let P=0;P<T.length-1;++P)if((v=[(y=T[P+1])[0]-(g=T[P])[0],y[1]-g[1]])[0]*(S=[(h=t)[0]-(a=r)[0],h[1]-a[1]])[1]-v[1]*S[0]!=0&&Ae(a,h,g,y)&&Ae(g,y,a,h))return!0;var a,h,g,y,v,S;return!1}function dr(r,t){for(let n=0;n<r.length;++n)if(!ve(r[n],t))return!1;for(let n=0;n<r.length-1;++n)if(Ie(r[n],r[n+1],t))return!1;return!0}function ri(r,t){for(let n=0;n<t.length;n++)if(dr(r,t[n]))return!0;return!1}function fr(r,t,n){let a=[];for(let h=0;h<r.length;h++){let g=[];for(let y=0;y<r[h].length;y++){let v=Rt(r[h][y],n);At(t,v),g.push(v)}a.push(g)}return a}function Mi(r,t,n){let a=[];for(let h=0;h<r.length;h++){let g=fr(r[h],t,n);a.push(g)}return a}function ce(r,t,n,a){if(r[0]<n[0]||r[0]>n[2]){let h=.5*a,g=r[0]-n[0]>h?-a:n[0]-r[0]>h?a:0;g===0&&(g=r[0]-n[2]>h?-a:n[2]-r[0]>h?a:0),r[0]+=g}At(t,r)}function Xe(r,t,n,a){let h=Math.pow(2,a.z)*vt,g=[a.x*vt,a.y*vt],y=[];for(let v of r)for(let S of v){let T=[S.x+g[0],S.y+g[1]];ce(T,t,n,h),y.push(T)}return y}function cn(r,t,n,a){let h=Math.pow(2,a.z)*vt,g=[a.x*vt,a.y*vt],y=[];for(let S of r){let T=[];for(let P of S){let M=[P.x+g[0],P.y+g[1]];At(t,M),T.push(M)}y.push(T)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let S of y)for(let T of S)ce(T,t,n,h)}var v;return y}class wn{constructor(t,n){this.type=ge,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ns(t[1])){let a=t[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){let g=a.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new wn(a,a.features[h].geometry)}else if(a.type==="Feature"){let h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wn(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){let h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){let v=fr(a.coordinates,g,y),S=Xe(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!ve(T,v))return!1}if(a.type==="MultiPolygon"){let v=Mi(a.coordinates,g,y),S=Xe(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!Ce(T,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){let h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){let v=fr(a.coordinates,g,y),S=cn(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!dr(T,v))return!1}if(a.type==="MultiPolygon"){let v=Mi(a.coordinates,g,y),S=cn(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!ri(T,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Qn{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=t[1];return n.scope.has(a)?new Qn(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ni{constructor(t,n,a,h){this.name=t,this.type=n,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){let a=t[0],h=ni.definitions[a];if(!h)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([T])=>!Array.isArray(T)||T.length===t.length-1),S=null;for(let[T,P]of v){S=new U(n.registry,hl,n.path,null,n.scope);let M=[],z=!1;for(let N=1;N<t.length;N++){let B=t[N],q=Array.isArray(T)?T[N-1]:T.type,W=S.parse(B,1+M.length,q);if(!W){z=!0;break}M.push(W)}if(!z)if(Array.isArray(T)&&T.length!==M.length)S.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let N=0;N<M.length;N++){let B=Array.isArray(T)?T[N]:T.type,q=M[N];S.concat(N+1).checkSubtype(B,q.type)}if(S.errors.length===0)return new ni(a,g,P,M)}}if(v.length===1)n.errors.push(...S.errors);else{let T=(v.length?v:y).map(([M])=>{return z=M,Array.isArray(z)?`(${z.map(J).join(", ")})`:`(${J(z.type)}...)`;var z}).join(" | "),P=[];for(let M=1;M<t.length;M++){let z=n.parse(t[M],1+P.length);if(!z)return null;P.push(J(z.type))}n.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(t,n){ni.definitions=n;for(let a in n)t[a]=ni}}function hl(r){if(r instanceof Qn)return hl(r.boundExpression);if(r instanceof ni&&r.name==="error"||r instanceof ct||r instanceof wn)return!1;let t=r instanceof Vo||r instanceof gi,n=!0;return r.eachChild(a=>{n=t?n&&hl(a):n&&a instanceof Bo}),!!n&&gn(r)&&pl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function gn(r){if(r instanceof ni&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof wn)return!1;let t=!0;return r.eachChild(n=>{t&&!gn(n)&&(t=!1)}),t}function oa(r){if(r instanceof ni&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!oa(n)&&(t=!1)}),t}function pl(r,t){if(r instanceof ni&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!pl(a,t)&&(n=!1)}),n}function Yi(r,t){let n=r.length-1,a,h,g=0,y=n,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),a=r[v],h=r[v+1],a<=t){if(v===n||t<h)return v;g=v+1}else{if(!(a>t))throw new Tr("Input is not a number.");y=v-1}return 0}class ko{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(let[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(t[1],1,Nt);if(!a)return null;let h=[],g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let y=1;y<t.length;y+=2){let v=y===1?-1/0:t[y],S=t[y+1],T=y,P=y+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);let M=n.parse(S,P,g);if(!M)return null;g=g||M.type,h.push([v,M])}return new ko(g,a,h)}evaluate(t){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);let g=n.length;return h>=n[g-1]?a[g-1].evaluate(t):a[Yi(n,h)].evaluate(t)}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Oe(r,t,n){return r+n*(t-r)}function Ua(r,t,n){return r.map((a,h)=>Oe(a,t[h],n))}let Un={number:Oe,color:function(r,t,n,a="rgb"){switch(a){case"rgb":{let[h,g,y,v]=Ua(r.rgb,t.rgb,n);return new tr(h,g,y,v,!1)}case"hcl":{let[h,g,y,v]=r.hcl,[S,T,P,M]=t.hcl,z,N;if(isNaN(h)||isNaN(S))isNaN(h)?isNaN(S)?z=NaN:(z=S,y!==1&&y!==0||(N=T)):(z=h,P!==1&&P!==0||(N=g));else{let ut=S-h;S>h&&ut>180?ut-=360:S<h&&h-S>180&&(ut+=360),z=h+n*ut}let[B,q,W,Q]=function([ut,rt,pt,ft]){return ut=isNaN(ut)?0:ut*xe,hr([pt,Math.cos(ut)*rt,Math.sin(ut)*rt,ft])}([z,N??Oe(g,T,n),Oe(y,P,n),Oe(v,M,n)]);return new tr(B,q,W,Q,!1)}case"lab":{let[h,g,y,v]=hr(Ua(r.lab,t.lab,n));return new tr(h,g,y,v,!1)}}},array:Ua,padding:function(r,t,n){return new Rn(Ua(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){let a=r.values,h=t.values;if(a.length!==h.length)throw new Tr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);let g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new Tr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);let[v,S]=a[y+1],[T,P]=h[y+1];g.push([Oe(v,T,n),Oe(S,P,n)])}return new En(g)}};class ti{constructor(t,n,a,h,g){this.type=t,this.operator=n,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(let[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(t,n,a,h){let g=0;if(t.name==="exponential")g=ql(n,t.base,a,h);else if(t.name==="linear")g=ql(n,1,a,h);else if(t.name==="cubic-bezier"){let y=t.controlPoints;g=new It(y[0],y[1],y[2],y[3]).solve(ql(n,1,a,h))}return g}static parse(t,n){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let T=h[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let T=h.slice(1);if(T.length!==4||T.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Nt),!g)return null;let v=[],S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=bn:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let T=0;T<y.length;T+=2){let P=y[T],M=y[T+1],z=T+3,N=T+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);let B=n.parse(M,N,S);if(!B)return null;S=S||B.type,v.push([P,B])}return bt(S,Nt)||bt(S,bn)||bt(S,k)||bt(S,j)||bt(S,Y(Nt))?new ti(S,a,h,g,v):n.error(`Type ${J(S)} is not interpolatable.`)}evaluate(t){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);let g=n.length;if(h>=n[g-1])return a[g-1].evaluate(t);let y=Yi(n,h),v=ti.interpolationFactor(this.interpolation,h,n[y],n[y+1]),S=a[y].evaluate(t),T=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return Un[this.type.kind](S,T,v);case"interpolate-hcl":return Un.color(S,T,v,"hcl");case"interpolate-lab":return Un.color(S,T,v,"lab")}}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ql(r,t,n,a){let h=a-n,g=r-n;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class dl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null,h=n.expectedType;h&&h.kind!=="value"&&(a=h);let g=[];for(let v of t.slice(1)){let S=n.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,g.push(S)}if(!a)throw new Error("No output type");let y=h&&g.some(v=>nt(h,v.type));return new dl(y?ye:a,g)}evaluate(t){let n,a=null,h=0;for(let g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof un&&!a.available&&(n||(n=a.name),a=null,h===this.args.length&&(a=n)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class fl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let g=1;g<t.length-1;g+=2){let y=t[g];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);let v=n.parse(t[g+1],g+1);if(!v)return null;a.push([y,v])}let h=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return h?new fl(a,h):null}outputDefined(){return this.result.outputDefined()}}class vu{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,Nt),h=n.parse(t[2],2,Y(n.expectedType||ye));return a&&h?new vu(h.type.itemType,a,h):null}evaluate(t){let n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new Tr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Tr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Tr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $l{constructor(t,n){this.type=ge,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,ye);return a&&h?tt(a.type,[ge,Se,Nt,Ai,ye])?new $l(a,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`):null}evaluate(t){let n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!it(n,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${J(br(n))} instead.`);if(!it(a,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${J(br(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ja{constructor(t,n,a){this.type=Nt,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,ye);if(!a||!h)return null;if(!tt(a.type,[ge,Se,Nt,Ai,ye]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`);if(t.length===4){let g=n.parse(t[3],3,Nt);return g?new ja(a,h,g):null}return new ja(a,h)}evaluate(t){let n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!it(n,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${J(br(n))} instead.`);if(!it(a,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${J(br(a))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(t);return a.indexOf(n,h)}return a.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Zl{constructor(t,n,a,h,g,y){this.inputType=t,this.type=n,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);let g={},y=[];for(let T=2;T<t.length-1;T+=2){let P=t[T],M=t[T+1];Array.isArray(P)||(P=[P]);let z=n.concat(T);if(P.length===0)return z.error("Expected at least one branch label.");for(let B of P){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,br(B)))return null}else a=br(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=y.length}let N=n.parse(M,T,h);if(!N)return null;h=h||N.type,y.push(N)}let v=n.parse(t[1],1,ye);if(!v)return null;let S=n.parse(t[t.length-1],t.length-1,h);return S?v.type.kind!=="value"&&n.concat(1).checkSubtype(a,v.type)?null:new Zl(a,h,v,g,y,S):null}evaluate(t){let n=this.input.evaluate(t);return(br(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class xu{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let h=[];for(let y=1;y<t.length-1;y+=2){let v=n.parse(t[y],y,ge);if(!v)return null;let S=n.parse(t[y+1],y+1,a);if(!S)return null;h.push([v,S]),a=a||S.type}let g=n.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new xu(a,h,g)}evaluate(t){for(let[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class ml{constructor(t,n,a,h){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,Nt);if(!a||!h)return null;if(!tt(a.type,[Y(ye),Se,ye]))return n.error(`Expected first argument to be of type array or string, but found ${J(a.type)} instead`);if(t.length===4){let g=n.parse(t[3],3,Nt);return g?new ml(a.type,a,h,g):null}return new ml(a.type,a,h)}evaluate(t){let n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!it(n,["string","array"]))throw new Tr(`Expected first argument to be of type array or string, but found ${J(br(n))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(t);return n.slice(a,h)}return n.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Xl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function bu(r,t,n,a){return a.compare(t,n)===0}function Ss(r,t,n){let a=r!=="=="&&r!=="!=";return class W2{constructor(g,y,v){this.type=ge,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");let v=g[0],S=y.parse(g[1],1,ye);if(!S)return null;if(!Xl(v,S.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${J(S.type)}'.`);let T=y.parse(g[2],2,ye);if(!T)return null;if(!Xl(v,T.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${J(T.type)}'.`);if(S.type.kind!==T.type.kind&&S.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${J(S.type)}' and '${J(T.type)}'.`);a&&(S.type.kind==="value"&&T.type.kind!=="value"?S=new gi(T.type,[S]):S.type.kind!=="value"&&T.type.kind==="value"&&(T=new gi(S.type,[T])));let P=null;if(g.length===4){if(S.type.kind!=="string"&&T.type.kind!=="string"&&S.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(P=y.parse(g[3],3,Gi),!P)return null}return new W2(S,T,P)}evaluate(g){let y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){let S=br(y),T=br(v);if(S.kind!==T.kind||S.kind!=="string"&&S.kind!=="number")throw new Tr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let S=br(y),T=br(v);if(S.kind!=="string"||T.kind!=="string")return t(g,y,v)}return this.collator?n(g,y,v,this.collator.evaluate(g)):t(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}let sa=Ss("==",function(r,t,n){return t===n},bu),Mh=Ss("!=",function(r,t,n){return t!==n},function(r,t,n,a){return!bu(0,t,n,a)}),Dh=Ss("<",function(r,t,n){return t<n},function(r,t,n,a){return a.compare(t,n)<0}),np=Ss(">",function(r,t,n){return t>n},function(r,t,n,a){return a.compare(t,n)>0}),kh=Ss("<=",function(r,t,n){return t<=n},function(r,t,n,a){return a.compare(t,n)<=0}),ec=Ss(">=",function(r,t,n){return t>=n},function(r,t,n,a){return a.compare(t,n)>=0});class Hl{constructor(t,n,a,h,g){this.type=Se,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");let a=n.parse(t[1],1,Nt);if(!a)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,Se),!g))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,Se),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,Nt),!v))return null;let S=null;return h["max-fraction-digits"]&&(S=n.parse(h["max-fraction-digits"],1,Nt),!S)?null:new Hl(a,g,y,v,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ga{constructor(t){this.type=X,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let h=[],g=!1;for(let y=1;y<=t.length-1;++y){let v=t[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let S=null;if(v["font-scale"]&&(S=n.parse(v["font-scale"],1,Nt),!S))return null;let T=null;if(v["text-font"]&&(T=n.parse(v["text-font"],1,Y(Se)),!T))return null;let P=null;if(v["text-color"]&&(P=n.parse(v["text-color"],1,bn),!P))return null;let M=h[h.length-1];M.scale=S,M.font=T,M.textColor=P}else{let S=n.parse(t[y],1,ye);if(!S)return null;let T=S.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new Ga(h)}evaluate(t){return new Br(this.sections.map(n=>{let a=n.content.evaluate(t);return br(a)===O?new ts("",a,null,null,null):new ts(He(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(let n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class wu{constructor(t){this.type=O,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");let a=n.parse(t[1],1,Se);return a?new wu(a):n.error("No image name provided.")}evaluate(t){let n=this.input.evaluate(t),a=un.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Bs{constructor(t){this.type=Nt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${J(a.type)} instead.`):new Bs(a):null}evaluate(t){let n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Tr(`Expected value to be of type string or array, but found ${J(br(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Es={"==":sa,"!=":Mh,">":np,"<":Dh,">=":ec,"<=":kh,array:gi,at:vu,boolean:gi,case:xu,coalesce:dl,collator:ct,format:Ga,image:wu,in:$l,"index-of":ja,interpolate:ti,"interpolate-hcl":ti,"interpolate-lab":ti,length:Bs,let:fl,literal:Bo,match:Zl,number:gi,"number-format":Hl,object:gi,slice:ml,step:ko,string:gi,"to-boolean":Vo,"to-color":Vo,"to-number":Vo,"to-string":Vo,var:Qn,within:wn};function Ic(r,[t,n,a,h]){t=t.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);let g=h?h.evaluate(r):1,y=cl(t,n,a,g);if(y)throw new Tr(y);return new tr(t/255,n/255,a/255,g,!1)}function Cc(r,t){return r in t}function gl(r,t){let n=t[r];return n===void 0?null:n}function po(r){return{type:r}}function Su(r){return{result:"success",value:r}}function fo(r){return{result:"error",value:r}}function ds(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function yl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Eu(r){return!!r.expression&&r.expression.interpolated}function Ye(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function wr(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ip(r){return r}function Be(r,t){let n=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),g=r.type||(Eu(t)?"exponential":"interval");if(n||t.type==="padding"){let P=n?tr.parse:Rn.parse;(r=Pi({},r)).stops&&(r.stops=r.stops.map(M=>[M[0],P(M[1])])),r.default=P(r.default?r.default:t.default)}if(r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;let v,S,T;if(g==="exponential")v=mo;else if(g==="interval")v=ur;else if(g==="categorical"){v=gr,S=Object.create(null);for(let P of r.stops)S[P[0]]=P[1];T=typeof r.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=wa}if(a){let P={},M=[];for(let B=0;B<r.stops.length;B++){let q=r.stops[B],W=q[0].zoom;P[W]===void 0&&(P[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},M.push(W)),P[W].stops.push([q[0].value,q[1]])}let z=[];for(let B of M)z.push([P[B].zoom,Be(P[B],t)]);let N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:ti.interpolationFactor.bind(void 0,N),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},q)=>mo({stops:z,base:r.base},t,B).evaluate(B,q)}}if(h){let P=g==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ti.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>v(r,t,M,S,T)}}return{kind:"source",evaluate(P,M){let z=M&&M.properties?M.properties[r.property]:void 0;return z===void 0?es(r.default,t.default):v(r,t,z,S,T)}}}function es(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function gr(r,t,n,a,h){return es(typeof n===h?a[n]:void 0,r.default,t.default)}function ur(r,t,n){if(Ye(n)!=="number")return es(r.default,t.default);let a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];let h=Yi(r.stops.map(g=>g[0]),n);return r.stops[h][1]}function mo(r,t,n){let a=r.base!==void 0?r.base:1;if(Ye(n)!=="number")return es(r.default,t.default);let h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];let g=Yi(r.stops.map(P=>P[0]),n),y=function(P,M,z,N){let B=N-z,q=P-z;return B===0?0:M===1?q/B:(Math.pow(M,q)-1)/(Math.pow(M,B)-1)}(n,a,r.stops[g][0],r.stops[g+1][0]),v=r.stops[g][1],S=r.stops[g+1][1],T=Un[t.type]||ip;return typeof v.evaluate=="function"?{evaluate(...P){let M=v.evaluate.apply(void 0,P),z=S.evaluate.apply(void 0,P);if(M!==void 0&&z!==void 0)return T(M,z,y,r.colorSpace)}}:T(v,S,y,r.colorSpace)}function wa(r,t,n){switch(t.type){case"color":n=tr.parse(n);break;case"formatted":n=Br.fromString(n.toString());break;case"resolvedImage":n=un.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;default:Ye(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return es(n,r.default,t.default)}ni.register(Es,{error:[{kind:"error"},[Se],(r,[t])=>{throw new Tr(t.evaluate(r))}],typeof:[Se,[ye],(r,[t])=>J(br(t.evaluate(r)))],"to-rgba":[Y(Nt,4),[bn],(r,[t])=>{let[n,a,h,g]=t.evaluate(r).rgb;return[255*n,255*a,255*h,g]}],rgb:[bn,[Nt,Nt,Nt],Ic],rgba:[bn,[Nt,Nt,Nt,Nt],Ic],has:{type:ge,overloads:[[[Se],(r,[t])=>Cc(t.evaluate(r),r.properties())],[[Se,Li],(r,[t,n])=>Cc(t.evaluate(r),n.evaluate(r))]]},get:{type:ye,overloads:[[[Se],(r,[t])=>gl(t.evaluate(r),r.properties())],[[Se,Li],(r,[t,n])=>gl(t.evaluate(r),n.evaluate(r))]]},"feature-state":[ye,[Se],(r,[t])=>gl(t.evaluate(r),r.featureState||{})],properties:[Li,[],r=>r.properties()],"geometry-type":[Se,[],r=>r.geometryType()],id:[ye,[],r=>r.id()],zoom:[Nt,[],r=>r.globals.zoom],"heatmap-density":[Nt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Nt,[],r=>r.globals.lineProgress||0],accumulated:[ye,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Nt,po(Nt),(r,t)=>{let n=0;for(let a of t)n+=a.evaluate(r);return n}],"*":[Nt,po(Nt),(r,t)=>{let n=1;for(let a of t)n*=a.evaluate(r);return n}],"-":{type:Nt,overloads:[[[Nt,Nt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Nt],(r,[t])=>-t.evaluate(r)]]},"/":[Nt,[Nt,Nt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Nt,[Nt,Nt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Nt,[Nt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))],log2:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Nt,[Nt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Nt,[Nt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Nt,[Nt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Nt,[Nt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Nt,[Nt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Nt,[Nt],(r,[t])=>Math.atan(t.evaluate(r))],min:[Nt,po(Nt),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Nt,po(Nt),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Nt,[Nt],(r,[t])=>Math.abs(t.evaluate(r))],round:[Nt,[Nt],(r,[t])=>{let n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Nt,[Nt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Nt,[Nt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[ge,[Se,ye],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[ge,[ye],(r,[t])=>r.id()===t.value],"filter-type-==":[ge,[Se],(r,[t])=>r.geometryType()===t.value],"filter-<":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a>h}],"filter-id->":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[ge,[ye],(r,[t])=>t.value in r.properties()],"filter-has-id":[ge,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ge,[Y(Se)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[ge,[Y(ye)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[ge,[Se,Y(ye)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[ge,[Se,Y(ye)],(r,[t,n])=>function(a,h,g,y){for(;g<=y;){let v=g+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:g=v+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ge,overloads:[[[ge,ge],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[po(ge),(r,t)=>{for(let n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:ge,overloads:[[[ge,ge],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[po(ge),(r,t)=>{for(let n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[ge,[ge],(r,[t])=>!t.evaluate(r)],"is-supported-script":[ge,[Se],(r,[t])=>{let n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[Se,[Se],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Se,[Se],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Se,po(ye),(r,t)=>t.map(n=>He(n.evaluate(r))).join("")],"resolved-locale":[Se,[Gi],(r,[t])=>t.evaluate(r).resolvedLocale()]});class qa{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new D,this._defaultValue=n?(a=n).type==="color"&&wr(a.default)?new tr(0,0,0,0):a.type==="color"?tr.parse(a.default)||null:a.type==="padding"?Rn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?En.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{let v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Tr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function rs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Es}function _l(r,t){let n=new U(Es,hl,[],t?function(h){let g={color:bn,string:Se,number:Nt,enum:Se,boolean:ge,formatted:X,padding:k,resolvedImage:O,variableAnchorOffsetCollection:j};return h.type==="array"?Y(g[h.value]||ye,h.length):g[h.type]}(t):void 0),a=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Su(new qa(a,t)):fo(n.errors)}class $a{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!oa(n.expression)}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,g,y)}evaluate(t,n,a,h,g,y){return this._styleExpression.evaluate(t,n,a,h,g,y)}}class Vs{constructor(t,n,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!oa(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,g,y)}evaluate(t,n,a,h,g,y){return this._styleExpression.evaluate(t,n,a,h,g,y)}interpolationFactor(t,n,a){return this.interpolationType?ti.interpolationFactor(this.interpolationType,t,n,a):0}}function Yl(r,t){let n=_l(r,t);if(n.result==="error")return n;let a=n.value.expression,h=gn(a);if(!h&&!ds(t))return fo([new Cr("","data expressions not supported")]);let g=pl(a,["zoom"]);if(!g&&!yl(t))return fo([new Cr("","zoom expressions not supported")]);let y=Sa(a);return y||g?y instanceof Cr?fo([y]):y instanceof ti&&!Eu(t)?fo([new Cr("",'"interpolate" expressions cannot be used with this property')]):Su(y?new Vs(h?"camera":"composite",n.value,y.labels,y instanceof ti?y.interpolation:void 0):new $a(h?"constant":"source",n.value)):fo([new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class aa{constructor(t,n){this._parameters=t,this._specification=n,Pi(this,Be(this._parameters,this._specification))}static deserialize(t){return new aa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Sa(r){let t=null;if(r instanceof fl)t=Sa(r.result);else if(r instanceof dl){for(let n of r.args)if(t=Sa(n),t)break}else(r instanceof ko||r instanceof ti)&&r.input instanceof ni&&r.input.name==="zoom"&&(t=r);return t instanceof Cr||r.eachChild(n=>{let a=Sa(n);a instanceof Cr?t=a:!t&&a?t=new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ea(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let t of r.slice(1))if(!Ea(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let zh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ea(r)||(r=vl(r));let t=_l(r,zh);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,h)=>t.value.evaluate(n,a,{},h),needGeometry:Za(r)}}function rc(r,t){return r<t?-1:r>t?1:0}function Za(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let t=1;t<r.length;t++)if(Za(r[t]))return!0;return!1}function vl(r){if(!r)return!0;let t=r[0];return r.length<=1?t!=="any":t==="=="?Ts(r[1],r[2],"=="):t==="!="?la(Ts(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ts(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(vl))):t==="all"?["all"].concat(r.slice(1).map(vl)):t==="none"?["all"].concat(r.slice(1).map(vl).map(la)):t==="in"?Pc(r[1],r.slice(2)):t==="!in"?la(Pc(r[1],r.slice(2))):t==="has"?Ta(r[1]):t==="!has"?la(Ta(r[1])):t!=="within"||r;var n}function Ts(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Pc(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(rc)]]:["filter-in-small",r,["literal",t]]}}function Ta(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function la(r){return["!",r]}function xl(r){let t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(let g of r)h+=`${xl(g)},`;return`${h}]`}let n=Object.keys(r).sort(),a="{";for(let h=0;h<n.length;h++)a+=`${JSON.stringify(n[h])}:${xl(r[n[h]])},`;return`${a}}`}function ua(r){let t="";for(let n of Vn)t+=`/${xl(r[n])}`;return t}function Tu(r){let t=r.value;return t?[new Ot(r.key,t,"constants have been deprecated as of v8")]:[]}function Ir(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ns(r){if(Array.isArray(r))return r.map(ns);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let t={};for(let n in r)t[n]=ns(r[n]);return t}return Ir(r)}function On(r){let t=r.key,n=r.value,a=r.valueSpec||{},h=r.objectElementValidators||{},g=r.style,y=r.styleSpec,v=r.validateSpec,S=[],T=Ye(n);if(T!=="object")return[new Ot(t,n,`object expected, ${T} found`)];for(let P in n){let M=P.split(".")[0],z=a[M]||a["*"],N;if(h[M])N=h[M];else if(a[M])N=v;else if(h["*"])N=h["*"];else{if(!a["*"]){S.push(new Ot(t,n[P],`unknown property "${P}"`));continue}N=v}S=S.concat(N({key:(t&&`${t}.`)+P,value:n[P],valueSpec:z,style:g,styleSpec:y,object:n,objectKey:P,validateSpec:v},n))}for(let P in a)h[P]||a[P].required&&a[P].default===void 0&&n[P]===void 0&&S.push(new Ot(t,n,`missing required property "${P}"`));return S}function Uo(r){let t=r.value,n=r.valueSpec,a=r.style,h=r.styleSpec,g=r.key,y=r.arrayElementValidator||r.validateSpec;if(Ye(t)!=="array")return[new Ot(g,t,`array expected, ${Ye(t)} found`)];if(n.length&&t.length!==n.length)return[new Ot(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ot(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};h.$version<7&&(v.function=n.function),Ye(n.value)==="object"&&(v=n.value);let S=[];for(let T=0;T<t.length;T++)S=S.concat(y({array:t,arrayIndex:T,value:t[T],valueSpec:v,validateSpec:r.validateSpec,style:a,styleSpec:h,key:`${g}[${T}]`}));return S}function ca(r){let t=r.key,n=r.value,a=r.valueSpec,h=Ye(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Ot(t,n,`number expected, ${h} found`)]:"minimum"in a&&n<a.minimum?[new Ot(t,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new Ot(t,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function bl(r){let t=r.valueSpec,n=Ir(r.value.type),a,h,g,y={},v=n!=="categorical"&&r.value.property===void 0,S=!v,T=Ye(r.value.stops)==="array"&&Ye(r.value.stops[0])==="array"&&Ye(r.value.stops[0][0])==="object",P=On({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(N){if(n==="identity")return[new Ot(N.key,N.value,'identity function may not have a "stops" property')];let B=[],q=N.value;return B=B.concat(Uo({key:N.key,value:q,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:M})),Ye(q)==="array"&&q.length===0&&B.push(new Ot(N.key,q,"array must have at least one stop")),B},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return n==="identity"&&v&&P.push(new Ot(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||P.push(new Ot(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Eu(r.valueSpec)&&P.push(new Ot(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!ds(r.valueSpec)?P.push(new Ot(r.key,r.value,"property functions not supported")):v&&!yl(r.valueSpec)&&P.push(new Ot(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!T||r.value.property!==void 0||P.push(new Ot(r.key,r.value,'"property" property is required')),P;function M(N){let B=[],q=N.value,W=N.key;if(Ye(q)!=="array")return[new Ot(W,q,`array expected, ${Ye(q)} found`)];if(q.length!==2)return[new Ot(W,q,`array length 2 expected, length ${q.length} found`)];if(T){if(Ye(q[0])!=="object")return[new Ot(W,q,`object expected, ${Ye(q[0])} found`)];if(q[0].zoom===void 0)return[new Ot(W,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Ot(W,q,"object stop key must have value")];if(g&&g>Ir(q[0].zoom))return[new Ot(W,q[0].zoom,"stop zoom values must appear in ascending order")];Ir(q[0].zoom)!==g&&(g=Ir(q[0].zoom),h=void 0,y={}),B=B.concat(On({key:`${W}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:ca,value:z}}))}else B=B.concat(z({key:`${W}[0]`,value:q[0],valueSpec:{},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},q));return rs(ns(q[1]))?B.concat([new Ot(`${W}[1]`,q[1],"expressions are not allowed in function stops.")]):B.concat(N.validateSpec({key:`${W}[1]`,value:q[1],valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function z(N,B){let q=Ye(N.value),W=Ir(N.value),Q=N.value!==null?N.value:B;if(a){if(q!==a)return[new Ot(N.key,Q,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Ot(N.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let ut=`number expected, ${q} found`;return ds(t)&&n===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(N.key,Q,ut)]}return n!=="categorical"||q!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&q==="number"&&h!==void 0&&W<h?[new Ot(N.key,Q,"stop domain values must appear in ascending order")]:(h=W,n==="categorical"&&W in y?[new Ot(N.key,Q,"stop domain values must be unique")]:(y[W]=!0,[])):[new Ot(N.key,Q,`integer expected, found ${W}`)]}}function kt(r){let t=(r.expressionContext==="property"?Yl:_l)(ns(r.value),r.valueSpec);if(t.result==="error")return t.value.map(a=>new Ot(`${r.key}${a.key}`,r.value,a.message));let n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ot(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!oa(n))return[new Ot(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!oa(n))return[new Ot(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!pl(n,["zoom","feature-state"]))return[new Ot(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!gn(n))return[new Ot(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wt(r){let t=r.key,n=r.value,a=r.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Ir(n))===-1&&h.push(new Ot(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(Ir(n))===-1&&h.push(new Ot(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function we(r){return Ea(ns(r.value))?kt(Pi({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rr(r)}function rr(r){let t=r.value,n=r.key;if(Ye(t)!=="array")return[new Ot(n,t,`array expected, ${Ye(t)} found`)];let a=r.styleSpec,h,g=[];if(t.length<1)return[new Ot(n,t,"filter array must have at least 1 element")];switch(g=g.concat(Wt({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ir(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ir(t[1])==="$type"&&g.push(new Ot(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ot(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Ye(t[1]),h!=="string"&&g.push(new Ot(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Ye(t[y]),Ir(t[1])==="$type"?g=g.concat(Wt({key:`${n}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ot(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(rr({key:`${n}[${y}]`,value:t[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Ye(t[1]),t.length!==2?g.push(new Ot(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ot(`${n}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Ye(t[1]),t.length!==2?g.push(new Ot(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&g.push(new Ot(`${n}[1]`,t[1],`object expected, ${h} found`))}return g}function jn(r,t){let n=r.key,a=r.validateSpec,h=r.style,g=r.styleSpec,y=r.value,v=r.objectKey,S=g[`${t}_${r.layerType}`];if(!S)return[];let T=v.match(/^(.*)-transition$/);if(t==="paint"&&T&&S[T[1]]&&S[T[1]].transition)return a({key:n,value:y,valueSpec:g.transition,style:h,styleSpec:g});let P=r.valueSpec||S[v];if(!P)return[new Ot(n,y,`unknown property "${v}"`)];let M;if(Ye(y)==="string"&&ds(P)&&!P.tokens&&(M=/^{([^}]+)}$/.exec(y)))return[new Ot(n,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];let z=[];return r.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&z.push(new Ot(n,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&wr(ns(y))&&Ir(y.type)==="identity"&&z.push(new Ot(n,y,'"text-font" does not support identity functions'))),z.concat(a({key:r.key,value:y,valueSpec:P,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function $r(r){return jn(r,"paint")}function yi(r){return jn(r,"layout")}function Di(r){let t=[],n=r.value,a=r.key,h=r.style,g=r.styleSpec;n.type||n.ref||t.push(new Ot(a,n,'either "type" or "ref" is required'));let y=Ir(n.type),v=Ir(n.ref);if(n.id){let S=Ir(n.id);for(let T=0;T<r.arrayIndex;T++){let P=h.layers[T];Ir(P.id)===S&&t.push(new Ot(a,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&t.push(new Ot(a,n[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{Ir(T.id)===v&&(S=T)}),S?S.ref?t.push(new Ot(a,n.ref,"ref cannot reference another ref layer")):y=Ir(S.type):t.push(new Ot(a,n.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(n.source){let S=h.sources&&h.sources[n.source],T=S&&Ir(S.type);S?T==="vector"&&y==="raster"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&y==="hillshade"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&y!=="raster"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&y!=="hillshade"?t.push(new Ot(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&S.lineMetrics||t.push(new Ot(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ot(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ot(a,n.source,`source "${n.source}" not found`))}else t.push(new Ot(a,n,'missing required property "source"'));return t=t.concat(On({key:a,value:n,valueSpec:g.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:g.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:we,layout:S=>On({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":T=>yi(Pi({layerType:y},T))}}),paint:S=>On({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":T=>$r(Pi({layerType:y},T))}})}})),t}function Tn(r){let t=r.value,n=r.key,a=Ye(t);return a!=="string"?[new Ot(n,t,`string expected, ${a} found`)]:[]}let Gn={promoteId:function({key:r,value:t}){if(Ye(t)==="string")return Tn({key:r,value:t});{let n=[];for(let a in t)n.push(...Tn({key:`${r}.${a}`,value:t[a]}));return n}}};function Mr(r){let t=r.value,n=r.key,a=r.styleSpec,h=r.style,g=r.validateSpec;if(!t.type)return[new Ot(n,t,'"type" is required')];let y=Ir(t.type),v;switch(y){case"vector":case"raster":return v=On({key:n,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Gn,validateSpec:g}),v;case"raster-dem":return v=function(S){var T;let P=(T=S.sourceName)!==null&&T!==void 0?T:"",M=S.value,z=S.styleSpec,N=z.source_raster_dem,B=S.style,q=[],W=Ye(M);if(M===void 0)return q;if(W!=="object")return q.push(new Ot("source_raster_dem",M,`object expected, ${W} found`)),q;let Q=Ir(M.encoding)==="custom",ut=["redFactor","greenFactor","blueFactor","baseShift"],rt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(let pt in M)!Q&&ut.includes(pt)?q.push(new Ot(pt,M[pt],`In "${P}": "${pt}" is only valid when "encoding" is set to "custom". ${rt} encoding found`)):N[pt]?q=q.concat(S.validateSpec({key:pt,value:M[pt],valueSpec:N[pt],validateSpec:S.validateSpec,style:B,styleSpec:z})):q.push(new Ot(pt,M[pt],`unknown property "${pt}"`));return q}({sourceName:n,value:t,style:r.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=On({key:n,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:Gn}),t.cluster)for(let S in t.clusterProperties){let[T,P]=t.clusterProperties[S],M=typeof T=="string"?[T,["accumulated"],["get",S]]:T;v.push(...kt({key:`${n}.${S}.map`,value:P,validateSpec:g,expressionContext:"cluster-map"})),v.push(...kt({key:`${n}.${S}.reduce`,value:M,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return On({key:n,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return On({key:n,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Ot(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wt({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:a})}}function so(r){let t=r.value,n=r.styleSpec,a=n.light,h=r.style,g=[],y=Ye(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ot("light",t,`object expected, ${y} found`)]),g;for(let v in t){let S=v.match(/^(.*)-transition$/);g=g.concat(S&&a[S[1]]&&a[S[1]].transition?r.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):a[v]?r.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Ot(v,t[v],`unknown property "${v}"`)])}return g}function Us(r){let t=r.value,n=r.styleSpec,a=n.terrain,h=r.style,g=[],y=Ye(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ot("terrain",t,`object expected, ${y} found`)]),g;for(let v in t)g=g.concat(a[v]?r.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Ot(v,t[v],`unknown property "${v}"`)]);return g}function go(r){let t=[],n=r.value,a=r.key;if(Array.isArray(n)){let h=[],g=[];for(let y in n)n[y].id&&h.includes(n[y].id)&&t.push(new Ot(a,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&g.includes(n[y].url)&&t.push(new Ot(a,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),g.push(n[y].url),t=t.concat(On({key:`${a}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Tn({key:a,value:n})}let js={"*":()=>[],array:Uo,boolean:function(r){let t=r.value,n=r.key,a=Ye(t);return a!=="boolean"?[new Ot(n,t,`boolean expected, ${a} found`)]:[]},number:ca,color:function(r){let t=r.key,n=r.value,a=Ye(n);return a!=="string"?[new Ot(t,n,`color expected, ${a} found`)]:tr.parse(String(n))?[]:[new Ot(t,n,`color expected, "${n}" found`)]},constants:Tu,enum:Wt,filter:we,function:bl,layer:Di,object:On,source:Mr,light:so,terrain:Us,string:Tn,formatted:function(r){return Tn(r).length===0?[]:kt(r)},resolvedImage:function(r){return Tn(r).length===0?[]:kt(r)},padding:function(r){let t=r.key,n=r.value;if(Ye(n)==="array"){if(n.length<1||n.length>4)return[new Ot(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];let a={type:"number"},h=[];for(let g=0;g<n.length;g++)h=h.concat(r.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:r.validateSpec,valueSpec:a}));return h}return ca({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){let t=r.key,n=r.value,a=Ye(n),h=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new Ot(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<n.length;y+=2)g=g.concat(Wt({key:`${t}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Uo({key:`${t}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return g},sprite:go};function ki(r){let t=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=ki,n.expression&&wr(Ir(t))?bl(r):n.expression&&rs(ns(t))?kt(r):n.type&&js[n.type]?js[n.type](r):On(Pi({},r,{valueSpec:n.type?a[n.type]:n}))}function Jl(r){let t=r.value,n=r.key,a=Tn(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ot(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ot(n,t,'"glyphs" url must include a "{range}" token'))),a}function Fn(r,t=_t){let n=[];return n=n.concat(ki({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:ki,objectElementValidators:{glyphs:Jl,"*":()=>[]}})),r.constants&&(n=n.concat(Tu({key:"constants",value:r.constants,style:r,styleSpec:t,validateSpec:ki}))),Xa(n)}function Fi(r){return function(t){return r({...t,validateSpec:ki})}}function Xa(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function yo(r){return function(...t){return Xa(r.apply(this,t))}}Fn.source=yo(Fi(Mr)),Fn.sprite=yo(Fi(go)),Fn.glyphs=yo(Fi(Jl)),Fn.light=yo(Fi(so)),Fn.terrain=yo(Fi(Us)),Fn.layer=yo(Fi(Di)),Fn.filter=yo(Fi(we)),Fn.paintProperty=yo(Fi($r)),Fn.layoutProperty=yo(Fi(yi));let _o=Fn,qn=_o.light,hn=_o.paintProperty,Kl=_o.layoutProperty;function is(r,t){let n=!1;if(t&&t.length)for(let a of t)r.fire(new No(new Error(a.message))),n=!0;return n}class fs{constructor(t,n,a){let h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(n=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){let T=y[3+S],P=y[3+S+1];h.push(T===P?null:y.subarray(T,P))}let v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;let g=a/n*t;this.min=-g,this.max=t+g}insert(t,n,a,h,g){this._forEachCell(n,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,a,h,g,y){this.cells[g].push(y)}query(t,n,a,h,g){let y=this.min,v=this.max;if(t<=y&&n<=y&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{let S=[];return this._forEachCell(t,n,a,h,this._queryCell,S,{},g),S}}_queryCell(t,n,a,h,g,y,v,S){let T=this.cells[g];if(T!==null){let P=this.keys,M=this.bboxes;for(let z=0;z<T.length;z++){let N=T[z];if(v[N]===void 0){let B=4*N;(S?S(M[B+0],M[B+1],M[B+2],M[B+3]):t<=M[B+2]&&n<=M[B+3]&&a>=M[B+0]&&h>=M[B+1])?(v[N]=!0,y.push(P[N])):v[N]=!1}}}}_forEachCell(t,n,a,h,g,y,v,S){let T=this._convertToCellCoord(t),P=this._convertToCellCoord(n),M=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let N=T;N<=M;N++)for(let B=P;B<=z;B++){let q=this.d*B+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(B),this._convertFromCellCoord(N+1),this._convertFromCellCoord(B+1)))&&g.call(this,t,n,a,h,q,y,v,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,n=3+this.cells.length+1+1,a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;let h=new Int32Array(n+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let y=0;y<t.length;y++){let v=t[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,n){let a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(t){return new fs(t.buffer)}}let Nn={};function Ht(r,t,n={}){if(Nn[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Nn[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",fs),Ht("Color",tr),Ht("Error",Error),Ht("AJAXError",oo),Ht("ResolvedImage",un),Ht("StylePropertyFunction",aa),Ht("StyleExpression",qa,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Vs),Ht("ZoomConstantExpression",$a),Ht("CompoundExpression",ni,{omit:["_evaluate"]});for(let r in Es)Es[r]._classRegistryKey||Ht(`Expression_${r}`,Es[r]);function os(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Wi(r,t){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(os(r)||pi(r))return t&&t.push(r),r;if(ArrayBuffer.isView(r)){let n=r;return t&&t.push(n.buffer),n}if(r instanceof ImageData)return t&&t.push(r.data.buffer),r;if(Array.isArray(r)){let n=[];for(let a of r)n.push(Wi(a,t));return n}if(typeof r=="object"){let n=r.constructor,a=n._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Nn[a])throw new Error(`${a} is not registered.`);let h=n.serialize?n.serialize(r,t):{};if(n.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let g in r){if(!r.hasOwnProperty(g)||Nn[a].omit.indexOf(g)>=0)continue;let y=r[g];h[g]=Nn[a].shallow.indexOf(g)>=0?y:Wi(y,t)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function ss(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||os(r)||pi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ss);if(typeof r=="object"){let t=r.$name||"Object";if(!Nn[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:n}=Nn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);let a=Object.create(n.prototype);for(let h of Object.keys(r)){if(h==="$name")continue;let g=r[h];a[h]=Nn[t].shallow.indexOf(h)>=0?g:ss(g)}return a}throw new Error("can't deserialize object of type "+typeof r)}class Ha{constructor(){this.first=!0}update(t,n){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let Gt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Ql(r){for(let t of r)if(Wa(t.charCodeAt(0)))return!0;return!1}function Ya(r){for(let t of r)if(!Ac(t.charCodeAt(0)))return!1;return!0}function Ac(r){return!(Gt.Arabic(r)||Gt["Arabic Supplement"](r)||Gt["Arabic Extended-A"](r)||Gt["Arabic Presentation Forms-A"](r)||Gt["Arabic Presentation Forms-B"](r))}function Wa(r){return!(r!==746&&r!==747&&(r<4352||!(Gt["Bopomofo Extended"](r)||Gt.Bopomofo(r)||Gt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Gt["CJK Compatibility Ideographs"](r)||Gt["CJK Compatibility"](r)||Gt["CJK Radicals Supplement"](r)||Gt["CJK Strokes"](r)||!(!Gt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Gt["CJK Unified Ideographs Extension A"](r)||Gt["CJK Unified Ideographs"](r)||Gt["Enclosed CJK Letters and Months"](r)||Gt["Hangul Compatibility Jamo"](r)||Gt["Hangul Jamo Extended-A"](r)||Gt["Hangul Jamo Extended-B"](r)||Gt["Hangul Jamo"](r)||Gt["Hangul Syllables"](r)||Gt.Hiragana(r)||Gt["Ideographic Description Characters"](r)||Gt.Kanbun(r)||Gt["Kangxi Radicals"](r)||Gt["Katakana Phonetic Extensions"](r)||Gt.Katakana(r)&&r!==12540||!(!Gt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Gt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Gt["Unified Canadian Aboriginal Syllabics"](r)||Gt["Unified Canadian Aboriginal Syllabics Extended"](r)||Gt["Vertical Forms"](r)||Gt["Yijing Hexagram Symbols"](r)||Gt["Yi Syllables"](r)||Gt["Yi Radicals"](r))))}function tu(r){return!(Wa(r)||function(t){return!!(Gt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gt["Letterlike Symbols"](t)||Gt["Number Forms"](t)||Gt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gt["Control Pictures"](t)&&t!==9251||Gt["Optical Character Recognition"](t)||Gt["Enclosed Alphanumerics"](t)||Gt["Geometric Shapes"](t)||Gt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gt["CJK Symbols and Punctuation"](t)||Gt.Katakana(t)||Gt["Private Use Area"](t)||Gt["CJK Compatibility Forms"](t)||Gt["Small Form Variants"](t)||Gt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}function nc(r){return r>=1424&&r<=2303||Gt["Arabic Presentation Forms-A"](r)||Gt["Arabic Presentation Forms-B"](r)}function eu(r,t){return!(!t&&nc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Gt.Khmer(r))}function ic(r){for(let t of r)if(nc(t.charCodeAt(0)))return!0;return!1}let Lc="deferred",Mc="loading",Dc="loaded",kc=null,ii="unavailable",ms=null,wl=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ii="error"),kc&&kc(r)};function zc(){Sl.fire(new Mo("pluginStateChange",{pluginStatus:ii,pluginURL:ms}))}let Sl=new ls,Rc=function(){return ii},op=function(){if(ii!==Lc||!ms)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ii=Mc,zc(),ms&&ba({url:ms},r=>{r?wl(r):(ii=Dc,zc())})},_i={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ii===Dc||_i.applyArabicShaping!=null,isLoading:()=>ii===Mc,setState(r){if(!Ar())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ii=r.pluginStatus,ms=r.pluginURL},isParsed(){if(!Ar())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return _i.applyArabicShaping!=null&&_i.processBidirectionalText!=null&&_i.processStyledBidirectionalText!=null},getPluginURL(){if(!Ar())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ms}};class yr{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ha,this.transition={})}isSupportedScript(t){return function(n,a){for(let h of n)if(!eu(h.charCodeAt(0),a))return!1;return!0}(t,_i.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class Iu{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,h){if(wr(a))return new aa(a,h);if(rs(a)){let g=Yl(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=tr.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=En.parse(a)):g=Rn.parse(a),{kind:"constant",evaluate:()=>g}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class Oc{constructor(t){this.property=t,this.value=new Iu(t,void 0)}transitioned(t,n){return new ap(this.property,this.value,n,Le({},t.transition,this.transition),t.now)}untransitioned(){return new ap(this.property,this.value,null,{},0)}}class sp{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return nr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Oc(this._values[t].property)),this._values[t].value=new Iu(this._values[t].property,n===null?void 0:nr(n))}getTransition(t){return nr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Oc(this._values[t].property)),this._values[t].transition=nr(n)||void 0}serialize(){let t={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(t[n]=a);let h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){let a=new lp(this._properties);for(let h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,n._values[h]);return a}untransitioned(){let t=new lp(this._properties);for(let n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ap{constructor(t,n,a,h,g){this.property=t,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){let h=t.now||0,g=this.value.possiblyEvaluate(t,n,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,n,a);{let v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,n,a),g,function(S){if(S<=0)return 0;if(S>=1)return 1;let T=S*S,P=T*S;return 4*(S<.5?P:3*(S-T)+P-.75)}(v))}}return g}}class lp{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){let h=new Cu(this._properties);for(let g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,a);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class gd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return nr(this._values[t].value)}setValue(t,n){this._values[t]=new Iu(this._values[t].property,n===null?void 0:nr(n))}serialize(){let t={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){let h=new Cu(this._properties);for(let g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,a);return h}}class $n{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,a,h){return this.property.evaluate(this.value,this.parameters,t,n,a,h)}}class Cu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ie{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,a){let h=Un[this.specification.type];return h?h(t,n,a):t}}class he{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,h){return new $n(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,h)}:t.expression,n)}interpolate(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},t.parameters);let h=Un[this.specification.type];if(h){let g=h(t.value.value,n.value.value,a);return new $n(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(n,a,h,g,y)}}class El extends he{possiblyEvaluate(t,n,a,h){if(t.value===void 0)return new $n(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){let g=t.expression.evaluate(n,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,n);return new $n(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){let g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new $n(this,{kind:"constant",value:g},n)}return new $n(this,t.expression,n)}evaluate(t,n,a,h,g,y){if(t.kind==="source"){let v=t.evaluate(n,a,h,g,y);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,h),t.evaluate({zoom:Math.floor(n.zoom)},a,h),t.evaluate({zoom:Math.floor(n.zoom)+1},a,h),n):t.value}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Fc{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){let g=t.expression.evaluate(n,null,{},a,h);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new yr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new yr(Math.floor(n.zoom),n)),t.expression.evaluate(new yr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Nc{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){return!!t.expression.evaluate(n,null,{},a,h)}interpolate(){return!1}}class Ur{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let n in t){let a=t[n];a.specification.overridable&&this.overridableProperties.push(n);let h=this.defaultPropertyValues[n]=new Iu(a,void 0),g=this.defaultTransitionablePropertyValues[n]=new Oc(a);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Ht("DataDrivenProperty",he),Ht("DataConstantProperty",ie),Ht("CrossFadedDataDrivenProperty",El),Ht("CrossFadedProperty",Fc),Ht("ColorRampProperty",Nc);let Bc="-transition";class Ni extends ls{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new gd(n.layout)),n.paint)){this._transitionablePaint=new sp(n.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cu(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){n!=null&&this._validate(Kl,`layers.${this.id}.layout.${t}`,t,n,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Bc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(n!=null&&this._validate(hn,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(t.endsWith(Bc))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{let h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);let S=this._transitionablePaint._values[t].value;return S.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,v,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),zr(t,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(t,n,a,h,g={}){return(!g||g.validate!==!1)&&is(this,t.call(_o,{key:n,layerType:this.type,objectKey:a,value:h,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let n=this.paint.get(t);if(n instanceof $n&&ds(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let up={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gs{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pr(r,t=1){let n=0,a=0;return{members:r.map(h=>{let g=up[h.type].BYTES_PER_ELEMENT,y=n=Ia(n,Math.max(t,g)),v=h.components||1;return a=Math.max(a,g),n+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:Ia(n,Math.max(a,t)),alignment:t}}function Ia(r,t){return Math.ceil(r/t)*t}class Tl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.int16[h+0]=n,this.int16[h+1]=a,t}}Tl.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",Tl);class Il extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=h,t}}Il.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",Il);class qs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=4*t;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}qs.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",qs);class Vc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=6*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,t}}Vc.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",Vc);class Uc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=4*t,T=8*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.uint8[T+4]=h,this.uint8[T+5]=g,this.uint8[T+6]=y,this.uint8[T+7]=v,t}}Uc.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",Uc);class Ca extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.float32[h+0]=n,this.float32[h+1]=a,t}}Ca.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",Ca);class jc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P){let M=this.length;return this.resize(M+1),this.emplace(M,t,n,a,h,g,y,v,S,T,P)}emplace(t,n,a,h,g,y,v,S,T,P,M){let z=10*t;return this.uint16[z+0]=n,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=v,this.uint16[z+6]=S,this.uint16[z+7]=T,this.uint16[z+8]=P,this.uint16[z+9]=M,t}}jc.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",jc);class Gc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z){let N=this.length;return this.resize(N+1),this.emplace(N,t,n,a,h,g,y,v,S,T,P,M,z)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N){let B=12*t;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=v,this.uint16[B+6]=S,this.uint16[B+7]=T,this.int16[B+8]=P,this.int16[B+9]=M,this.int16[B+10]=z,this.int16[B+11]=N,t}}Gc.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",Gc);class Je extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,t}}Je.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",Je);class f extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}f.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",f);class e extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T){let P=this.length;return this.resize(P+1),this.emplace(P,t,n,a,h,g,y,v,S,T)}emplace(t,n,a,h,g,y,v,S,T,P){let M=10*t,z=5*t;return this.int16[M+0]=n,this.int16[M+1]=a,this.int16[M+2]=h,this.int16[M+3]=g,this.int16[M+4]=y,this.int16[M+5]=v,this.uint32[z+3]=S,this.uint16[M+8]=T,this.uint16[M+9]=P,t}}e.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",e);class o extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=6*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,t}}o.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",o);class c extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,h,g)}emplace(t,n,a,h,g,y){let v=4*t,S=8*t;return this.float32[v+0]=n,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[S+6]=g,this.int16[S+7]=y,t}}c.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",c);class p extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=12*t,v=3*t;return this.uint8[y+0]=n,this.uint8[y+1]=a,this.float32[v+1]=h,this.float32[v+2]=g,t}}p.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",p);class m extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}m.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",m);class x extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q){let ut=this.length;return this.resize(ut+1),this.emplace(ut,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut){let rt=24*t,pt=12*t,ft=48*t;return this.int16[rt+0]=n,this.int16[rt+1]=a,this.uint16[rt+2]=h,this.uint16[rt+3]=g,this.uint32[pt+2]=y,this.uint32[pt+3]=v,this.uint32[pt+4]=S,this.uint16[rt+10]=T,this.uint16[rt+11]=P,this.uint16[rt+12]=M,this.float32[pt+7]=z,this.float32[pt+8]=N,this.uint8[ft+36]=B,this.uint8[ft+37]=q,this.uint8[ft+38]=W,this.uint32[pt+10]=Q,this.int16[rt+22]=ut,t}}x.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt){let Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt,Bt){let Dt=32*t,ue=16*t;return this.int16[Dt+0]=n,this.int16[Dt+1]=a,this.int16[Dt+2]=h,this.int16[Dt+3]=g,this.int16[Dt+4]=y,this.int16[Dt+5]=v,this.int16[Dt+6]=S,this.int16[Dt+7]=T,this.uint16[Dt+8]=P,this.uint16[Dt+9]=M,this.uint16[Dt+10]=z,this.uint16[Dt+11]=N,this.uint16[Dt+12]=B,this.uint16[Dt+13]=q,this.uint16[Dt+14]=W,this.uint16[Dt+15]=Q,this.uint16[Dt+16]=ut,this.uint16[Dt+17]=rt,this.uint16[Dt+18]=pt,this.uint16[Dt+19]=ft,this.uint16[Dt+20]=Et,this.uint16[Dt+21]=Zt,this.uint16[Dt+22]=ee,this.uint32[ue+12]=$t,this.float32[ue+13]=jt,this.float32[ue+14]=Ft,this.uint16[Dt+30]=Yt,this.uint16[Dt+31]=Bt,t}}w.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",w);class E extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}E.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",E);class I extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,t}}I.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",I);class A extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}A.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",A);class L extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=a,t}}L.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",L);class F extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}F.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",F);class $ extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=4*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}$.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",$);class Z extends Gs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class H extends e{get(t){return new Z(this,t)}}Ht("CollisionBoxArray",H);class G extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class ot extends x{get(t){return new G(this,t)}}Ht("PlacedSymbolArray",ot);class dt extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}dt.prototype.size=64;class K extends w{get(t){return new dt(this,t)}}Ht("SymbolInstanceArray",K);class lt extends E{getoffsetX(t){return this.float32[1*t+0]}}Ht("GlyphOffsetArray",lt);class mt extends Il{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ht("SymbolLineVertexArray",mt);class gt extends Gs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}gt.prototype.size=12;class St extends I{get(t){return new gt(this,t)}}Ht("TextAnchorOffsetArray",St);class Mt extends Gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Mt.prototype.size=8;class Ct extends A{get(t){return new Mt(this,t)}}Ht("FeatureIndexArray",Ct);class zt extends Tl{}class te extends Tl{}class ze extends Tl{}class Ut extends Vc{}class pe extends Uc{}class re extends Ca{}class or extends jc{}class De extends Gc{}class Te extends Je{}class Re extends f{}class Rr extends o{}class pr extends p{}class yn extends m{}class Qr extends L{}let jr=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:vi}=jr;class _r{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,h){let g=this.segments[this.segments.length-1];return t>_r.MAX_VERTEX_ARRAY_LENGTH&&de(`Max vertices per segment is ${_r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>_r.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(let t of this.segments)for(let n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,h){return new _r([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function vo(r,t){return 256*(r=ke(Math.floor(r),0,255))+ke(Math.floor(t),0,255)}_r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",_r);let xo=Pr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gs={exports:{}},$s={exports:{}};$s.exports=function(r,t){var n,a,h,g,y,v,S,T;for(a=r.length-(n=3&r.length),h=t,y=3432918353,v=461845907,T=0;T<a;)S=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,h=27492+(65535&(g=5*(65535&(h=(h^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&r.charCodeAt(T+2))<<16;case 2:S^=(255&r.charCodeAt(T+1))<<8;case 1:h^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(T)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Pa=$s.exports,In={exports:{}};In.exports=function(r,t){for(var n,a=r.length,h=t^a,g=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&r.charCodeAt(g+2))<<16;case 2:h^=(255&r.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var _n=Pa,Zn=In.exports;gs.exports=_n,gs.exports.murmur3=_n,gs.exports.murmur2=Zn;var Zs=R(gs.exports);class Or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,h){this.ids.push(tn(t)),this.positions.push(n,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let n=tn(t),a=0,h=this.ids.length-1;for(;a<h;){let y=a+h>>1;this.ids[y]>=n?h=y:a=y+1}let g=[];for(;this.ids[a]===n;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,n){let a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return oi(a,h,0,a.length-1),n&&n.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){let n=new Or;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function tn(r){let t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Zs(String(r))}function oi(r,t,n,a){for(;n<a;){let h=r[n+a>>1],g=n-1,y=a+1;for(;;){do g++;while(r[g]<h);do y--;while(r[y]>h);if(g>=y)break;Fr(r,g,y),Fr(t,3*g,3*y),Fr(t,3*g+1,3*y+1),Fr(t,3*g+2,3*y+2)}y-n<a-y?(oi(r,t,n,y),n=y+1):(oi(r,t,y+1,a),a=y)}}function Fr(r,t,n){let a=r[t];r[t]=r[n],r[n]=a}Ht("FeaturePositionMap",Or);class Xs{constructor(t,n){this.gl=t.gl,this.location=n}}class Pu extends Xs{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class cp extends Xs{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class hp extends Xs{constructor(t,n){super(t,n),this.current=tr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let yd=new Float32Array(16);function qc(r){return[vo(255*r.r,255*r.g),vo(255*r.b,255*r.a)]}class bo{constructor(t,n,a){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return this.type==="color"?new hp(t,n):new Pu(t,n)}}class Hs{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,a,h){let g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,n,a){return a.substr(0,9)==="u_pattern"?new cp(t,n):new Pu(t,n)}}class wo{constructor(t,n,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,a,h,g){let y=this.paintVertexArray.length,v=this.expression.evaluate(new yr(0),n,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,v)}updatePaintArray(t,n,a,h){let g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,n,g)}_setPaintValue(t,n,a){if(this.type==="color"){let h=qc(a);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bi{constructor(t,n,a,h,g,y){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,n,a,h,g){let y=this.expression.evaluate(new yr(this.zoom),n,{},h,[],g),v=this.expression.evaluate(new yr(this.zoom+1),n,{},h,[],g),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,y,v)}updatePaintArray(t,n,a,h){let g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,n,g,y)}_setPaintValue(t,n,a,h){if(this.type==="color"){let g=qc(a),y=qc(h);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){let a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ke(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,a){return new Pu(t,n)}}class So{constructor(t,n,a,h,g,y){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,a){let h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,h,g){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,n,a,h){if(!h||!a)return;let{min:g,mid:y,max:v}=a,S=h[g],T=h[y],P=h[v];if(S&&T&&P)for(let M=t;M<n;M++)this.zoomInPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],T.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],T.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,xo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,xo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $c{constructor(t,n,a){this.binders={},this._buffers=[];let h=[];for(let g in t.paint._values){if(!a(g))continue;let y=t.paint.get(g);if(!(y instanceof $n&&ds(y.property.specification)))continue;let v=xv(g,t.type),S=y.value,T=y.property.specification.type,P=y.property.useIntegerZoom,M=y.property.specification["property-type"],z=M==="cross-faded"||M==="cross-faded-data-driven";if(S.kind==="constant")this.binders[g]=z?new Hs(S.value,v):new bo(S.value,v,T),h.push(`/u_${g}`);else if(S.kind==="source"||z){let N=Bm(g,T,"source");this.binders[g]=z?new So(S,T,P,n,N,t.id):new wo(S,v,T,N),h.push(`/a_${g}`)}else{let N=Bm(g,T,"composite");this.binders[g]=new Bi(S,v,T,P,n,N),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){let n=this.binders[t];return n instanceof wo||n instanceof Bi?n.maxValue:0}populatePaintArrays(t,n,a,h,g){for(let y in this.binders){let v=this.binders[y];(v instanceof wo||v instanceof Bi||v instanceof So)&&v.populatePaintArray(t,n,a,h,g)}}setConstantPatternPositions(t,n){for(let a in this.binders){let h=this.binders[a];h instanceof Hs&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,a,h,g){let y=!1;for(let v in t){let S=n.getPositions(v);for(let T of S){let P=a.feature(T.index);for(let M in this.binders){let z=this.binders[M];if((z instanceof wo||z instanceof Bi||z instanceof So)&&z.expression.isStateDependent===!0){let N=h.paint.get(M);z.expression=N.value,z.updatePaintArray(T.start,T.end,P,t[v],g),y=!0}}}}return y}defines(){let t=[];for(let n in this.binders){let a=this.binders[n];(a instanceof bo||a instanceof Hs)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){let t=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof wo||a instanceof Bi)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof So)for(let h=0;h<xo.members.length;h++)t.push(xo.members[h].name)}return t}getBinderUniforms(){let t=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof bo||a instanceof Hs||a instanceof Bi)for(let h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){let a=[];for(let h in this.binders){let g=this.binders[h];if(g instanceof bo||g instanceof Hs||g instanceof Bi){for(let y of g.uniformNames)if(n[y]){let v=g.getBinding(t,n[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(t,n,a,h){for(let{name:g,property:y,binding:v}of n)this.binders[y].setUniform(v,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(let n in this.binders){let a=this.binders[n];if(t&&a instanceof So){let h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof wo||a instanceof Bi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let n in this.binders){let a=this.binders[n];(a instanceof wo||a instanceof Bi||a instanceof So)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let n=this.binders[t];(n instanceof wo||n instanceof Bi||n instanceof So)&&n.destroy()}}}class jo{constructor(t,n,a=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new $c(h,n,a);this.needsUpload=!1,this._featureMap=new Or,this._bufferOffset=0}populatePaintArrays(t,n,a,h,g,y){for(let v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,h,g,y);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,h){for(let g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function xv(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Bm(r,t,n){let a={color:{source:Ca,composite:$},number:{source:E,composite:Ca}},h=function(g){return{"line-pattern":{source:or,composite:or},"fill-pattern":{source:or,composite:or},"fill-extrusion-pattern":{source:or,composite:or}}[g]}(r);return h&&h[n]||a[t][n]}Ht("ConstantBinder",bo),Ht("CrossFadedConstantBinder",Hs),Ht("SourceExpressionBinder",wo),Ht("CrossFadedCompositeBinder",So),Ht("CompositeExpressionBinder",Bi),Ht("ProgramConfiguration",$c,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",jo);let Xr=8192,_d=Math.pow(2,14)-1,Vm=-_d-1;function Cl(r){let t=Xr/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){let h=n[a];for(let g=0;g<h.length;g++){let y=h[g],v=Math.round(y.x*t),S=Math.round(y.y*t);y.x=ke(v,Vm,_d),y.y=ke(S,Vm,_d),(v<y.x||v>y.x+1||S<y.y||S>y.y+1)&&de("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Pl(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Cl(r):[]}}function pp(r,t,n,a,h){r.emplaceBack(2*t+(a+1)/2,2*n+(h+1)/2)}class vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.indexArray=new yn,this.segments=new _r,this.programConfigurations=new jo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){let h=this.layers[0],g=[],y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(let{feature:S,id:T,index:P,sourceLayerIndex:M}of t){let z=this.layers[0]._featureFilter.needGeometry,N=Pl(S,z);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),N,a))continue;let B=v?y.evaluate(N,{},a):void 0,q={id:T,properties:S.properties,type:S.type,sourceLayerIndex:M,index:P,geometry:z?N.geometry:Cl(S),patterns:{},sortKey:B};g.push(q)}v&&g.sort((S,T)=>S.sortKey-T.sortKey);for(let S of g){let{geometry:T,index:P,sourceLayerIndex:M}=S,z=t[P].feature;this.addFeature(S,T,P,a),n.featureIndex.insert(z,T,P,M,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,h){for(let g of n)for(let y of g){let v=y.x,S=y.y;if(v<0||v>=Xr||S<0||S>=Xr)continue;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=T.vertexLength;pp(this.layoutVertexArray,v,S,-1,-1),pp(this.layoutVertexArray,v,S,1,-1),pp(this.layoutVertexArray,v,S,1,1),pp(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function Um(r,t){for(let n=0;n<r.length;n++)if(Au(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Au(r,t[n]))return!0;return!!xd(r,t)}function bv(r,t,n){return!!Au(r,t)||!!bd(t,r,n)}function jm(r,t){if(r.length===1)return qm(t,r[0]);for(let n=0;n<t.length;n++){let a=t[n];for(let h=0;h<a.length;h++)if(Au(r,a[h]))return!0}for(let n=0;n<r.length;n++)if(qm(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(xd(r,t[n]))return!0;return!1}function wv(r,t,n){if(r.length>1){if(xd(r,t))return!0;for(let a=0;a<t.length;a++)if(bd(t[a],r,n))return!0}for(let a=0;a<r.length;a++)if(bd(r[a],t,n))return!0;return!1}function xd(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){let a=r[n],h=r[n+1];for(let g=0;g<t.length-1;g++)if(Sv(a,h,t[g],t[g+1]))return!0}return!1}function Sv(r,t,n,a){return Ke(r,n,a)!==Ke(t,n,a)&&Ke(r,t,n)!==Ke(r,t,a)}function bd(r,t,n){let a=n*n;if(t.length===1)return r.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Gm(r,t[h-1],t[h])<a)return!0;return!1}function Gm(r,t,n){let a=t.distSqr(n);if(a===0)return r.distSqr(t);let h=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/a;return r.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function qm(r,t){let n,a,h,g=!1;for(let y=0;y<r.length;y++){n=r[y];for(let v=0,S=n.length-1;v<n.length;S=v++)a=n[v],h=n[S],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Au(r,t){let n=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){let g=r[a],y=r[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(n=!n)}return n}function Ev(r,t,n){let a=n[0],h=n[2];if(r.x<a.x&&t.x<a.x||r.x>h.x&&t.x>h.x||r.y<a.y&&t.y<a.y||r.y>h.y&&t.y>h.y)return!1;let g=Ke(r,t,n[0]);return g!==Ke(r,t,n[1])||g!==Ke(r,t,n[2])||g!==Ke(r,t,n[3])}function Zc(r,t,n){let a=t.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(t.id).getMaxValue(r)}function dp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function fp(r,t,n,a,h){if(!t[0]&&!t[1])return r;let g=st.convert(t)._mult(h);n==="viewport"&&g._rotate(-a);let y=[];for(let v=0;v<r.length;v++)y.push(r[v].sub(g));return y}let $m,Zm;Ht("CircleBucket",vd,{omit:["layers"]});var Tv={get paint(){return Zm=Zm||new Ur({"circle-radius":new he(_t.paint_circle["circle-radius"]),"circle-color":new he(_t.paint_circle["circle-color"]),"circle-blur":new he(_t.paint_circle["circle-blur"]),"circle-opacity":new he(_t.paint_circle["circle-opacity"]),"circle-translate":new ie(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new ie(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ie(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ie(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new he(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new he(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new he(_t.paint_circle["circle-stroke-opacity"])})},get layout(){return $m=$m||new Ur({"circle-sort-key":new he(_t.layout_circle["circle-sort-key"])})}},si=1e-6,Lu=typeof Float32Array<"u"?Float32Array:Array;function wd(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Xm(r,t,n){var a=t[0],h=t[1],g=t[2],y=t[3],v=t[4],S=t[5],T=t[6],P=t[7],M=t[8],z=t[9],N=t[10],B=t[11],q=t[12],W=t[13],Q=t[14],ut=t[15],rt=n[0],pt=n[1],ft=n[2],Et=n[3];return r[0]=rt*a+pt*v+ft*M+Et*q,r[1]=rt*h+pt*S+ft*z+Et*W,r[2]=rt*g+pt*T+ft*N+Et*Q,r[3]=rt*y+pt*P+ft*B+Et*ut,r[4]=(rt=n[4])*a+(pt=n[5])*v+(ft=n[6])*M+(Et=n[7])*q,r[5]=rt*h+pt*S+ft*z+Et*W,r[6]=rt*g+pt*T+ft*N+Et*Q,r[7]=rt*y+pt*P+ft*B+Et*ut,r[8]=(rt=n[8])*a+(pt=n[9])*v+(ft=n[10])*M+(Et=n[11])*q,r[9]=rt*h+pt*S+ft*z+Et*W,r[10]=rt*g+pt*T+ft*N+Et*Q,r[11]=rt*y+pt*P+ft*B+Et*ut,r[12]=(rt=n[12])*a+(pt=n[13])*v+(ft=n[14])*M+(Et=n[15])*q,r[13]=rt*h+pt*S+ft*z+Et*W,r[14]=rt*g+pt*T+ft*N+Et*Q,r[15]=rt*y+pt*P+ft*B+Et*ut,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Xc,Iv=Xm;function mp(r,t,n){var a=t[0],h=t[1],g=t[2],y=t[3];return r[0]=n[0]*a+n[4]*h+n[8]*g+n[12]*y,r[1]=n[1]*a+n[5]*h+n[9]*g+n[13]*y,r[2]=n[2]*a+n[6]*h+n[10]*g+n[14]*y,r[3]=n[3]*a+n[7]*h+n[11]*g+n[15]*y,r}Xc=new Lu(4),Lu!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0);class Cv extends Ni{constructor(t){super(t,Tv)}createBucket(t){return new vd(t)}queryRadius(t){let n=t;return Zc("circle-radius",this,n)+Zc("circle-stroke-width",this,n)+dp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v,S){let T=fp(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),P=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),M=this.paint.get("circle-pitch-alignment")==="map",z=M?T:function(B,q){return B.map(W=>Hm(W,q))}(T,S),N=M?P*v:P;for(let B of h)for(let q of B){let W=M?q:Hm(q,S),Q=N,ut=mp([],[q.x,q.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=ut[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=y.cameraToCenterDistance/ut[3]),bv(z,W,Q))return!0}return!1}}function Hm(r,t){let n=mp([],[r.x,r.y,0,1],t);return new st(n[0]/n[3],n[1]/n[3])}class Ym extends vd{}let Wm;Ht("HeatmapBucket",Ym,{omit:["layers"]});var Pv={get paint(){return Wm=Wm||new Ur({"heatmap-radius":new he(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new he(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ie(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nc(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ie(_t.paint_heatmap["heatmap-opacity"])})}};function Sd(r,{width:t,height:n},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*a}`)}else h=new Uint8Array(t*n*a);return r.width=t,r.height=n,r.data=h,r}function Jm(r,{width:t,height:n},a){if(t===r.width&&n===r.height)return;let h=Sd({},{width:t,height:n},a);Ed(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},a),r.width=t,r.height=n,r.data=h.data}function Ed(r,t,n,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let y=r.data,v=t.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<h.height;S++){let T=((n.y+S)*r.width+n.x)*g,P=((a.y+S)*t.width+a.x)*g;for(let M=0;M<h.width*g;M++)v[P+M]=y[T+M]}return t}class Hc{constructor(t,n){Sd(this,t,1,n)}resize(t){Jm(this,t,1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,g){Ed(t,n,a,h,g,1)}}class Ji{constructor(t,n){Sd(this,t,4,n)}resize(t){Jm(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ji({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,g){Ed(t,n,a,h,g,4)}}function Km(r){let t={},n=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new Ji({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);let g=(y,v,S)=>{t[r.evaluationKey]=S;let T=r.expression.evaluate(t);h.data[y+v+0]=Math.floor(255*T.r/T.a),h.data[y+v+1]=Math.floor(255*T.g/T.a),h.data[y+v+2]=Math.floor(255*T.b/T.a),h.data[y+v+3]=Math.floor(255*T.a)};if(r.clips)for(let y=0,v=0;y<a;++y,v+=4*n)for(let S=0,T=0;S<n;S++,T+=4){let P=S/(n-1),{start:M,end:z}=r.clips[y];g(v,T,M*(1-P)+z*P)}else for(let y=0,v=0;y<n;y++,v+=4)g(0,v,y/(n-1));return h}Ht("AlphaImage",Hc),Ht("RGBAImage",Ji);class Av extends Ni{createBucket(t){return new Ym(t)}constructor(t){super(t,Pv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Qm;var Lv={get paint(){return Qm=Qm||new Ur({"hillshade-illumination-direction":new ie(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ie(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ie(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ie(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ie(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ie(_t.paint_hillshade["hillshade-accent-color"])})}};class Mv extends Ni{constructor(t){super(t,Lv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Dv=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:kv}=Dv;var Td={exports:{}};function gp(r,t,n){n=n||2;var a,h,g,y,v,S,T,P=t&&t.length,M=P?t[0]*n:r.length,z=tg(r,0,M,n,!0),N=[];if(!z||z.next===z.prev)return N;if(P&&(z=function(q,W,Q,ut){var rt,pt,ft,Et=[];for(rt=0,pt=W.length;rt<pt;rt++)(ft=tg(q,W[rt]*ut,rt<pt-1?W[rt+1]*ut:q.length,ut,!1))===ft.next&&(ft.steiner=!0),Et.push(Uv(ft));for(Et.sort(Nv),rt=0;rt<Et.length;rt++)Q=Bv(Et[rt],Q);return Q}(r,t,z,n)),r.length>80*n){a=g=r[0],h=y=r[1];for(var B=n;B<M;B+=n)(v=r[B])<a&&(a=v),(S=r[B+1])<h&&(h=S),v>g&&(g=v),S>y&&(y=S);T=(T=Math.max(g-a,y-h))!==0?32767/T:0}return Yc(z,N,n,a,h,T,0),N}function tg(r,t,n,a,h){var g,y;if(h===Pd(r,t,n,a)>0)for(g=t;g<n;g+=a)y=ng(g,r[g],r[g+1],y);else for(g=n-a;g>=t;g-=a)y=ng(g,r[g],r[g+1],y);return y&&yp(y,y.next)&&(Jc(y),y=y.next),y}function Al(r,t){if(!r)return r;t||(t=r);var n,a=r;do if(n=!1,a.steiner||!yp(a,a.next)&&Gr(a.prev,a,a.next)!==0)a=a.next;else{if(Jc(a),(a=t=a.prev)===a.next)break;n=!0}while(n||a!==t);return t}function Yc(r,t,n,a,h,g,y){if(r){!y&&g&&function(P,M,z,N){var B=P;do B.z===0&&(B.z=Id(B.x,B.y,M,z,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function(q){var W,Q,ut,rt,pt,ft,Et,Zt,ee=1;do{for(Q=q,q=null,pt=null,ft=0;Q;){for(ft++,ut=Q,Et=0,W=0;W<ee&&(Et++,ut=ut.nextZ);W++);for(Zt=ee;Et>0||Zt>0&&ut;)Et!==0&&(Zt===0||!ut||Q.z<=ut.z)?(rt=Q,Q=Q.nextZ,Et--):(rt=ut,ut=ut.nextZ,Zt--),pt?pt.nextZ=rt:q=rt,rt.prevZ=pt,pt=rt;Q=ut}pt.nextZ=null,ee*=2}while(ft>1)}(B)}(r,a,h,g);for(var v,S,T=r;r.prev!==r.next;)if(v=r.prev,S=r.next,g?Rv(r,a,h,g):zv(r))t.push(v.i/n|0),t.push(r.i/n|0),t.push(S.i/n|0),Jc(r),r=S.next,T=S.next;else if((r=S)===T){y?y===1?Yc(r=Ov(Al(r),t,n),t,n,a,h,g,2):y===2&&Fv(r,t,n,a,h,g):Yc(Al(r),t,n,a,h,g,1);break}}}function zv(r){var t=r.prev,n=r,a=r.next;if(Gr(t,n,a)>=0)return!1;for(var h=t.x,g=n.x,y=a.x,v=t.y,S=n.y,T=a.y,P=h<g?h<y?h:y:g<y?g:y,M=v<S?v<T?v:T:S<T?S:T,z=h>g?h>y?h:y:g>y?g:y,N=v>S?v>T?v:T:S>T?S:T,B=a.next;B!==t;){if(B.x>=P&&B.x<=z&&B.y>=M&&B.y<=N&&Mu(h,v,g,S,y,T,B.x,B.y)&&Gr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Rv(r,t,n,a){var h=r.prev,g=r,y=r.next;if(Gr(h,g,y)>=0)return!1;for(var v=h.x,S=g.x,T=y.x,P=h.y,M=g.y,z=y.y,N=v<S?v<T?v:T:S<T?S:T,B=P<M?P<z?P:z:M<z?M:z,q=v>S?v>T?v:T:S>T?S:T,W=P>M?P>z?P:z:M>z?M:z,Q=Id(N,B,t,n,a),ut=Id(q,W,t,n,a),rt=r.prevZ,pt=r.nextZ;rt&&rt.z>=Q&&pt&&pt.z<=ut;){if(rt.x>=N&&rt.x<=q&&rt.y>=B&&rt.y<=W&&rt!==h&&rt!==y&&Mu(v,P,S,M,T,z,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0||(rt=rt.prevZ,pt.x>=N&&pt.x<=q&&pt.y>=B&&pt.y<=W&&pt!==h&&pt!==y&&Mu(v,P,S,M,T,z,pt.x,pt.y)&&Gr(pt.prev,pt,pt.next)>=0))return!1;pt=pt.nextZ}for(;rt&&rt.z>=Q;){if(rt.x>=N&&rt.x<=q&&rt.y>=B&&rt.y<=W&&rt!==h&&rt!==y&&Mu(v,P,S,M,T,z,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0)return!1;rt=rt.prevZ}for(;pt&&pt.z<=ut;){if(pt.x>=N&&pt.x<=q&&pt.y>=B&&pt.y<=W&&pt!==h&&pt!==y&&Mu(v,P,S,M,T,z,pt.x,pt.y)&&Gr(pt.prev,pt,pt.next)>=0)return!1;pt=pt.nextZ}return!0}function Ov(r,t,n){var a=r;do{var h=a.prev,g=a.next.next;!yp(h,g)&&eg(h,a,a.next,g)&&Wc(h,g)&&Wc(g,h)&&(t.push(h.i/n|0),t.push(a.i/n|0),t.push(g.i/n|0),Jc(a),Jc(a.next),a=r=g),a=a.next}while(a!==r);return Al(a)}function Fv(r,t,n,a,h,g){var y=r;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&jv(y,v)){var S=rg(y,v);return y=Al(y,y.next),S=Al(S,S.next),Yc(y,t,n,a,h,g,0),void Yc(S,t,n,a,h,g,0)}v=v.next}y=y.next}while(y!==r)}function Nv(r,t){return r.x-t.x}function Bv(r,t){var n=function(h,g){var y,v=g,S=h.x,T=h.y,P=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){var M=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(M<=S&&M>P&&(P=M,y=v.x<v.next.x?v:v.next,M===S))return y}v=v.next}while(v!==g);if(!y)return null;var z,N=y,B=y.x,q=y.y,W=1/0;v=y;do S>=v.x&&v.x>=B&&S!==v.x&&Mu(T<q?S:P,T,B,q,T<q?P:S,T,v.x,v.y)&&(z=Math.abs(T-v.y)/(S-v.x),Wc(v,h)&&(z<W||z===W&&(v.x>y.x||v.x===y.x&&Vv(y,v)))&&(y=v,W=z)),v=v.next;while(v!==N);return y}(r,t);if(!n)return t;var a=rg(n,r);return Al(a,a.next),Al(n,n.next)}function Vv(r,t){return Gr(r.prev,r,t.prev)<0&&Gr(t.next,r,r.next)<0}function Id(r,t,n,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Uv(r){var t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function Mu(r,t,n,a,h,g,y,v){return(h-y)*(t-v)>=(r-y)*(g-v)&&(r-y)*(a-v)>=(n-y)*(t-v)&&(n-y)*(g-v)>=(h-y)*(a-v)}function jv(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,a){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==a.i&&h.next.i!==a.i&&eg(h,h.next,n,a))return!0;h=h.next}while(h!==n);return!1}(r,t)&&(Wc(r,t)&&Wc(t,r)&&function(n,a){var h=n,g=!1,y=(n.x+a.x)/2,v=(n.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(r,t)&&(Gr(r.prev,r,t.prev)||Gr(r,t.prev,t))||yp(r,t)&&Gr(r.prev,r,r.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function yp(r,t){return r.x===t.x&&r.y===t.y}function eg(r,t,n,a){var h=vp(Gr(r,t,n)),g=vp(Gr(r,t,a)),y=vp(Gr(n,a,r)),v=vp(Gr(n,a,t));return h!==g&&y!==v||!(h!==0||!_p(r,n,t))||!(g!==0||!_p(r,a,t))||!(y!==0||!_p(n,r,a))||!(v!==0||!_p(n,t,a))}function _p(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function vp(r){return r>0?1:r<0?-1:0}function Wc(r,t){return Gr(r.prev,r,r.next)<0?Gr(r,t,r.next)>=0&&Gr(r,r.prev,t)>=0:Gr(r,t,r.prev)<0||Gr(r,r.next,t)<0}function rg(r,t){var n=new Cd(r.i,r.x,r.y),a=new Cd(t.i,t.x,t.y),h=r.next,g=t.prev;return r.next=t,t.prev=r,n.next=h,h.prev=n,a.next=n,n.prev=a,g.next=a,a.prev=g,a}function ng(r,t,n,a){var h=new Cd(r,t,n);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Jc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cd(r,t,n){this.i=r,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pd(r,t,n,a){for(var h=0,g=t,y=n-a;g<n;g+=a)h+=(r[y]-r[g])*(r[g+1]+r[y+1]),y=g;return h}Td.exports=gp,Td.exports.default=gp,gp.deviation=function(r,t,n,a){var h=t&&t.length,g=Math.abs(Pd(r,0,h?t[0]*n:r.length,n));if(h)for(var y=0,v=t.length;y<v;y++)g-=Math.abs(Pd(r,t[y]*n,y<v-1?t[y+1]*n:r.length,n));var S=0;for(y=0;y<a.length;y+=3){var T=a[y]*n,P=a[y+1]*n,M=a[y+2]*n;S+=Math.abs((r[T]-r[M])*(r[P+1]-r[T+1])-(r[T]-r[P])*(r[M+1]-r[T+1]))}return g===0&&S===0?0:Math.abs((S-g)/g)},gp.flatten=function(r){for(var t=r[0][0].length,n={vertices:[],holes:[],dimensions:t},a=0,h=0;h<r.length;h++){for(var g=0;g<r[h].length;g++)for(var y=0;y<t;y++)n.vertices.push(r[h][g][y]);h>0&&n.holes.push(a+=r[h-1].length)}return n};var ig=R(Td.exports);function Gv(r,t,n,a,h){og(r,t,n||0,a||r.length-1,h||qv)}function og(r,t,n,a,h){for(;a>n;){if(a-n>600){var g=a-n+1,y=t-n+1,v=Math.log(g),S=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*S*(g-S)/g)*(y-g/2<0?-1:1);og(r,t,Math.max(n,Math.floor(t-y*S/g+T)),Math.min(a,Math.floor(t+(g-y)*S/g+T)),h)}var P=r[t],M=n,z=a;for(Kc(r,n,t),h(r[a],P)>0&&Kc(r,n,a);M<z;){for(Kc(r,M,z),M++,z--;h(r[M],P)<0;)M++;for(;h(r[z],P)>0;)z--}h(r[n],P)===0?Kc(r,n,z):Kc(r,++z,a),z<=t&&(n=z+1),t<=z&&(a=z-1)}}function Kc(r,t,n){var a=r[t];r[t]=r[n],r[n]=a}function qv(r,t){return r<t?-1:r>t?1:0}function Ad(r,t){let n=r.length;if(n<=1)return[r];let a=[],h,g;for(let y=0;y<n;y++){let v=Er(r[y]);v!==0&&(r[y].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(h&&a.push(h),h=[r[y]]):h.push(r[y]))}if(h&&a.push(h),t>1)for(let y=0;y<a.length;y++)a[y].length<=t||(Gv(a[y],t,1,a[y].length-1,$v),a[y]=a[y].slice(0,t));return a}function $v(r,t){return t.area-r.area}function Ld(r,t,n){let a=n.patternDependencies,h=!1;for(let g of t){let y=g.paint.get(`${r}-pattern`);y.isConstant()||(h=!0);let v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Md(r,t,n,a,h){let g=h.patternDependencies;for(let y of t){let v=y.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:a-1},n,{},h.availableImages),T=v.evaluate({zoom:a},n,{},h.availableImages),P=v.evaluate({zoom:a+1},n,{},h.availableImages);S=S&&S.name?S.name:S,T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,g[S]=!0,g[T]=!0,g[P]=!0,n.patterns[y.id]={min:S,mid:T,max:P}}}return n}class Dd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ze,this.indexArray=new yn,this.indexArray2=new Qr,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.segments2=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Ld("fill",this.layers,n);let h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(let{feature:v,id:S,index:T,sourceLayerIndex:P}of t){let M=this.layers[0]._featureFilter.needGeometry,z=Pl(v,M);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),z,a))continue;let N=g?h.evaluate(z,{},a,n.availableImages):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:P,index:T,geometry:M?z.geometry:Cl(v),patterns:{},sortKey:N};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(let v of y){let{geometry:S,index:T,sourceLayerIndex:P}=v;if(this.hasPattern){let M=Md("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,S,T,a,{});n.featureIndex.insert(t[T].feature,S,T,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,h,g){for(let y of Ad(n,500)){let v=0;for(let N of y)v+=N.length;let S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=S.vertexLength,P=[],M=[];for(let N of y){if(N.length===0)continue;N!==y[0]&&M.push(P.length/2);let B=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=B.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),P.push(N[0].x),P.push(N[0].y);for(let W=1;W<N.length;W++)this.layoutVertexArray.emplaceBack(N[W].x,N[W].y),this.indexArray2.emplaceBack(q+W-1,q+W),P.push(N[W].x),P.push(N[W].y);B.vertexLength+=N.length,B.primitiveLength+=N.length}let z=ig(P,M);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(T+z[N],T+z[N+1],T+z[N+2]);S.vertexLength+=v,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let sg,ag;Ht("FillBucket",Dd,{omit:["layers","patternFeatures"]});var Zv={get paint(){return ag=ag||new Ur({"fill-antialias":new ie(_t.paint_fill["fill-antialias"]),"fill-opacity":new he(_t.paint_fill["fill-opacity"]),"fill-color":new he(_t.paint_fill["fill-color"]),"fill-outline-color":new he(_t.paint_fill["fill-outline-color"]),"fill-translate":new ie(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new ie(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new El(_t.paint_fill["fill-pattern"])})},get layout(){return sg=sg||new Ur({"fill-sort-key":new he(_t.layout_fill["fill-sort-key"])})}};class Xv extends Ni{constructor(t){super(t,Zv)}recalculate(t,n){super.recalculate(t,n);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Dd(t)}queryRadius(){return dp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v){return jm(fp(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}let Hv=Pr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yv=Pr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wv}=Hv;var Aa={},Jv=et,lg=Du;function Du(r,t,n,a,h){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=h,r.readFields(Kv,this,t)}function Kv(r,t,n){r==1?t.id=n.readVarint():r==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function Qv(r){for(var t,n,a=0,h=0,g=r.length,y=g-1;h<g;y=h++)a+=((n=r[y]).x-(t=r[h]).x)*(t.y+n.y);return a}Du.types=["Unknown","Point","LineString","Polygon"],Du.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,a=1,h=0,g=0,y=0,v=[];r.pos<n;){if(h<=0){var S=r.readVarint();a=7&S,h=S>>3}if(h--,a===1||a===2)g+=r.readSVarint(),y+=r.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new Jv(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Du.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,a=0,h=0,g=0,y=1/0,v=-1/0,S=1/0,T=-1/0;r.pos<t;){if(a<=0){var P=r.readVarint();n=7&P,a=P>>3}if(a--,n===1||n===2)(h+=r.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=r.readSVarint())<S&&(S=g),g>T&&(T=g);else if(n!==7)throw new Error("unknown command "+n)}return[y,S,v,T]},Du.prototype.toGeoJSON=function(r,t,n){var a,h,g=this.extent*Math.pow(2,n),y=this.extent*r,v=this.extent*t,S=this.loadGeometry(),T=Du.types[this.type];function P(N){for(var B=0;B<N.length;B++){var q=N[B];N[B]=[360*(q.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<S.length;a++)M[a]=S[a][0];P(S=M);break;case 2:for(a=0;a<S.length;a++)P(S[a]);break;case 3:for(S=function(N){var B=N.length;if(B<=1)return[N];for(var q,W,Q=[],ut=0;ut<B;ut++){var rt=Qv(N[ut]);rt!==0&&(W===void 0&&(W=rt<0),W===rt<0?(q&&Q.push(q),q=[N[ut]]):q.push(N[ut]))}return q&&Q.push(q),Q}(S),a=0;a<S.length;a++)for(h=0;h<S[a].length;h++)P(S[a][h])}S.length===1?S=S[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:S},properties:this.properties};return"id"in this&&(z.id=this.id),z};var tx=lg,ug=cg;function cg(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(ex,this,t),this.length=this._features.length}function ex(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(n))}cg.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new tx(this._pbf,t,this.extent,this._keys,this._values)};var rx=ug;function nx(r,t,n){if(r===3){var a=new rx(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}Aa.VectorTile=function(r,t){this.layers=r.readFields(nx,{},t)},Aa.VectorTileFeature=lg,Aa.VectorTileLayer=ug;let ix=Aa.VectorTileFeature.types,kd=Math.pow(2,13);function Qc(r,t,n,a,h,g,y,v){r.emplaceBack(t,n,2*Math.floor(a*kd)+y,h*kd*2,g*kd*2,Math.round(v))}class zd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ut,this.centroidVertexArray=new zt,this.indexArray=new yn,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.features=[],this.hasPattern=Ld("fill-extrusion",this.layers,n);for(let{feature:h,id:g,index:y,sourceLayerIndex:v}of t){let S=this.layers[0]._featureFilter.needGeometry,T=Pl(h,S);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),T,a))continue;let P={id:g,sourceLayerIndex:v,index:y,geometry:S?T.geometry:Cl(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Md("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,y,a,{}),n.featureIndex.insert(h,P.geometry,y,v,this.index,!0)}}addFeatures(t,n,a){for(let h of this.features){let{geometry:g}=h;this.addFeature(h,g,h.index,n,a)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wv),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Yv.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,a,h,g){let y={x:0,y:0,vertexCount:0};for(let v of Ad(n,500)){let S=0;for(let B of v)S+=B.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let B of v){if(B.length===0||sx(B))continue;let q=0;for(let W=0;W<B.length;W++){let Q=B[W];if(W>=1){let ut=B[W-1];if(!ox(Q,ut)){T.vertexLength+4>_r.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let rt=Q.sub(ut)._perp()._unit(),pt=ut.dist(Q);q+pt>32768&&(q=0),Qc(this.layoutVertexArray,Q.x,Q.y,rt.x,rt.y,0,0,q),Qc(this.layoutVertexArray,Q.x,Q.y,rt.x,rt.y,0,1,q),y.x+=2*Q.x,y.y+=2*Q.y,y.vertexCount+=2,q+=pt,Qc(this.layoutVertexArray,ut.x,ut.y,rt.x,rt.y,0,0,q),Qc(this.layoutVertexArray,ut.x,ut.y,rt.x,rt.y,0,1,q),y.x+=2*ut.x,y.y+=2*ut.y,y.vertexCount+=2;let ft=T.vertexLength;this.indexArray.emplaceBack(ft,ft+2,ft+1),this.indexArray.emplaceBack(ft+1,ft+2,ft+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+S>_r.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),ix[t.type]!=="Polygon")continue;let P=[],M=[],z=T.vertexLength;for(let B of v)if(B.length!==0){B!==v[0]&&M.push(P.length/2);for(let q=0;q<B.length;q++){let W=B[q];Qc(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),y.x+=W.x,y.y+=W.y,y.vertexCount+=1,P.push(W.x),P.push(W.y)}}let N=ig(P,M);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(z+N[B],z+N[B+2],z+N[B+1]);T.primitiveLength+=N.length/3,T.vertexLength+=S}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function ox(r,t){return r.x===t.x&&(r.x<0||r.x>Xr)||r.y===t.y&&(r.y<0||r.y>Xr)}function sx(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Xr)||r.every(t=>t.y<0)||r.every(t=>t.y>Xr)}let hg;Ht("FillExtrusionBucket",zd,{omit:["layers","features"]});var ax={get paint(){return hg=hg||new Ur({"fill-extrusion-opacity":new ie(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new he(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ie(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ie(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new El(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new he(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new he(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ie(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lx extends Ni{constructor(t){super(t,ax)}createBucket(t){return new zd(t)}queryRadius(){return dp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,a,h,g,y,v,S){let T=fp(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),P=this.paint.get("fill-extrusion-height").evaluate(n,a),M=this.paint.get("fill-extrusion-base").evaluate(n,a),z=function(B,q,W,Q){let ut=[];for(let rt of B){let pt=[rt.x,rt.y,0,1];mp(pt,pt,q),ut.push(new st(pt[0]/pt[3],pt[1]/pt[3]))}return ut}(T,S),N=function(B,q,W,Q){let ut=[],rt=[],pt=Q[8]*q,ft=Q[9]*q,Et=Q[10]*q,Zt=Q[11]*q,ee=Q[8]*W,$t=Q[9]*W,jt=Q[10]*W,Ft=Q[11]*W;for(let Yt of B){let Bt=[],Dt=[];for(let ue of Yt){let ne=ue.x,Me=ue.y,vr=Q[0]*ne+Q[4]*Me+Q[12],Sr=Q[1]*ne+Q[5]*Me+Q[13],rn=Q[2]*ne+Q[6]*Me+Q[14],Vi=Q[3]*ne+Q[7]*Me+Q[15],ai=rn+Et,Hr=Vi+Zt,vn=vr+ee,Pn=Sr+$t,li=rn+jt,ui=Vi+Ft,nn=new st((vr+pt)/Hr,(Sr+ft)/Hr);nn.z=ai/Hr,Bt.push(nn);let on=new st(vn/ui,Pn/ui);on.z=li/ui,Dt.push(on)}ut.push(Bt),rt.push(Dt)}return[ut,rt]}(h,M,P,S);return function(B,q,W){let Q=1/0;jm(W,q)&&(Q=pg(W,q[0]));for(let ut=0;ut<q.length;ut++){let rt=q[ut],pt=B[ut];for(let ft=0;ft<rt.length-1;ft++){let Et=rt[ft],Zt=[Et,rt[ft+1],pt[ft+1],pt[ft],Et];Um(W,Zt)&&(Q=Math.min(Q,pg(W,Zt)))}}return Q!==1/0&&Q}(N[0],N[1],z)}}function th(r,t){return r.x*t.x+r.y*t.y}function pg(r,t){if(r.length===1){let n=0,a=t[n++],h;for(;!h||a.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){let g=t[n],y=r[0],v=h.sub(a),S=g.sub(a),T=y.sub(a),P=th(v,v),M=th(v,S),z=th(S,S),N=th(T,v),B=th(T,S),q=P*z-M*M,W=(z*N-M*B)/q,Q=(P*B-M*N)/q,ut=a.z*(1-W-Q)+h.z*W+g.z*Q;if(isFinite(ut))return ut}return 1/0}{let n=1/0;for(let a of t)n=Math.min(n,a.z);return n}}let ux=Pr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:cx}=ux,hx=Pr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:px}=hx,dx=Aa.VectorTileFeature.types,fx=Math.cos(Math.PI/180*37.5),dg=Math.pow(2,14)/.5;class Rd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new pe,this.layoutVertexArray2=new re,this.indexArray=new yn,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Ld("line",this.layers,n);let h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(let{feature:v,id:S,index:T,sourceLayerIndex:P}of t){let M=this.layers[0]._featureFilter.needGeometry,z=Pl(v,M);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),z,a))continue;let N=g?h.evaluate(z,{},a):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:P,index:T,geometry:M?z.geometry:Cl(v),patterns:{},sortKey:N};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(let v of y){let{geometry:S,index:T,sourceLayerIndex:P}=v;if(this.hasPattern){let M=Md("line",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,S,T,a,{});n.featureIndex.insert(t[T].feature,S,T,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,px)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,h,g){let y=this.layers[0].layout,v=y.get("line-join").evaluate(t,{}),S=y.get("line-cap"),T=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let M of n)this.addLine(M,t,v,S,T,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,n,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<t.length-1;Q++)this.totalDistance+=t[Q].dist(t[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let v=dx[n.type]==="Polygon",S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let T=0;for(;T<S-1&&t[T].equals(t[T+1]);)T++;if(S<(v?3:2))return;a==="bevel"&&(g=1.05);let P=this.overscaling<=16?15*Xr/(512*this.overscaling):0,M=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray),z,N,B,q,W;this.e1=this.e2=-1,v&&(z=t[S-2],W=t[T].sub(z)._unit()._perp());for(let Q=T;Q<S;Q++){if(B=Q===S-1?v?t[T+1]:void 0:t[Q+1],B&&t[Q].equals(B))continue;W&&(q=W),z&&(N=z),z=t[Q],W=B?B.sub(z)._unit()._perp():q,q=q||W;let ut=q.add(W);ut.x===0&&ut.y===0||ut._unit();let rt=q.x*W.x+q.y*W.y,pt=ut.x*W.x+ut.y*W.y,ft=pt!==0?1/pt:1/0,Et=2*Math.sqrt(2-2*pt),Zt=pt<fx&&N&&B,ee=q.x*W.y-q.y*W.x>0;if(Zt&&Q>T){let Ft=z.dist(N);if(Ft>2*P){let Yt=z.sub(z.sub(N)._mult(P/Ft)._round());this.updateDistance(N,Yt),this.addCurrentVertex(Yt,q,0,0,M),N=Yt}}let $t=N&&B,jt=$t?a:v?"butt":h;if($t&&jt==="round"&&(ft<y?jt="miter":ft<=2&&(jt="fakeround")),jt==="miter"&&ft>g&&(jt="bevel"),jt==="bevel"&&(ft>2&&(jt="flipbevel"),ft<g&&(jt="miter")),N&&this.updateDistance(N,z),jt==="miter")ut._mult(ft),this.addCurrentVertex(z,ut,0,0,M);else if(jt==="flipbevel"){if(ft>100)ut=W.mult(-1);else{let Ft=ft*q.add(W).mag()/q.sub(W).mag();ut._perp()._mult(Ft*(ee?-1:1))}this.addCurrentVertex(z,ut,0,0,M),this.addCurrentVertex(z,ut.mult(-1),0,0,M)}else if(jt==="bevel"||jt==="fakeround"){let Ft=-Math.sqrt(ft*ft-1),Yt=ee?Ft:0,Bt=ee?0:Ft;if(N&&this.addCurrentVertex(z,q,Yt,Bt,M),jt==="fakeround"){let Dt=Math.round(180*Et/Math.PI/20);for(let ue=1;ue<Dt;ue++){let ne=ue/Dt;if(ne!==.5){let vr=ne-.5;ne+=ne*vr*(ne-1)*((1.0904+rt*(rt*(3.55645-1.43519*rt)-3.2452))*vr*vr+(.848013+rt*(.215638*rt-1.06021)))}let Me=W.sub(q)._mult(ne)._add(q)._unit()._mult(ee?-1:1);this.addHalfVertex(z,Me.x,Me.y,!1,ee,0,M)}}B&&this.addCurrentVertex(z,W,-Yt,-Bt,M)}else if(jt==="butt")this.addCurrentVertex(z,ut,0,0,M);else if(jt==="square"){let Ft=N?1:-1;this.addCurrentVertex(z,ut,Ft,Ft,M)}else jt==="round"&&(N&&(this.addCurrentVertex(z,q,0,0,M),this.addCurrentVertex(z,q,1,1,M,!0)),B&&(this.addCurrentVertex(z,W,-1,-1,M,!0),this.addCurrentVertex(z,W,0,0,M)));if(Zt&&Q<S-1){let Ft=z.dist(B);if(Ft>2*P){let Yt=z.add(B.sub(z)._mult(P/Ft)._round());this.updateDistance(z,Yt),this.addCurrentVertex(Yt,W,0,0,M),z=Yt}}}}addCurrentVertex(t,n,a,h,g,y=!1){let v=n.y*h-n.x,S=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,y,!1,a,g),this.addHalfVertex(t,v,S,y,!0,-h,g),this.distance>dg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,a,h,g,y))}addHalfVertex({x:t,y:n},a,h,g,y,v,S){let T=.5*(this.lineClips?this.scaledDistance*(dg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let P=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),S.primitiveLength++),y?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let fg,mg;Ht("LineBucket",Rd,{omit:["layers","patternFeatures"]});var gg={get paint(){return mg=mg||new Ur({"line-opacity":new he(_t.paint_line["line-opacity"]),"line-color":new he(_t.paint_line["line-color"]),"line-translate":new ie(_t.paint_line["line-translate"]),"line-translate-anchor":new ie(_t.paint_line["line-translate-anchor"]),"line-width":new he(_t.paint_line["line-width"]),"line-gap-width":new he(_t.paint_line["line-gap-width"]),"line-offset":new he(_t.paint_line["line-offset"]),"line-blur":new he(_t.paint_line["line-blur"]),"line-dasharray":new Fc(_t.paint_line["line-dasharray"]),"line-pattern":new El(_t.paint_line["line-pattern"]),"line-gradient":new Nc(_t.paint_line["line-gradient"])})},get layout(){return fg=fg||new Ur({"line-cap":new ie(_t.layout_line["line-cap"]),"line-join":new he(_t.layout_line["line-join"]),"line-miter-limit":new ie(_t.layout_line["line-miter-limit"]),"line-round-limit":new ie(_t.layout_line["line-round-limit"]),"line-sort-key":new he(_t.layout_line["line-sort-key"])})}};class mx extends he{possiblyEvaluate(t,n){return n=new yr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,a,h){return n=Le({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,a,h)}}let xp;class gx extends Ni{constructor(t){super(t,gg),this.gradientVersion=0,xp||(xp=new mx(gg.paint.properties["line-width"].specification),xp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=xp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Rd(t)}queryRadius(t){let n=t,a=yg(Zc("line-width",this,n),Zc("line-gap-width",this,n)),h=Zc("line-offset",this,n);return a/2+Math.abs(h)+dp(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v){let S=fp(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),T=v/2*yg(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),P=this.paint.get("line-offset").evaluate(n,a);return P&&(h=function(M,z){let N=[];for(let B=0;B<M.length;B++){let q=M[B],W=[];for(let Q=0;Q<q.length;Q++){let ut=q[Q-1],rt=q[Q],pt=q[Q+1],ft=Q===0?new st(0,0):rt.sub(ut)._unit()._perp(),Et=Q===q.length-1?new st(0,0):pt.sub(rt)._unit()._perp(),Zt=ft._add(Et)._unit(),ee=Zt.x*Et.x+Zt.y*Et.y;ee!==0&&Zt._mult(1/ee),W.push(Zt._mult(z)._add(rt))}N.push(W)}return N}(h,P*v)),function(M,z,N){for(let B=0;B<z.length;B++){let q=z[B];if(M.length>=3){for(let W=0;W<q.length;W++)if(Au(M,q[W]))return!0}if(wv(M,q,N))return!0}return!1}(S,h,T)}isTileClipped(){return!0}}function yg(r,t){return t>0?t+2*r:r}let yx=Pr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_x=Pr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let vx=Pr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Pr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let _g=Pr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xx=Pr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bx(r,t,n){return r.sections.forEach(a=>{a.text=function(h,g,y){let v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),_i.applyArabicShaping&&(h=_i.applyArabicShaping(h)),h}(a.text,t,n)}),r}Pr([{name:"triangle",components:3,type:"Uint16"}]),Pr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Pr([{type:"Float32",name:"offsetX"}]),Pr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Pr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let eh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var en=24,vg=cr,xg=function(r,t,n,a,h){var g,y,v=8*h-a-1,S=(1<<v)-1,T=S>>1,P=-7,M=n?h-1:0,z=n?-1:1,N=r[t+M];for(M+=z,g=N&(1<<-P)-1,N>>=-P,P+=v;P>0;g=256*g+r[t+M],M+=z,P-=8);for(y=g&(1<<-P)-1,g>>=-P,P+=a;P>0;y=256*y+r[t+M],M+=z,P-=8);if(g===0)g=1-T;else{if(g===S)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,a),g-=T}return(N?-1:1)*y*Math.pow(2,g-a)},bg=function(r,t,n,a,h,g){var y,v,S,T=8*g-h-1,P=(1<<T)-1,M=P>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=a?0:g-1,B=a?1:-1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,y=P):(y=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-y))<1&&(y--,S*=2),(t+=y+M>=1?z/S:z*Math.pow(2,1-M))*S>=2&&(y++,S/=2),y+M>=P?(v=0,y=P):y+M>=1?(v=(t*S-1)*Math.pow(2,h),y+=M):(v=t*Math.pow(2,M-1)*Math.pow(2,h),y=0));h>=8;r[n+N]=255&v,N+=B,v/=256,h-=8);for(y=y<<h|v,T+=h;T>0;r[n+N]=255&y,N+=B,y/=256,T-=8);r[n+N-B]|=128*q};function cr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}cr.Varint=0,cr.Fixed64=1,cr.Bytes=2,cr.Fixed32=5;var Od=4294967296,wg=1/Od,Sg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ys(r){return r.type===cr.Bytes?r.readVarint()+r.pos:r.pos+1}function wx(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Eg(r,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var h=n.pos-1;h>=r;h--)n.buf[h+a]=n.buf[h]}function Sx(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function Ex(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function Tx(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function Ix(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function Cx(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function Px(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function Ax(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function Lx(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function Mx(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function bp(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function ku(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function Tg(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}cr.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,r(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=bp(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Tg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=bp(this.buf,this.pos)+bp(this.buf,this.pos+4)*Od;return this.pos+=8,r},readSFixed64:function(){var r=bp(this.buf,this.pos)+Tg(this.buf,this.pos+4)*Od;return this.pos+=8,r},readFloat:function(){var r=xg(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=xg(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(h,g,y){var v,S,T=y.buf;if(v=(112&(S=T[y.pos++]))>>4,S<128||(v|=(127&(S=T[y.pos++]))<<3,S<128)||(v|=(127&(S=T[y.pos++]))<<10,S<128)||(v|=(127&(S=T[y.pos++]))<<17,S<128)||(v|=(127&(S=T[y.pos++]))<<24,S<128)||(v|=(1&(S=T[y.pos++]))<<31,S<128))return wx(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&Sg?function(n,a,h){return Sg.decode(n.subarray(a,h))}(this.buf,t,r):function(n,a,h){for(var g="",y=a;y<h;){var v,S,T,P=n[y],M=null,z=P>239?4:P>223?3:P>191?2:1;if(y+z>h)break;z===1?P<128&&(M=P):z===2?(192&(v=n[y+1]))==128&&(M=(31&P)<<6|63&v)<=127&&(M=null):z===3?(S=n[y+2],(192&(v=n[y+1]))==128&&(192&S)==128&&((M=(15&P)<<12|(63&v)<<6|63&S)<=2047||M>=55296&&M<=57343)&&(M=null)):z===4&&(S=n[y+2],T=n[y+3],(192&(v=n[y+1]))==128&&(192&S)==128&&(192&T)==128&&((M=(15&P)<<18|(63&v)<<12|(63&S)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,z=1):M>65535&&(M-=65536,g+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),g+=String.fromCharCode(M),y+=z}return g}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==cr.Bytes)return r.push(this.readVarint(t));var n=Ys(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==cr.Bytes)return r.push(this.readSVarint());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==cr.Bytes)return r.push(this.readBoolean());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==cr.Bytes)return r.push(this.readFloat());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==cr.Bytes)return r.push(this.readDouble());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed32());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed32());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed64());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed64());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===cr.Varint)for(;this.buf[this.pos++]>127;);else if(t===cr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===cr.Fixed32)this.pos+=4;else{if(t!==cr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),ku(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),ku(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),ku(this.buf,-1&r,this.pos),ku(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),ku(this.buf,-1&r,this.pos),ku(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,n),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,v,S=0;S<h.length;S++){if((y=h.charCodeAt(S))>55295&&y<57344){if(!v){y>56319||S+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Eg(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),bg(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),bg(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var a=this.pos-n;a>=128&&Eg(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,n){this.writeTag(r,cr.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,Sx,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,Ex,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Cx,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Tx,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Ix,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Px,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Ax,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Lx,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Mx,t)},writeBytesField:function(r,t){this.writeTag(r,cr.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,cr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,cr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,cr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,cr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,cr.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,cr.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,cr.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,cr.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,cr.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Fd=R(vg);let Nd=3;function Dx(r,t,n){r===1&&n.readMessage(kx,t)}function kx(r,t,n){if(r===3){let{id:a,bitmap:h,width:g,height:y,left:v,top:S,advance:T}=n.readMessage(zx,{});t.push({id:a,bitmap:new Hc({width:g+2*Nd,height:y+2*Nd},h),metrics:{width:g,height:y,left:v,top:S,advance:T}})}}function zx(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}let Ig=Nd;function Cg(r){let t=0,n=0;for(let y of r)t+=y.w*y.h,n=Math.max(n,y.w);r.sort((y,v)=>v.h-y.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],h=0,g=0;for(let y of r)for(let v=a.length-1;v>=0;v--){let S=a[v];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===S.w&&y.h===S.h){let T=a.pop();v<a.length&&(a[v]=T)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}let xi=1;class Bd{constructor(t,{pixelRatio:n,version:a,stretchX:h,stretchY:g,content:y}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+xi,this.paddedRect.y+xi]}get br(){return[this.paddedRect.x+this.paddedRect.w-xi,this.paddedRect.y+this.paddedRect.h-xi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*xi)/this.pixelRatio,(this.paddedRect.h-2*xi)/this.pixelRatio]}}class Pg{constructor(t,n){let a={},h={};this.haveRenderCallbacks=[];let g=[];this.addImages(t,a,g),this.addImages(n,h,g);let{w:y,h:v}=Cg(g),S=new Ji({width:y||1,height:v||1});for(let T in t){let P=t[T],M=a[T].paddedRect;Ji.copy(P.data,S,{x:0,y:0},{x:M.x+xi,y:M.y+xi},P.data)}for(let T in n){let P=n[T],M=h[T].paddedRect,z=M.x+xi,N=M.y+xi,B=P.data.width,q=P.data.height;Ji.copy(P.data,S,{x:0,y:0},{x:z,y:N},P.data),Ji.copy(P.data,S,{x:0,y:q-1},{x:z,y:N-1},{width:B,height:1}),Ji.copy(P.data,S,{x:0,y:0},{x:z,y:N+q},{width:B,height:1}),Ji.copy(P.data,S,{x:B-1,y:0},{x:z-1,y:N},{width:1,height:q}),Ji.copy(P.data,S,{x:0,y:0},{x:z+B,y:N},{width:1,height:q})}this.image=S,this.iconPositions=a,this.patternPositions=h}addImages(t,n,a){for(let h in t){let g=t[h],y={x:0,y:0,w:g.data.width+2*xi,h:g.data.height+2*xi};a.push(y),n[h]=new Bd(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;let[h,g]=t.tl;a.update(n.data,void 0,{x:h,y:g})}}var La;Ht("ImagePosition",Bd),Ht("ImageAtlas",Pg),l.ai=void 0,(La=l.ai||(l.ai={}))[La.none=0]="none",La[La.horizontal=1]="horizontal",La[La.vertical=2]="vertical",La[La.horizontalOnly=3]="horizontalOnly";let rh=-17;class nh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){let a=new nh;return a.scale=t||1,a.fontStack=n,a}static forImage(t){let n=new nh;return n.imageName=t,n}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){let a=new zu;for(let h=0;h<t.sections.length;h++){let g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let a=0;a<t.length;a++){let h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;n+=h&&tu(h)&&!eh[t[a+1]]||g&&tu(g)&&!eh[t[a-1]]||!eh[t[a]]?t[a]:eh[t[a]]}return n}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Sp[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Sp[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){let a=new zu;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(nh.forText(t.scale,t.fontStack||n));let a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){let n=t.image?t.image.name:"";if(n.length===0)return void de("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(nh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):de("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wp(r,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q){let W=zu.fromFeature(r,h),Q;M===l.ai.vertical&&W.verticalizePunctuation();let{processBidirectionalText:ut,processStyledBidirectionalText:rt}=_i;if(ut&&W.sections.length===1){Q=[];let Et=ut(W.toString(),Vd(W,T,g,t,a,N,B));for(let Zt of Et){let ee=new zu;ee.text=Zt,ee.sections=W.sections;for(let $t=0;$t<Zt.length;$t++)ee.sectionIndex.push(0);Q.push(ee)}}else if(rt){Q=[];let Et=rt(W.text,W.sectionIndex,Vd(W,T,g,t,a,N,B));for(let Zt of Et){let ee=new zu;ee.text=Zt[0],ee.sectionIndex=Zt[1],ee.sections=W.sections,Q.push(ee)}}else Q=function(Et,Zt){let ee=[],$t=Et.text,jt=0;for(let Ft of Zt)ee.push(Et.substring(jt,Ft)),jt=Ft;return jt<$t.length&&ee.push(Et.substring(jt,$t.length)),ee}(W,Vd(W,T,g,t,a,N,B));let pt=[],ft={positionedLines:pt,text:W.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(Et,Zt,ee,$t,jt,Ft,Yt,Bt,Dt,ue,ne,Me){let vr=0,Sr=rh,rn=0,Vi=0,ai=Bt==="right"?1:Bt==="left"?0:.5,Hr=0;for(let nn of jt){nn.trim();let on=nn.getMaxScale(),Xn=(on-1)*en,ci={positionedGlyphs:[],lineOffset:0};Et.positionedLines[Hr]=ci;let Hn=ci.positionedGlyphs,bi=0;if(!nn.length()){Sr+=Ft,++Hr;continue}for(let sn=0;sn<nn.length();sn++){let Ve=nn.getSection(sn),Yn=nn.getSectionIndex(sn),An=nn.getCharCode(sn),an=0,Eo=null,Go=null,qo=null,Ws=en,To=!(Dt===l.ai.horizontal||!ne&&!Wa(An)||ne&&(Sp[An]||(vn=An,Gt.Arabic(vn)||Gt["Arabic Supplement"](vn)||Gt["Arabic Extended-A"](vn)||Gt["Arabic Presentation Forms-A"](vn)||Gt["Arabic Presentation Forms-B"](vn))));if(Ve.imageName){let Qi=$t[Ve.imageName];if(!Qi)continue;qo=Ve.imageName,Et.iconsInText=Et.iconsInText||!0,Go=Qi.paddedRect;let Si=Qi.displaySize;Ve.scale=Ve.scale*en/Me,Eo={width:Si[0],height:Si[1],left:xi,top:-Ig,advance:To?Si[1]:Si[0]},an=Xn+(en-Si[1]*Ve.scale),Ws=Eo.advance;let Js=To?Si[0]*Ve.scale-en*on:Si[1]*Ve.scale-en*on;Js>0&&Js>bi&&(bi=Js)}else{let Qi=ee[Ve.fontStack],Si=Qi&&Qi[An];if(Si&&Si.rect)Go=Si.rect,Eo=Si.metrics;else{let Js=Zt[Ve.fontStack],lh=Js&&Js[An];if(!lh)continue;Eo=lh.metrics}an=(on-Ve.scale)*en}To?(Et.verticalizable=!0,Hn.push({glyph:An,imageName:qo,x:vr,y:Sr+an,vertical:To,scale:Ve.scale,fontStack:Ve.fontStack,sectionIndex:Yn,metrics:Eo,rect:Go}),vr+=Ws*Ve.scale+ue):(Hn.push({glyph:An,imageName:qo,x:vr,y:Sr+an,vertical:To,scale:Ve.scale,fontStack:Ve.fontStack,sectionIndex:Yn,metrics:Eo,rect:Go}),vr+=Eo.advance*Ve.scale+ue)}Hn.length!==0&&(rn=Math.max(vr-ue,rn),Fx(Hn,0,Hn.length-1,ai,bi)),vr=0;let wi=Ft*on+bi;ci.lineOffset=Math.max(bi,Xn),Sr+=wi,Vi=Math.max(wi,Vi),++Hr}var vn;let Pn=Sr-rh,{horizontalAlign:li,verticalAlign:ui}=Ud(Yt);(function(nn,on,Xn,ci,Hn,bi,wi,sn,Ve){let Yn=(on-Xn)*Hn,An=0;An=bi!==wi?-sn*ci-rh:(-ci*Ve+.5)*wi;for(let an of nn)for(let Eo of an.positionedGlyphs)Eo.x+=Yn,Eo.y+=An})(Et.positionedLines,ai,li,ui,rn,Vi,Ft,Pn,jt.length),Et.top+=-ui*Pn,Et.bottom=Et.top+Pn,Et.left+=-li*rn,Et.right=Et.left+rn}(ft,t,n,a,Q,y,v,S,M,T,z,q),!function(Et){for(let Zt of Et)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(pt)&&ft}let Sp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ag(r,t,n,a,h,g){if(t.imageName){let y=a[t.imageName];return y?y.displaySize[0]*t.scale*en/g+h:0}{let y=n[t.fontStack],v=y&&y[r];return v?v.metrics.advance*t.scale+h:0}}function Lg(r,t,n,a){let h=Math.pow(r-t,2);return a?r<t?h/2:2*h:h+Math.abs(n)*n}function Ox(r,t,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Mg(r,t,n,a,h,g){let y=null,v=Lg(t,n,h,g);for(let S of a){let T=Lg(t-S.x,n,h,g)+S.badness;T<=v&&(y=S,v=T)}return{index:r,x:t,priorBreak:y,badness:v}}function Dg(r){return r?Dg(r.priorBreak).concat(r.index):[]}function Vd(r,t,n,a,h,g,y){if(g!=="point")return[];if(!r)return[];let v=[],S=function(z,N,B,q,W,Q){let ut=0;for(let rt=0;rt<z.length();rt++){let pt=z.getSection(rt);ut+=Ag(z.getCharCode(rt),pt,q,W,N,Q)}return ut/Math.max(1,Math.ceil(ut/B))}(r,t,n,a,h,y),T=r.text.indexOf("\u200B")>=0,P=0;for(let z=0;z<r.length();z++){let N=r.getSection(z),B=r.getCharCode(z);if(Sp[B]||(P+=Ag(B,N,a,h,t,y)),z<r.length()-1){let q=!((M=B)<11904||!(Gt["Bopomofo Extended"](M)||Gt.Bopomofo(M)||Gt["CJK Compatibility Forms"](M)||Gt["CJK Compatibility Ideographs"](M)||Gt["CJK Compatibility"](M)||Gt["CJK Radicals Supplement"](M)||Gt["CJK Strokes"](M)||Gt["CJK Symbols and Punctuation"](M)||Gt["CJK Unified Ideographs Extension A"](M)||Gt["CJK Unified Ideographs"](M)||Gt["Enclosed CJK Letters and Months"](M)||Gt["Halfwidth and Fullwidth Forms"](M)||Gt.Hiragana(M)||Gt["Ideographic Description Characters"](M)||Gt["Kangxi Radicals"](M)||Gt["Katakana Phonetic Extensions"](M)||Gt.Katakana(M)||Gt["Vertical Forms"](M)||Gt["Yi Radicals"](M)||Gt["Yi Syllables"](M)));(Rx[B]||q||N.imageName)&&v.push(Mg(z+1,P,S,v,Ox(B,r.getCharCode(z+1),q&&T),!1))}}var M;return Dg(Mg(r.length(),P,S,v,0,!0))}function Ud(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Fx(r,t,n,a,h){if(!a&&!h)return;let g=r[n],y=(r[n].x+g.metrics.advance*g.scale)*a;for(let v=t;v<=n;v++)r[v].x-=y,r[v].y+=h}function Nx(r,t,n){let{horizontalAlign:a,verticalAlign:h}=Ud(n),g=t[0]-r.displaySize[0]*a,y=t[1]-r.displaySize[1]*h;return{image:r,top:y,bottom:y+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function kg(r,t,n,a,h,g){let y=r.image,v;if(y.content){let W=y.content,Q=y.pixelRatio||1;v=[W[0]/Q,W[1]/Q,y.displaySize[0]-W[2]/Q,y.displaySize[1]-W[3]/Q]}let S=t.left*g,T=t.right*g,P,M,z,N;n==="width"||n==="both"?(N=h[0]+S-a[3],M=h[0]+T+a[1]):(N=h[0]+(S+T-y.displaySize[0])/2,M=N+y.displaySize[0]);let B=t.top*g,q=t.bottom*g;return n==="height"||n==="both"?(P=h[1]+B-a[0],z=h[1]+q+a[2]):(P=h[1]+(B+q-y.displaySize[1])/2,z=P+y.displaySize[1]),{image:y,top:P,right:M,bottom:z,left:N,collisionPadding:v}}let ih=255,ys=128,Ma=ih*ys;function zg(r,t){let{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new yr(r+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:h}=n,g=0;for(;g<a.length&&a[g]<=r;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);let v=a[g],S=a[y];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:S,minSize:n.evaluate(new yr(v)),maxSize:n.evaluate(new yr(S)),interpolationType:h}}}function jd(r,t,n){let a="never",h=r.get(t);return h?a=h:r.get(n)&&(a="always"),a}let Bx=Aa.VectorTileFeature.types,Vx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ep(r,t,n,a,h,g,y,v,S,T,P,M,z){let N=v?Math.min(Ma,Math.round(v[0])):0,B=v?Math.min(Ma,Math.round(v[1])):0;r.emplaceBack(t,n,Math.round(32*a),Math.round(32*h),g,y,(N<<1)+(S?1:0),B,16*T,16*P,256*M,256*z)}function Gd(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Ux(r){for(let t of r.sections)if(ic(t.text))return!0;return!1}class qd{constructor(t){this.layoutVertexArray=new De,this.indexArray=new yn,this.programConfigurations=t,this.segments=new _r,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Re,this.hasVisibleVertices=!1,this.placedSymbolArray=new ot}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_x.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Vx,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",qd);class $d{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new _r,this.collisionVertexArray=new pr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,vx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",$d);class Ru{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wd([]),this.placementViewportMatrix=wd([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zg(this.zoom,n["text-size"]),this.iconSizeData=zg(this.zoom,n["icon-size"]);let a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=jd(a,"text-overlap","text-allow-overlap")!=="never"||jd(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>l.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new qd(new jo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qd(new jo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new lt,this.lineVertexArray=new mt,this.symbolInstances=new K,this.textAnchorOffsets=new St}calculateGlyphDependencies(t,n,a,h,g){for(let y=0;y<t.length;y++)if(n[t.charCodeAt(y)]=!0,(a||h)&&g){let v=eh[t.charAt(y)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,a){let h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),S=g.get("icon-image"),T=(v.value.kind!=="constant"||v.value.value instanceof Br&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,M=g.get("symbol-sort-key");if(this.features=[],!T&&!P)return;let z=n.iconDependencies,N=n.glyphDependencies,B=n.availableImages,q=new yr(this.zoom);for(let{feature:W,id:Q,index:ut,sourceLayerIndex:rt}of t){let pt=h._featureFilter.needGeometry,ft=Pl(W,pt);if(!h._featureFilter.filter(q,ft,a))continue;let Et,Zt;if(pt||(ft.geometry=Cl(W)),T){let $t=h.getValueAndResolveTokens("text-field",ft,a,B),jt=Br.factory($t);Ux(jt)&&(this.hasRTLText=!0),(!this.hasRTLText||Rc()==="unavailable"||this.hasRTLText&&_i.isParsed())&&(Et=bx(jt,h,ft))}if(P){let $t=h.getValueAndResolveTokens("icon-image",ft,a,B);Zt=$t instanceof un?$t:un.fromString($t)}if(!Et&&!Zt)continue;let ee=this.sortFeaturesByKey?M.evaluate(ft,{},a):void 0;if(this.features.push({id:Q,text:Et,icon:Zt,index:ut,sourceLayerIndex:rt,geometry:ft.geometry,properties:W.properties,type:Bx[W.type],sortKey:ee}),Zt&&(z[Zt.name]=!0),Et){let $t=y.evaluate(ft,{},a).join(","),jt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(let Ft of Et.sections)if(Ft.image)z[Ft.image.name]=!0;else{let Yt=Ql(Et.toString()),Bt=Ft.fontStack||$t,Dt=N[Bt]=N[Bt]||{};this.calculateGlyphDependencies(Ft.text,Dt,jt,this.allowVerticalPlacement,Yt)}}}g.get("symbol-placement")==="line"&&(this.features=function(W){let Q={},ut={},rt=[],pt=0;function ft($t){rt.push(W[$t]),pt++}function Et($t,jt,Ft){let Yt=ut[$t];return delete ut[$t],ut[jt]=Yt,rt[Yt].geometry[0].pop(),rt[Yt].geometry[0]=rt[Yt].geometry[0].concat(Ft[0]),Yt}function Zt($t,jt,Ft){let Yt=Q[jt];return delete Q[jt],Q[$t]=Yt,rt[Yt].geometry[0].shift(),rt[Yt].geometry[0]=Ft[0].concat(rt[Yt].geometry[0]),Yt}function ee($t,jt,Ft){let Yt=Ft?jt[0][jt[0].length-1]:jt[0][0];return`${$t}:${Yt.x}:${Yt.y}`}for(let $t=0;$t<W.length;$t++){let jt=W[$t],Ft=jt.geometry,Yt=jt.text?jt.text.toString():null;if(!Yt){ft($t);continue}let Bt=ee(Yt,Ft),Dt=ee(Yt,Ft,!0);if(Bt in ut&&Dt in Q&&ut[Bt]!==Q[Dt]){let ue=Zt(Bt,Dt,Ft),ne=Et(Bt,Dt,rt[ue].geometry);delete Q[Bt],delete ut[Dt],ut[ee(Yt,rt[ne].geometry,!0)]=ne,rt[ue].geometry=null}else Bt in ut?Et(Bt,Dt,Ft):Dt in Q?Zt(Bt,Dt,Ft):(ft($t),Q[Bt]=pt-1,ut[Dt]=pt-1)}return rt.filter($t=>$t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Q)=>W.sortKey-Q.sortKey)}update(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){let a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]),y={};for(let v=t.segment+1;v<n.length;v++)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){let S=y[v];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,h,g,y,v,S,T,P,M,z){let N=t.indexArray,B=t.layoutVertexArray,q=t.segments.prepareSegment(4*n.length,B,N,this.canOverlap?y.sortKey:void 0),W=this.glyphOffsetArray.length,Q=q.vertexLength,ut=this.allowVerticalPlacement&&v===l.ai.vertical?Math.PI/2:0,rt=y.text&&y.text.sections;for(let pt=0;pt<n.length;pt++){let{tl:ft,tr:Et,bl:Zt,br:ee,tex:$t,pixelOffsetTL:jt,pixelOffsetBR:Ft,minFontScaleX:Yt,minFontScaleY:Bt,glyphOffset:Dt,isSDF:ue,sectionIndex:ne}=n[pt],Me=q.vertexLength,vr=Dt[1];Ep(B,S.x,S.y,ft.x,vr+ft.y,$t.x,$t.y,a,ue,jt.x,jt.y,Yt,Bt),Ep(B,S.x,S.y,Et.x,vr+Et.y,$t.x+$t.w,$t.y,a,ue,Ft.x,jt.y,Yt,Bt),Ep(B,S.x,S.y,Zt.x,vr+Zt.y,$t.x,$t.y+$t.h,a,ue,jt.x,Ft.y,Yt,Bt),Ep(B,S.x,S.y,ee.x,vr+ee.y,$t.x+$t.w,$t.y+$t.h,a,ue,Ft.x,Ft.y,Yt,Bt),Gd(t.dynamicLayoutVertexArray,S,ut),N.emplaceBack(Me,Me+1,Me+2),N.emplaceBack(Me+1,Me+2,Me+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),pt!==n.length-1&&ne===n[pt+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,y,y.index,{},z,rt&&rt[ne])}t.placedSymbolArray.emplaceBack(S.x,S.y,W,this.glyphOffsetArray.length-W,Q,T,P,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,M)}_addCollisionDebugVertex(t,n,a,h,g,y){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,n,a,h,g,y,v){let S=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),T=S.vertexLength,P=g.layoutVertexArray,M=g.collisionVertexArray,z=v.anchorX,N=v.anchorY;this._addCollisionDebugVertex(P,M,y,z,N,new st(t,n)),this._addCollisionDebugVertex(P,M,y,z,N,new st(a,n)),this._addCollisionDebugVertex(P,M,y,z,N,new st(a,h)),this._addCollisionDebugVertex(P,M,y,z,N,new st(t,h)),S.vertexLength+=4;let B=g.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),S.primitiveLength+=4}addDebugCollisionBoxes(t,n,a,h){for(let g=t;g<n;g++){let y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $d(Rr,_g.members,Qr),this.iconCollisionBox=new $d(Rr,_g.members,Qr);for(let t=0;t<this.symbolInstances.length;t++){let n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,a,h,g,y,v,S,T){let P={};for(let M=n;M<a;M++){let z=t.get(M);P.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.textFeatureIndex=z.featureIndex;break}for(let M=h;M<g;M++){let z=t.get(M);P.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalTextFeatureIndex=z.featureIndex;break}for(let M=y;M<v;M++){let z=t.get(M);P.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.iconFeatureIndex=z.featureIndex;break}for(let M=S;M<T;M++){let z=t.get(M);P.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalIconFeatureIndex=z.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){let a=t.placedSymbolArray.get(n),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);let S=this.symbolInstances.get(v);h.push(0|Math.round(n*S.anchorX+a*S.anchorY)),g.push(S.featureIndex)}return y.sort((v,S)=>h[v]-h[S]||g[S]-g[v]),y}addToSortKeyRanges(t,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rg,Og;Ht("SymbolBucket",Ru,{omit:["layers","collisionBoxArray","features","compareText"]}),Ru.MAX_GLYPHS=65535,Ru.addDynamicAttributes=Gd;var Zd={get paint(){return Og=Og||new Ur({"icon-opacity":new he(_t.paint_symbol["icon-opacity"]),"icon-color":new he(_t.paint_symbol["icon-color"]),"icon-halo-color":new he(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new he(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new he(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new ie(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new ie(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new he(_t.paint_symbol["text-opacity"]),"text-color":new he(_t.paint_symbol["text-color"],{runtimeType:bn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new he(_t.paint_symbol["text-halo-color"]),"text-halo-width":new he(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new he(_t.paint_symbol["text-halo-blur"]),"text-translate":new ie(_t.paint_symbol["text-translate"]),"text-translate-anchor":new ie(_t.paint_symbol["text-translate-anchor"])})},get layout(){return Rg=Rg||new Ur({"symbol-placement":new ie(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new ie(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ie(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new he(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ie(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ie(_t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ie(_t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ie(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new ie(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ie(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new he(_t.layout_symbol["icon-size"]),"icon-text-fit":new ie(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ie(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new he(_t.layout_symbol["icon-image"]),"icon-rotate":new he(_t.layout_symbol["icon-rotate"]),"icon-padding":new he(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new ie(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new he(_t.layout_symbol["icon-offset"]),"icon-anchor":new he(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ie(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ie(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ie(_t.layout_symbol["text-rotation-alignment"]),"text-field":new he(_t.layout_symbol["text-field"]),"text-font":new he(_t.layout_symbol["text-font"]),"text-size":new he(_t.layout_symbol["text-size"]),"text-max-width":new he(_t.layout_symbol["text-max-width"]),"text-line-height":new ie(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new he(_t.layout_symbol["text-letter-spacing"]),"text-justify":new he(_t.layout_symbol["text-justify"]),"text-radial-offset":new he(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ie(_t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new he(_t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new he(_t.layout_symbol["text-anchor"]),"text-max-angle":new ie(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new ie(_t.layout_symbol["text-writing-mode"]),"text-rotate":new he(_t.layout_symbol["text-rotate"]),"text-padding":new ie(_t.layout_symbol["text-padding"]),"text-keep-upright":new ie(_t.layout_symbol["text-keep-upright"]),"text-transform":new he(_t.layout_symbol["text-transform"]),"text-offset":new he(_t.layout_symbol["text-offset"]),"text-allow-overlap":new ie(_t.layout_symbol["text-allow-overlap"]),"text-overlap":new ie(_t.layout_symbol["text-overlap"]),"text-ignore-placement":new ie(_t.layout_symbol["text-ignore-placement"]),"text-optional":new ie(_t.layout_symbol["text-optional"])})}};class Fg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ai,this.defaultValue=t}evaluate(t){if(t.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",Fg,{omit:["defaultValue"]});class Tp extends Ni{constructor(t){super(t,Zd)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let h=[];for(let g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,h){let g=this.layout.get(t).evaluate(n,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||rs(y.value)||!g?g:function(v,S){return S.replace(/{([^{}]+)}/g,(T,P)=>v&&P in v?String(v[P]):"")}(n.properties,g)}createBucket(t){return new Ru(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Zd.paint.overridableProperties){if(!Tp.hasPaintOverride(this.layout,t))continue;let n=this.paint.get(t),a=new Fg(n),h=new qa(a,n.property.specification),g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new $a("source",h):new Vs("composite",h,n.value.zoomStops),this.paint._values[t]=new $n(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Tp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){let a=t.get("text-field"),h=Zd.paint.properties[n],g=!1,y=v=>{for(let S of v)if(h.overrides&&h.overrides.hasOverride(S))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Br)y(a.value.value.sections);else if(a.value.kind==="source"){let v=T=>{g||(T instanceof Bo&&br(T.value)===X?y(T.value.sections):T instanceof Ga?y(T.sections):T.eachChild(v))},S=a.value;S._styleExpression&&v(S._styleExpression.expression)}return g}}let Ng;var jx={get paint(){return Ng=Ng||new Ur({"background-color":new ie(_t.paint_background["background-color"]),"background-pattern":new Fc(_t.paint_background["background-pattern"]),"background-opacity":new ie(_t.paint_background["background-opacity"])})}};class Gx extends Ni{constructor(t){super(t,jx)}}let Bg;var qx={get paint(){return Bg=Bg||new Ur({"raster-opacity":new ie(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new ie(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ie(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ie(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new ie(_t.paint_raster["raster-saturation"]),"raster-contrast":new ie(_t.paint_raster["raster-contrast"]),"raster-resampling":new ie(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new ie(_t.paint_raster["raster-fade-duration"])})}};class $x extends Ni{constructor(t){super(t,qx)}}class Zx extends Ni{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Xx{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let Xd=63710088e-1;class Da{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Da(er(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let n=Math.PI/180,a=this.lat*n,h=t.lat*n,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Xd*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Da)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Da(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Da(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Vg=2*Math.PI*Xd;function Ug(r){return Vg*Math.cos(r*Math.PI/180)}function jg(r){return(180+r)/360}function Gg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function qg(r,t){return r/Ug(t)}function $g(r){return 360*r-180}function Hd(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ip{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){let a=Da.convert(t);return new Ip(jg(a.lng),Gg(a.lat),qg(n,a.lat))}toLngLat(){return new Da($g(this.x),Hd(this.y))}toAltitude(){return this.z*Ug(Hd(this.y))}meterInMercatorCoordinateUnits(){return 1/Vg*(t=Hd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Zg(r,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Yd{constructor(t,n,a){if(t<0||t>25||a<0||a>=Math.pow(2,t)||n<0||n>=Math.pow(2,t))throw new Error(`x=${n}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=a,this.key=oh(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,a){let h=(y=this.y,v=this.z,S=Zg(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),T=Zg(256*(g+1),256*(y+1),v),S[0]+","+S[1]+","+T[0]+","+T[1]);var g,y,v,S,T;let P=function(M,z,N){let B,q="";for(let W=M;W>0;W--)B=1<<W-1,q+=(z&B?1:0)+(N&B?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){let n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){let n=Math.pow(2,this.z);return new st((t.x*n-this.x)*Xr,(t.y*n-this.y)*Xr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xg{constructor(t,n){this.wrap=t,this.canonical=n,this.key=oh(t,n.z,n.z,n.x,n.y)}}class Ki{constructor(t,n,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Yd(a,+h,+g),this.key=oh(n,t,a,h,g)}clone(){return new Ki(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?new Ki(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ki(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?oh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):oh(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Ki(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Ki(n,this.wrap,n,a,h),new Ki(n,this.wrap,n,a+1,h),new Ki(n,this.wrap,n,a,h+1),new Ki(n,this.wrap,n,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ki(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ki(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ip(t.x-this.wrap,t.y))}}function oh(r,t,n,a,h){(r*=2)<0&&(r=-1*r-1);let g=1<<n;return(g*g*r+g*h+a).toString(36)+n.toString(36)+t.toString(36)}Ht("CanonicalTileID",Yd),Ht("OverscaledTileID",Ki,{omit:["posMatrix"]});class Hg{constructor(t,n,a,h=1,g=1,y=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void de(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;let S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<S;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(S,T)]=this.data[this._idx(S-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,S)]=this.data[this._idx(T,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<S;T++)for(let P=0;P<S;P++){let M=this.get(T,P);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,n){let a=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,a){return t*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ji({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}let S=-n*this.dim,T=-a*this.dim;for(let P=y;P<v;P++)for(let M=h;M<g;M++)this.data[this._idx(M,P)]=t.data[this._idx(M+S,P+T)]}}Ht("DEMData",Hg);class Yg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){let a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Wg{constructor(t,n,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Jg{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new fs(Xr,16,0),this.grid3D=new fs(Xr,16,0),this.featureIndexArray=new Ct,this.promoteId=n}insert(t,n,a,h,g,y){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);let S=y?this.grid3D:this.grid;for(let T=0;T<n.length;T++){let P=n[T],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){let N=P[z];M[0]=Math.min(M[0],N.x),M[1]=Math.min(M[1],N.y),M[2]=Math.max(M[2],N.x),M[3]=Math.max(M[3],N.y)}M[0]<Xr&&M[1]<Xr&&M[2]>=0&&M[3]>=0&&S.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Aa.VectorTile(new Fd(this.rawTileData)).layers,this.sourceLayerCoder=new Yg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,a,h){this.loadVTLayers();let g=t.params||{},y=Xr/t.tileSize/t.scale,v=Wl(g.filter),S=t.queryGeometry,T=t.queryPadding*y,P=Qg(S),M=this.grid.query(P.minX-T,P.minY-T,P.maxX+T,P.maxY+T),z=Qg(t.cameraQueryGeometry),N=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,(W,Q,ut,rt)=>function(pt,ft,Et,Zt,ee){for(let jt of pt)if(ft<=jt.x&&Et<=jt.y&&Zt>=jt.x&&ee>=jt.y)return!0;let $t=[new st(ft,Et),new st(ft,ee),new st(Zt,ee),new st(Zt,Et)];if(pt.length>2){for(let jt of $t)if(Au(pt,jt))return!0}for(let jt=0;jt<pt.length-1;jt++)if(Ev(pt[jt],pt[jt+1],$t))return!0;return!1}(t.cameraQueryGeometry,W-T,Q-T,ut+T,rt+T));for(let W of N)M.push(W);M.sort(Hx);let B={},q;for(let W=0;W<M.length;W++){let Q=M[W];if(Q===q)continue;q=Q;let ut=this.featureIndexArray.get(Q),rt=null;this.loadMatchingFeature(B,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,v,g.layers,g.availableImages,n,a,h,(pt,ft,Et)=>(rt||(rt=Cl(pt)),ft.queryIntersectsFeature(S,pt,Et,rt,this.z,t.transform,y,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,a,h,g,y,v,S,T,P,M){let z=this.bucketLayerIDs[n];if(y&&!function(W,Q){for(let ut=0;ut<W.length;ut++)if(Q.indexOf(W[ut])>=0)return!0;return!1}(y,z))return;let N=this.sourceLayerCoder.decode(a),B=this.vtLayers[N].feature(h);if(g.needGeometry){let W=Pl(B,!0);if(!g.filter(new yr(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!g.filter(new yr(this.tileID.overscaledZ),B))return;let q=this.getId(B,N);for(let W=0;W<z.length;W++){let Q=z[W];if(y&&y.indexOf(Q)<0)continue;let ut=S[Q];if(!ut)continue;let rt={};q&&P&&(rt=P.getState(ut.sourceLayer||"_geojsonTileLayer",q));let pt=Le({},T[Q]);pt.paint=Kg(pt.paint,ut.paint,B,rt,v),pt.layout=Kg(pt.layout,ut.layout,B,rt,v);let ft=!M||M(B,ut,rt);if(!ft)continue;let Et=new Wg(B,this.z,this.x,this.y,q);Et.layer=pt;let Zt=t[Q];Zt===void 0&&(Zt=t[Q]=[]),Zt.push({featureIndex:h,feature:Et,intersectionZ:ft})}}lookupSymbolFeatures(t,n,a,h,g,y,v,S){let T={};this.loadVTLayers();let P=Wl(g);for(let M of t)this.loadMatchingFeature(T,a,h,M,P,y,v,S,n);return T}hasLayer(t){for(let n of this.bucketLayerIDs)for(let a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function Kg(r,t,n,a,h){return je(r,(g,y)=>{let v=t instanceof Cu?t.get(y):null;return v&&v.evaluate?v.evaluate(n,a,h):v})}function Qg(r){let t=1/0,n=1/0,a=-1/0,h=-1/0;for(let g of r)t=Math.min(t,g.x),n=Math.min(n,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:n,maxX:a,maxY:h}}function Hx(r,t){return t-r}function ty(r,t,n,a,h){let g=[];for(let y=0;y<r.length;y++){let v=r[y],S;for(let T=0;T<v.length-1;T++){let P=v[T],M=v[T+1];P.x<t&&M.x<t||(P.x<t?P=new st(t,P.y+(t-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x<t&&(M=new st(t,P.y+(t-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y<n&&M.y<n||(P.y<n?P=new st(P.x+(n-P.y)/(M.y-P.y)*(M.x-P.x),n)._round():M.y<n&&(M=new st(P.x+(n-P.y)/(M.y-P.y)*(M.x-P.x),n)._round()),P.x>=a&&M.x>=a||(P.x>=a?P=new st(a,P.y+(a-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x>=a&&(M=new st(a,P.y+(a-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y>=h&&M.y>=h||(P.y>=h?P=new st(P.x+(h-P.y)/(M.y-P.y)*(M.x-P.x),h)._round():M.y>=h&&(M=new st(P.x+(h-P.y)/(M.y-P.y)*(M.x-P.x),h)._round()),S&&P.equals(S[S.length-1])||(S=[P],g.push(S)),S.push(M)))))}}return g}Ht("FeatureIndex",Jg,{omit:["rawTileData","sourceLayerCoder"]});class ka extends st{constructor(t,n,a,h){super(t,n),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new ka(this.x,this.y,this.angle,this.segment)}}function ey(r,t,n,a,h){if(t.segment===void 0||n===0)return!0;let g=t,y=t.segment+1,v=0;for(;v>-n/2;){if(y--,y<0)return!1;v-=r[y].dist(g),g=r[y]}v+=r[y].dist(r[y+1]),y++;let S=[],T=0;for(;v<n/2;){let P=r[y],M=r[y+1];if(!M)return!1;let z=r[y-1].angleTo(P)-P.angleTo(M);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:z}),T+=z;v-S[0].distance>a;)T-=S.shift().angleDelta;if(T>h)return!1;y++,v+=P.dist(M)}return!0}function ry(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function ny(r,t,n){return r?.6*t*n:0}function iy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Yx(r,t,n,a,h,g){let y=ny(n,h,g),v=iy(n,a)*g,S=0,T=ry(r)/2;for(let P=0;P<r.length-1;P++){let M=r[P],z=r[P+1],N=M.dist(z);if(S+N>T){let B=(T-S)/N,q=Un.number(M.x,z.x,B),W=Un.number(M.y,z.y,B),Q=new ka(q,W,z.angleTo(M),P);return Q._round(),!y||ey(r,Q,v,y,t)?Q:void 0}S+=N}}function Wx(r,t,n,a,h,g,y,v,S){let T=ny(a,g,y),P=iy(a,h),M=P*y,z=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return t-M<t/4&&(t=M+t/4),oy(r,z?t/2*v%t:(P/2+2*g)*y*v%t,t,T,n,M,z,!1,S)}function oy(r,t,n,a,h,g,y,v,S){let T=g/2,P=ry(r),M=0,z=t-n,N=[];for(let B=0;B<r.length-1;B++){let q=r[B],W=r[B+1],Q=q.dist(W),ut=W.angleTo(q);for(;z+n<M+Q;){z+=n;let rt=(z-M)/Q,pt=Un.number(q.x,W.x,rt),ft=Un.number(q.y,W.y,rt);if(pt>=0&&pt<S&&ft>=0&&ft<S&&z-T>=0&&z+T<=P){let Et=new ka(pt,ft,ut,B);Et._round(),a&&!ey(r,Et,g,a,h)||N.push(Et)}}M+=Q}return v||N.length||y||(N=oy(r,M/2,n,a,h,g,y,!0,S)),N}Ht("Anchor",ka);let Ou=xi;function sy(r,t,n,a){let h=[],g=r.image,y=g.pixelRatio,v=g.paddedRect.w-2*Ou,S=g.paddedRect.h-2*Ou,T=r.right-r.left,P=r.bottom-r.top,M=g.stretchX||[[0,v]],z=g.stretchY||[[0,S]],N=(Ft,Yt)=>Ft+Yt[1]-Yt[0],B=M.reduce(N,0),q=z.reduce(N,0),W=v-B,Q=S-q,ut=0,rt=B,pt=0,ft=q,Et=0,Zt=W,ee=0,$t=Q;if(g.content&&a){let Ft=g.content;ut=Cp(M,0,Ft[0]),pt=Cp(z,0,Ft[1]),rt=Cp(M,Ft[0],Ft[2]),ft=Cp(z,Ft[1],Ft[3]),Et=Ft[0]-ut,ee=Ft[1]-pt,Zt=Ft[2]-Ft[0]-rt,$t=Ft[3]-Ft[1]-ft}let jt=(Ft,Yt,Bt,Dt)=>{let ue=Pp(Ft.stretch-ut,rt,T,r.left),ne=Ap(Ft.fixed-Et,Zt,Ft.stretch,B),Me=Pp(Yt.stretch-pt,ft,P,r.top),vr=Ap(Yt.fixed-ee,$t,Yt.stretch,q),Sr=Pp(Bt.stretch-ut,rt,T,r.left),rn=Ap(Bt.fixed-Et,Zt,Bt.stretch,B),Vi=Pp(Dt.stretch-pt,ft,P,r.top),ai=Ap(Dt.fixed-ee,$t,Dt.stretch,q),Hr=new st(ue,Me),vn=new st(Sr,Me),Pn=new st(Sr,Vi),li=new st(ue,Vi),ui=new st(ne/y,vr/y),nn=new st(rn/y,ai/y),on=t*Math.PI/180;if(on){let Hn=Math.sin(on),bi=Math.cos(on),wi=[bi,-Hn,Hn,bi];Hr._matMult(wi),vn._matMult(wi),li._matMult(wi),Pn._matMult(wi)}let Xn=Ft.stretch+Ft.fixed,ci=Yt.stretch+Yt.fixed;return{tl:Hr,tr:vn,bl:li,br:Pn,tex:{x:g.paddedRect.x+Ou+Xn,y:g.paddedRect.y+Ou+ci,w:Bt.stretch+Bt.fixed-Xn,h:Dt.stretch+Dt.fixed-ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ui,pixelOffsetBR:nn,minFontScaleX:Zt/y/T,minFontScaleY:$t/y/P,isSDF:n}};if(a&&(g.stretchX||g.stretchY)){let Ft=ay(M,W,B),Yt=ay(z,Q,q);for(let Bt=0;Bt<Ft.length-1;Bt++){let Dt=Ft[Bt],ue=Ft[Bt+1];for(let ne=0;ne<Yt.length-1;ne++)h.push(jt(Dt,Yt[ne],ue,Yt[ne+1]))}}else h.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:S+1}));return h}function Cp(r,t,n){let a=0;for(let h of r)a+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return a}function ay(r,t,n){let a=[{fixed:-Ou,stretch:0}];for(let[h,g]of r){let y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Ou,stretch:n}),a}function Pp(r,t,n,a){return r/t*n+a}function Ap(r,t,n,a){return r-t*n/a}class Lp{constructor(t,n,a,h,g,y,v,S,T,P){if(this.boxStartIndex=t.length,T){let M=y.top,z=y.bottom,N=y.collisionPadding;N&&(M-=N[1],z+=N[3]);let B=z-M;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let M=y.top*v-S[0],z=y.bottom*v+S[2],N=y.left*v-S[3],B=y.right*v+S[1],q=y.collisionPadding;if(q&&(N-=q[0]*v,M-=q[1]*v,B+=q[2]*v,z+=q[3]*v),P){let W=new st(N,M),Q=new st(B,M),ut=new st(N,z),rt=new st(B,z),pt=P*Math.PI/180;W._rotate(pt),Q._rotate(pt),ut._rotate(pt),rt._rotate(pt),N=Math.min(W.x,Q.x,ut.x,rt.x),B=Math.max(W.x,Q.x,ut.x,rt.x),M=Math.min(W.y,Q.y,ut.y,rt.y),z=Math.max(W.y,Q.y,ut.y,rt.y)}t.emplaceBack(n.x,n.y,N,M,B,z,a,h,g)}this.boxEndIndex=t.length}}class Jx{constructor(t=[],n=Kx){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:n,compare:a}=this,h=n[t];for(;t>0;){let g=t-1>>1,y=n[g];if(a(h,y)>=0)break;n[t]=y,t=g}n[t]=h}_down(t){let{data:n,compare:a}=this,h=this.length>>1,g=n[t];for(;t<h;){let y=1+(t<<1),v=n[y],S=y+1;if(S<this.length&&a(n[S],v)<0&&(y=S,v=n[S]),a(v,g)>=0)break;n[t]=v,t=y}n[t]=g}}function Kx(r,t){return r<t?-1:r>t?1:0}function Qx(r,t=1,n=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0,v=r[0];for(let N=0;N<v.length;N++){let B=v[N];(!N||B.x<a)&&(a=B.x),(!N||B.y<h)&&(h=B.y),(!N||B.x>g)&&(g=B.x),(!N||B.y>y)&&(y=B.y)}let S=Math.min(g-a,y-h),T=S/2,P=new Jx([],t1);if(S===0)return new st(a,h);for(let N=a;N<g;N+=S)for(let B=h;B<y;B+=S)P.push(new Fu(N+T,B+T,T,r));let M=function(N){let B=0,q=0,W=0,Q=N[0];for(let ut=0,rt=Q.length,pt=rt-1;ut<rt;pt=ut++){let ft=Q[ut],Et=Q[pt],Zt=ft.x*Et.y-Et.x*ft.y;q+=(ft.x+Et.x)*Zt,W+=(ft.y+Et.y)*Zt,B+=3*Zt}return new Fu(q/B,W/B,0,N)}(r),z=P.length;for(;P.length;){let N=P.pop();(N.d>M.d||!M.d)&&(M=N,n&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,z)),N.max-M.d<=t||(T=N.h/2,P.push(new Fu(N.p.x-T,N.p.y-T,T,r)),P.push(new Fu(N.p.x+T,N.p.y-T,T,r)),P.push(new Fu(N.p.x-T,N.p.y+T,T,r)),P.push(new Fu(N.p.x+T,N.p.y+T,T,r)),z+=4)}return n&&(console.log(`num probes: ${z}`),console.log(`best distance: ${M.d}`)),M.p}function t1(r,t){return t.max-r.max}function Fu(r,t,n,a){this.p=new st(r,t),this.h=n,this.d=function(h,g){let y=!1,v=1/0;for(let S=0;S<g.length;S++){let T=g[S];for(let P=0,M=T.length,z=M-1;P<M;z=P++){let N=T[P],B=T[z];N.y>h.y!=B.y>h.y&&h.x<(B.x-N.x)*(h.y-N.y)/(B.y-N.y)+N.x&&(y=!y),v=Math.min(v,Gm(h,N,B))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Cn;l.aq=void 0,(Cn=l.aq||(l.aq={}))[Cn.center=1]="center",Cn[Cn.left=2]="left",Cn[Cn.right=3]="right",Cn[Cn.top=4]="top",Cn[Cn.bottom=5]="bottom",Cn[Cn["top-left"]=6]="top-left",Cn[Cn["top-right"]=7]="top-right",Cn[Cn["bottom-left"]=8]="bottom-left",Cn[Cn["bottom-right"]=9]="bottom-right";let za=7,Wd=Number.POSITIVE_INFINITY;function ly(r,t){return t[1]!==Wd?function(n,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-za;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+za}switch(n){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(r,t[0],t[1]):function(n,a){let h=0,g=0;a<0&&(a=0);let y=a/Math.SQRT2;switch(n){case"top-right":case"top-left":g=y-za;break;case"bottom-right":case"bottom-left":g=-y+za;break;case"bottom":g=-a+za;break;case"top":g=a-za}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(r,t[0])}function uy(r,t,n){var a;let h=r.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},n);if(g){let v=g.values,S=[];for(let T=0;T<v.length;T+=2){let P=S[T]=v[T],M=v[T+1].map(z=>z*en);P.startsWith("top")?M[1]-=za:P.startsWith("bottom")&&(M[1]+=za),S[T+1]=M}return new En(S)}let y=h.get("text-variable-anchor");if(y){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},n)*en,Wd]:h.get("text-offset").evaluate(t,{},n).map(T=>T*en);let S=[];for(let T of y)S.push(T,ly(T,v));return new En(S)}return null}function Jd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e1(r,t,n,a,h,g,y,v,S,T,P){let M=g.textMaxSize.evaluate(t,{});M===void 0&&(M=y);let z=r.layers[0].layout,N=z.get("icon-offset").evaluate(t,{},P),B=hy(n.horizontal),q=y/24,W=r.tilePixelRatio*q,Q=r.tilePixelRatio*M/24,ut=r.tilePixelRatio*v,rt=r.tilePixelRatio*z.get("symbol-spacing"),pt=z.get("text-padding")*r.tilePixelRatio,ft=function(Dt,ue,ne,Me=1){let vr=Dt.get("icon-padding").evaluate(ue,{},ne),Sr=vr&&vr.values;return[Sr[0]*Me,Sr[1]*Me,Sr[2]*Me,Sr[3]*Me]}(z,t,P,r.tilePixelRatio),Et=z.get("text-max-angle")/180*Math.PI,Zt=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",ee=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",$t=z.get("symbol-placement"),jt=rt/2,Ft=z.get("icon-text-fit"),Yt;a&&Ft!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Yt=kg(a,n.vertical,Ft,z.get("icon-text-fit-padding"),N,q)),B&&(a=kg(a,B,Ft,z.get("icon-text-fit-padding"),N,q)));let Bt=(Dt,ue)=>{ue.x<0||ue.x>=Xr||ue.y<0||ue.y>=Xr||function(ne,Me,vr,Sr,rn,Vi,ai,Hr,vn,Pn,li,ui,nn,on,Xn,ci,Hn,bi,wi,sn,Ve,Yn,An,an,Eo){let Go=ne.addToLineVertexArray(Me,vr),qo,Ws,To,Qi,Si=0,Js=0,lh=0,my=0,sf=-1,af=-1,Ks={},gy=Zs("");if(ne.allowVerticalPlacement&&Sr.vertical){let Wn=Hr.layout.get("text-rotate").evaluate(Ve,{},an)+90;To=new Lp(vn,Me,Pn,li,ui,Sr.vertical,nn,on,Xn,Wn),ai&&(Qi=new Lp(vn,Me,Pn,li,ui,ai,Hn,bi,Xn,Wn))}if(rn){let Wn=Hr.layout.get("icon-rotate").evaluate(Ve,{}),to=Hr.layout.get("icon-text-fit")!=="none",Ll=sy(rn,Wn,An,to),Zo=ai?sy(ai,Wn,An,to):void 0;Ws=new Lp(vn,Me,Pn,li,ui,rn,Hn,bi,!1,Wn),Si=4*Ll.length;let Ml=ne.iconSizeData,_s=null;Ml.kind==="source"?(_s=[ys*Hr.layout.get("icon-size").evaluate(Ve,{})],_s[0]>Ma&&de(`${ne.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)):Ml.kind==="composite"&&(_s=[ys*Yn.compositeIconSizes[0].evaluate(Ve,{},an),ys*Yn.compositeIconSizes[1].evaluate(Ve,{},an)],(_s[0]>Ma||_s[1]>Ma)&&de(`${ne.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)),ne.addSymbols(ne.icon,Ll,_s,sn,wi,Ve,l.ai.none,Me,Go.lineStartIndex,Go.lineLength,-1,an),sf=ne.icon.placedSymbolArray.length-1,Zo&&(Js=4*Zo.length,ne.addSymbols(ne.icon,Zo,_s,sn,wi,Ve,l.ai.vertical,Me,Go.lineStartIndex,Go.lineLength,-1,an),af=ne.icon.placedSymbolArray.length-1)}let yy=Object.keys(Sr.horizontal);for(let Wn of yy){let to=Sr.horizontal[Wn];if(!qo){gy=Zs(to.text);let Zo=Hr.layout.get("text-rotate").evaluate(Ve,{},an);qo=new Lp(vn,Me,Pn,li,ui,to,nn,on,Xn,Zo)}let Ll=to.positionedLines.length===1;if(lh+=cy(ne,Me,to,Vi,Hr,Xn,Ve,ci,Go,Sr.vertical?l.ai.horizontal:l.ai.horizontalOnly,Ll?yy:[Wn],Ks,sf,Yn,an),Ll)break}Sr.vertical&&(my+=cy(ne,Me,Sr.vertical,Vi,Hr,Xn,Ve,ci,Go,l.ai.vertical,["vertical"],Ks,af,Yn,an));let i1=qo?qo.boxStartIndex:ne.collisionBoxArray.length,o1=qo?qo.boxEndIndex:ne.collisionBoxArray.length,s1=To?To.boxStartIndex:ne.collisionBoxArray.length,a1=To?To.boxEndIndex:ne.collisionBoxArray.length,l1=Ws?Ws.boxStartIndex:ne.collisionBoxArray.length,u1=Ws?Ws.boxEndIndex:ne.collisionBoxArray.length,c1=Qi?Qi.boxStartIndex:ne.collisionBoxArray.length,h1=Qi?Qi.boxEndIndex:ne.collisionBoxArray.length,$o=-1,Dp=(Wn,to)=>Wn&&Wn.circleDiameter?Math.max(Wn.circleDiameter,to):to;$o=Dp(qo,$o),$o=Dp(To,$o),$o=Dp(Ws,$o),$o=Dp(Qi,$o);let _y=$o>-1?1:0;_y&&($o*=Eo/en),ne.glyphOffsetArray.length>=Ru.MAX_GLYPHS&&de("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ve.sortKey!==void 0&&ne.addToSortKeyRanges(ne.symbolInstances.length,Ve.sortKey);let p1=uy(Hr,Ve,an),[d1,f1]=function(Wn,to){let Ll=Wn.length,Zo=to?.values;if(Zo?.length>0)for(let Ml=0;Ml<Zo.length;Ml+=2){let _s=Zo[Ml+1];Wn.emplaceBack(l.aq[Zo[Ml]],_s[0],_s[1])}return[Ll,Wn.length]}(ne.textAnchorOffsets,p1);ne.symbolInstances.emplaceBack(Me.x,Me.y,Ks.right>=0?Ks.right:-1,Ks.center>=0?Ks.center:-1,Ks.left>=0?Ks.left:-1,Ks.vertical||-1,sf,af,gy,i1,o1,s1,a1,l1,u1,c1,h1,Pn,lh,my,Si,Js,_y,0,nn,$o,d1,f1)}(r,ue,Dt,n,a,h,Yt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,W,[pt,pt,pt,pt],Zt,S,ut,ft,ee,N,t,g,T,P,y)};if($t==="line")for(let Dt of ty(t.geometry,0,0,Xr,Xr)){let ue=Wx(Dt,rt,Et,n.vertical||B,a,24,Q,r.overscaling,Xr);for(let ne of ue)B&&r1(r,B.text,jt,ne)||Bt(Dt,ne)}else if($t==="line-center"){for(let Dt of t.geometry)if(Dt.length>1){let ue=Yx(Dt,Et,n.vertical||B,a,24,Q);ue&&Bt(Dt,ue)}}else if(t.type==="Polygon")for(let Dt of Ad(t.geometry,0)){let ue=Qx(Dt,16);Bt(Dt[0],new ka(ue.x,ue.y,0))}else if(t.type==="LineString")for(let Dt of t.geometry)Bt(Dt,new ka(Dt[0].x,Dt[0].y,0));else if(t.type==="Point")for(let Dt of t.geometry)for(let ue of Dt)Bt([ue],new ka(ue.x,ue.y,0))}function cy(r,t,n,a,h,g,y,v,S,T,P,M,z,N,B){let q=function(ut,rt,pt,ft,Et,Zt,ee,$t){let jt=ft.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,Ft=[];for(let Yt of rt.positionedLines)for(let Bt of Yt.positionedGlyphs){if(!Bt.rect)continue;let Dt=Bt.rect||{},ue=Ig+1,ne=!0,Me=1,vr=0,Sr=(Et||$t)&&Bt.vertical,rn=Bt.metrics.advance*Bt.scale/2;if($t&&rt.verticalizable&&(vr=Yt.lineOffset/2-(Bt.imageName?-(en-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*en)),Bt.imageName){let sn=ee[Bt.imageName];ne=sn.sdf,Me=sn.pixelRatio,ue=xi/Me}let Vi=Et?[Bt.x+rn,Bt.y]:[0,0],ai=Et?[0,0]:[Bt.x+rn+pt[0],Bt.y+pt[1]-vr],Hr=[0,0];Sr&&(Hr=ai,ai=[0,0]);let vn=Bt.metrics.isDoubleResolution?2:1,Pn=(Bt.metrics.left-ue)*Bt.scale-rn+ai[0],li=(-Bt.metrics.top-ue)*Bt.scale+ai[1],ui=Pn+Dt.w/vn*Bt.scale/Me,nn=li+Dt.h/vn*Bt.scale/Me,on=new st(Pn,li),Xn=new st(ui,li),ci=new st(Pn,nn),Hn=new st(ui,nn);if(Sr){let sn=new st(-rn,rn-rh),Ve=-Math.PI/2,Yn=en/2-rn,An=new st(5-rh-Yn,-(Bt.imageName?Yn:0)),an=new st(...Hr);on._rotateAround(Ve,sn)._add(An)._add(an),Xn._rotateAround(Ve,sn)._add(An)._add(an),ci._rotateAround(Ve,sn)._add(An)._add(an),Hn._rotateAround(Ve,sn)._add(An)._add(an)}if(jt){let sn=Math.sin(jt),Ve=Math.cos(jt),Yn=[Ve,-sn,sn,Ve];on._matMult(Yn),Xn._matMult(Yn),ci._matMult(Yn),Hn._matMult(Yn)}let bi=new st(0,0),wi=new st(0,0);Ft.push({tl:on,tr:Xn,bl:ci,br:Hn,tex:Dt,writingMode:rt.writingMode,glyphOffset:Vi,sectionIndex:Bt.sectionIndex,isSDF:ne,pixelOffsetTL:bi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}return Ft}(0,n,v,h,g,y,a,r.allowVerticalPlacement),W=r.textSizeData,Q=null;W.kind==="source"?(Q=[ys*h.layout.get("text-size").evaluate(y,{})],Q[0]>Ma&&de(`${r.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)):W.kind==="composite"&&(Q=[ys*N.compositeTextSizes[0].evaluate(y,{},B),ys*N.compositeTextSizes[1].evaluate(y,{},B)],(Q[0]>Ma||Q[1]>Ma)&&de(`${r.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)),r.addSymbols(r.text,q,Q,v,g,y,T,t,S.lineStartIndex,S.lineLength,z,B);for(let ut of P)M[ut]=r.text.placedSymbolArray.length-1;return 4*q.length}function hy(r){for(let t in r)return r[t];return null}function r1(r,t,n,a){let h=r.compareText;if(t in h){let g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<n)return!0}else h[t]=[];return h[t].push(a),!1}let py=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let g=py[15&a];if(!g)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Kd(v,y,g,t)}constructor(t,n=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let g=py.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=n,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Qd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:g,coords:y,nodeSize:v}=this,S=[0,g.length-1,0],T=[];for(;S.length;){let P=S.pop()||0,M=S.pop()||0,z=S.pop()||0;if(M-z<=v){for(let W=z;W<=M;W++){let Q=y[2*W],ut=y[2*W+1];Q>=t&&Q<=a&&ut>=n&&ut<=h&&T.push(g[W])}continue}let N=z+M>>1,B=y[2*N],q=y[2*N+1];B>=t&&B<=a&&q>=n&&q<=h&&T.push(g[N]),(P===0?t<=B:n<=q)&&(S.push(z),S.push(N-1),S.push(1-P)),(P===0?a>=B:h>=q)&&(S.push(N+1),S.push(M),S.push(1-P))}return T}within(t,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],S=[],T=a*a;for(;v.length;){let P=v.pop()||0,M=v.pop()||0,z=v.pop()||0;if(M-z<=y){for(let W=z;W<=M;W++)fy(g[2*W],g[2*W+1],t,n)<=T&&S.push(h[W]);continue}let N=z+M>>1,B=g[2*N],q=g[2*N+1];fy(B,q,t,n)<=T&&S.push(h[N]),(P===0?t-a<=B:n-a<=q)&&(v.push(z),v.push(N-1),v.push(1-P)),(P===0?t+a>=B:n+a>=q)&&(v.push(N+1),v.push(M),v.push(1-P))}return S}}function Qd(r,t,n,a,h,g){if(h-a<=n)return;let y=a+h>>1;dy(r,t,y,a,h,g),Qd(r,t,n,a,y-1,1-g),Qd(r,t,n,y+1,h,1-g)}function dy(r,t,n,a,h,g){for(;h>a;){if(h-a>600){let T=h-a+1,P=n-a+1,M=Math.log(T),z=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*z*(T-z)/T)*(P-T/2<0?-1:1);dy(r,t,n,Math.max(a,Math.floor(n-P*z/T+N)),Math.min(h,Math.floor(n+(T-P)*z/T+N)),g)}let y=t[2*n+g],v=a,S=h;for(sh(r,t,a,n),t[2*h+g]>y&&sh(r,t,a,h);v<S;){for(sh(r,t,v,S),v++,S--;t[2*v+g]<y;)v++;for(;t[2*S+g]>y;)S--}t[2*a+g]===y?sh(r,t,a,S):(S++,sh(r,t,S,h)),S<=n&&(a=S+1),n<=S&&(h=S-1)}}function sh(r,t,n,a){tf(r,n,a),tf(t,2*n,2*a),tf(t,2*n+1,2*a+1)}function tf(r,t,n){let a=r[t];r[t]=r[n],r[n]=a}function fy(r,t,n,a){let h=r-n,g=t-a;return h*h+g*g}var ef;l.bh=void 0,(ef=l.bh||(l.bh={})).create="create",ef.load="load",ef.fullLoad="fullLoad";let Mp=null,ah=[],rf=1e3/60,nf="loadTime",of="fullLoadTime",n1={mark(r){performance.mark(r)},frame(r){let t=r;Mp!=null&&ah.push(t-Mp),Mp=t},clearMetrics(){Mp=null,ah=[],performance.clearMeasures(nf),performance.clearMeasures(of);for(let r in l.bh)performance.clearMarks(l.bh[r])},getPerformanceMetrics(){performance.measure(nf,l.bh.create,l.bh.load),performance.measure(of,l.bh.create,l.bh.fullLoad);let r=performance.getEntriesByName(nf)[0].duration,t=performance.getEntriesByName(of)[0].duration,n=ah.length,a=1/(ah.reduce((g,y)=>g+y,0)/n/1e3),h=ah.filter(g=>g>rf).reduce((g,y)=>g+(y-rf)/rf,0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};l.$=function(r,t,n){var a,h,g,y,v,S,T,P,M,z,N,B,q=n[0],W=n[1],Q=n[2];return t===r?(r[12]=t[0]*q+t[4]*W+t[8]*Q+t[12],r[13]=t[1]*q+t[5]*W+t[9]*Q+t[13],r[14]=t[2]*q+t[6]*W+t[10]*Q+t[14],r[15]=t[3]*q+t[7]*W+t[11]*Q+t[15]):(h=t[1],g=t[2],y=t[3],v=t[4],S=t[5],T=t[6],P=t[7],M=t[8],z=t[9],N=t[10],B=t[11],r[0]=a=t[0],r[1]=h,r[2]=g,r[3]=y,r[4]=v,r[5]=S,r[6]=T,r[7]=P,r[8]=M,r[9]=z,r[10]=N,r[11]=B,r[12]=a*q+v*W+M*Q+t[12],r[13]=h*q+S*W+z*Q+t[13],r[14]=g*q+T*W+N*Q+t[14],r[15]=y*q+P*W+B*Q+t[15]),r},l.A=Lu,l.B=Un,l.C=class{constructor(r,t,n){this.receive=a=>{let h=a.data,g=h.id;if(g&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[g];let y=this.cancelCallbacks[g];delete this.cancelCallbacks[g],y&&y()}else Ar()||h.mustQueue?(this.tasks[g]=h,this.taskQueue.push(g),this.invoker.trigger()):this.processTask(g,h)},this.process=()=>{if(!this.taskQueue.length)return;let a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)},this.target=r,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Xx(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ar()?r:window}send(r,t,n,a,h=!1){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[g]=n);let y=[],v={id:g,type:r,hasCallback:!!n,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Wi(t,y)};return this.target.postMessage(v,{transfer:y}),{cancel:()=>{n&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(r,t){if(t.type==="<response>"){let n=this.callbacks[r];delete this.callbacks[r],n&&(t.error?n(ss(t.error)):n(null,ss(t.data)))}else{let n=!1,a=[],h=t.hasCallback?(v,S)=>{n=!0,delete this.cancelCallbacks[r];let T={id:r,type:"<response>",sourceMapId:this.mapId,error:v?Wi(v):null,data:Wi(S,a)};this.target.postMessage(T,{transfer:a})}:v=>{n=!0},g=null,y=ss(t.data);if(this.parent[t.type])g=this.parent[t.type](t.sourceMapId,y,h);else if("getWorkerSource"in this.parent){let v=t.type.split(".");g=this.parent.getWorkerSource(t.sourceMapId,v[0],y.source)[v[1]](y,h)}else h(new Error(`Could not find function ${t.type}`));!n&&g&&g.cancel&&(this.cancelCallbacks[r]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=ie,l.E=ls,l.F=function(r,t){let n={};for(let a=0;a<t.length;a++){let h=t[a];h in r&&(n[h]=r[h])}return n},l.G=jg,l.H=Gg,l.I=Bd,l.J=Qt,l.K=se,l.L=Da,l.M=Ri,l.N=Xr,l.O=Ki,l.P=st,l.Q=Pr,l.R=Ji,l.S=_r,l.T=sp,l.U=Ip,l.V=class extends qs{},l.W=Yd,l.X=function(r,t){let n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let a=0;a<r.length;a++){let h=window.document.createElement("source");Oi(r[a])||(n.crossOrigin="Anonymous"),h.src=r[a],n.appendChild(h)}return{cancel:()=>{}}},l.Y=Ot,l.Z=function(){var r=new Lu(16);return Lu!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},l._=V,l.a=pi,l.a$=class extends F{},l.a0=function(r,t,n){var a=n[0],h=n[1],g=n[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*h,r[5]=t[5]*h,r[6]=t[6]*h,r[7]=t[7]*h,r[8]=t[8]*g,r[9]=t[9]*g,r[10]=t[10]*g,r[11]=t[11]*g,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.a1=Xm,l.a2=function(){return lr++},l.a3=H,l.a4=Ru,l.a5=function(){_i.isLoading()||_i.isLoaded()||Rc()!=="deferred"||op()},l.a6=Wl,l.a7=Pl,l.a8=yr,l.a9=Wg,l.aA=wl,l.aB=function(r){r=r.slice();let t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=fi(r[n],t[r[n].ref]));return r},l.aC=function(r){if(r.type==="custom")return new Zx(r);switch(r.type){case"background":return new Gx(r);case"circle":return new Cv(r);case"fill":return new Xv(r);case"fill-extrusion":return new lx(r);case"heatmap":return new Av(r);case"hillshade":return new Mv(r);case"line":return new gx(r);case"raster":return new $x(r);case"symbol":return new Tp(r)}},l.aD=nr,l.aE=function(r,t){if(!r)return[{command:Ze.setStyle,args:[t]}];let n=[];try{if(!ar(r.version,t.version))return[{command:Ze.setStyle,args:[t]}];ar(r.center,t.center)||n.push({command:Ze.setCenter,args:[t.center]}),ar(r.zoom,t.zoom)||n.push({command:Ze.setZoom,args:[t.zoom]}),ar(r.bearing,t.bearing)||n.push({command:Ze.setBearing,args:[t.bearing]}),ar(r.pitch,t.pitch)||n.push({command:Ze.setPitch,args:[t.pitch]}),ar(r.sprite,t.sprite)||n.push({command:Ze.setSprite,args:[t.sprite]}),ar(r.glyphs,t.glyphs)||n.push({command:Ze.setGlyphs,args:[t.glyphs]}),ar(r.transition,t.transition)||n.push({command:Ze.setTransition,args:[t.transition]}),ar(r.light,t.light)||n.push({command:Ze.setLight,args:[t.light]});let a={},h=[];(function(y,v,S,T){let P;for(P in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(v,P)||ho(P,S,T));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(y,P)?ar(y[P],v[P])||(y[P].type==="geojson"&&v[P].type==="geojson"&&ia(y,v,P)?S.push({command:Ze.setGeoJSONSourceData,args:[P,v[P].data]}):Zi(P,v,S,T)):ji(P,v,S))})(r.sources,t.sources,h,a);let g=[];r.layers&&r.layers.forEach(y=>{a[y.source]?n.push({command:Ze.removeLayer,args:[y.id]}):g.push(y)}),n=n.concat(h),function(y,v,S){v=v||[];let T=(y=y||[]).map(Xi),P=v.map(Xi),M=y.reduce(Do,{}),z=v.reduce(Do,{}),N=T.slice(),B=Object.create(null),q,W,Q,ut,rt,pt,ft;for(q=0,W=0;q<T.length;q++)Q=T[q],Object.prototype.hasOwnProperty.call(z,Q)?W++:(S.push({command:Ze.removeLayer,args:[Q]}),N.splice(N.indexOf(Q,W),1));for(q=0,W=0;q<P.length;q++)Q=P[P.length-1-q],N[N.length-1-q]!==Q&&(Object.prototype.hasOwnProperty.call(M,Q)?(S.push({command:Ze.removeLayer,args:[Q]}),N.splice(N.lastIndexOf(Q,N.length-W),1)):W++,pt=N[N.length-q],S.push({command:Ze.addLayer,args:[z[Q],pt]}),N.splice(N.length-q,0,Q),B[Q]=!0);for(q=0;q<P.length;q++)if(Q=P[q],ut=M[Q],rt=z[Q],!B[Q]&&!ar(ut,rt))if(ar(ut.source,rt.source)&&ar(ut["source-layer"],rt["source-layer"])&&ar(ut.type,rt.type)){for(ft in us(ut.layout,rt.layout,S,Q,null,Ze.setLayoutProperty),us(ut.paint,rt.paint,S,Q,null,Ze.setPaintProperty),ar(ut.filter,rt.filter)||S.push({command:Ze.setFilter,args:[Q,rt.filter]}),ar(ut.minzoom,rt.minzoom)&&ar(ut.maxzoom,rt.maxzoom)||S.push({command:Ze.setLayerZoomRange,args:[Q,rt.minzoom,rt.maxzoom]}),ut)Object.prototype.hasOwnProperty.call(ut,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?us(ut[ft],rt[ft],S,Q,ft.slice(6),Ze.setPaintProperty):ar(ut[ft],rt[ft])||S.push({command:Ze.setLayerProperty,args:[Q,ft,rt[ft]]}));for(ft in rt)Object.prototype.hasOwnProperty.call(rt,ft)&&!Object.prototype.hasOwnProperty.call(ut,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?us(ut[ft],rt[ft],S,Q,ft.slice(6),Ze.setPaintProperty):ar(ut[ft],rt[ft])||S.push({command:Ze.setLayerProperty,args:[Q,ft,rt[ft]]}))}else S.push({command:Ze.removeLayer,args:[Q]}),pt=N[N.lastIndexOf(Q)+1],S.push({command:Ze.addLayer,args:[rt,pt]})}(g,t.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:Ze.setStyle,args:[t]}]}return n},l.aF=function(r){let t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},l.aG=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],n[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(let a in t)if(!r(t[a],n[a]))return!1;return!0}return t===n},l.aH=je,l.aI=zr,l.aJ=Sl,l.aK=function(r){return r({pluginStatus:ii,pluginURL:ms}),Sl.on("pluginStateChange",r),r},l.aL=class extends Xs{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.aM=Pu,l.aN=class extends Xs{constructor(r,t){super(r,t),this.current=yd}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.aO=cp,l.aP=class extends Xs{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.aQ=class extends Xs{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.aR=hp,l.aS=function(r,t,n,a,h,g,y){var v=1/(t-n),S=1/(a-h),T=1/(g-y);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(t+n)*v,r[13]=(h+a)*S,r[14]=(y+g)*T,r[15]=1,r},l.aT=tr,l.aU=Iv,l.aV=class extends c{},l.aW=xx,l.aX=class extends m{},l.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},l.aZ=Km,l.a_=zt,l.aa=function(r){let t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,h,g)=>{let y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){let n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},l.ab=function(r,t){let n=[];for(let a in r)a in t||n.push(a);return n},l.ac=function(r){if(xn==null){let t=r.navigator?r.navigator.userAgent:null;xn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return xn},l.ad=ke,l.ae=function(r,t,n){var a=Math.sin(n),h=Math.cos(n),g=t[0],y=t[1],v=t[2],S=t[3],T=t[4],P=t[5],M=t[6],z=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=g*h+T*a,r[1]=y*h+P*a,r[2]=v*h+M*a,r[3]=S*h+z*a,r[4]=T*h-g*a,r[5]=P*h-y*a,r[6]=M*h-v*a,r[7]=z*h-S*a,r},l.af=function(r){var t=new Lu(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.ag=mp,l.ah=function(r,t){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){let{interpolationType:h,minZoom:g,maxZoom:y}=r,v=h?ke(ti.interpolationFactor(h,t,g,y),0,1):0;r.kind==="camera"?a=Un.number(r.minSize,r.maxSize,v):n=v}return{uSizeT:n,uSize:a}},l.aj=function(r,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/ys:r.kind==="composite"?Un.number(a/ys,h/ys,n):t},l.ak=Gd,l.al=function(r,t,n,a){let h=t.y-r.y,g=t.x-r.x,y=a.y-n.y,v=a.x-n.x,S=y*g-v*h;if(S===0)return null;let T=(v*(r.y-n.y)-y*(r.x-n.x))/S;return new st(r.x+T*g,r.y+T*h)},l.am=ty,l.an=Um,l.ao=wd,l.ap=en,l.ar=jd,l.as=function(r,t){var n=t[0],a=t[1],h=t[2],g=t[3],y=t[4],v=t[5],S=t[6],T=t[7],P=t[8],M=t[9],z=t[10],N=t[11],B=t[12],q=t[13],W=t[14],Q=t[15],ut=n*v-a*y,rt=n*S-h*y,pt=n*T-g*y,ft=a*S-h*v,Et=a*T-g*v,Zt=h*T-g*S,ee=P*q-M*B,$t=P*W-z*B,jt=P*Q-N*B,Ft=M*W-z*q,Yt=M*Q-N*q,Bt=z*Q-N*W,Dt=ut*Bt-rt*Yt+pt*Ft+ft*jt-Et*$t+Zt*ee;return Dt?(r[0]=(v*Bt-S*Yt+T*Ft)*(Dt=1/Dt),r[1]=(h*Yt-a*Bt-g*Ft)*Dt,r[2]=(q*Zt-W*Et+Q*ft)*Dt,r[3]=(z*Et-M*Zt-N*ft)*Dt,r[4]=(S*jt-y*Bt-T*$t)*Dt,r[5]=(n*Bt-h*jt+g*$t)*Dt,r[6]=(W*pt-B*Zt-Q*rt)*Dt,r[7]=(P*Zt-z*pt+N*rt)*Dt,r[8]=(y*Yt-v*jt+T*ee)*Dt,r[9]=(a*jt-n*Yt-g*ee)*Dt,r[10]=(B*Et-q*pt+Q*ut)*Dt,r[11]=(M*pt-P*Et-N*ut)*Dt,r[12]=(v*$t-y*Ft-S*ee)*Dt,r[13]=(n*Ft-a*$t+h*ee)*Dt,r[14]=(q*rt-B*ft-W*ut)*Dt,r[15]=(P*ft-M*rt+z*ut)*Dt,r):null},l.at=Jd,l.au=Ud,l.av=Kd,l.aw=function(){let r={},t=_t.$version;for(let n in _t.$root){let a=_t.$root[n];if(a.required){let h=null;h=n==="version"?t:a.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},l.ax=Ze,l.ay=Ha,l.az=ln,l.b=function(r,t){let n=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(n).then(a=>{t(null,a)}).catch(a=>{t(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=yn,l.b1=function(r,t){var n=r[0],a=r[1],h=r[2],g=r[3],y=r[4],v=r[5],S=r[6],T=r[7],P=r[8],M=r[9],z=r[10],N=r[11],B=r[12],q=r[13],W=r[14],Q=r[15],ut=t[0],rt=t[1],pt=t[2],ft=t[3],Et=t[4],Zt=t[5],ee=t[6],$t=t[7],jt=t[8],Ft=t[9],Yt=t[10],Bt=t[11],Dt=t[12],ue=t[13],ne=t[14],Me=t[15];return Math.abs(n-ut)<=si*Math.max(1,Math.abs(n),Math.abs(ut))&&Math.abs(a-rt)<=si*Math.max(1,Math.abs(a),Math.abs(rt))&&Math.abs(h-pt)<=si*Math.max(1,Math.abs(h),Math.abs(pt))&&Math.abs(g-ft)<=si*Math.max(1,Math.abs(g),Math.abs(ft))&&Math.abs(y-Et)<=si*Math.max(1,Math.abs(y),Math.abs(Et))&&Math.abs(v-Zt)<=si*Math.max(1,Math.abs(v),Math.abs(Zt))&&Math.abs(S-ee)<=si*Math.max(1,Math.abs(S),Math.abs(ee))&&Math.abs(T-$t)<=si*Math.max(1,Math.abs(T),Math.abs($t))&&Math.abs(P-jt)<=si*Math.max(1,Math.abs(P),Math.abs(jt))&&Math.abs(M-Ft)<=si*Math.max(1,Math.abs(M),Math.abs(Ft))&&Math.abs(z-Yt)<=si*Math.max(1,Math.abs(z),Math.abs(Yt))&&Math.abs(N-Bt)<=si*Math.max(1,Math.abs(N),Math.abs(Bt))&&Math.abs(B-Dt)<=si*Math.max(1,Math.abs(B),Math.abs(Dt))&&Math.abs(q-ue)<=si*Math.max(1,Math.abs(q),Math.abs(ue))&&Math.abs(W-ne)<=si*Math.max(1,Math.abs(W),Math.abs(ne))&&Math.abs(Q-Me)<=si*Math.max(1,Math.abs(Q),Math.abs(Me))},l.b2=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.b3=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},l.b4=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},l.b5=er,l.b6=Xg,l.b7=qg,l.b8=function(r,t,n,a,h){var g,y=1/Math.tan(t/2);return r[0]=y/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+a)*(g=1/(a-h)),r[14]=2*h*a*g):(r[10]=-1,r[14]=-2*a),r},l.b9=function(r,t,n){var a=Math.sin(n),h=Math.cos(n),g=t[4],y=t[5],v=t[6],S=t[7],T=t[8],P=t[9],M=t[10],z=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=g*h+T*a,r[5]=y*h+P*a,r[6]=v*h+M*a,r[7]=S*h+z*a,r[8]=T*h-g*a,r[9]=P*h-y*a,r[10]=M*h-v*a,r[11]=z*h-S*a,r},l.bA=et,l.bB=vg,l.bC=_l,l.bD=_i,l.ba=le,l.bb=Ue,l.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.bd=class extends Il{},l.be=Xd,l.bf=$g,l.bg=n1,l.bi=oo,l.bj=function(r,t,n=!1){if(ii===Lc||ii===Mc||ii===Dc)throw new Error("setRTLTextPlugin cannot be called multiple times.");ms=Ci.resolveURL(r),ii=Lc,kc=t,zc(),n||op()},l.bk=Rc,l.bl=function(r,t){let n={};for(let h=0;h<r.length;h++){let g=t&&t[r[h].id]||ua(r[h]);t&&(t[r[h].id]=g);let y=n[g];y||(y=n[g]=[]),y.push(r[h])}let a=[];for(let h in n)a.push(n[h]);return a},l.bm=Ht,l.bn=Yg,l.bo=Jg,l.bp=Pg,l.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Xr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;let t=r.bucket.layers[0],n=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new yr(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new yr(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new yr(18))};if(r.bucket.textSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=r.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new yr(T),r.canonical),a["text-size"].possiblyEvaluate(new yr(P),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=r.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new yr(T),r.canonical),a["icon-size"].possiblyEvaluate(new yr(P),r.canonical)]}let g=n.get("text-line-height")*en,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),S=n.get("text-size");for(let T of r.bucket.features){let P=n.get("text-font").evaluate(T,{},r.canonical).join(","),M=S.evaluate(T,{},r.canonical),z=h.layoutTextSize.evaluate(T,{},r.canonical),N=h.layoutIconSize.evaluate(T,{},r.canonical),B={horizontal:{},vertical:void 0},q=T.text,W,Q=[0,0];if(q){let pt=q.toString(),ft=n.get("text-letter-spacing").evaluate(T,{},r.canonical)*en,Et=Ya(pt)?ft:0,Zt=n.get("text-anchor").evaluate(T,{},r.canonical),ee=uy(t,T,r.canonical);if(!ee){let Bt=n.get("text-radial-offset").evaluate(T,{},r.canonical);Q=Bt?ly(Zt,[Bt*en,Wd]):n.get("text-offset").evaluate(T,{},r.canonical).map(Dt=>Dt*en)}let $t=y?"center":n.get("text-justify").evaluate(T,{},r.canonical),jt=n.get("symbol-placement"),Ft=jt==="point"?n.get("text-max-width").evaluate(T,{},r.canonical)*en:0,Yt=()=>{r.bucket.allowVerticalPlacement&&Ql(pt)&&(B.vertical=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,"left",Et,Q,l.ai.vertical,!0,jt,z,M))};if(!y&&ee){let Bt=new Set;if($t==="auto")for(let ue=0;ue<ee.values.length;ue+=2)Bt.add(Jd(ee.values[ue]));else Bt.add($t);let Dt=!1;for(let ue of Bt)if(!B.horizontal[ue])if(Dt)B.horizontal[ue]=B.horizontal[0];else{let ne=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,"center",ue,Et,Q,l.ai.horizontal,!1,jt,z,M);ne&&(B.horizontal[ue]=ne,Dt=ne.positionedLines.length===1)}Yt()}else{$t==="auto"&&($t=Jd(Zt));let Bt=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,$t,Et,Q,l.ai.horizontal,!1,jt,z,M);Bt&&(B.horizontal[$t]=Bt),Yt(),Ql(pt)&&y&&v&&(B.vertical=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,$t,Et,Q,l.ai.vertical,!1,jt,z,M))}}let ut=!1;if(T.icon&&T.icon.name){let pt=r.imageMap[T.icon.name];pt&&(W=Nx(r.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},r.canonical),n.get("icon-anchor").evaluate(T,{},r.canonical)),ut=!!pt.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ut:r.bucket.sdfIcons!==ut&&de("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}let rt=hy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!rt&&rt.iconsInText,(rt||W)&&e1(r.bucket,T,B,W,r.imageMap,h,z,N,Q,ut,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},l.br=Rd,l.bs=Dd,l.bt=zd,l.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},l.bv=Fd,l.bw=Aa,l.bx=function(r,t,n,a,h){return V(this,void 0,void 0,function*(){if(se())try{return yield Ri(r,t,n,a,h)}catch{}return function(g,y,v,S,T){let P=g.width,M=g.height;Sn&&Ne||(Sn=new OffscreenCanvas(P,M),Ne=Sn.getContext("2d",{willReadFrequently:!0})),Sn.width=P,Sn.height=M,Ne.drawImage(g,0,0,P,M);let z=Ne.getImageData(y,v,S,T);return Ne.clearRect(0,0,P,M),z.data}(r,t,n,a,h)})},l.by=Hg,l.bz=R,l.c=Os,l.d=function(r,t){let n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Qo})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let a=new Blob([new Uint8Array(r)],{type:"image/png"});n.src=r.byteLength?URL.createObjectURL(a):Qo},l.e=Le,l.f=function(r,t){return Fo(Le(r,{type:"json"}),t)},l.g=Qe,l.h=Ci,l.i=Ar,l.j=No,l.k=Mo,l.l=ba,l.m=Fo,l.n=function(r){return new Fd(r).readFields(Dx,[])},l.o=function(r,t,n){if(!r.length)return n(null,[]);let a=r.length,h=new Array(r.length),g=null;r.forEach((y,v)=>{t(y,(S,T)=>{S&&(g=S),h[v]=T,--a==0&&n(g,h)})})},l.p=Cg,l.q=Hc,l.r=Ur,l.s=Oi,l.t=qn,l.u=Gt,l.v=_t,l.w=de,l.x=is,l.y=_o,l.z=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}}}),b(["./shared"],function(l){class V{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,O){for(let Y of k){this._layerConfigs[Y.id]=Y;let J=this._layers[Y.id]=l.aC(Y);J._featureFilter=l.a6(J.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(let Y of O)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};let j=l.bl(Object.values(this._layerConfigs),this.keyCache);for(let Y of j){let J=Y.map(wt=>this._layers[wt.id]),ht=J[0];if(ht.visibility==="none")continue;let nt=ht.source||"",tt=this.familiesBySource[nt];tt||(tt=this.familiesBySource[nt]={});let it=ht.sourceLayer||"_geojsonTileLayer",bt=tt[it];bt||(bt=tt[it]=[]),bt.push(J)}}}class R{constructor(k){let O={},j=[];for(let nt in k){let tt=k[nt],it=O[nt]={};for(let bt in tt){let wt=tt[+bt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;let Tt={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};j.push(Tt),it[bt]={rect:Tt,metrics:wt.metrics}}}let{w:Y,h:J}=l.p(j),ht=new l.q({width:Y||1,height:J||1});for(let nt in k){let tt=k[nt];for(let it in tt){let bt=tt[+it];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;let wt=O[nt][it].rect;l.q.copy(bt.bitmap,ht,{x:0,y:0},{x:wt.x+1,y:wt.y+1},bt.bitmap)}}this.image=ht,this.positions=O}}l.bm("GlyphAtlas",R);class et{constructor(k){this.tileID=new l.O(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(k,O,j,Y,J){this.status="parsing",this.data=k,this.collisionBoxArray=new l.a3;let ht=new l.bn(Object.keys(k.layers).sort()),nt=new l.bo(this.tileID,this.promoteId);nt.bucketLayerIDs=[];let tt={},it={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},bt=O.familiesBySource[this.source];for(let $e in bt){let Ge=k.layers[$e];if(!Ge)continue;Ge.version===1&&l.w(`Vector tile source "${this.source}" layer "${$e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let mn=ht.encode($e),hr=[];for(let Vr=0;Vr<Ge.length;Vr++){let Kr=Ge.feature(Vr),mi=nt.getId(Kr,$e);hr.push({feature:Kr,id:mi,index:Vr,sourceLayerIndex:mn})}for(let Vr of bt[$e]){let Kr=Vr[0];Kr.source!==this.source&&l.w(`layer.source = ${Kr.source} does not equal this.source = ${this.source}`),Kr.minzoom&&this.zoom<Math.floor(Kr.minzoom)||Kr.maxzoom&&this.zoom>=Kr.maxzoom||Kr.visibility!=="none"&&(at(Vr,this.zoom,j),(tt[Kr.id]=Kr.createBucket({index:nt.bucketLayerIDs.length,layers:Vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mn,sourceID:this.source})).populate(hr,it,this.tileID.canonical),nt.bucketLayerIDs.push(Vr.map(mi=>mi.id)))}}let wt,Tt,oe,me,Kt=l.aH(it.glyphDependencies,$e=>Object.keys($e).map(Number));this.inFlightDependencies.forEach($e=>$e?.cancel()),this.inFlightDependencies=[];let ae=++this.dependencySentinel;Object.keys(Kt).length?this.inFlightDependencies.push(Y.send("getGlyphs",{uid:this.uid,stacks:Kt,source:this.source,tileID:this.tileID,type:"glyphs"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,Tt=Ge,qe.call(this)))})):Tt={};let xe=Object.keys(it.iconDependencies);xe.length?this.inFlightDependencies.push(Y.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"icons"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,oe=Ge,qe.call(this)))})):oe={};let We=Object.keys(it.patternDependencies);function qe(){if(wt)return J(wt);if(Tt&&oe&&me){let $e=new R(Tt),Ge=new l.bp(oe,me);for(let mn in tt){let hr=tt[mn];hr instanceof l.a4?(at(hr.layers,this.zoom,j),l.bq({bucket:hr,glyphMap:Tt,glyphPositions:$e.positions,imageMap:oe,imagePositions:Ge.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):hr.hasPattern&&(hr instanceof l.br||hr instanceof l.bs||hr instanceof l.bt)&&(at(hr.layers,this.zoom,j),hr.addFeatures(it,this.tileID.canonical,Ge.patternPositions))}this.status="done",J(null,{buckets:Object.values(tt).filter(mn=>!mn.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$e.image,imageAtlas:Ge,glyphMap:this.returnDependencies?Tt:null,iconMap:this.returnDependencies?oe:null,glyphPositions:this.returnDependencies?$e.positions:null})}}We.length?this.inFlightDependencies.push(Y.send("getImages",{icons:We,source:this.source,tileID:this.tileID,type:"patterns"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,me=Ge,qe.call(this)))})):me={},qe.call(this)}}function at(X,k,O){let j=new l.a8(k);for(let Y of X)Y.recalculate(j,O)}function st(X,k){let O=l.l(X.request,(j,Y,J,ht)=>{if(j)k(j);else if(Y)try{let nt=new l.bw.VectorTile(new l.bv(Y));k(null,{vectorTile:nt,rawData:Y,cacheControl:J,expires:ht})}catch(nt){let tt=new Uint8Array(Y),it=`Unable to parse the tile at ${X.request.url}, `;it+=tt[0]===31&&tt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${nt.messge}`,k(new Error(it))}});return()=>{O.cancel(),k()}}class yt{constructor(k,O,j,Y){this.actor=k,this.layerIndex=O,this.availableImages=j,this.loadVectorData=Y||st,this.fetching={},this.loading={},this.loaded={}}loadTile(k,O){let j=k.uid;this.loading||(this.loading={});let Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.bu(k.request),J=this.loading[j]=new et(k);J.abort=this.loadVectorData(k,(ht,nt)=>{if(delete this.loading[j],ht||!nt)return J.status="done",this.loaded[j]=J,O(ht);let tt=nt.rawData,it={};nt.expires&&(it.expires=nt.expires),nt.cacheControl&&(it.cacheControl=nt.cacheControl);let bt={};if(Y){let wt=Y.finish();wt&&(bt.resourceTiming=JSON.parse(JSON.stringify(wt)))}J.vectorTile=nt.vectorTile,J.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(wt,Tt)=>{if(delete this.fetching[j],wt||!Tt)return O(wt);O(null,l.e({rawTileData:tt.slice(0)},Tt,it,bt))}),this.loaded=this.loaded||{},this.loaded[j]=J,this.fetching[j]={rawTileData:tt,cacheControl:it,resourceTiming:bt}})}reloadTile(k,O){let j=this.loaded,Y=k.uid;if(j&&j[Y]){let J=j[Y];J.showCollisionBoxes=k.showCollisionBoxes,J.status==="parsing"?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(ht,nt)=>{if(ht||!nt)return O(ht,nt);let tt;if(this.fetching[Y]){let{rawTileData:it,cacheControl:bt,resourceTiming:wt}=this.fetching[Y];delete this.fetching[Y],tt=l.e({rawTileData:it.slice(0)},nt,bt,wt)}else tt=nt;O(null,tt)}):J.status==="done"&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,O):O())}}abortTile(k,O){let j=this.loading,Y=k.uid;j&&j[Y]&&j[Y].abort&&(j[Y].abort(),delete j[Y]),O()}removeTile(k,O){let j=this.loaded,Y=k.uid;j&&j[Y]&&delete j[Y],O()}}class xt{constructor(){this.loaded={}}loadTile(k,O){return l._(this,void 0,void 0,function*(){let{uid:j,encoding:Y,rawImageData:J,redFactor:ht,greenFactor:nt,blueFactor:tt,baseShift:it}=k,bt=J.width+2,wt=J.height+2,Tt=l.a(J)?new l.R({width:bt,height:wt},yield l.bx(J,-1,-1,bt,wt)):J,oe=new l.by(j,Tt,Y,ht,nt,tt,it);this.loaded=this.loaded||{},this.loaded[j]=oe,O(null,oe)})}removeTile(k){let O=this.loaded,j=k.uid;O&&O[j]&&delete O[j]}}function It(X,k){if(X.length!==0){Pt(X[0],k);for(var O=1;O<X.length;O++)Pt(X[O],!k)}}function Pt(X,k){for(var O=0,j=0,Y=0,J=X.length,ht=J-1;Y<J;ht=Y++){var nt=(X[Y][0]-X[ht][0])*(X[ht][1]+X[Y][1]),tt=O+nt;j+=Math.abs(O)>=Math.abs(nt)?O-tt+nt:nt-tt+O,O=tt}O+j>=0!=!!k&&X.reverse()}var qt=l.bz(function X(k,O){var j,Y=k&&k.type;if(Y==="FeatureCollection")for(j=0;j<k.features.length;j++)X(k.features[j],O);else if(Y==="GeometryCollection")for(j=0;j<k.geometries.length;j++)X(k.geometries[j],O);else if(Y==="Feature")X(k.geometry,O);else if(Y==="Polygon")It(k.coordinates,O);else if(Y==="MultiPolygon")for(j=0;j<k.coordinates.length;j++)It(k.coordinates[j],O);return k});let Qt=l.bw.VectorTileFeature.prototype.toGeoJSON;var se={exports:{}},le=l.bA,Ue=l.bw.VectorTileFeature,ke=er;function er(X,k){this.options=k||{},this.features=X,this.length=X.length}function Le(X,k){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=k||4096}er.prototype.feature=function(X){return new Le(this.features[X],this.options.extent)},Le.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var k=0;k<X.length;k++){for(var O=X[k],j=[],Y=0;Y<O.length;Y++)j.push(new le(O[Y][0],O[Y][1]));this.geometry.push(j)}return this.geometry},Le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,k=1/0,O=-1/0,j=1/0,Y=-1/0,J=0;J<X.length;J++)for(var ht=X[J],nt=0;nt<ht.length;nt++){var tt=ht[nt];k=Math.min(k,tt.x),O=Math.max(O,tt.x),j=Math.min(j,tt.y),Y=Math.max(Y,tt.y)}return[k,j,O,Y]},Le.prototype.toGeoJSON=Ue.prototype.toGeoJSON;var lr=l.bB,je=ke;function zr(X){var k=new lr;return function(O,j){for(var Y in O.layers)j.writeMessage(3,nr,O.layers[Y])}(X,k),k.finish()}function nr(X,k){var O;k.writeVarintField(15,X.version||1),k.writeStringField(1,X.name||""),k.writeVarintField(5,X.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<X.length;O++)j.feature=X.feature(O),k.writeMessage(2,fn,j);var Y=j.keys;for(O=0;O<Y.length;O++)k.writeStringField(3,Y[O]);var J=j.values;for(O=0;O<J.length;O++)k.writeMessage(4,xn,J[O])}function fn(X,k){var O=X.feature;O.id!==void 0&&k.writeVarintField(1,O.id),k.writeMessage(2,de,X),k.writeVarintField(3,O.type),k.writeMessage(4,Ar,O)}function de(X,k){var O=X.feature,j=X.keys,Y=X.values,J=X.keycache,ht=X.valuecache;for(var nt in O.properties){var tt=O.properties[nt],it=J[nt];if(tt!==null){it===void 0&&(j.push(nt),J[nt]=it=j.length-1),k.writeVarint(it);var bt=typeof tt;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(tt=JSON.stringify(tt));var wt=bt+":"+tt,Tt=ht[wt];Tt===void 0&&(Y.push(tt),ht[wt]=Tt=Y.length-1),k.writeVarint(Tt)}}}function Ke(X,k){return(k<<3)+(7&X)}function Er(X){return X<<1^X>>31}function Ar(X,k){for(var O=X.loadGeometry(),j=X.type,Y=0,J=0,ht=O.length,nt=0;nt<ht;nt++){var tt=O[nt],it=1;j===1&&(it=tt.length),k.writeVarint(Ke(1,it));for(var bt=j===3?tt.length-1:tt.length,wt=0;wt<bt;wt++){wt===1&&j!==1&&k.writeVarint(Ke(2,bt-1));var Tt=tt[wt].x-Y,oe=tt[wt].y-J;k.writeVarint(Er(Tt)),k.writeVarint(Er(oe)),Y+=Tt,J+=oe}j===3&&k.writeVarint(Ke(7,1))}}function xn(X,k){var O=typeof X;O==="string"?k.writeStringField(1,X):O==="boolean"?k.writeBooleanField(7,X):O==="number"&&(X%1!=0?k.writeDoubleField(3,X):X<0?k.writeSVarintField(6,X):k.writeVarintField(5,X))}se.exports=zr,se.exports.fromVectorTileJs=zr,se.exports.fromGeojsonVt=function(X,k){k=k||{};var O={};for(var j in X)O[j]=new je(X[j].features,k),O[j].name=j,O[j].version=k.version,O[j].extent=k.extent;return zr({layers:O})},se.exports.GeoJSONWrapper=je;var pi=l.bz(se.exports);let Qo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},Ri=Math.fround||(Sn=new Float32Array(1),X=>(Sn[0]=+X,Sn[0]));var Sn;let Ne=3,qr=5,zn=6;class Ci{constructor(k){this.options=Object.assign(Object.create(Qo),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){let{log:O,minZoom:j,maxZoom:Y}=this.options;O&&console.time("total time");let J=`prepare ${k.length} points`;O&&console.time(J),this.points=k;let ht=[];for(let tt=0;tt<k.length;tt++){let it=k[tt];if(!it.geometry)continue;let[bt,wt]=it.geometry.coordinates,Tt=Ri(ln(bt)),oe=Ri(Qe(wt));ht.push(Tt,oe,1/0,tt,-1,1),this.options.reduce&&ht.push(0)}let nt=this.trees[Y+1]=this._createTree(ht);O&&console.timeEnd(J);for(let tt=Y;tt>=j;tt--){let it=+Date.now();nt=this.trees[tt]=this._createTree(this._cluster(nt,tt)),O&&console.log("z%d: %d clusters in %dms",tt,nt.numItems,+Date.now()-it)}return O&&console.timeEnd("total time"),this}getClusters(k,O){let j=((k[0]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,k[1])),J=k[2]===180?180:((k[2]+180)%360+360)%360-180,ht=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)j=-180,J=180;else if(j>J){let wt=this.getClusters([j,Y,180,ht],O),Tt=this.getClusters([-180,Y,J,ht],O);return wt.concat(Tt)}let nt=this.trees[this._limitZoom(O)],tt=nt.range(ln(j),Qe(ht),ln(J),Qe(Y)),it=nt.data,bt=[];for(let wt of tt){let Tt=this.stride*wt;bt.push(it[Tt+qr]>1?Os(it,Tt,this.clusterProps):this.points[it[Tt+Ne]])}return bt}getChildren(k){let O=this._getOriginId(k),j=this._getOriginZoom(k),Y="No cluster with the specified id.",J=this.trees[j];if(!J)throw new Error(Y);let ht=J.data;if(O*this.stride>=ht.length)throw new Error(Y);let nt=this.options.radius/(this.options.extent*Math.pow(2,j-1)),tt=J.within(ht[O*this.stride],ht[O*this.stride+1],nt),it=[];for(let bt of tt){let wt=bt*this.stride;ht[wt+4]===k&&it.push(ht[wt+qr]>1?Os(ht,wt,this.clusterProps):this.points[ht[wt+Ne]])}if(it.length===0)throw new Error(Y);return it}getLeaves(k,O,j){let Y=[];return this._appendLeaves(Y,k,O=O||10,j=j||0,0),Y}getTile(k,O,j){let Y=this.trees[this._limitZoom(k)],J=Math.pow(2,k),{extent:ht,radius:nt}=this.options,tt=nt/ht,it=(j-tt)/J,bt=(j+1+tt)/J,wt={features:[]};return this._addTileFeatures(Y.range((O-tt)/J,it,(O+1+tt)/J,bt),Y.data,O,j,J,wt),O===0&&this._addTileFeatures(Y.range(1-tt/J,it,1,bt),Y.data,J,j,J,wt),O===J-1&&this._addTileFeatures(Y.range(0,it,tt/J,bt),Y.data,-1,j,J,wt),wt.features.length?wt:null}getClusterExpansionZoom(k){let O=this._getOriginZoom(k)-1;for(;O<=this.options.maxZoom;){let j=this.getChildren(k);if(O++,j.length!==1)break;k=j[0].properties.cluster_id}return O}_appendLeaves(k,O,j,Y,J){let ht=this.getChildren(O);for(let nt of ht){let tt=nt.properties;if(tt&&tt.cluster?J+tt.point_count<=Y?J+=tt.point_count:J=this._appendLeaves(k,tt.cluster_id,j,Y,J):J<Y?J++:k.push(nt),k.length===j)break}return J}_createTree(k){let O=new l.av(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<k.length;j+=this.stride)O.add(k[j],k[j+1]);return O.finish(),O.data=k,O}_addTileFeatures(k,O,j,Y,J,ht){for(let nt of k){let tt=nt*this.stride,it=O[tt+qr]>1,bt,wt,Tt;if(it)bt=oo(O,tt,this.clusterProps),wt=O[tt],Tt=O[tt+1];else{let Kt=this.points[O[tt+Ne]];bt=Kt.properties;let[ae,xe]=Kt.geometry.coordinates;wt=ln(ae),Tt=Qe(xe)}let oe={type:1,geometry:[[Math.round(this.options.extent*(wt*J-j)),Math.round(this.options.extent*(Tt*J-Y))]],tags:bt},me;me=it||this.options.generateId?O[tt+Ne]:this.points[O[tt+Ne]].id,me!==void 0&&(oe.id=me),ht.features.push(oe)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,O){let{radius:j,extent:Y,reduce:J,minPoints:ht}=this.options,nt=j/(Y*Math.pow(2,O)),tt=k.data,it=[],bt=this.stride;for(let wt=0;wt<tt.length;wt+=bt){if(tt[wt+2]<=O)continue;tt[wt+2]=O;let Tt=tt[wt],oe=tt[wt+1],me=k.within(tt[wt],tt[wt+1],nt),Kt=tt[wt+qr],ae=Kt;for(let xe of me){let We=xe*bt;tt[We+2]>O&&(ae+=tt[We+qr])}if(ae>Kt&&ae>=ht){let xe,We=Tt*Kt,qe=oe*Kt,$e=-1,Ge=((wt/bt|0)<<5)+(O+1)+this.points.length;for(let mn of me){let hr=mn*bt;if(tt[hr+2]<=O)continue;tt[hr+2]=O;let Vr=tt[hr+qr];We+=tt[hr]*Vr,qe+=tt[hr+1]*Vr,tt[hr+4]=Ge,J&&(xe||(xe=this._map(tt,wt,!0),$e=this.clusterProps.length,this.clusterProps.push(xe)),J(xe,this._map(tt,hr)))}tt[wt+4]=Ge,it.push(We/ae,qe/ae,1/0,Ge,-1,ae),J&&it.push($e)}else{for(let xe=0;xe<bt;xe++)it.push(tt[wt+xe]);if(ae>1)for(let xe of me){let We=xe*bt;if(!(tt[We+2]<=O)){tt[We+2]=O;for(let qe=0;qe<bt;qe++)it.push(tt[We+qe])}}}}return it}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,O,j){if(k[O+qr]>1){let ht=this.clusterProps[k[O+zn]];return j?Object.assign({},ht):ht}let Y=this.points[k[O+Ne]].properties,J=this.options.map(Y);return j&&J===Y?Object.assign({},J):J}}function Os(X,k,O){return{type:"Feature",id:X[k+Ne],properties:oo(X,k,O),geometry:{type:"Point",coordinates:[(j=X[k],360*(j-.5)),na(X[k+1])]}};var j}function oo(X,k,O){let j=X[k+qr],Y=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,J=X[k+zn],ht=J===-1?{}:Object.assign({},O[J]);return Object.assign(ht,{cluster:!0,cluster_id:X[k+Ne],point_count:j,point_count_abbreviated:Y})}function ln(X){return X/360+.5}function Qe(X){let k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function na(X){let k=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function Fo(X,k,O,j){for(var Y,J=j,ht=O-k>>1,nt=O-k,tt=X[k],it=X[k+1],bt=X[O],wt=X[O+1],Tt=k+3;Tt<O;Tt+=3){var oe=ba(X[Tt],X[Tt+1],tt,it,bt,wt);if(oe>J)Y=Tt,J=oe;else if(oe===J){var me=Math.abs(Tt-ht);me<nt&&(Y=Tt,nt=me)}}J>j&&(Y-k>3&&Fo(X,k,Y,j),X[Y+2]=J,O-Y>3&&Fo(X,Y,O,j))}function ba(X,k,O,j,Y,J){var ht=Y-O,nt=J-j;if(ht!==0||nt!==0){var tt=((X-O)*ht+(k-j)*nt)/(ht*ht+nt*nt);tt>1?(O=Y,j=J):tt>0&&(O+=ht*tt,j+=nt*tt)}return(ht=X-O)*ht+(nt=k-j)*nt}function Oi(X,k,O,j){var Y={id:X===void 0?null:X,type:k,geometry:O,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var ht=J.geometry,nt=J.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Fs(J,ht);else if(nt==="Polygon"||nt==="MultiLineString")for(var tt=0;tt<ht.length;tt++)Fs(J,ht[tt]);else if(nt==="MultiPolygon")for(tt=0;tt<ht.length;tt++)for(var it=0;it<ht[tt].length;it++)Fs(J,ht[tt][it])}(Y),Y}function Fs(X,k){for(var O=0;O<k.length;O+=3)X.minX=Math.min(X.minX,k[O]),X.minY=Math.min(X.minY,k[O+1]),X.maxX=Math.max(X.maxX,k[O]),X.maxY=Math.max(X.maxY,k[O+1])}function Zr(X,k,O,j){if(k.geometry){var Y=k.geometry.coordinates,J=k.geometry.type,ht=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),nt=[],tt=k.id;if(O.promoteId?tt=k.properties[O.promoteId]:O.generateId&&(tt=j||0),J==="Point")Mo(Y,nt);else if(J==="MultiPoint")for(var it=0;it<Y.length;it++)Mo(Y[it],nt);else if(J==="LineString")No(Y,nt,ht,!1);else if(J==="MultiLineString"){if(O.lineMetrics){for(it=0;it<Y.length;it++)No(Y[it],nt=[],ht,!1),X.push(Oi(tt,"LineString",nt,k.properties));return}ls(Y,nt,ht,!1)}else if(J==="Polygon")ls(Y,nt,ht,!0);else{if(J!=="MultiPolygon"){if(J==="GeometryCollection"){for(it=0;it<k.geometry.geometries.length;it++)Zr(X,{id:tt,geometry:k.geometry.geometries[it],properties:k.properties},O,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<Y.length;it++){var bt=[];ls(Y[it],bt,ht,!0),nt.push(bt)}}X.push(Oi(tt,J,nt,k.properties))}}function Mo(X,k){k.push(_t(X[0])),k.push(Vn(X[1])),k.push(0)}function No(X,k,O,j){for(var Y,J,ht=0,nt=0;nt<X.length;nt++){var tt=_t(X[nt][0]),it=Vn(X[nt][1]);k.push(tt),k.push(it),k.push(0),nt>0&&(ht+=j?(Y*it-tt*J)/2:Math.sqrt(Math.pow(tt-Y,2)+Math.pow(it-J,2))),Y=tt,J=it}var bt=k.length-3;k[2]=1,Fo(k,0,bt,O),k[bt+2]=1,k.size=Math.abs(ht),k.start=0,k.end=k.size}function ls(X,k,O,j){for(var Y=0;Y<X.length;Y++){var J=[];No(X[Y],J,O,j),k.push(J)}}function _t(X){return X/360+.5}function Vn(X){var k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function fi(X,k,O,j,Y,J,ht,nt){if(j/=k,J>=(O/=k)&&ht<j)return X;if(ht<O||J>=j)return null;for(var tt=[],it=0;it<X.length;it++){var bt=X[it],wt=bt.geometry,Tt=bt.type,oe=Y===0?bt.minX:bt.minY,me=Y===0?bt.maxX:bt.maxY;if(oe>=O&&me<j)tt.push(bt);else if(!(me<O||oe>=j)){var Kt=[];if(Tt==="Point"||Tt==="MultiPoint")ar(wt,Kt,O,j,Y);else if(Tt==="LineString")Ze(wt,Kt,O,j,Y,!1,nt.lineMetrics);else if(Tt==="MultiLineString")ho(wt,Kt,O,j,Y,!1);else if(Tt==="Polygon")ho(wt,Kt,O,j,Y,!0);else if(Tt==="MultiPolygon")for(var ae=0;ae<wt.length;ae++){var xe=[];ho(wt[ae],xe,O,j,Y,!0),xe.length&&Kt.push(xe)}if(Kt.length){if(nt.lineMetrics&&Tt==="LineString"){for(ae=0;ae<Kt.length;ae++)tt.push(Oi(bt.id,Tt,Kt[ae],bt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Kt.length===1?(Tt="LineString",Kt=Kt[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Kt.length===3?"Point":"MultiPoint"),tt.push(Oi(bt.id,Tt,Kt,bt.tags))}}}return tt.length?tt:null}function ar(X,k,O,j,Y){for(var J=0;J<X.length;J+=3){var ht=X[J+Y];ht>=O&&ht<=j&&(k.push(X[J]),k.push(X[J+1]),k.push(X[J+2]))}}function Ze(X,k,O,j,Y,J,ht){for(var nt,tt,it=ji(X),bt=Y===0?ia:us,wt=X.start,Tt=0;Tt<X.length-3;Tt+=3){var oe=X[Tt],me=X[Tt+1],Kt=X[Tt+2],ae=X[Tt+3],xe=X[Tt+4],We=Y===0?oe:me,qe=Y===0?ae:xe,$e=!1;ht&&(nt=Math.sqrt(Math.pow(oe-ae,2)+Math.pow(me-xe,2))),We<O?qe>O&&(tt=bt(it,oe,me,ae,xe,O),ht&&(it.start=wt+nt*tt)):We>j?qe<j&&(tt=bt(it,oe,me,ae,xe,j),ht&&(it.start=wt+nt*tt)):Zi(it,oe,me,Kt),qe<O&&We>=O&&(tt=bt(it,oe,me,ae,xe,O),$e=!0),qe>j&&We<=j&&(tt=bt(it,oe,me,ae,xe,j),$e=!0),!J&&$e&&(ht&&(it.end=wt+nt*tt),k.push(it),it=ji(X)),ht&&(wt+=nt)}var Ge=X.length-3;oe=X[Ge],me=X[Ge+1],Kt=X[Ge+2],(We=Y===0?oe:me)>=O&&We<=j&&Zi(it,oe,me,Kt),Ge=it.length-3,J&&Ge>=3&&(it[Ge]!==it[0]||it[Ge+1]!==it[1])&&Zi(it,it[0],it[1],it[2]),it.length&&k.push(it)}function ji(X){var k=[];return k.size=X.size,k.start=X.start,k.end=X.end,k}function ho(X,k,O,j,Y,J){for(var ht=0;ht<X.length;ht++)Ze(X[ht],k,O,j,Y,J,!1)}function Zi(X,k,O,j){X.push(k),X.push(O),X.push(j)}function ia(X,k,O,j,Y,J){var ht=(J-k)/(j-k);return X.push(J),X.push(O+(Y-O)*ht),X.push(1),ht}function us(X,k,O,j,Y,J){var ht=(J-O)/(Y-O);return X.push(k+(j-k)*ht),X.push(J),X.push(1),ht}function Xi(X,k){for(var O=[],j=0;j<X.length;j++){var Y,J=X[j],ht=J.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")Y=Do(J.geometry,k);else if(ht==="MultiLineString"||ht==="Polygon"){Y=[];for(var nt=0;nt<J.geometry.length;nt++)Y.push(Do(J.geometry[nt],k))}else if(ht==="MultiPolygon")for(Y=[],nt=0;nt<J.geometry.length;nt++){for(var tt=[],it=0;it<J.geometry[nt].length;it++)tt.push(Do(J.geometry[nt][it],k));Y.push(tt)}O.push(Oi(J.id,ht,Y,J.tags))}return O}function Do(X,k){var O=[];O.size=X.size,X.start!==void 0&&(O.start=X.start,O.end=X.end);for(var j=0;j<X.length;j+=3)O.push(X[j]+k,X[j+1],X[j+2]);return O}function Ot(X,k){if(X.transformed)return X;var O,j,Y,J=1<<X.z,ht=X.x,nt=X.y;for(O=0;O<X.features.length;O++){var tt=X.features[O],it=tt.geometry,bt=tt.type;if(tt.geometry=[],bt===1)for(j=0;j<it.length;j+=2)tt.geometry.push(Pi(it[j],it[j+1],k,J,ht,nt));else for(j=0;j<it.length;j++){var wt=[];for(Y=0;Y<it[j].length;Y+=2)wt.push(Pi(it[j][Y],it[j][Y+1],k,J,ht,nt));tt.geometry.push(wt)}}return X.transformed=!0,X}function Pi(X,k,O,j,Y,J){return[Math.round(O*(X*j-Y)),Math.round(O*(k*j-J))]}function Cr(X,k,O,j,Y){for(var J=k===Y.maxZoom?0:Y.tolerance/((1<<k)*Y.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:j,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},nt=0;nt<X.length;nt++){ht.numFeatures++,cs(ht,X[nt],J,Y);var tt=X[nt].minX,it=X[nt].minY,bt=X[nt].maxX,wt=X[nt].maxY;tt<ht.minX&&(ht.minX=tt),it<ht.minY&&(ht.minY=it),bt>ht.maxX&&(ht.maxX=bt),wt>ht.maxY&&(ht.maxY=wt)}return ht}function cs(X,k,O,j){var Y=k.geometry,J=k.type,ht=[];if(J==="Point"||J==="MultiPoint")for(var nt=0;nt<Y.length;nt+=3)ht.push(Y[nt]),ht.push(Y[nt+1]),X.numPoints++,X.numSimplified++;else if(J==="LineString")Ai(ht,Y,X,O,!1,!1);else if(J==="MultiLineString"||J==="Polygon")for(nt=0;nt<Y.length;nt++)Ai(ht,Y[nt],X,O,J==="Polygon",nt===0);else if(J==="MultiPolygon")for(var tt=0;tt<Y.length;tt++){var it=Y[tt];for(nt=0;nt<it.length;nt++)Ai(ht,it[nt],X,O,!0,nt===0)}if(ht.length){var bt=k.tags||null;if(J==="LineString"&&j.lineMetrics){for(var wt in bt={},k.tags)bt[wt]=k.tags[wt];bt.mapbox_clip_start=Y.start/Y.size,bt.mapbox_clip_end=Y.end/Y.size}var Tt={geometry:ht,type:J==="Polygon"||J==="MultiPolygon"?3:J==="LineString"||J==="MultiLineString"?2:1,tags:bt};k.id!==null&&(Tt.id=k.id),X.features.push(Tt)}}function Ai(X,k,O,j,Y,J){var ht=j*j;if(j>0&&k.size<(Y?ht:j))O.numPoints+=k.length/3;else{for(var nt=[],tt=0;tt<k.length;tt+=3)(j===0||k[tt+2]>ht)&&(O.numSimplified++,nt.push(k[tt]),nt.push(k[tt+1])),O.numPoints++;Y&&function(it,bt){for(var wt=0,Tt=0,oe=it.length,me=oe-2;Tt<oe;me=Tt,Tt+=2)wt+=(it[Tt]-it[me])*(it[Tt+1]+it[me+1]);if(wt>0===bt)for(Tt=0,oe=it.length;Tt<oe/2;Tt+=2){var Kt=it[Tt],ae=it[Tt+1];it[Tt]=it[oe-2-Tt],it[Tt+1]=it[oe-1-Tt],it[oe-2-Tt]=Kt,it[oe-1-Tt]=ae}}(nt,J),X.push(nt)}}function Nt(X,k){var O=(k=this.options=function(Y,J){for(var ht in J)Y[ht]=J[ht];return Y}(Object.create(this.options),k)).debug;if(O&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(Y,J){var ht=[];if(Y.type==="FeatureCollection")for(var nt=0;nt<Y.features.length;nt++)Zr(ht,Y.features[nt],J,nt);else Zr(ht,Y.type==="Feature"?Y:{geometry:Y},J);return ht}(X,k);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(Y,J){var ht=J.buffer/J.extent,nt=Y,tt=fi(Y,1,-1-ht,ht,0,-1,2,J),it=fi(Y,1,1-ht,2+ht,0,-1,2,J);return(tt||it)&&(nt=fi(Y,1,-ht,1+ht,0,-1,2,J)||[],tt&&(nt=Xi(tt,1).concat(nt)),it&&(nt=nt.concat(Xi(it,-1)))),nt}(j,k),j.length&&this.splitTile(j,0,0,0),O&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Se(X,k,O){return 32*((1<<X)*O+k)+X}function ge(X,k){return k?X.properties[k]:X.id}function bn(X,k){if(X==null)return!0;if(X.type==="Feature")return ge(X,k)!=null;if(X.type==="FeatureCollection"){let O=new Set;for(let j of X.features){let Y=ge(j,k);if(Y==null||O.has(Y))return!1;O.add(Y)}return!0}return!1}function Li(X,k){let O=new Map;if(X!=null)if(X.type==="Feature")O.set(ge(X,k),X);else for(let j of X.features)O.set(ge(j,k),j);return O}Nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nt.prototype.splitTile=function(X,k,O,j,Y,J,ht){for(var nt=[X,k,O,j],tt=this.options,it=tt.debug;nt.length;){j=nt.pop(),O=nt.pop(),k=nt.pop(),X=nt.pop();var bt=1<<k,wt=Se(k,O,j),Tt=this.tiles[wt];if(!Tt&&(it>1&&console.time("creation"),Tt=this.tiles[wt]=Cr(X,k,O,j,tt),this.tileCoords.push({z:k,x:O,y:j}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,O,j,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var oe="z"+k;this.stats[oe]=(this.stats[oe]||0)+1,this.total++}if(Tt.source=X,Y){if(k===tt.maxZoom||k===Y)continue;var me=1<<Y-k;if(O!==Math.floor(J/me)||j!==Math.floor(ht/me))continue}else if(k===tt.indexMaxZoom||Tt.numPoints<=tt.indexMaxPoints)continue;if(Tt.source=null,X.length!==0){it>1&&console.time("clipping");var Kt,ae,xe,We,qe,$e,Ge=.5*tt.buffer/tt.extent,mn=.5-Ge,hr=.5+Ge,Vr=1+Ge;Kt=ae=xe=We=null,qe=fi(X,bt,O-Ge,O+hr,0,Tt.minX,Tt.maxX,tt),$e=fi(X,bt,O+mn,O+Vr,0,Tt.minX,Tt.maxX,tt),X=null,qe&&(Kt=fi(qe,bt,j-Ge,j+hr,1,Tt.minY,Tt.maxY,tt),ae=fi(qe,bt,j+mn,j+Vr,1,Tt.minY,Tt.maxY,tt),qe=null),$e&&(xe=fi($e,bt,j-Ge,j+hr,1,Tt.minY,Tt.maxY,tt),We=fi($e,bt,j+mn,j+Vr,1,Tt.minY,Tt.maxY,tt),$e=null),it>1&&console.timeEnd("clipping"),nt.push(Kt||[],k+1,2*O,2*j),nt.push(ae||[],k+1,2*O,2*j+1),nt.push(xe||[],k+1,2*O+1,2*j),nt.push(We||[],k+1,2*O+1,2*j+1)}}},Nt.prototype.getTile=function(X,k,O){var j=this.options,Y=j.extent,J=j.debug;if(X<0||X>24)return null;var ht=1<<X,nt=Se(X,k=(k%ht+ht)%ht,O);if(this.tiles[nt])return Ot(this.tiles[nt],Y);J>1&&console.log("drilling down to z%d-%d-%d",X,k,O);for(var tt,it=X,bt=k,wt=O;!tt&&it>0;)it--,bt=Math.floor(bt/2),wt=Math.floor(wt/2),tt=this.tiles[Se(it,bt,wt)];return tt&&tt.source?(J>1&&console.log("found parent tile z%d-%d-%d",it,bt,wt),J>1&&console.time("drilling down"),this.splitTile(tt.source,it,bt,wt,X,k,O),J>1&&console.timeEnd("drilling down"),this.tiles[nt]?Ot(this.tiles[nt],Y):null):null};class ye extends yt{constructor(k,O,j,Y){super(k,O,j),this._dataUpdateable=new Map,this.loadGeoJSON=(J,ht)=>{let{promoteId:nt}=J;if(J.request)return l.f(J.request,(tt,it,bt,wt)=>{this._dataUpdateable=bn(it,nt)?Li(it,nt):void 0,ht(tt,it,bt,wt)});if(typeof J.data=="string")try{let tt=JSON.parse(J.data);this._dataUpdateable=bn(tt,nt)?Li(tt,nt):void 0,ht(null,tt)}catch{ht(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}else J.dataDiff?this._dataUpdateable?(function(tt,it,bt){var wt,Tt,oe,me;if(it.removeAll&&tt.clear(),it.remove)for(let Kt of it.remove)tt.delete(Kt);if(it.add)for(let Kt of it.add){let ae=ge(Kt,bt);ae!=null&&tt.set(ae,Kt)}if(it.update)for(let Kt of it.update){let ae=tt.get(Kt.id);if(ae==null)continue;let xe=!Kt.removeAllProperties&&(((wt=Kt.removeProperties)===null||wt===void 0?void 0:wt.length)>0||((Tt=Kt.addOrUpdateProperties)===null||Tt===void 0?void 0:Tt.length)>0);if((Kt.newGeometry||Kt.removeAllProperties||xe)&&(ae=Object.assign({},ae),tt.set(Kt.id,ae),xe&&(ae.properties=Object.assign({},ae.properties))),Kt.newGeometry&&(ae.geometry=Kt.newGeometry),Kt.removeAllProperties)ae.properties={};else if(((oe=Kt.removeProperties)===null||oe===void 0?void 0:oe.length)>0)for(let We of Kt.removeProperties)Object.prototype.hasOwnProperty.call(ae.properties,We)&&delete ae.properties[We];if(((me=Kt.addOrUpdateProperties)===null||me===void 0?void 0:me.length)>0)for(let{key:We,value:qe}of Kt.addOrUpdateProperties)ae.properties[We]=qe}}(this._dataUpdateable,J.dataDiff,nt),ht(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ht(new Error(`Cannot update existing geojson data in ${J.source}`)):ht(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Y&&(this.loadGeoJSON=Y)}loadGeoJSONTile(k,O){let j=k.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);let Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return O(null,null);let J=new class{constructor(nt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=nt.length,this._features=nt}feature(nt){return new class{constructor(tt){this._feature=tt,this.extent=l.N,this.type=tt.type,this.properties=tt.tags,"id"in tt&&!isNaN(tt.id)&&(this.id=parseInt(tt.id,10))}loadGeometry(){if(this._feature.type===1){let tt=[];for(let it of this._feature.geometry)tt.push([new l.P(it[0],it[1])]);return tt}{let tt=[];for(let it of this._feature.geometry){let bt=[];for(let wt of it)bt.push(new l.P(wt[0],wt[1]));tt.push(bt)}return tt}}toGeoJSON(tt,it,bt){return Qt.call(this,tt,it,bt)}}(this._features[nt])}}(Y.features),ht=pi(J);ht.byteOffset===0&&ht.byteLength===ht.buffer.byteLength||(ht=new Uint8Array(ht)),O(null,{vectorTile:J,rawData:ht.buffer})}loadData(k,O){var j;(j=this._pendingRequest)===null||j===void 0||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.bu(k.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(k,(J,ht)=>{if(delete this._pendingCallback,delete this._pendingRequest,J||!ht)return O(J);if(typeof ht!="object")return O(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{qt(ht,!0);try{if(k.filter){let tt=l.bC(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(tt.result==="error")throw new Error(tt.value.map(it=>`${it.key}: ${it.message}`).join(", "));ht={type:"FeatureCollection",features:ht.features.filter(it=>tt.value.evaluate({zoom:0},it))}}this._geoJSONIndex=k.cluster?new Ci(function({superclusterOptions:tt,clusterProperties:it}){if(!it||!tt)return tt;let bt={},wt={},Tt={accumulated:null,zoom:0},oe={properties:null},me=Object.keys(it);for(let Kt of me){let[ae,xe]=it[Kt],We=l.bC(xe),qe=l.bC(typeof ae=="string"?[ae,["accumulated"],["get",Kt]]:ae);bt[Kt]=We.value,wt[Kt]=qe.value}return tt.map=Kt=>{oe.properties=Kt;let ae={};for(let xe of me)ae[xe]=bt[xe].evaluate(Tt,oe);return ae},tt.reduce=(Kt,ae)=>{oe.properties=ae;for(let xe of me)Tt.accumulated=Kt[xe],Kt[xe]=wt[xe].evaluate(Tt,oe)},tt}(k)).load(ht.features):function(tt,it){return new Nt(tt,it)}(ht,k.geojsonVtOptions)}catch(tt){return O(tt)}this.loaded={};let nt={};if(Y){let tt=Y.finish();tt&&(nt.resourceTiming={},nt.resourceTiming[k.source]=JSON.parse(JSON.stringify(tt)))}O(null,nt)}})}reloadTile(k,O){let j=this.loaded;return j&&j[k.uid]?super.reloadTile(k,O):this.loadTile(k,O)}removeSource(k,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(k,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(j){O(j)}}getClusterChildren(k,O){try{O(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(j){O(j)}}getClusterLeaves(k,O){try{O(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(j){O(j)}}}class Gi{constructor(k){this.self=k,this.actor=new l.C(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:yt,geojson:ye},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,j)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=j},this.self.registerRTLTextPlugin=O=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=O.applyArabicShaping,l.bD.processBidirectionalText=O.processBidirectionalText,l.bD.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(k,O){this.referrer=O}setImages(k,O,j){this.availableImages[k]=O;for(let Y in this.workerSources[k]){let J=this.workerSources[k][Y];for(let ht in J)J[ht].availableImages=O}j()}setLayers(k,O,j){this.getLayerIndex(k).replace(O),j()}updateLayers(k,O,j){this.getLayerIndex(k).update(O.layers,O.removedIds),j()}loadTile(k,O,j){this.getWorkerSource(k,O.type,O.source).loadTile(O,j)}loadDEMTile(k,O,j){this.getDEMWorkerSource(k,O.source).loadTile(O,j)}reloadTile(k,O,j){this.getWorkerSource(k,O.type,O.source).reloadTile(O,j)}abortTile(k,O,j){this.getWorkerSource(k,O.type,O.source).abortTile(O,j)}removeTile(k,O,j){this.getWorkerSource(k,O.type,O.source).removeTile(O,j)}removeDEMTile(k,O){this.getDEMWorkerSource(k,O.source).removeTile(O)}removeSource(k,O,j){if(!this.workerSources[k]||!this.workerSources[k][O.type]||!this.workerSources[k][O.type][O.source])return;let Y=this.workerSources[k][O.type][O.source];delete this.workerSources[k][O.type][O.source],Y.removeSource!==void 0?Y.removeSource(O,j):j()}loadWorkerSource(k,O,j){try{this.self.importScripts(O.url),j()}catch(Y){j(Y.toString())}}syncRTLPluginState(k,O,j){try{l.bD.setState(O);let Y=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&Y!=null){this.self.importScripts(Y);let J=l.bD.isParsed();j(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),J)}}catch(Y){j(Y.toString())}}getAvailableImages(k){let O=this.availableImages[k];return O||(O=[]),O}getLayerIndex(k){let O=this.layerIndexes[k];return O||(O=this.layerIndexes[k]=new V),O}getWorkerSource(k,O,j){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][O]||(this.workerSources[k][O]={}),this.workerSources[k][O][j]||(this.workerSources[k][O][j]=new this.workerSourceTypes[O]({send:(Y,J,ht)=>{this.actor.send(Y,J,ht,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][O][j]}getDEMWorkerSource(k,O){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][O]||(this.demWorkerSources[k][O]=new xt),this.demWorkerSources[k][O]}}return l.i()&&(self.worker=new Gi(self)),Gi}),b(["./shared"],function(l){var V="3.6.2";class R{static testProp(e){if(!R.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in R.docStyle)return e[o];return e[0]}static create(e,o,c){let p=window.document.createElement(e);return o!==void 0&&(p.className=o),c&&c.appendChild(p),p}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(e,o){e.style[R.transformProp]=o}static addEventListener(e,o,c,p={}){e.addEventListener(o,c,"passive"in p?p:p.capture)}static removeEventListener(e,o,c,p={}){e.removeEventListener(o,c,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static mousePos(e,o){let c=e.getBoundingClientRect();return new l.P(o.clientX-c.left-e.clientLeft,o.clientY-c.top-e.clientTop)}static touchPos(e,o){let c=e.getBoundingClientRect(),p=[];for(let m=0;m<o.length;m++)p.push(new l.P(o[m].clientX-c.left-e.clientLeft,o[m].clientY-c.top-e.clientTop));return p}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);let et={supported:!1,testSupport:function(f){!yt&&st&&(xt?It(f):at=f)}},at,st,yt=!1,xt=!1;function It(f){let e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,st),f.isContextLost())return;et.supported=!0}catch{}f.deleteTexture(e),yt=!0}var Pt,qt;typeof document<"u"&&(st=document.createElement("img"),st.onload=function(){at&&It(at),at=null,xt=!0},st.onerror=function(){yt=!0,at=null},st.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,o,c,p;f.resetRequestQueue=()=>{e=[],o=0,c=0,p={}},f.addThrottleControl=I=>{let A=c++;return p[A]=I,A},f.removeThrottleControl=I=>{delete p[I],w()},f.getImage=(I,A,L=!0)=>{et.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*");let F={requestParameters:I,supportImageRefresh:L,callback:A,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),o--),w())}};return e.push(F),w(),F};let m=I=>{let{requestParameters:A,supportImageRefresh:L,callback:F}=I;return l.e(A,{type:"image"}),(L!==!1||l.i()||l.g(A.url)||A.headers&&!Object.keys(A.headers).reduce(($,Z)=>$&&Z==="accept",!0)?l.m:E)(A,($,Z,H,G)=>{x(I,F,$,Z,H,G)})},x=(I,A,L,F,$,Z)=>{L?A(L):F instanceof HTMLImageElement||l.a(F)?A(null,F):F&&((H,G)=>{typeof createImageBitmap=="function"?l.b(H,G):l.d(H,G)})(F,(H,G)=>{H!=null?A(H):G!=null&&A(null,G,{cacheControl:$,expires:Z})}),I.cancelled||(I.completed=!0,o--,w())},w=()=>{let I=(()=>{let A=Object.keys(p),L=!1;if(A.length>0){for(let F of A)if(L=p[F](),L)break}return L})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=o;A<I&&e.length>0;A++){let L=e.shift();if(L.cancelled){A--;continue}let F=m(L);o++,L.innerRequest=F}},E=(I,A)=>{let L=new Image,F=I.url,$=!1,Z=I.credentials;return Z&&Z==="include"?L.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!l.s(F))&&(L.crossOrigin="anonymous"),L.fetchPriority="high",L.onload=()=>{A(null,L),L.onerror=L.onload=null},L.onerror=()=>{$||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),L.onerror=L.onload=null},L.src=F,{cancel:()=>{$=!0,L.src=""}}}}(Pt||(Pt={})),Pt.resetRequestQueue(),function(f){f.Glyphs="Glyphs",f.Image="Image",f.Source="Source",f.SpriteImage="SpriteImage",f.SpriteJSON="SpriteJSON",f.Style="Style",f.Tile="Tile",f.Unknown="Unknown"}(qt||(qt={}));class Qt{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}normalizeSpriteURL(e,o,c){let p=function(m){let x=m.match(se);if(!x)throw new Error(`Unable to parse URL "${m}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(e);return p.path+=`${o}${c}`,function(m){let x=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${x}`}(p)}setTransformRequest(e){this._transformRequestFn=e}}let se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(f){var e=new l.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Ue,ke=function(f,e,o){return f[0]=e[0]-o[0],f[1]=e[1]-o[1],f[2]=e[2]-o[2],f};Ue=new l.A(3),l.A!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0);var er=function(f){var e=f[0],o=f[1];return e*e+o*o};function Le(f){let e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){let o=[];for(let{id:c,url:p}of f){let m=`${c}${p}`;o.indexOf(m)===-1&&(o.push(m),e.push({id:c,url:p}))}}return e}function lr(f,e,o,c,p){if(c)return void f(c);if(p!==Object.values(e).length||p!==Object.values(o).length)return;let m={};for(let x in e){m[x]={};let w=l.h.getImageCanvasContext(o[x]),E=e[x];for(let I in E){let{width:A,height:L,x:F,y:$,sdf:Z,pixelRatio:H,stretchX:G,stretchY:ot,content:dt}=E[I];m[x][I]={data:null,pixelRatio:H,sdf:Z,stretchX:G,stretchY:ot,content:dt,spriteData:{width:A,height:L,x:F,y:$,context:w}}}}f(null,m)}(function(){var f=new l.A(2);l.A!=Float32Array&&(f[0]=0,f[1]=0)})();class je{constructor(e,o,c,p){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(o,p)}update(e,o,c){let{width:p,height:m}=e,x=!(this.size&&this.size[0]===p&&this.size[1]===m||c),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[p,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.a(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,p,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{let{x:I,y:A}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.a(e)?E.texSubImage2D(E.TEXTURE_2D,0,I,A,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,I,A,p,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,o,c){let{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||e),this.filter=e),o!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function zr(f){let{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class nr extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:o,callback:c}of this.requestors)this._notify(o,c);this.requestors=[]}}getImage(e){let o=this.images[e];if(o&&!o.data&&o.spriteData){let c=o.spriteData;o.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let c=!0,p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,o){if(!e)return!0;let c=0;for(let p of e){if(p[0]<c||p[1]<p[0]||o<p[1])return!1;c=p[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;let c=o.spriteData,p=c&&c.width||o.data.width,m=c&&c.height||o.data.height;return!(e[0]<0||p<e[0]||e[1]<0||m<e[1]||e[2]<0||p<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,c=!0){let p=this.getImage(e);if(c&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){let o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,o){let c=!0;if(!this.isLoaded())for(let p of e)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(e,o):this.requestors.push({ids:e,callback:o})}_notify(e,o){let c={};for(let p of e){let m=this.getImage(p);m||(this.fire(new l.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?c[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:l.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,c)}getPixelSize(){let{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){let o=this.patterns[e],c=this.getImage(e);if(!c)return null;if(o&&o.position.version===c.version)return o.position;if(o)o.position.version=c.version;else{let p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},m=new l.I(p,c);this.patterns[e]={bin:p,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new je(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let m in this.patterns)e.push(this.patterns[m].bin);let{w:o,h:c}=l.p(e),p=this.atlasImage;p.resize({width:o||1,height:c||1});for(let m in this.patterns){let{bin:x}=this.patterns[m],w=x.x+1,E=x.y+1,I=this.getImage(m).data,A=I.width,L=I.height;l.R.copy(I,p,{x:0,y:0},{x:w,y:E},{width:A,height:L}),l.R.copy(I,p,{x:0,y:L-1},{x:w,y:E-1},{width:A,height:1}),l.R.copy(I,p,{x:0,y:0},{x:w,y:E+L},{width:A,height:1}),l.R.copy(I,p,{x:A-1,y:0},{x:w-1,y:E},{width:1,height:L}),l.R.copy(I,p,{x:0,y:0},{x:w+A,y:E},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;let c=this.getImage(o);c||l.w(`Image with ID: "${o}" was not found`),zr(c)&&this.updateImage(o,c)}}}let fn=1e20;function de(f,e,o,c,p,m,x,w,E){for(let I=e;I<e+c;I++)Ke(f,o*m+I,m,p,x,w,E);for(let I=o;I<o+p;I++)Ke(f,I*m+e,1,c,x,w,E)}function Ke(f,e,o,c,p,m,x){m[0]=0,x[0]=-fn,x[1]=fn,p[0]=f[e];for(let w=1,E=0,I=0;w<c;w++){p[w]=f[e+w*o];let A=w*w;do{let L=m[E];I=(p[w]-p[L]+A-L*L)/(w-L)/2}while(I<=x[E]&&--E>-1);E++,m[E]=w,x[E]=I,x[E+1]=fn}for(let w=0,E=0;w<c;w++){for(;x[E+1]<w;)E++;let I=m[E],A=w-I;f[e+w*o]=p[I]+A*A}}class Er{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e,o){let c=[];for(let p in e)for(let m of e[p])c.push({stack:p,id:m});l.o(c,({stack:p,id:m},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{}});let E=w.glyphs[m];if(E!==void 0)return void x(null,{stack:p,id:m,glyph:E});if(E=this._tinySDF(w,p,m),E)return w.glyphs[m]=E,void x(null,{stack:p,id:m,glyph:E});let I=Math.floor(m/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void x(null,{stack:p,id:m,glyph:E});if(!this.url)return void x(new Error("glyphsUrl is not set"));let A=w.requests[I];A||(A=w.requests[I]=[],Er.loadGlyphRange(p,I,this.url,this.requestManager,(L,F)=>{if(F){for(let $ in F)this._doesCharSupportLocalGlyph(+$)||(w.glyphs[+$]=F[+$]);w.ranges[I]=!0}for(let $ of A)$(L,F);delete w.requests[I]})),A.push((L,F)=>{L?x(L):F&&x(null,{stack:p,id:m,glyph:F[m]||null})})},(p,m)=>{if(p)o(p);else if(m){let x={};for(let{stack:w,id:E,glyph:I}of m)(x[w]||(x[w]={}))[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};o(null,x)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e))}_tinySDF(e,o,c){let p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let m=e.tinySDF;if(!m){let w="400";/bold/i.test(o)?w="900":/medium/i.test(o)?w="500":/light/i.test(o)&&(w="200"),m=e.tinySDF=new Er.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:w})}let x=m.draw(String.fromCharCode(c));return{id:c,bitmap:new l.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Er.loadGlyphRange=function(f,e,o,c,p){let m=256*e,x=m+255,w=c.transformRequest(o.replace("{fontstack}",f).replace("{range}",`${m}-${x}`),qt.Glyphs);l.l(w,(E,I)=>{if(E)p(E);else if(I){let A={};for(let L of l.n(I))A[L.id]=L;p(null,A)}})},Er.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:o=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:m="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=o;let w=this.size=f+4*e,E=this._createCanvas(w),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${m} ${f}px ${p}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){let e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){let{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:m}=this.ctx.measureText(f),x=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-p))),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),I=w+2*this.buffer,A=E+2*this.buffer,L=Math.max(I*A,0),F=new Uint8ClampedArray(L),$={data:F,width:I,height:A,glyphWidth:w,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(w===0||E===0)return $;let{ctx:Z,buffer:H,gridInner:G,gridOuter:ot}=this;Z.clearRect(H,H,w,E),Z.fillText(f,H,H+x);let dt=Z.getImageData(H,H,w,E);ot.fill(fn,0,L),G.fill(0,0,L);for(let K=0;K<E;K++)for(let lt=0;lt<w;lt++){let mt=dt.data[4*(K*w+lt)+3]/255;if(mt===0)continue;let gt=(K+H)*I+lt+H;if(mt===1)ot[gt]=0,G[gt]=fn;else{let St=.5-mt;ot[gt]=St>0?St*St:0,G[gt]=St<0?St*St:0}}de(ot,0,0,I,A,I,this.f,this.v,this.z),de(G,H,H,w,E,I,this.f,this.v,this.z);for(let K=0;K<L;K++){let lt=Math.sqrt(ot[K])-Math.sqrt(G[K]);F[K]=Math.round(255-255*(lt/this.radius+this.cutoff))}return $}};class Ar{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,o){return l.z(e.expression.evaluate(o))}interpolate(e,o,c){return{x:l.B.number(e.x,o.x,c),y:l.B.number(e.y,o.y,c),z:l.B.number(e.z,o.z,c)}}}let xn;class pi extends l.E{constructor(e){super(),xn=xn||new l.r({anchor:new l.D(l.v.light.anchor),position:new Ar,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(xn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(l.t,e,o))for(let c in e){let p=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),p):this._transitionable.setValue(c,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,c){return(!c||c.validate!==!1)&&l.x(this,e.call(l.y,l.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class Qo{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){let c=e.join(",")+String(o);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,o)),this.dashEntry[c]}getDashRanges(e,o,c){let p=[],m=e.length%2==1?-e[e.length-1]*c:0,x=e[0]*c,w=!0;p.push({left:m,right:x,isDash:w,zeroLength:e[0]===0});let E=e[0];for(let I=1;I<e.length;I++){w=!w;let A=e[I];m=E*c,E+=A,x=E*c,p.push({left:m,right:x,isDash:w,zeroLength:A===0})}return p}addRoundDash(e,o,c){let p=o/2;for(let m=-c;m<=c;m++){let x=this.width*(this.nextRow+c+m),w=0,E=e[w];for(let I=0;I<this.width;I++){I/E.right>1&&(E=e[++w]);let A=Math.abs(I-E.left),L=Math.abs(I-E.right),F=Math.min(A,L),$,Z=m/c*(p+1);if(E.isDash){let H=p-Math.abs(Z);$=Math.sqrt(F*F+H*H)}else $=p-Math.sqrt(F*F+Z*Z);this.data[x+I]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){let E=e[w],I=e[w+1];E.zeroLength?e.splice(w,1):I&&I.isDash===E.isDash&&(I.left=E.left,e.splice(w,1))}let o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let p=this.width*this.nextRow,m=0,x=e[m];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++m]);let E=Math.abs(w-x.left),I=Math.abs(w-x.right),A=Math.min(E,I);this.data[p+w]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(e,o){let c=o?7:0,p=2*c+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let m=0;for(let w=0;w<e.length;w++)m+=e[w];if(m!==0){let w=this.width/m,E=this.getDashRanges(e,this.width,w);o?this.addRoundDash(E,w,c):this.addRegularDash(E)}let x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:m};return this.nextRow+=p,this.dirty=!0,x}bind(e){let o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}class Ri{constructor(e,o,c){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=c;let p=this.workerPool.acquire(c);for(let m=0;m<p.length;m++){let x=new l.C(p[m],o,c);x.name=`Worker ${m}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o,c){l.o(this.actors,(p,m)=>{p.send(e,o,m)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function Sn(f,e,o){let c=function(p,m){if(p)return o(p);if(m){let x=l.F(l.e(m,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(x.vectorLayers=m.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),o(null,x)}};return f.url?l.f(e.transformRequest(f.url,qt.Source),c):l.h.frame(()=>c(null,f))}class Ne{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.L?new l.L(e.lng,e.lat):l.L.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.L?new l.L(e.lng,e.lat):l.L.convert(e),this}extend(e){let o=this._sw,c=this._ne,p,m;if(e instanceof l.L)p=e,m=e;else{if(!(e instanceof Ne))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ne.convert(e)):this.extend(l.L.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.L.convert(e)):this;if(p=e._sw,m=e._ne,!p||!m)return this}return o||c?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new l.L(p.lng,p.lat),this._ne=new l.L(m.lng,m.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:o,lat:c}=l.L.convert(e),p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){return e instanceof Ne?e:e&&new Ne(e)}static fromLngLat(e,o=0){let c=360*o/40075017,p=c/Math.cos(Math.PI/180*e.lat);return new Ne(new l.L(e.lng-p,e.lat-c),new l.L(e.lng+p,e.lat+c))}}class qr{constructor(e,o,c){this.bounds=Ne.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let o=Math.pow(2,e.z),c=Math.floor(l.G(this.bounds.getWest())*o),p=Math.floor(l.H(this.bounds.getNorth())*o),m=Math.ceil(l.G(this.bounds.getEast())*o),x=Math.ceil(l.H(this.bounds.getSouth())*o);return e.x>=c&&e.x<m&&e.y>=p&&e.y<x}}class zn extends l.E{constructor(e,o,c,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Sn(this._options,this.map._requestManager,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),m?this.fire(new l.j(m)):x&&(l.e(this,x),x.bounds&&(this.tileBounds=new qr(x.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,qt.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(x,w){return delete e.request,e.aborted?o(null):x&&x.status!==404?o(x):(w&&w.resourceTiming&&(e.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&e.setExpiryData(w),e.loadVectorData(w,this.map.painter),o(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=o:e.request=e.actor.send("reloadTile",p,m.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",p,m.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ci extends l.E{constructor(e,o,c,p){super(),this.id=e,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.F(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Sn(this._options,this.map._requestManager,(e,o)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new l.j(e)):o&&(l.e(this,o),o.bounds&&(this.tileBounds=new qr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=Pt.getImage(this.map._requestManager.transformRequest(c,qt.Tile),(p,m,x)=>{if(delete e.request,e.aborted)e.state="unloaded",o(null);else if(p)e.state="errored",o(p);else if(m){this.map._refreshExpiredTiles&&x&&e.setExpiryData(x);let w=this.map.painter.context,E=w.gl;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new je(w,m,E.RGBA,{useMipmap:!0}),e.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),e.state="loaded",o(null)}},this.map._refreshExpiredTiles)}abortTile(e,o){e.request&&(e.request.cancel(),delete e.request),o()}unloadTile(e,o){e.texture&&this.map.painter.saveTileTexture(e.texture),o()}hasTransition(){return!1}}class Os extends Ci{constructor(e,o,c,p){super(e,o,c,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(c,qt.Tile);function m(x,w){x&&(e.state="errored",o(x)),w&&(e.dem=w,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",o(null))}e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.request=Pt.getImage(p,(x,w,E)=>l._(this,void 0,void 0,function*(){if(delete e.request,e.aborted)e.state="unloaded",o(null);else if(x)e.state="errored",o(x);else if(w){this.map._refreshExpiredTiles&&e.setExpiryData(E);let I=l.a(w)&&l.J()?w:yield function(L){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){let F=L.width+2,$=L.height+2;try{return new l.R({width:F,height:$},yield l.M(L,-1,-1,F,$))}catch{}}return l.h.getImageData(L,1)})}(w),A={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",A,m))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(e){let o=e.canonical,c=Math.pow(2,o.z),p=(o.x-1+c)%c,m=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+c)%c,w=o.x+1===c?e.wrap+1:e.wrap,E={};return E[new l.O(e.overscaledZ,m,o.z,p,o.y).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(E[new l.O(e.overscaledZ,m,o.z,p,o.y-1).key]={backfilled:!1},E[new l.O(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(E[new l.O(e.overscaledZ,m,o.z,p,o.y+1).key]={backfilled:!1},E[new l.O(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y+1).key]={backfilled:!1}),E}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class oo extends l.E{constructor(e,o,c,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let m=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*m,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*m,extent:l.N,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.N,radius:(o.clusterRadius||50)*m,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},o),this}getClusterChildren(e,o){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},o),this}getClusterLeaves(e,o,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:o,offset:c},p),this}_updateWorkerData(e){let o=l.e({},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),qt.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,o,(c,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let m=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0)),c)return void this.fire(new l.j(c));let x={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&l.e(x,{resourceTiming:m}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(e,o){let c=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let p={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(c,p,(m,x)=>(delete e.request,e.unloadVectorData(),e.aborted?o(null):m?o(m):(e.loadVectorData(x,this.map.painter,c==="reloadTile"),o(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ln=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qe extends l.E{constructor(e,o,c,p){super(),this.load=(m,x)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Pt.getImage(this.map._requestManager.transformRequest(this.url,qt.Image),(w,E)=>{this._request=null,this._loaded=!0,w?this.fire(new l.j(w)):E&&(this.image=E,m&&(this.coordinates=m),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let m=this.map.painter.context,x=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new je(m,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(let E in this.tiles){let I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;let o=e.map(l.U.fromLngLat);this.tileID=function(p){let m=1/0,x=1/0,w=-1/0,E=-1/0;for(let F of p)m=Math.min(m,F.x),x=Math.min(x,F.y),w=Math.max(w,F.x),E=Math.max(E,F.y);let I=Math.max(w-m,E-x),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,A);return new l.W(A,Math.floor((m+w)/2*L),Math.floor((x+E)/2*L))}(o),this.minzoom=this.maxzoom=this.tileID.z;let c=o.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,l.N,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,l.N),this._boundsArray.emplaceBack(c[2].x,c[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}hasTransition(){return!1}}class na extends Qe{constructor(e,o,c,p){super(e,o,c,p),this.load=()=>{this._loaded=!1;let m=this.options;this.urls=[];for(let x of m.urls)this.urls.push(this.map._requestManager.transformRequest(x,qt.Source).url);l.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new l.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,x=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new je(m,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(let E in this.tiles){let I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=o}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Fo extends Qe{constructor(e,o,c,p){super(e,o,c,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new je(x,this.canvas,w.RGBA,{premultiply:!0});let E=!1;for(let I in this.tiles){let A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,E=!0)}E&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(x=>typeof x!="number"))||this.fire(new l.j(new l.Y(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let ba={},Oi=f=>{switch(f){case"geojson":return oo;case"image":return Qe;case"raster":return Ci;case"raster-dem":return Os;case"vector":return zn;case"video":return na;case"canvas":return Fo}return ba[f]};function Fs(f,e){let o=l.Z();return l.$(o,o,[1,1,0]),l.a0(o,o,[.5*f.width,.5*f.height,1]),l.a1(o,o,f.calculatePosMatrix(e.toUnwrapped()))}function Zr(f,e,o,c,p,m){let x=function(L,F,$){if(L)for(let Z of L){let H=F[Z];if(H&&H.source===$&&H.type==="fill-extrusion")return!0}else for(let Z in F){let H=F[Z];if(H.source===$&&H.type==="fill-extrusion")return!0}return!1}(p&&p.layers,e,f.id),w=m.maxPitchScaleFactor(),E=f.tilesIn(c,w,x);E.sort(Mo);let I=[];for(let L of E)I.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,o,f._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,p,m,w,Fs(f.transform,L.tileID))});let A=function(L){let F={},$={};for(let Z of L){let H=Z.queryResults,G=Z.wrappedTileID,ot=$[G]=$[G]||{};for(let dt in H){let K=H[dt],lt=ot[dt]=ot[dt]||{},mt=F[dt]=F[dt]||[];for(let gt of K)lt[gt.featureIndex]||(lt[gt.featureIndex]=!0,mt.push(gt))}}return F}(I);for(let L in A)A[L].forEach(F=>{let $=F.feature,Z=f.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=Z});return A}function Mo(f,e){let o=f.tileID,c=e.tileID;return o.overscaledZ-c.overscaledZ||o.canonical.y-c.canonical.y||o.wrap-c.wrap||o.canonical.x-c.canonical.x}class No{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a2(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,m){let x={};if(!m)return x;for(let w of p){let E=w.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(E.length!==0){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(I=>E.filter(A=>A.id===I)[0]));for(let I of E)x[I.id]=w}}return x}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(let p in this.buckets){let m=this.buckets[p];if(m instanceof l.a4){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let p in this.buckets){let m=this.buckets[p];if(m instanceof l.a4&&m.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(let p in this.buckets){let m=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let c in this.buckets){let p=this.buckets[c];p.uploadPending()&&p.upload(e)}let o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new je(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new je(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,c,p,m,x,w,E,I,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:m,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:w,queryPadding:this.queryPadding*I},e,o,c):{}}querySourceFeatures(e,o){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let p=c.loadVTLayers(),m=o&&o.sourceLayer?o.sourceLayer:"",x=p._geojsonTileLayer||p[m];if(!x)return;let w=l.a6(o&&o.filter),{z:E,x:I,y:A}=this.tileID.canonical,L={z:E,x:I,y:A};for(let F=0;F<x.length;F++){let $=x.feature(F);if(w.needGeometry){let G=l.a7($,!0);if(!w.filter(new l.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new l.a8(this.tileID.overscaledZ),$))continue;let Z=c.getId($,m),H=new l.a9($,E,I,A,Z);H.tile=L,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let o=this.expirationTime;if(e.cacheControl){let c=l.aa(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),p=!1;if(this.expirationTime>c)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{let m=this.expirationTime-o;m?this.expirationTime=c+Math.max(m,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let c=this.latestFeatureIndex.loadVTLayers();for(let p in this.buckets){if(!o.style.hasLayer(p))continue;let m=this.buckets[p],x=m.layers[0].sourceLayer||"_geojsonTileLayer",w=c[x],E=e[x];if(!w||!E||Object.keys(E).length===0)continue;m.update(E,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});let I=o&&o.style&&o.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=l.h.now()+e}setDependencies(e,o){let c={};for(let p of o)c[p]=!0;this.dependencies[e]=c}hasDependency(e,o){for(let c of e){let p=this.dependencies[c];if(p){for(let m of o)if(p[m])return!0}}return!1}}class ls{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(let e in this.data)for(let o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,c){let p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);let m={value:o,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},c)),this.data[p].push(m),this.order.push(p),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){let o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;let c=e.wrapped().key,p=o===void 0?0:this.data[c].indexOf(o),m=this.data[c][p];return this.data[c].splice(p,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){let o=[];for(let c in this.data)for(let p of this.data[c])e(p.value)||o.push(p);for(let c of o)this.remove(c.value.tileID,c)}}class _t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,c){let p=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},l.e(this.stateChanges[e][p],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==p&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(let m in this.state[e][p])c[m]||(this.deletedStates[e][p][m]=null)}else for(let m in c)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][m]===null&&delete this.deletedStates[e][p][m]}removeFeatureState(e,o,c){if(this.deletedStates[e]===null)return;let p=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&o!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][c]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(c in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][c]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,o){let c=String(o),p=l.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][o];if(m===null)return{};for(let x in m)delete p[x]}return p}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){let c={};for(let p in this.stateChanges){this.state[p]=this.state[p]||{};let m={};for(let x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),l.e(this.state[p][x],this.stateChanges[p][x]),m[x]=this.state[p][x];c[p]=m}for(let p in this.deletedStates){this.state[p]=this.state[p]||{};let m={};if(this.deletedStates[p]===null)for(let x in this.state[p])m[x]={},this.state[p][x]={};else for(let x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(let w of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][w];m[x]=this.state[p][x]}c[p]=c[p]||{},l.e(c[p],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let p in e)e[p].setFeatureState(c,o)}}class Vn extends l.E{constructor(e,o,c){super(),this.id=e,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,m,x,w)=>{let E=new(Oi(m.type))(p,m,x,w);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return E})(e,o,c,this),this._tiles={},this._cache=new ls(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o){return this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new l.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let c=this._tiles[o];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(fi).map(e=>e.key)}getRenderableIds(e){let o=[];for(let c in this._tiles)this._isIdRenderable(c,e)&&o.push(this._tiles[c]);return e?o.sort((c,p)=>{let m=c.tileID,x=p.tileID,w=new l.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-x.overscaledZ||E.y-w.y||E.x-w.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(fi).map(c=>c.key)}hasRenderableParent(e){let o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,e,o)))}_tileLoaded(e,o,c,p){if(p)return e.state="errored",void(p.status!==404?this._source.fire(new l.j(p,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=l.h.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let o=this.getRenderableIds();for(let p=0;p<o.length;p++){let m=o[p];if(e.neighboringTiles&&e.neighboringTiles[m]){let x=this.getTileByID(m);c(e,x),c(x,e)}}function c(p,m){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=m.tileID.canonical.x-p.tileID.canonical.x,w=m.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),I=m.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),m.dem&&p.dem&&(p.dem.backfillBorder(m.dem,x,w),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,c,p){for(let m in this._tiles){let x=this._tiles[m];if(p[m]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>c)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){let I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(w=I)}let E=w;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){p[w.key]=w;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){let c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=e.overscaledZ-1;c>=o;c--){let p=e.scaledTo(c),m=this._getLoadedTile(p);if(m)return m}}_getLoadedTile(e){let o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let o=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(o*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(m)}handleWrapJump(e){let o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){let c={};for(let p in this._tiles){let m=this._tiles[p];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),c[m.tileID.key]=m}this._tiles=c;for(let p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(let p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(e,o){if(this.transform=e,this.terrain=o,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new l.O(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(c=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(c=c.filter(A=>this._source.hasTile(A)))):c=[];let p=e.coveringZoomLevel(this._source),m=Math.max(p-Vn.maxOverzooming,this._source.minzoom),x=Math.max(p+Vn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let A={};for(let L of c)if(L.canonical.z>this._source.minzoom){let F=L.scaledTo(L.canonical.z-1);A[F.key]=F;let $=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));A[$.key]=$}c=c.concat(Object.values(A))}let w=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let E=this._updateRetainedTiles(c,p);if(ar(this._source.type)){let A={},L={},F=Object.keys(E),$=l.h.now();for(let Z of F){let H=E[Z],G=this._tiles[Z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=$)continue;let ot=this.findLoadedParent(H,m);ot&&(this._addTile(ot.tileID),A[ot.tileID.key]=ot.tileID),L[Z]=H}this._retainLoadedChildren(L,p,x,E);for(let Z in A)E[Z]||(this._coveredTiles[Z]=!0,E[Z]=A[Z]);if(o){let Z={},H={};for(let G of c)this._tiles[G.key].hasData()?Z[G.key]=G:H[G.key]=G;for(let G in H){let ot=H[G].children(this._source.maxzoom);this._tiles[ot[0].key]&&this._tiles[ot[1].key]&&this._tiles[ot[2].key]&&this._tiles[ot[3].key]&&(Z[ot[0].key]=E[ot[0].key]=ot[0],Z[ot[1].key]=E[ot[1].key]=ot[1],Z[ot[2].key]=E[ot[2].key]=ot[2],Z[ot[3].key]=E[ot[3].key]=ot[3],delete H[G])}for(let G in H){let ot=this.findLoadedParent(H[G],this._source.minzoom);if(ot){Z[ot.tileID.key]=E[ot.tileID.key]=ot.tileID;for(let dt in Z)Z[dt].isChildOf(ot.tileID)&&delete Z[dt]}}for(let G in this._tiles)Z[G]||(this._coveredTiles[G]=!0)}}for(let A in E)this._tiles[A].clearFadeHold();let I=l.ab(this._tiles,E);for(let A of I){let L=this._tiles[A];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){let c={},p={},m=Math.max(o-Vn.maxOverzooming,this._source.minzoom),x=Math.max(o+Vn.maxUnderzooming,this._source.minzoom),w={};for(let E of e){let I=this._addTile(E);c[E.key]=E,I.hasData()||o<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,o,x,c);for(let E of e){let I=this._tiles[E.key];if(I.hasData())continue;if(o+1>this._source.maxzoom){let L=E.children(this._source.maxzoom)[0],F=this.getTile(L);if(F&&F.hasData()){c[L.key]=L;continue}}else{let L=E.children(this._source.maxzoom);if(c[L[0].key]&&c[L[1].key]&&c[L[2].key]&&c[L[3].key])continue}let A=I.wasRequested();for(let L=E.overscaledZ-1;L>=m;--L){let F=E.scaledTo(L);if(p[F.key])break;if(p[F.key]=!0,I=this.getTile(F),!I&&A&&(I=this._addTile(F)),I){let $=I.hasData();if((A||$)&&(c[F.key]=F),A=I.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let o=[],c,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}o.push(p.key);let m=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;p=m}for(let m of o)this._loadedParentTiles[m]=c}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));let c=o;return o||(o=new No(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))),o.uses++,this._tiles[e.key]=o,c||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let c=o.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){let o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,c){let p=[],m=this.transform;if(!m)return p;let x=c?m.getCameraQueryGeometry(e):e,w=e.map(Z=>m.pointCoordinate(Z,this.terrain)),E=x.map(Z=>m.pointCoordinate(Z,this.terrain)),I=this.getIds(),A=1/0,L=1/0,F=-1/0,$=-1/0;for(let Z of E)A=Math.min(A,Z.x),L=Math.min(L,Z.y),F=Math.max(F,Z.x),$=Math.max($,Z.y);for(let Z=0;Z<I.length;Z++){let H=this._tiles[I[Z]];if(H.holdingForFade())continue;let G=H.tileID,ot=Math.pow(2,m.zoom-H.tileID.overscaledZ),dt=o*H.queryPadding*l.N/H.tileSize/ot,K=[G.getTilePoint(new l.U(A,L)),G.getTilePoint(new l.U(F,$))];if(K[0].x-dt<l.N&&K[0].y-dt<l.N&&K[1].x+dt>=0&&K[1].y+dt>=0){let lt=w.map(gt=>G.getTilePoint(gt)),mt=E.map(gt=>G.getTilePoint(gt));p.push({tile:H,tileID:G,queryGeometry:lt,cameraQueryGeometry:mt,scale:ot})}}return p}getVisibleCoordinates(e){let o=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(let c of o)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ar(this._source.type)){let e=l.h.now();for(let o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,c){this._state.updateState(e=e||"_geojsonTileLayer",o,c)}removeFeatureState(e,o,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,c)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,c){let p=this._tiles[e];p&&p.setDependencies(o,c)}reloadTilesForDependencies(e,o){for(let c in this._tiles)this._tiles[c].hasDependency(e,o)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(e,o))}}function fi(f,e){let o=Math.abs(2*f.wrap)-+(f.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||c-o||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function ar(f){return f==="raster"||f==="image"||f==="video"}Vn.maxOverzooming=10,Vn.maxUnderzooming=3;let Ze="mapboxgl_preloaded_worker_pool";class ji{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ji.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}let ho=Math.floor(l.h.hardwareConcurrency/2),Zi;function ia(){return Zi||(Zi=new ji),Zi}ji.workerCount=l.ac(globalThis)?Math.max(Math.min(ho,3),1):1;class us{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ad(e,0,1);let o=1,c=this._distances[o],p=e*this.paddedLength+this.padding;for(;c<p&&o<this._distances.length;)c=this._distances[++o];let m=o-1,x=this._distances[m],w=c-x,E=w>0?(p-x)/w:0;return this.points[m].mult(1-E).add(this.points[o].mult(E))}}function Xi(f,e){let o=!0;return f==="always"||f!=="never"&&e!=="never"||(o=!1),o}class Do{constructor(e,o,c){let p=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(o/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,c,p,m){this._forEachCell(o,c,p,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m)}insertCircle(e,o,c,p){this._forEachCell(o-p,c-p,o+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(c),this.circles.push(p)}_insertBoxCell(e,o,c,p,m,x){this.boxCells[m].push(x)}_insertCircleCell(e,o,c,p,m,x){this.circleCells[m].push(x)}_query(e,o,c,p,m,x,w){if(c<0||e>this.width||p<0||o>this.height)return[];let E=[];if(e<=0&&o<=0&&this.width<=c&&this.height<=p){if(m)return[{key:null,x1:e,y1:o,x2:c,y2:p}];for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let A=this.circles[3*I],L=this.circles[3*I+1],F=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:A-F,y1:L-F,x2:A+F,y2:L+F})}}else this._forEachCell(e,o,c,p,this._queryCell,E,{hitTest:m,overlapMode:x,seenUids:{box:{},circle:{}}},w);return E}query(e,o,c,p){return this._query(e,o,c,p,!1,null)}hitTest(e,o,c,p,m,x){return this._query(e,o,c,p,!0,m,x).length>0}hitTestCircle(e,o,c,p,m){let x=e-c,w=e+c,E=o-c,I=o+c;if(w<0||x>this.width||I<0||E>this.height)return!1;let A=[];return this._forEachCell(x,E,w,I,this._queryCellCircle,A,{hitTest:!0,overlapMode:p,circle:{x:e,y:o,radius:c},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(e,o,c,p,m,x,w,E){let{seenUids:I,hitTest:A,overlapMode:L}=w,F=this.boxCells[m];if(F!==null){let Z=this.bboxes;for(let H of F)if(!I.box[H]){I.box[H]=!0;let G=4*H,ot=this.boxKeys[H];if(e<=Z[G+2]&&o<=Z[G+3]&&c>=Z[G+0]&&p>=Z[G+1]&&(!E||E(ot))&&(!A||!Xi(L,ot.overlapMode))&&(x.push({key:ot,x1:Z[G],y1:Z[G+1],x2:Z[G+2],y2:Z[G+3]}),A))return!0}}let $=this.circleCells[m];if($!==null){let Z=this.circles;for(let H of $)if(!I.circle[H]){I.circle[H]=!0;let G=3*H,ot=this.circleKeys[H];if(this._circleAndRectCollide(Z[G],Z[G+1],Z[G+2],e,o,c,p)&&(!E||E(ot))&&(!A||!Xi(L,ot.overlapMode))){let dt=Z[G],K=Z[G+1],lt=Z[G+2];if(x.push({key:ot,x1:dt-lt,y1:K-lt,x2:dt+lt,y2:K+lt}),A)return!0}}}return!1}_queryCellCircle(e,o,c,p,m,x,w,E){let{circle:I,seenUids:A,overlapMode:L}=w,F=this.boxCells[m];if(F!==null){let Z=this.bboxes;for(let H of F)if(!A.box[H]){A.box[H]=!0;let G=4*H,ot=this.boxKeys[H];if(this._circleAndRectCollide(I.x,I.y,I.radius,Z[G+0],Z[G+1],Z[G+2],Z[G+3])&&(!E||E(ot))&&!Xi(L,ot.overlapMode))return x.push(!0),!0}}let $=this.circleCells[m];if($!==null){let Z=this.circles;for(let H of $)if(!A.circle[H]){A.circle[H]=!0;let G=3*H,ot=this.circleKeys[H];if(this._circlesCollide(Z[G],Z[G+1],Z[G+2],I.x,I.y,I.radius)&&(!E||E(ot))&&!Xi(L,ot.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,c,p,m,x,w,E){let I=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),L=this._convertToXCellCoord(c),F=this._convertToYCellCoord(p);for(let $=I;$<=L;$++)for(let Z=A;Z<=F;Z++)if(m.call(this,e,o,c,p,this.xCellCount*Z+$,x,w,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,c,p,m,x){let w=p-e,E=m-o,I=c+x;return I*I>w*w+E*E}_circleAndRectCollide(e,o,c,p,m,x,w){let E=(x-p)/2,I=Math.abs(e-(p+E));if(I>E+c)return!1;let A=(w-m)/2,L=Math.abs(o-(m+A));if(L>A+c)return!1;if(I<=E||L<=A)return!0;let F=I-E,$=L-A;return F*F+$*$<=c*c}}function Ot(f,e,o,c,p){let m=l.Z();return e?(l.a0(m,m,[1/p,1/p,1]),o||l.ae(m,m,c.angle)):l.a1(m,c.labelPlaneMatrix,f),m}function Pi(f,e,o,c,p){if(e){let m=l.af(f);return l.a0(m,m,[p,p,1]),o||l.ae(m,m,-c.angle),m}return c.glCoordMatrix}function Cr(f,e,o){let c;o?(c=[f.x,f.y,o(f.x,f.y),1],l.ag(c,c,e)):(c=[f.x,f.y,0,1],Y(c,c,e));let p=c[3];return{point:new l.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function cs(f,e){return .5+f/e*.5}function Ai(f,e){let o=f[0]/f[3],c=f[1]/f[3];return o>=-e[0]&&o<=e[0]&&c>=-e[1]&&c<=e[1]}function Nt(f,e,o,c,p,m,x,w,E,I){let A=c?f.textSizeData:f.iconSizeData,L=l.ah(A,o.transform.zoom),F=[256/o.width*2+1,256/o.height*2+1],$=c?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();let Z=f.lineVertexArray,H=c?f.text.placedSymbolArray:f.icon.placedSymbolArray,G=o.transform.width/o.transform.height,ot=!1;for(let dt=0;dt<H.length;dt++){let K=H.get(dt);if(K.hidden||K.writingMode===l.ai.vertical&&!ot){j(K.numGlyphs,$);continue}let lt;if(ot=!1,I?(lt=[K.anchorX,K.anchorY,I(K.anchorX,K.anchorY),1],l.ag(lt,lt,e)):(lt=[K.anchorX,K.anchorY,0,1],Y(lt,lt,e)),!Ai(lt,F)){j(K.numGlyphs,$);continue}let mt=cs(o.transform.cameraToCenterDistance,lt[3]),gt=l.aj(A,L,K),St=x?gt/mt:gt*mt,Mt=new l.P(K.anchorX,K.anchorY),Ct=Cr(Mt,p,I).point,zt={projections:{},offsets:{}},te=bn(K,St,!1,w,e,p,m,f.glyphOffsetArray,Z,$,Ct,Mt,zt,G,E,I);ot=te.useVertical,(te.notEnoughRoom||ot||te.needsFlipping&&bn(K,St,!0,w,e,p,m,f.glyphOffsetArray,Z,$,Ct,Mt,zt,G,E,I).notEnoughRoom)&&j(K.numGlyphs,$)}c?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function Se(f,e,o,c,p,m,x,w,E,I,A,L,F){let $=w.glyphStartIndex+w.numGlyphs,Z=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,G=e.getoffsetX(w.glyphStartIndex),ot=e.getoffsetX($-1),dt=k(f*G,o,c,p,m,x,w.segment,Z,H,E,I,A,L,F);if(!dt)return null;let K=k(f*ot,o,c,p,m,x,w.segment,Z,H,E,I,A,L,F);return K?{first:dt,last:K}:null}function ge(f,e,o,c){return f===l.ai.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*c?{useVertical:!0}:(f===l.ai.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function bn(f,e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H){let G=e/24,ot=f.lineOffsetX*G,dt=f.lineOffsetY*G,K;if(f.numGlyphs>1){let lt=f.glyphStartIndex+f.numGlyphs,mt=f.lineStartIndex,gt=f.lineStartIndex+f.lineLength,St=Se(G,w,ot,dt,o,A,L,f,E,m,F,Z,H);if(!St)return{notEnoughRoom:!0};let Mt=Cr(St.first.point,x,H).point,Ct=Cr(St.last.point,x,H).point;if(c&&!o){let zt=ge(f.writingMode,Mt,Ct,$);if(zt)return zt}K=[St.first];for(let zt=f.glyphStartIndex+1;zt<lt-1;zt++)K.push(k(G*w.getoffsetX(zt),ot,dt,o,A,L,f.segment,mt,gt,E,m,F,Z,H));K.push(St.last)}else{if(c&&!o){let mt=Cr(L,p,H).point,gt=f.lineStartIndex+f.segment+1,St=new l.P(E.getx(gt),E.gety(gt)),Mt=Cr(St,p,H),Ct=Mt.signedDistanceFromCamera>0?Mt.point:Li(L,St,mt,1,p,H),zt=ge(f.writingMode,mt,Ct,$);if(zt)return zt}let lt=k(G*w.getoffsetX(f.glyphStartIndex),ot,dt,o,A,L,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,E,m,F,Z,H);if(!lt)return{notEnoughRoom:!0};K=[lt]}for(let lt of K)l.ak(I,lt.point,lt.angle);return{}}function Li(f,e,o,c,p,m){let x=Cr(f.add(f.sub(e)._unit()),p,m).point,w=o.sub(x);return o.add(w._mult(c/w.mag()))}function ye(f,e){let{projectionCache:o,lineVertexArray:c,labelPlaneMatrix:p,tileAnchorPoint:m,distanceFromAnchor:x,getElevation:w,previousVertex:E,direction:I,absOffsetX:A}=e;if(o.projections[f])return o.projections[f];let L=new l.P(c.getx(f),c.gety(f)),F=Cr(L,p,w);if(F.signedDistanceFromCamera>0)return o.projections[f]=F.point,F.point;let $=f-I;return Li(x===0?m:new l.P(c.getx($),c.gety($)),L,E,A-x+1,p,w)}function Gi(f,e,o){return f._unit()._perp()._mult(e*o)}function X(f,e,o,c,p,m,x,w){let{projectionCache:E,direction:I}=w;if(E.offsets[f])return E.offsets[f];let A=o.add(e);if(f+I<c||f+I>=p)return E.offsets[f]=A,A;let L=ye(f+I,w),F=Gi(L.sub(o),x,I),$=o.add(F),Z=L.add(F);return E.offsets[f]=l.al(m,A,$,Z)||A,E.offsets[f]}function k(f,e,o,c,p,m,x,w,E,I,A,L,F,$){let Z=c?f-e:f+e,H=Z>0?1:-1,G=0;c&&(H*=-1,G=Math.PI),H<0&&(G+=Math.PI);let ot,dt,K=H>0?w+x:w+x+1,lt=p,mt=p,gt=0,St=0,Mt=Math.abs(Z),Ct=[],zt;for(;gt+St<=Mt;){if(K+=H,K<w||K>=E)return null;gt+=St,mt=lt,dt=ot;let Ut={projectionCache:L,lineVertexArray:I,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:gt,getElevation:$,previousVertex:mt,direction:H,absOffsetX:Mt};if(lt=ye(K,Ut),o===0)Ct.push(mt),zt=lt.sub(mt);else{let pe,re=lt.sub(mt);pe=re.mag()===0?Gi(ye(K+H,Ut).sub(lt),o,H):Gi(re,o,H),dt||(dt=mt.add(pe)),ot=X(K,pe,lt,w,E,dt,o,Ut),Ct.push(dt),zt=ot.sub(dt)}St=zt.mag()}let te=zt._mult((Mt-gt)/St)._add(dt||mt),ze=G+Math.atan2(lt.y-mt.y,lt.x-mt.x);return Ct.push(te),{point:te,angle:F?ze:0,path:Ct}}let O=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function j(f,e){for(let o=0;o<f;o++){let c=e.length;e.resize(c+4),e.float32.set(O,3*c)}}function Y(f,e,o){let c=e[0],p=e[1];return f[0]=o[0]*c+o[4]*p+o[12],f[1]=o[1]*c+o[5]*p+o[13],f[3]=o[3]*c+o[7]*p+o[15],f}let J=100;class ht{constructor(e,o=new Do(e.width+200,e.height+200,25),c=new Do(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=c,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+J,this.screenBottomBoundary=e.height+J,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,c,p,m,x){let w=this.projectAndGetPerspectiveRatio(p,e.anchorPointX,e.anchorPointY,x),E=c*w.perspectiveRatio,I=e.x1*E+w.point.x,A=e.y1*E+w.point.y,L=e.x2*E+w.point.x,F=e.y2*E+w.point.y;return!this.isInsideGrid(I,A,L,F)||o!=="always"&&this.grid.hitTest(I,A,L,F,o,m)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,A,L,F],offscreen:this.isOffscreen(I,A,L,F)}}placeCollisionCircles(e,o,c,p,m,x,w,E,I,A,L,F,$,Z){let H=[],G=new l.P(o.anchorX,o.anchorY),ot=Cr(G,x,Z),dt=cs(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),K=(A?m/dt:m*dt)/l.ap,lt=Cr(G,w,Z).point,mt=Se(K,p,o.lineOffsetX*K,o.lineOffsetY*K,!1,lt,G,o,c,w,{projections:{},offsets:{}},!1,Z),gt=!1,St=!1,Mt=!0;if(mt){let Ct=.5*F*dt+$,zt=new l.P(-100,-100),te=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new us,Ut=mt.first,pe=mt.last,re=[];for(let Te=Ut.path.length-1;Te>=1;Te--)re.push(Ut.path[Te]);for(let Te=1;Te<pe.path.length;Te++)re.push(pe.path[Te]);let or=2.5*Ct;if(E){let Te=re.map(Re=>Cr(Re,E,Z));re=Te.some(Re=>Re.signedDistanceFromCamera<=0)?[]:Te.map(Re=>Re.point)}let De=[];if(re.length>0){let Te=re[0].clone(),Re=re[0].clone();for(let Rr=1;Rr<re.length;Rr++)Te.x=Math.min(Te.x,re[Rr].x),Te.y=Math.min(Te.y,re[Rr].y),Re.x=Math.max(Re.x,re[Rr].x),Re.y=Math.max(Re.y,re[Rr].y);De=Te.x>=zt.x&&Re.x<=te.x&&Te.y>=zt.y&&Re.y<=te.y?[re]:Re.x<zt.x||Te.x>te.x||Re.y<zt.y||Te.y>te.y?[]:l.am([re],zt.x,zt.y,te.x,te.y)}for(let Te of De){ze.reset(Te,.25*Ct);let Re=0;Re=ze.length<=.5*Ct?1:Math.ceil(ze.paddedLength/or)+1;for(let Rr=0;Rr<Re;Rr++){let pr=Rr/Math.max(Re-1,1),yn=ze.lerp(pr),Qr=yn.x+J,jr=yn.y+J;H.push(Qr,jr,Ct,0);let vi=Qr-Ct,_r=jr-Ct,vo=Qr+Ct,xo=jr+Ct;if(Mt=Mt&&this.isOffscreen(vi,_r,vo,xo),St=St||this.isInsideGrid(vi,_r,vo,xo),e!=="always"&&this.grid.hitTestCircle(Qr,jr,Ct,e,L)&&(gt=!0,!I))return{circles:[],offscreen:!1,collisionDetected:gt}}}}return{circles:!I&&gt||!St||dt<this.perspectiveRatioCutoff?[]:H,offscreen:Mt,collisionDetected:gt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],c=1/0,p=1/0,m=-1/0,x=-1/0;for(let A of e){let L=new l.P(A.x+J,A.y+J);c=Math.min(c,L.x),p=Math.min(p,L.y),m=Math.max(m,L.x),x=Math.max(x,L.y),o.push(L)}let w=this.grid.query(c,p,m,x).concat(this.ignoredGrid.query(c,p,m,x)),E={},I={};for(let A of w){let L=A.key;if(E[L.bucketInstanceId]===void 0&&(E[L.bucketInstanceId]={}),E[L.bucketInstanceId][L.featureIndex])continue;let F=[new l.P(A.x1,A.y1),new l.P(A.x2,A.y1),new l.P(A.x2,A.y2),new l.P(A.x1,A.y2)];l.an(o,F)&&(E[L.bucketInstanceId][L.featureIndex]=!0,I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]=[]),I[L.bucketInstanceId].push(L.featureIndex))}return I}insertCollisionBox(e,o,c,p,m,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:m,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,c,p,m,x){let w=c?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:m,collisionGroupID:x,overlapMode:o};for(let I=0;I<e.length;I+=4)w.insertCircle(E,e[I],e[I+1],e[I+2])}projectAndGetPerspectiveRatio(e,o,c,p){let m;return p?(m=[o,c,p(o,c),1],l.ag(m,m,e)):(m=[o,c,0,1],Y(m,m,e)),{point:new l.P((m[0]/m[3]+1)/2*this.transform.width+J,(-m[1]/m[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(e,o,c,p){return c<J||e>=this.screenRightBoundary||p<J||o>this.screenBottomBoundary}isInsideGrid(e,o,c,p){return c>=0&&e<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let e=l.ao([]);return l.$(e,e,[-100,-100,0]),e}}function nt(f,e,o){return e*(l.N/(f.tileSize*Math.pow(2,o-f.tileID.overscaledZ)))}class tt{constructor(e,o,c,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class it{constructor(e,o,c,p,m){this.text=new tt(e?e.text:null,o,c,m),this.icon=new tt(e?e.icon:null,o,p,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bt{constructor(e,o,c){this.text=e,this.icon=o,this.skipFade=c}}class wt{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Tt{constructor(e,o,c,p,m){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=m}}class oe{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:c=>c.collisionGroupID===o}}return this.collisionGroups[e]}}function me(f,e,o,c,p){let{horizontalAlign:m,verticalAlign:x}=l.au(f);return new l.P(-(m-.5)*e+c[0]*p,-(x-.5)*o+c[1]*p)}function Kt(f,e,o,c,p,m){let{x1:x,x2:w,y1:E,y2:I,anchorPointX:A,anchorPointY:L}=f,F=new l.P(e,o);return c&&F._rotate(p?m:-m),{x1:x+F.x,y1:E+F.y,x2:w+F.x,y2:I+F.y,anchorPointX:A,anchorPointY:L}}class ae{constructor(e,o,c,p,m){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new oe(p),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,o,c,p){let m=c.getBucket(o),x=c.latestFeatureIndex;if(!m||!x||o.id!==m.layerIds[0])return;let w=c.collisionBoxArray,E=m.layers[0].layout,I=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),A=c.tileSize/l.N,L=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),F=E.get("text-pitch-alignment")==="map",$=E.get("text-rotation-alignment")==="map",Z=nt(c,1,this.transform.zoom),H=Ot(L,F,$,this.transform,Z),G=null;if(F){let dt=Pi(L,F,$,this.transform,Z);G=l.a1([],this.transform.labelPlaneMatrix,dt)}this.retainedQueryData[m.bucketInstanceId]=new Tt(m.bucketInstanceId,x,m.sourceLayerIndex,m.index,c.tileID);let ot={bucket:m,layout:E,posMatrix:L,textLabelPlaneMatrix:H,labelToScreenMatrix:G,scale:I,textPixelRatio:A,holdingForFade:c.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:l.ah(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(p)for(let dt of m.sortKeyRanges){let{sortKey:K,symbolInstanceStart:lt,symbolInstanceEnd:mt}=dt;e.push({sortKey:K,symbolInstanceStart:lt,symbolInstanceEnd:mt,parameters:ot})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H,G){let ot=l.aq[e.textAnchor],dt=[e.textOffset0,e.textOffset1],K=me(ot,c,p,dt,m),lt=this.collisionIndex.placeCollisionBox(Kt(o,K.x,K.y,x,w,this.transform.angle),L,E,I,A.predicate,G);if((!H||this.collisionIndex.placeCollisionBox(Kt(H,K.x,K.y,x,w,this.transform.angle),L,E,I,A.predicate,G).box.length!==0)&&lt.box.length>0){let mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:dt,width:c,height:p,anchor:ot,textBoxScale:m,prevAnchor:mt},this.markUsedJustification($,ot,F,Z),$.allowVerticalPlacement&&(this.markUsedOrientation($,Z,F),this.placedOrientations[F.crossTileID]=Z),{shift:K,placedGlyphBoxes:lt}}}placeLayerBucketPart(e,o,c){let{bucket:p,layout:m,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:E,textPixelRatio:I,holdingForFade:A,collisionBoxArray:L,partiallyEvaluatedTextSize:F,collisionGroup:$}=e.parameters,Z=m.get("text-optional"),H=m.get("icon-optional"),G=l.ar(m,"text-overlap","text-allow-overlap"),ot=G==="always",dt=l.ar(m,"icon-overlap","icon-allow-overlap"),K=dt==="always",lt=m.get("text-rotation-alignment")==="map",mt=m.get("text-pitch-alignment")==="map",gt=m.get("icon-text-fit")!=="none",St=m.get("symbol-z-order")==="viewport-y",Mt=ot&&(K||!p.hasIconData()||H),Ct=K&&(ot||!p.hasTextData()||Z);!p.collisionArrays&&L&&p.deserializeCollisionBoxes(L);let zt=this.retainedQueryData[p.bucketInstanceId].tileID,te=this.terrain?(Ut,pe)=>this.terrain.getElevation(zt,Ut,pe):null,ze=(Ut,pe)=>{var re,or;if(o[Ut.crossTileID])return;if(A)return void(this.placements[Ut.crossTileID]=new bt(!1,!1,!1));let De=!1,Te=!1,Re=!0,Rr=null,pr={box:null,offscreen:null},yn={box:null,offscreen:null},Qr=null,jr=null,vi=null,_r=0,vo=0,xo=0;pe.textFeatureIndex?_r=pe.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(_r=Ut.featureIndex),pe.verticalTextFeatureIndex&&(vo=pe.verticalTextFeatureIndex);let gs=pe.textBox;if(gs){let In=Or=>{let tn=l.ai.horizontal;if(p.allowVerticalPlacement&&!Or&&this.prevPlacement){let oi=this.prevPlacement.placedOrientations[Ut.crossTileID];oi&&(this.placedOrientations[Ut.crossTileID]=oi,tn=oi,this.markUsedOrientation(p,tn,Ut))}return tn},_n=(Or,tn)=>{if(p.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&pe.verticalTextBox){for(let oi of p.writingModes)if(oi===l.ai.vertical?(pr=tn(),yn=pr):pr=Or(),pr&&pr.box&&pr.box.length)break}else pr=Or()},Zn=Ut.textAnchorOffsetStartIndex,Zs=Ut.textAnchorOffsetEndIndex;if(Zs===Zn){let Or=(tn,oi)=>{let Fr=this.collisionIndex.placeCollisionBox(tn,G,I,x,$.predicate,te);return Fr&&Fr.box&&Fr.box.length&&(this.markUsedOrientation(p,oi,Ut),this.placedOrientations[Ut.crossTileID]=oi),Fr};_n(()=>Or(gs,l.ai.horizontal),()=>{let tn=pe.verticalTextBox;return p.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&tn?Or(tn,l.ai.vertical):{box:null,offscreen:null}}),In(pr&&pr.box&&pr.box.length)}else{let Or=l.aq[(or=(re=this.prevPlacement)===null||re===void 0?void 0:re.variableOffsets[Ut.crossTileID])===null||or===void 0?void 0:or.anchor],tn=(Fr,Xs,Pu)=>{let cp=Fr.x2-Fr.x1,hp=Fr.y2-Fr.y1,yd=Ut.textBoxScale,qc=gt&&dt==="never"?Xs:null,bo={box:[],offscreen:!1},Hs=G==="never"?1:2,wo="never";Or&&Hs++;for(let Bi=0;Bi<Hs;Bi++){for(let So=Zn;So<Zs;So++){let $c=p.textAnchorOffsets.get(So);if(Or&&$c.textAnchor!==Or)continue;let jo=this.attemptAnchorPlacement($c,Fr,cp,hp,yd,lt,mt,I,x,$,wo,Ut,p,Pu,qc,te);if(jo&&(bo=jo.placedGlyphBoxes,bo&&bo.box&&bo.box.length))return De=!0,Rr=jo.shift,bo}Or?Or=null:wo=G}return bo};_n(()=>tn(gs,pe.iconBox,l.ai.horizontal),()=>{let Fr=pe.verticalTextBox;return p.allowVerticalPlacement&&!(pr&&pr.box&&pr.box.length)&&Ut.numVerticalGlyphVertices>0&&Fr?tn(Fr,pe.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),pr&&(De=pr.box,Re=pr.offscreen);let oi=In(pr&&pr.box);if(!De&&this.prevPlacement){let Fr=this.prevPlacement.variableOffsets[Ut.crossTileID];Fr&&(this.variableOffsets[Ut.crossTileID]=Fr,this.markUsedJustification(p,Fr.anchor,Ut,oi))}}}if(Qr=pr,De=Qr&&Qr.box&&Qr.box.length>0,Re=Qr&&Qr.offscreen,Ut.useRuntimeCollisionCircles){let In=p.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),_n=l.aj(p.textSizeData,F,In),Zn=m.get("text-padding");jr=this.collisionIndex.placeCollisionCircles(G,In,p.lineVertexArray,p.glyphOffsetArray,_n,x,w,E,c,mt,$.predicate,Ut.collisionCircleDiameter,Zn,te),jr.circles.length&&jr.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),De=ot||jr.circles.length>0&&!jr.collisionDetected,Re=Re&&jr.offscreen}if(pe.iconFeatureIndex&&(xo=pe.iconFeatureIndex),pe.iconBox){let In=_n=>{let Zn=gt&&Rr?Kt(_n,Rr.x,Rr.y,lt,mt,this.transform.angle):_n;return this.collisionIndex.placeCollisionBox(Zn,dt,I,x,$.predicate,te)};yn&&yn.box&&yn.box.length&&pe.verticalIconBox?(vi=In(pe.verticalIconBox),Te=vi.box.length>0):(vi=In(pe.iconBox),Te=vi.box.length>0),Re=Re&&vi.offscreen}let $s=Z||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Pa=H||Ut.numIconVertices===0;if($s||Pa?Pa?$s||(Te=Te&&De):De=Te&&De:Te=De=Te&&De,De&&Qr&&Qr.box&&this.collisionIndex.insertCollisionBox(Qr.box,G,m.get("text-ignore-placement"),p.bucketInstanceId,yn&&yn.box&&vo?vo:_r,$.ID),Te&&vi&&this.collisionIndex.insertCollisionBox(vi.box,dt,m.get("icon-ignore-placement"),p.bucketInstanceId,xo,$.ID),jr&&(De&&this.collisionIndex.insertCollisionCircles(jr.circles,G,m.get("text-ignore-placement"),p.bucketInstanceId,_r,$.ID),c)){let In=p.bucketInstanceId,_n=this.collisionCircleArrays[In];_n===void 0&&(_n=this.collisionCircleArrays[In]=new wt);for(let Zn=0;Zn<jr.circles.length;Zn+=4)_n.circles.push(jr.circles[Zn+0]),_n.circles.push(jr.circles[Zn+1]),_n.circles.push(jr.circles[Zn+2]),_n.circles.push(jr.collisionDetected?1:0)}if(Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new bt(De||Mt,Te||Ct,Re||p.justReloaded),o[Ut.crossTileID]=!0};if(St){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=p.getSortedSymbolIndexes(this.transform.angle);for(let pe=Ut.length-1;pe>=0;--pe){let re=Ut[pe];ze(p.symbolInstances.get(re),p.collisionArrays[re])}}else for(let Ut=e.symbolInstanceStart;Ut<e.symbolInstanceEnd;Ut++)ze(p.symbolInstances.get(Ut),p.collisionArrays[Ut]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){let Ut=this.collisionCircleArrays[p.bucketInstanceId];l.as(Ut.invProjMatrix,x),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(e,o,c,p){let m;m=p===l.ai.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.at(o)];let x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(let w of x)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=m>=0&&w!==m?0:c.crossTileID)}markUsedOrientation(e,o,c){let p=o===l.ai.horizontal||o===l.ai.horizontalOnly?o:0,m=o===l.ai.vertical?o:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(let w of x)e.text.placedSymbolArray.get(w).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,c=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let p=o?o.symbolFadeChange(e):1,m=o?o.opacities:{},x=o?o.variableOffsets:{},w=o?o.placedOrientations:{};for(let E in this.placements){let I=this.placements[E],A=m[E];A?(this.opacities[E]=new it(A,p,I.text,I.icon),c=c||I.text!==A.text.placed||I.icon!==A.icon.placed):(this.opacities[E]=new it(null,p,I.text,I.icon,I.skipFade),c=c||I.text||I.icon)}for(let E in m){let I=m[E];if(!this.opacities[E]){let A=new it(I,p,!1,!1);A.isHidden()||(this.opacities[E]=A,c=c||I.text.placed||I.icon.placed)}}for(let E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(let E in w)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=w[E]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){let c={};for(let p of o){let m=p.getBucket(e);m&&p.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,c,p.collisionBoxArray)}}updateBucketOpacities(e,o,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let p=e.layers[0],m=p.layout,x=new it(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),I=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=m.get("text-rotation-alignment")==="map",L=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",$=new it(null,0,w&&(E||!e.hasIconData()||m.get("icon-optional")),E&&(w||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);let Z=(H,G,ot)=>{for(let dt=0;dt<G/4;dt++)H.opacityVertexArray.emplaceBack(ot);H.hasVisibleVertices=H.hasVisibleVertices||ot!==mi};for(let H=0;H<e.symbolInstances.length;H++){let G=e.symbolInstances.get(H),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:dt,crossTileID:K}=G,lt=this.opacities[K];o[K]?lt=x:lt||(lt=$,this.opacities[K]=lt),o[K]=!0;let mt=G.numIconVertices>0,gt=this.placedOrientations[G.crossTileID],St=gt===l.ai.vertical,Mt=gt===l.ai.horizontal||gt===l.ai.horizontalOnly;if(ot>0||dt>0){let Ct=Kr(lt.text);Z(e.text,ot,St?mi:Ct),Z(e.text,dt,Mt?mi:Ct);let zt=lt.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(e.text.placedSymbolArray.get(Ut).hidden=zt||St?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=zt||Mt?1:0);let te=this.variableOffsets[G.crossTileID];te&&this.markUsedJustification(e,te.anchor,G,gt);let ze=this.placedOrientations[G.crossTileID];ze&&(this.markUsedJustification(e,"left",G,ze),this.markUsedOrientation(e,ze,G))}if(mt){let Ct=Kr(lt.icon),zt=!(F&&G.verticalPlacedIconSymbolIndex&&St);G.placedIconSymbolIndex>=0&&(Z(e.icon,G.numIconVertices,zt?Ct:mi),e.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=lt.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(Z(e.icon,G.numVerticalIconVertices,zt?mi:Ct),e.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=lt.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Ct=e.collisionArrays[H];if(Ct){let zt=new l.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let ze=!0;if(I){let Ut=this.variableOffsets[K];Ut?(zt=me(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),A&&zt._rotate(L?this.transform.angle:-this.transform.angle)):ze=!1}Ct.textBox&&xe(e.textCollisionBox.collisionVertexArray,lt.text.placed,!ze||St,zt.x,zt.y),Ct.verticalTextBox&&xe(e.textCollisionBox.collisionVertexArray,lt.text.placed,!ze||Mt,zt.x,zt.y)}let te=!!(!Mt&&Ct.verticalIconBox);Ct.iconBox&&xe(e.iconCollisionBox.collisionVertexArray,lt.icon.placed,te,F?zt.x:0,F?zt.y:0),Ct.verticalIconBox&&xe(e.iconCollisionBox.collisionVertexArray,lt.icon.placed,!te,F?zt.x:0,F?zt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let H=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=H.invProjMatrix,e.placementViewportMatrix=H.viewportMatrix,e.collisionCircleArray=H.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){let c=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function xe(f,e,o,c,p){f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0)}let We=Math.pow(2,25),qe=Math.pow(2,24),$e=Math.pow(2,17),Ge=Math.pow(2,16),mn=Math.pow(2,9),hr=Math.pow(2,8),Vr=Math.pow(2,1);function Kr(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let e=f.placed?1:0,o=Math.floor(127*f.opacity);return o*We+e*qe+o*$e+e*Ge+o*mn+e*hr+o*Vr+e}let mi=0;class Ul{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,c,p,m){let x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,m())return!0;return!1}}class hs{constructor(e,o,c,p,m,x,w,E){this.placement=new ae(e,o,x,w,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,o,c){let p=l.h.now(),m=()=>!this._forceFullPlacement&&l.h.now()-p>2;for(;this._currentPlacementIndex>=0;){let x=o[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Ul(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let ps=512/l.N/2;class Hi{constructor(e,o,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};let p=new Map;for(let m=0;m<o.length;m++){let x=o.get(m),w=x.key,E=p.get(w);E?E.push(x):p.set(w,[x])}for(let[m,x]of p){let w={positions:x.map(E=>({x:Math.floor(E.anchorX*ps),y:Math.floor(E.anchorY*ps)})),crossTileIDs:x.map(E=>E.crossTileID)};if(w.positions.length>128){let E=new l.av(w.positions.length,16,Uint16Array);for(let{x:I,y:A}of w.positions)E.add(I,A);E.finish(),delete w.positions,w.index=E}this._symbolsByKey[m]=w}}getScaledCoordinates(e,o){let{x:c,y:p,z:m}=this.tileID.canonical,{x,y:w,z:E}=o.canonical,I=ps/Math.pow(2,E-m),A=(w*l.N+e.anchorY)*I,L=p*l.N*ps;return{x:Math.floor((x*l.N+e.anchorX)*I-c*l.N*ps),y:Math.floor(A-L)}}findMatches(e,o,c){let p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let m=0;m<e.length;m++){let x=e.get(m);if(x.crossTileID)continue;let w=this._symbolsByKey[x.key];if(!w)continue;let E=this.getScaledCoordinates(x,o);if(w.index){let I=w.index.range(E.x-p,E.y-p,E.x+p,E.y+p).sort();for(let A of I){let L=w.crossTileIDs[A];if(!c[L]){c[L]=!0,x.crossTileID=L;break}}}else if(w.positions)for(let I=0;I<w.positions.length;I++){let A=w.positions[I],L=w.crossTileIDs[I];if(Math.abs(A.x-E.x)<=p&&Math.abs(A.y-E.y)<=p&&!c[L]){c[L]=!0,x.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class tr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let o=Math.round((e-this.lng)/360);if(o!==0)for(let c in this.indexes){let p=this.indexes[c],m={};for(let x in p){let w=p[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+o),m[w.tileID.key]=w}this.indexes[c]=m}this.lng=e}addBucket(e,o,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<o.symbolInstances.length;m++)o.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let p=this.usedCrossTileIDs[e.overscaledZ];for(let m in this.indexes){let x=this.indexes[m];if(Number(m)>e.overscaledZ)for(let w in x){let E=x[w];E.tileID.isChildOf(e)&&E.findMatches(o.symbolInstances,e,p)}else{let w=x[e.scaledTo(Number(m)).key];w&&w.findMatches(o.symbolInstances,e,p)}}for(let m=0;m<o.symbolInstances.length;m++){let x=o.symbolInstances.get(m);x.crossTileID||(x.crossTileID=c.generate(),p[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Hi(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(let c of o.getCrossTileIDsLists())for(let p of c)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let o=!1;for(let c in this.indexes){let p=this.indexes[c];for(let m in p)e[p[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[m]),delete p[m],o=!0)}return o}}class ts{constructor(){this.layerIndexes={},this.crossTileIDs=new tr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,c){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new jl);let m=!1,x={};p.handleWrapJump(c);for(let w of o){let E=w.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(w.tileID,E,this.crossTileIDs)&&(m=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(m=!0),m}pruneUnusedLayers(e){let o={};e.forEach(c=>{o[c]=!0});for(let c in this.layerIndexes)o[c]||delete this.layerIndexes[c]}}let Br=(f,e)=>l.x(f,e&&e.filter(o=>o.identifier!=="source.canvas")),Rn=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ul=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),En=l.aw();class un extends l.E{constructor(e,o={}){super(),this.map=e,this.dispatcher=new Ri(ia(),this,e._getMapId()),this.imageManager=new nr,this.imageManager.setEventedParent(this),this.glyphManager=new Er(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Qo(256,512),this.crossTileSymbolIndex=new ts,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());let c=this;this._rtlTextPluginCallback=un.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(m,x)=>{if(l.aA(m),x&&x.every(w=>w))for(let w in c.sourceCaches){let E=c.sourceCaches[w].getSource().type;E!=="vector"&&E!=="geojson"||c.sourceCaches[w].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;let m=this.sourceCaches[p.sourceId];if(!m)return;let x=m.getSource();if(x&&x.vectorLayerIds)for(let w in this._layers){let E=this._layers[w];E.source===x.id&&this._validateLayer(E)}})}loadURL(e,o={},c){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;let p=this.map._requestManager.transformRequest(e,qt.Style);this._request=l.f(p,(m,x)=>{this._request=null,m?this.fire(new l.j(m)):x&&this._load(x,o,c)})}loadJSON(e,o={},c){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,o.validate=o.validate!==!1,this._load(e,o,c)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(En,{validate:!1})}_load(e,o,c){var p;let m=o.transformStyle?o.transformStyle(c,e):e;if(!o.validate||!Br(this,l.y(m))){this._loaded=!0,this.stylesheet=m;for(let x in m.sources)this.addSource(x,m.sources[x],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new pi(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){let e=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(let o of e){let c=l.aC(o);c.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=c}}_loadSprite(e,o=!1,c=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,m,x,w){let E=Le(p),I=E.length,A=x>1?"@2x":"",L={},F={},$={};for(let{id:Z,url:H}of E){let G=m.transformRequest(m.normalizeSpriteURL(H,A,".json"),qt.SpriteJSON),ot=`${Z}_${G.url}`;L[ot]=l.f(G,(lt,mt)=>{delete L[ot],F[Z]=mt,lr(w,F,$,lt,I)});let dt=m.transformRequest(m.normalizeSpriteURL(H,A,".png"),qt.SpriteImage),K=`${Z}_${dt.url}`;L[K]=Pt.getImage(dt,(lt,mt)=>{delete L[K],$[Z]=mt,lr(w,F,$,lt,I)})}return{cancel(){for(let Z of Object.values(L))Z.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),(p,m)=>{if(this._spriteRequest=null,p)this.fire(new l.j(p));else if(m)for(let x in m){this._spritesImagesIds[x]=[];let w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(E=>!(E in m)):[];for(let E of w)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(let E in m[x]){let I=x==="default"?E:`${x}:${E}`;this._spritesImagesIds[x].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,m[x][E],!1):this.imageManager.addImage(I,m[x][E]),o&&(this._changedImages[I]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),c&&c(p)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(e){let o=this.sourceCaches[e.source];if(!o)return;let c=e.sourceLayer;if(!c)return;let p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.j(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){let o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o);let c=[];for(let p of e)o[p]&&c.push(o[p]);return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let o=Object.keys(this._layers);for(let c of o){let p=this._layers[c];p.type!=="custom"&&(e[c]=p.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let o=this._changed;if(this._changed){let p=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(p.length||m.length)&&this._updateWorkerLayers(p,m);for(let x in this._updatedSources){let w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}let c={};for(let p in this.sourceCaches){let m=this.sourceCaches[p];c[p]=m.used,m.used=!1}for(let p of this._order){let m=this._layers[p];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(let p in c){let m=this.sourceCaches[p];c[p]!==m.used&&m.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.z=e.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){this._checkLoaded();let c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,Br(this,l.y(e)))return!1;(e=l.aD(e)).layers=l.aB(e.layers);let p=l.aE(c,e).filter(x=>!(x.command in ul));if(p.length===0)return!1;let m=p.filter(x=>!(x.command in Rn));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);for(let x of p)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=e,this._serializedLayers=null,!0}addImage(e,o){if(this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.y.source,`sources.${e}`,o,null,c))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let p=this.sourceCaches[e]=new Vn(e,o,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===e)return this.fire(new l.j(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));let o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,c={}){this._checkLoaded();let p=e.id;if(this.getLayer(p))return void this.fire(new l.j(new Error(`Layer "${p}" already exists on this map.`)));let m;if(e.type==="custom"){if(Br(this,l.aF(e)))return;m=l.aC(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=l.aD(e),e=l.e(e,{source:p})),this._validate(l.y.layer,`layers.${p}`,e,{arrayIndex:-1},c))return;m=l.aC(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:p}})}let x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new l.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=m,this._removedLayers[p]&&m.source&&m.type!=="custom"){let w=this._removedLayers[p];delete this._removedLayers[p],w.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;let c=this._order.indexOf(e);this._order.splice(c,1);let p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new l.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let o=this._layers[e];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);let c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,c){this._checkLoaded();let p=this.getLayer(e);p?p.minzoom===o&&p.maxzoom===c||(o!=null&&(p.minzoom=o),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,c={}){this._checkLoaded();let p=this.getLayer(e);if(p){if(!l.aG(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.y.filter,`layers.${p.id}.filter`,o,null,c)||(p.filter=l.aD(o),this._updateLayer(p)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.aD(this.getLayer(e).filter)}setLayoutProperty(e,o,c,p={}){this._checkLoaded();let m=this.getLayer(e);m?l.aG(m.getLayoutProperty(o),c)||(m.setLayoutProperty(o,c,p),this._updateLayer(m)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){let c=this.getLayer(e);if(c)return c.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,c,p={}){this._checkLoaded();let m=this.getLayer(e);m?l.aG(m.getPaintProperty(o),c)||(m.setPaintProperty(o,c,p)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();let c=e.source,p=e.sourceLayer,m=this.sourceCaches[c];if(m===void 0)return void this.fire(new l.j(new Error(`The source '${c}' does not exist in the map's style.`)));let x=m.getSource().type;x==="geojson"&&p?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(p,e.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();let c=e.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new l.j(new Error(`The source '${c}' does not exist in the map's style.`)));let m=p.getSource().type,x=m==="vector"?e.sourceLayer:void 0;m!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,e.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let o=e.source,c=e.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,e.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=l.aH(this.sourceCaches,m=>m.serialize()),o=this._serializeByIds(this._order),c=this.map.getTerrain()||void 0,p=this.stylesheet;return l.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:e,layers:o,terrain:c},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let o=x=>this._layers[x].type==="fill-extrusion",c={},p=[];for(let x=this._order.length-1;x>=0;x--){let w=this._order[x];if(o(w)){c[w]=x;for(let E of e){let I=E[w];if(I)for(let A of I)p.push(A)}}}p.sort((x,w)=>w.intersectionZ-x.intersectionZ);let m=[];for(let x=this._order.length-1;x>=0;x--){let w=this._order[x];if(o(w))for(let E=p.length-1;E>=0;E--){let I=p[E].feature;if(c[I.layer.id]<x)break;m.push(I),p.pop()}else for(let E of e){let I=E[w];if(I)for(let A of I)m.push(A.feature)}}return m}queryRenderedFeatures(e,o,c){o&&o.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",o.filter,null,o);let p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(let w of o.layers){let E=this._layers[w];if(!E)return this.fire(new l.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];p[E.source]=!0}}let m=[];o.availableImages=this._availableImages;let x=this._serializedAllLayers();for(let w in this.sourceCaches)o.layers&&!p[w]||m.push(Zr(this.sourceCaches[w],this._layers,x,e,o,c));return this.placement&&m.push(function(w,E,I,A,L,F,$){let Z={},H=F.queryRenderedSymbols(A),G=[];for(let ot of Object.keys(H).map(Number))G.push($[ot]);G.sort(Mo);for(let ot of G){let dt=ot.featureIndex.lookupSymbolFeatures(H[ot.bucketInstanceId],E,ot.bucketIndex,ot.sourceLayerIndex,L.filter,L.layers,L.availableImages,w);for(let K in dt){let lt=Z[K]=Z[K]||[],mt=dt[K];mt.sort((gt,St)=>{let Mt=ot.featureSortOrder;if(Mt){let Ct=Mt.indexOf(gt.featureIndex);return Mt.indexOf(St.featureIndex)-Ct}return St.featureIndex-gt.featureIndex});for(let gt of mt)lt.push(gt)}}for(let ot in Z)Z[ot].forEach(dt=>{let K=dt.feature,lt=I[w[ot].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=lt});return Z}(this._layers,x,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,o){o&&o.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",o.filter,null,o);let c=this.sourceCaches[e];return c?function(p,m){let x=p.getRenderableIds().map(I=>p.getTileByID(I)),w=[],E={};for(let I=0;I<x.length;I++){let A=x[I],L=A.tileID.canonical.key;E[L]||(E[L]=!0,A.querySourceFeatures(w,m))}return w}(c,o):[]}addSourceType(e,o,c){return Oi(e)?c(new Error(`A source type called "${e}" already exists.`)):(((p,m)=>{ba[p]=m})(e,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:o.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();let c=this.light.getLight(),p=!1;for(let x in e)if(!l.aG(e[x],c[x])){p=!0;break}if(!p)return;let m={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(m)}_validate(e,o,c,p,m={}){return(!m||m.validate!==!1)&&Br(this,e.call(l.y,l.e({key:o,style:this.serialize(),value:c,styleSpec:l.v},p)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._layers)this._layers[o].setEventedParent(null);for(let o in this.sourceCaches){let c=this.sourceCaches[o];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,c,p,m=!1){let x=!1,w=!1,E={};for(let I of this._order){let A=this._layers[I];if(A.type!=="symbol")continue;if(!E[A.source]){let F=this.sourceCaches[A.source];E[A.source]=F.getRenderableIds(!0).map($=>F.getTileByID($)).sort(($,Z)=>Z.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Z.tileID)?-1:1))}let L=this.crossTileSymbolIndex.addLayer(A,E[A.source],e.center.lng);x=x||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),e.zoom))&&(this.pauseablePlacement=new hs(e,this.map.terrain,this._order,m,o,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(let I of this._order){let A=this._layers[I];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o,c){this.imageManager.getImages(o.icons,c),this._updateTilesForChangedImages();let p=this.sourceCaches[o.source];p&&p.setDependencies(o.tileID.key,o.type,o.icons)}getGlyphs(e,o,c){this.glyphManager.getGlyphs(o.stacks,c);let p=this.sourceCaches[o.source];p&&p.setDependencies(o.tileID.key,o.type,[""])}getResource(e,o,c){return l.m(o,c)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(l.y.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,c={},p){this._checkLoaded();let m=[{id:e,url:o}],x=[...Le(this.stylesheet.sprite),...m];this._validate(l.y.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(m,!0,p))}removeSprite(e){this._checkLoaded();let o=Le(this.stylesheet.sprite);if(o.find(c=>c.id===e)){if(this._spritesImagesIds[e])for(let c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;o.splice(o.findIndex(c=>c.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Le(this.stylesheet.sprite)}setSprite(e,o={},c){this._checkLoaded(),e&&this._validate(l.y.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}un.registerForPluginStateChange=l.aK;var cl=l.Q([{name:"a_pos",type:"Int16",components:2}]),Ns="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let br={prelude:He(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:He(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:He(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:He(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:He("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:He(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:He(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:He("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:He("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:He("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:He(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:He(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:He(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:He(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:He(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:He(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:He(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:He(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:He(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:He(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:He(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:He("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ns),terrainDepth:He("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ns),terrainCoords:He("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ns)};function He(f,e){let o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/attribute ([\w]+) ([\w]+)/g),p=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=m?m.concat(p):p,w={};return{fragmentSource:f=f.replace(o,(E,I,A,L,F)=>(w[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${L} ${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(E,I,A,L,F)=>{let $=L==="float"?"vec2":"vec4",Z=F.match(/color/)?"color":$;return w[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${$} a_${F};
varying ${A} ${L} ${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${$} a_${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = a_${F};
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${A} ${L} ${F} = u_${F};
#endif
`}),staticAttributes:c,staticUniforms:x}}class Bo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,c,p,m,x,w,E,I){this.context=e;let A=this.boundPaintVertexBuffers.length!==p.length;for(let L=0;!A&&L<p.length;L++)this.boundPaintVertexBuffers[L]!==p[L]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==c||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==I?this.freshBind(o,c,p,m,x,w,E,I):(e.bindVertexArray.set(this.vao),w&&w.bind(),m&&m.dynamicDraw&&m.bind(),E&&E.bind(),I&&I.bind())}freshBind(e,o,c,p,m,x,w,E){let I=e.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=E,o.enableAttributes(L,e);for(let F of c)F.enableAttributes(L,e);x&&x.enableAttributes(L,e),w&&w.enableAttributes(L,e),E&&E.enableAttributes(L,e),o.bind(),o.setVertexAttribPointers(L,e,m);for(let F of c)F.bind(),F.setVertexAttribPointers(L,e,m);x&&(x.bind(),x.setVertexAttribPointers(L,e,m)),p&&p.bind(),w&&(w.bind(),w.setVertexAttribPointers(L,e,m)),E&&(E.bind(),E.setVertexAttribPointers(L,e,m)),A.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Tr(f){let e=[];for(let o=0;o<f.length;o++){if(f[o]===null)continue;let c=f[o].split(" ");e.push(c.pop())}return e}class Va{constructor(e,o,c,p,m,x){let w=e.gl;this.program=w.createProgram();let E=Tr(o.staticAttributes),I=c?c.getBinderAttributes():[],A=E.concat(I),L=br.prelude.staticUniforms?Tr(br.prelude.staticUniforms):[],F=o.staticUniforms?Tr(o.staticUniforms):[],$=c?c.getBinderUniforms():[],Z=L.concat(F).concat($),H=[];for(let gt of Z)H.indexOf(gt)<0&&H.push(gt);let G=c?c.defines():[];m&&G.push("#define OVERDRAW_INSPECTOR;"),x&&G.push("#define TERRAIN3D;");let ot=G.concat(br.prelude.fragmentSource,o.fragmentSource).join(`
`),dt=G.concat(br.prelude.vertexSource,o.vertexSource).join(`
`),K=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(K,ot),w.compileShader(K),!w.getShaderParameter(K,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(K)}`);w.attachShader(this.program,K);let lt=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(lt,dt),w.compileShader(lt),!w.getShaderParameter(lt,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(lt)}`);w.attachShader(this.program,lt),this.attributes={};let mt={};this.numAttributes=A.length;for(let gt=0;gt<this.numAttributes;gt++)A[gt]&&(w.bindAttribLocation(this.program,gt,A[gt]),this.attributes[A[gt]]=gt);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(lt),w.deleteShader(K);for(let gt=0;gt<H.length;gt++){let St=H[gt];if(St&&!mt[St]){let Mt=w.getUniformLocation(this.program,St);Mt&&(mt[St]=Mt)}}this.fixedUniforms=p(e,mt),this.terrainUniforms=((gt,St)=>({u_depth:new l.aL(gt,St.u_depth),u_terrain:new l.aL(gt,St.u_terrain),u_terrain_dim:new l.aM(gt,St.u_terrain_dim),u_terrain_matrix:new l.aN(gt,St.u_terrain_matrix),u_terrain_unpack:new l.aO(gt,St.u_terrain_unpack),u_terrain_exaggeration:new l.aM(gt,St.u_terrain_exaggeration)}))(e,mt),this.binderUniforms=c?c.getUniforms(e,mt):[]}draw(e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H,G,ot,dt){let K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(p),e.setColorMode(m),e.setCullFace(x),E){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,E.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,E.texture);for(let mt in this.terrainUniforms)this.terrainUniforms[mt].set(E[mt])}for(let mt in this.fixedUniforms)this.fixedUniforms[mt].set(w[mt]);H&&H.setUniforms(e,this.binderUniforms,$,{zoom:Z});let lt=0;switch(o){case K.LINES:lt=2;break;case K.TRIANGLES:lt=3;break;case K.LINE_STRIP:lt=1}for(let mt of F.get()){let gt=mt.vaos||(mt.vaos={});(gt[I]||(gt[I]=new Bo)).bind(e,this,A,H?H.getPaintVertexBuffers():[],L,mt.vertexOffset,G,ot,dt),K.drawElements(o,mt.primitiveLength*lt,K.UNSIGNED_SHORT,mt.primitiveOffset*lt*2)}}}function gi(f,e,o){let c=1/nt(o,1,e.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),m=o.tileSize*Math.pow(2,e.transform.tileZoom)/p,x=m*(o.tileID.canonical.x+o.tileID.wrap*p),w=m*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[c,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}let _u=(f,e,o,c)=>{let p=e.style.light,m=p.properties.get("position"),x=[m.x,m.y,m.z],w=function(){var I=new l.A(9);return l.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();p.properties.get("anchor")==="viewport"&&function(I,A){var L=Math.sin(A),F=Math.cos(A);I[0]=F,I[1]=L,I[2]=0,I[3]=-L,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(w,-e.transform.angle),function(I,A,L){var F=A[0],$=A[1],Z=A[2];I[0]=F*L[0]+$*L[3]+Z*L[6],I[1]=F*L[1]+$*L[4]+Z*L[7],I[2]=F*L[2]+$*L[5]+Z*L[8]}(x,x,w);let E=p.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+o,u_opacity:c}},Vo=(f,e,o,c,p,m,x)=>l.e(_u(f,e,o,c),gi(m,e,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),Gl=f=>({u_matrix:f}),D=(f,e,o,c)=>l.e(Gl(f),gi(o,e,c)),U=(f,e)=>({u_matrix:f,u_world:e}),ct=(f,e,o,c,p)=>l.e(D(f,e,o,c),{u_world:p}),vt=(f,e,o,c)=>{let p=f.transform,m,x;if(c.paint.get("circle-pitch-alignment")==="map"){let w=nt(o,1,p.zoom);m=!0,x=[w,w]}else m=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,o,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},At=(f,e,o)=>{let c=nt(o,1,e.zoom),p=Math.pow(2,e.zoom-o.tileID.overscaledZ),m=o.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[e.pixelsToGLUnits[0]/(c*p),e.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:m}},Lt=(f,e,o=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:o}),Rt=f=>({u_matrix:f}),fe=(f,e,o,c)=>({u_matrix:f,u_extrude_scale:nt(e,1,o),u_intensity:c});function ve(f,e){let o=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new l.U(0,c/o).toLngLat().lat,new l.U(0,(c+1)/o).toLngLat().lat]}let Ce=(f,e,o,c)=>{let p=f.transform;return{u_matrix:fr(f,e,o,c),u_ratio:1/nt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Ae=(f,e,o,c,p)=>l.e(Ce(f,e,o,p),{u_image:0,u_image_height:c}),Ie=(f,e,o,c,p)=>{let m=f.transform,x=ri(e,m);return{u_matrix:fr(f,e,o,p),u_texsize:e.imageAtlasTexture.size,u_ratio:1/nt(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},dr=(f,e,o,c,p,m)=>{let x=f.lineAtlas,w=ri(e,f.transform),E=o.layout.get("line-cap")==="round",I=x.getDash(c.from,E),A=x.getDash(c.to,E),L=I.width*p.fromScale,F=A.width*p.toScale;return l.e(Ce(f,e,o,m),{u_patternscale_a:[w/L,-I.height/2],u_patternscale_b:[w/F,-A.height/2],u_sdfgamma:x.width/(256*Math.min(L,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:A.y,u_mix:p.t})};function ri(f,e){return 1/nt(f,1,e.tileZoom)}function fr(f,e,o,c){return f.translatePosMatrix(c?c.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}let Mi=(f,e,o,c,p)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(m=p.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:ce(p.paint.get("raster-hue-rotate"))};var m,x};function ce(f){f*=Math.PI/180;let e=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}let Xe=(f,e,o,c,p,m,x,w,E,I)=>{let A=p.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:A.width/A.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+E,u_pitch_with_map:+c,u_texsize:I,u_texture:0}},cn=(f,e,o,c,p,m,x,w,E,I,A)=>{let L=p.transform;return l.e(Xe(f,e,o,c,p,m,x,w,E,I),{u_gamma_scale:c?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+A})},wn=(f,e,o,c,p,m,x,w,E,I)=>l.e(cn(f,e,o,c,p,m,x,w,!0,E,!0),{u_texsize_icon:I,u_texture_icon:1}),Qn=(f,e,o)=>({u_matrix:f,u_opacity:e,u_color:o}),ni=(f,e,o,c,p,m)=>l.e(function(x,w,E,I){let A=E.imageManager.getPattern(x.from.toString()),L=E.imageManager.getPattern(x.to.toString()),{width:F,height:$}=E.imageManager.getPixelSize(),Z=Math.pow(2,I.tileID.overscaledZ),H=I.tileSize*Math.pow(2,E.transform.tileZoom)/Z,G=H*(I.tileID.canonical.x+I.tileID.wrap*Z),ot=H*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[F,$],u_mix:w.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/nt(I,1,E.transform.tileZoom),u_pixel_coord_upper:[G>>16,ot>>16],u_pixel_coord_lower:[65535&G,65535&ot]}}(c,m,o,p),{u_matrix:f,u_opacity:e}),hl={fillExtrusion:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_lightpos:new l.aP(f,e.u_lightpos),u_lightintensity:new l.aM(f,e.u_lightintensity),u_lightcolor:new l.aP(f,e.u_lightcolor),u_vertical_gradient:new l.aM(f,e.u_vertical_gradient),u_opacity:new l.aM(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_lightpos:new l.aP(f,e.u_lightpos),u_lightintensity:new l.aM(f,e.u_lightintensity),u_lightcolor:new l.aP(f,e.u_lightcolor),u_vertical_gradient:new l.aM(f,e.u_vertical_gradient),u_height_factor:new l.aM(f,e.u_height_factor),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade),u_opacity:new l.aM(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_scale_with_map:new l.aL(f,e.u_scale_with_map),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_extrude_scale:new l.aQ(f,e.u_extrude_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_matrix:new l.aN(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(f,e.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(f,e.u_extrude_scale),u_overscale_factor:new l.aM(f,e.u_overscale_factor)}),collisionCircle:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_inv_matrix:new l.aN(f,e.u_inv_matrix),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_viewport_size:new l.aQ(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new l.aR(f,e.u_color),u_matrix:new l.aN(f,e.u_matrix),u_overlay:new l.aL(f,e.u_overlay),u_overlay_scale:new l.aM(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new l.aM(f,e.u_extrude_scale),u_intensity:new l.aM(f,e.u_intensity),u_matrix:new l.aN(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world),u_image:new l.aL(f,e.u_image),u_color_ramp:new l.aL(f,e.u_color_ramp),u_opacity:new l.aM(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_latrange:new l.aQ(f,e.u_latrange),u_light:new l.aQ(f,e.u_light),u_shadow:new l.aR(f,e.u_shadow),u_highlight:new l.aR(f,e.u_highlight),u_accent:new l.aR(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_dimension:new l.aQ(f,e.u_dimension),u_zoom:new l.aM(f,e.u_zoom),u_unpack:new l.aO(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_image:new l.aL(f,e.u_image),u_image_height:new l.aM(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texsize:new l.aQ(f,e.u_texsize),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_image:new l.aL(f,e.u_image),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_patternscale_a:new l.aQ(f,e.u_patternscale_a),u_patternscale_b:new l.aQ(f,e.u_patternscale_b),u_sdfgamma:new l.aM(f,e.u_sdfgamma),u_image:new l.aL(f,e.u_image),u_tex_y_a:new l.aM(f,e.u_tex_y_a),u_tex_y_b:new l.aM(f,e.u_tex_y_b),u_mix:new l.aM(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_tl_parent:new l.aQ(f,e.u_tl_parent),u_scale_parent:new l.aM(f,e.u_scale_parent),u_buffer_scale:new l.aM(f,e.u_buffer_scale),u_fade_t:new l.aM(f,e.u_fade_t),u_opacity:new l.aM(f,e.u_opacity),u_image0:new l.aL(f,e.u_image0),u_image1:new l.aL(f,e.u_image1),u_brightness_low:new l.aM(f,e.u_brightness_low),u_brightness_high:new l.aM(f,e.u_brightness_high),u_saturation_factor:new l.aM(f,e.u_saturation_factor),u_contrast_factor:new l.aM(f,e.u_contrast_factor),u_spin_weights:new l.aP(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texture:new l.aL(f,e.u_texture)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texture:new l.aL(f,e.u_texture),u_gamma_scale:new l.aM(f,e.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_is_halo:new l.aL(f,e.u_is_halo)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texsize_icon:new l.aQ(f,e.u_texsize_icon),u_texture:new l.aL(f,e.u_texture),u_texture_icon:new l.aL(f,e.u_texture_icon),u_gamma_scale:new l.aM(f,e.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_is_halo:new l.aL(f,e.u_is_halo)}),background:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_opacity:new l.aM(f,e.u_opacity),u_color:new l.aR(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_opacity:new l.aM(f,e.u_opacity),u_image:new l.aL(f,e.u_image),u_pattern_tl_a:new l.aQ(f,e.u_pattern_tl_a),u_pattern_br_a:new l.aQ(f,e.u_pattern_br_a),u_pattern_tl_b:new l.aQ(f,e.u_pattern_tl_b),u_pattern_br_b:new l.aQ(f,e.u_pattern_br_b),u_texsize:new l.aQ(f,e.u_texsize),u_mix:new l.aM(f,e.u_mix),u_pattern_size_a:new l.aQ(f,e.u_pattern_size_a),u_pattern_size_b:new l.aQ(f,e.u_pattern_size_b),u_scale_a:new l.aM(f,e.u_scale_a),u_scale_b:new l.aM(f,e.u_scale_b),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texture:new l.aL(f,e.u_texture),u_ele_delta:new l.aM(f,e.u_ele_delta)}),terrainDepth:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ele_delta:new l.aM(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texture:new l.aL(f,e.u_texture),u_terrain_coords_id:new l.aM(f,e.u_terrain_coords_id),u_ele_delta:new l.aM(f,e.u_ele_delta)})};class gn{constructor(e,o,c){this.context=e;let p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let oa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pl{constructor(e,o,c,p){this.length=o.length,this.attributes=c,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=e;let m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let c=0;c<this.attributes.length;c++){let p=o.attributes[this.attributes[c].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,o,c){for(let p=0;p<this.attributes.length;p++){let m=this.attributes[p],x=o.attributes[m.name];x!==void 0&&e.vertexAttribPointer(x,m.components,e[oa[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Yi=new WeakMap;function ko(f){var e;if(Yi.has(f))return Yi.get(f);{let o=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Yi.set(f,o),o}}class Oe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ua extends Oe{getDefault(){return l.aT.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Un extends Oe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ti extends Oe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ql extends Oe{getDefault(){return[!0,!0,!0,!0]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class dl extends Oe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class fl extends Oe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class vu extends Oe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class $l extends Oe{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ja extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Zl extends Oe{getDefault(){return[0,1]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class xu extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class ml extends Oe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Xl extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class bu extends Oe{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ss extends Oe{getDefault(){return l.aT.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class sa extends Oe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Mh extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class Dh extends Oe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class np extends Oe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class kh extends Oe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ec extends Oe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Hl extends Oe{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ga extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class wu extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Bs extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Es extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ic extends Oe{getDefault(){return null}set(e){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cc extends Oe{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;let c=this.gl;ko(c)?c.bindVertexArray(e):(o=c.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class gl extends Oe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class po extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Su extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fo extends Oe{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class ds extends fo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class yl extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Eu extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ye{constructor(e,o,c,p,m){this.context=e,this.width=o,this.height=c;let x=e.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new ds(e,w),p)this.depthAttachment=m?new Eu(e,w):new yl(e,w);else if(m)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){let c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class wr{constructor(e,o,c){this.blendFunction=e,this.blendColor=o,this.mask=c}}wr.Replace=[1,0],wr.disabled=new wr(wr.Replace,l.aT.transparent,[!1,!1,!1,!1]),wr.unblended=new wr(wr.Replace,l.aT.transparent,[!0,!0,!0,!0]),wr.alphaBlended=new wr([1,771],l.aT.transparent,[!0,!0,!0,!0]);class ip{constructor(e){var o,c;if(this.gl=e,this.clearColor=new Ua(this),this.clearDepth=new Un(this),this.clearStencil=new ti(this),this.colorMask=new ql(this),this.depthMask=new dl(this),this.stencilMask=new fl(this),this.stencilFunc=new vu(this),this.stencilOp=new $l(this),this.stencilTest=new ja(this),this.depthRange=new Zl(this),this.depthTest=new xu(this),this.depthFunc=new ml(this),this.blend=new Xl(this),this.blendFunc=new bu(this),this.blendColor=new Ss(this),this.blendEquation=new sa(this),this.cullFace=new Mh(this),this.cullFaceSide=new Dh(this),this.frontFace=new np(this),this.program=new kh(this),this.activeTexture=new ec(this),this.viewport=new Hl(this),this.bindFramebuffer=new Ga(this),this.bindRenderbuffer=new wu(this),this.bindTexture=new Bs(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new Ic(this),this.bindVertexArray=new Cc(this),this.pixelStoreUnpack=new gl(this),this.pixelStoreUnpackPremultiplyAlpha=new po(this),this.pixelStoreUnpackFlipY=new Su(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ko(e)){this.HALF_FLOAT=e.HALF_FLOAT;let p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:p?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new gn(this,e,o)}createVertexBuffer(e,o,c){return new pl(this,e,o,c)}createRenderbuffer(e,o,c){let p=this.gl,m=p.createRenderbuffer();return this.bindRenderbuffer.set(m),p.renderbufferStorage(p.RENDERBUFFER,e,o,c),this.bindRenderbuffer.set(null),m}createFramebuffer(e,o,c,p){return new Ye(this,e,o,c,p)}clear({color:e,depth:o,stencil:c}){let p=this.gl,m=0;e&&(m|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(m|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),c!==void 0&&(m|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.aG(e.blendFunction,wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ko(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return ko(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Be{constructor(e,o,c){this.func=e,this.mask=o,this.range=c}}Be.ReadOnly=!1,Be.ReadWrite=!0,Be.disabled=new Be(519,Be.ReadOnly,[0,1]);let es=7680;class gr{constructor(e,o,c,p,m,x){this.test=e,this.ref=o,this.mask=c,this.fail=p,this.depthFail=m,this.pass=x}}gr.disabled=new gr({func:519,mask:0},0,0,es,es,es);class ur{constructor(e,o,c){this.enable=e,this.mode=o,this.frontFace=c}}let mo;function wa(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I=f.useProgram("collisionBox"),A=[],L=0,F=0;for(let K=0;K<c.length;K++){let lt=c[K],mt=e.getTile(lt),gt=mt.getBucket(o);if(!gt)continue;let St=lt.posMatrix;p[0]===0&&p[1]===0||(St=f.translatePosMatrix(lt.posMatrix,mt,p,m));let Mt=x?gt.textCollisionBox:gt.iconCollisionBox,Ct=gt.collisionCircleArray;if(Ct.length>0){let zt=l.Z(),te=St;l.aU(zt,gt.placementInvProjMatrix,f.transform.glCoordMatrix),l.aU(zt,zt,gt.placementViewportMatrix),A.push({circleArray:Ct,circleOffset:F,transform:te,invTransform:zt,coord:lt}),L+=Ct.length/4,F=L}Mt&&I.draw(w,E.LINES,Be.disabled,gr.disabled,f.colorModeForRenderPass(),ur.disabled,At(St,f.transform,mt),f.style.map.terrain&&f.style.map.terrain.getTerrainData(lt),o.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,f.transform.zoom,null,null,Mt.collisionVertexBuffer)}if(!x||!A.length)return;let $=f.useProgram("collisionCircle"),Z=new l.aV;Z.resize(4*L),Z._trim();let H=0;for(let K of A)for(let lt=0;lt<K.circleArray.length/4;lt++){let mt=4*lt,gt=K.circleArray[mt+0],St=K.circleArray[mt+1],Mt=K.circleArray[mt+2],Ct=K.circleArray[mt+3];Z.emplace(H++,gt,St,Mt,Ct,0),Z.emplace(H++,gt,St,Mt,Ct,1),Z.emplace(H++,gt,St,Mt,Ct,2),Z.emplace(H++,gt,St,Mt,Ct,3)}(!mo||mo.length<2*L)&&(mo=function(K){let lt=2*K,mt=new l.aX;mt.resize(lt),mt._trim();for(let gt=0;gt<lt;gt++){let St=6*gt;mt.uint16[St+0]=4*gt+0,mt.uint16[St+1]=4*gt+1,mt.uint16[St+2]=4*gt+2,mt.uint16[St+3]=4*gt+2,mt.uint16[St+4]=4*gt+3,mt.uint16[St+5]=4*gt+0}return mt}(L));let G=w.createIndexBuffer(mo,!0),ot=w.createVertexBuffer(Z,l.aW.members,!0);for(let K of A){let lt={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(dt=f.transform).cameraToCenterDistance,u_viewport_size:[dt.width,dt.height]};$.draw(w,E.TRIANGLES,Be.disabled,gr.disabled,f.colorModeForRenderPass(),ur.disabled,lt,f.style.map.terrain&&f.style.map.terrain.getTerrainData(K.coord),o.id,ot,G,l.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,f.transform.zoom,null,null,null)}var dt;ot.destroy(),G.destroy()}ur.disabled=new ur(!1,1029,2305),ur.backCCW=new ur(!0,1029,2305);let qa=l.ao(new Float32Array(16));function rs(f,e,o,c,p,m){let{horizontalAlign:x,verticalAlign:w}=l.au(f);return new l.P((-(x-.5)*e/p+c[0])*m,(-(w-.5)*o/p+c[1])*m)}function _l(f,e,o,c,p,m,x,w,E,I,A){let L=f.text.placedSymbolArray,F=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,Z={};F.clear();for(let H=0;H<L.length;H++){let G=L.get(H),ot=G.hidden||!G.crossTileID||f.allowVerticalPlacement&&!G.placedOrientation?null:c[G.crossTileID];if(ot){let dt=new l.P(G.anchorX,G.anchorY),K=Cr(dt,o?x:m,A),lt=cs(p.cameraToCenterDistance,K.signedDistanceFromCamera),mt=l.aj(f.textSizeData,E,G)*lt/l.ap;o&&(mt*=f.tilePixelRatio/w);let{width:gt,height:St,anchor:Mt,textOffset:Ct,textBoxScale:zt}=ot,te=rs(Mt,gt,St,Ct,zt,mt),ze=o?Cr(dt.add(te),m,A).point:K.point.add(e?te.rotate(-p.angle):te),Ut=f.allowVerticalPlacement&&G.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let pe=0;pe<G.numGlyphs;pe++)l.ak(F,ze,Ut);I&&G.associatedIconIndex>=0&&(Z[G.associatedIconIndex]={shiftedAnchor:ze,angle:Ut})}else j(G.numGlyphs,F)}if(I){$.clear();let H=f.icon.placedSymbolArray;for(let G=0;G<H.length;G++){let ot=H.get(G);if(ot.hidden)j(ot.numGlyphs,$);else{let dt=Z[G];if(dt)for(let K=0;K<ot.numGlyphs;K++)l.ak($,dt.shiftedAnchor,dt.angle);else j(ot.numGlyphs,$)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(F)}function $a(f,e,o){return o.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Vs(f,e,o,c,p,m,x,w,E,I,A,L){let F=f.context,$=F.gl,Z=f.transform,H=w==="map",G=E==="map",ot=w!=="viewport"&&o.layout.get("symbol-placement")!=="point",dt=H&&!G&&!ot,K=!o.layout.get("symbol-sort-key").isConstant(),lt=!1,mt=f.depthModeForSublayer(0,Be.ReadOnly),gt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[];for(let Mt of c){let Ct=e.getTile(Mt),zt=Ct.getBucket(o);if(!zt)continue;let te=p?zt.text:zt.icon;if(!te||!te.segments.get().length||!te.hasVisibleVertices)continue;let ze=te.programConfigurations.get(o.id),Ut=p||zt.sdfIcons,pe=p?zt.textSizeData:zt.iconSizeData,re=G||Z.pitch!==0,or=f.useProgram($a(Ut,p,zt),ze),De=l.ah(pe,Z.zoom),Te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Mt),Re,Rr,pr,yn,Qr=[0,0],jr=null;if(p)Rr=Ct.glyphAtlasTexture,pr=$.LINEAR,Re=Ct.glyphAtlasTexture.size,zt.iconsInText&&(Qr=Ct.imageAtlasTexture.size,jr=Ct.imageAtlasTexture,yn=re||f.options.rotating||f.options.zooming||pe.kind==="composite"||pe.kind==="camera"?$.LINEAR:$.NEAREST);else{let Or=o.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear;Rr=Ct.imageAtlasTexture,pr=Ut||f.options.rotating||f.options.zooming||Or||re?$.LINEAR:$.NEAREST,Re=Ct.imageAtlasTexture.size}let vi=nt(Ct,1,f.transform.zoom),_r=Ot(Mt.posMatrix,G,H,f.transform,vi),vo=Pi(Mt.posMatrix,G,H,f.transform,vi),xo=gt&&zt.hasTextData(),gs=o.layout.get("icon-text-fit")!=="none"&&xo&&zt.hasIconData();if(ot){let Or=f.style.map.terrain?(oi,Fr)=>f.style.map.terrain.getElevation(Mt,oi,Fr):null,tn=o.layout.get("text-rotation-alignment")==="map";Nt(zt,Mt.posMatrix,f,p,_r,vo,G,I,tn,Or)}let $s=f.translatePosMatrix(Mt.posMatrix,Ct,m,x),Pa=ot||p&&gt||gs?qa:_r,In=f.translatePosMatrix(vo,Ct,m,x,!0),_n=Ut&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Zn;Zn=Ut?zt.iconsInText?wn(pe.kind,De,dt,G,f,$s,Pa,In,Re,Qr):cn(pe.kind,De,dt,G,f,$s,Pa,In,p,Re,!0):Xe(pe.kind,De,dt,G,f,$s,Pa,In,p,Re);let Zs={program:or,buffers:te,uniformValues:Zn,atlasTexture:Rr,atlasTextureIcon:jr,atlasInterpolation:pr,atlasInterpolationIcon:yn,isSDF:Ut,hasHalo:_n};if(K&&zt.canOverlap){lt=!0;let Or=te.segments.get();for(let tn of Or)St.push({segments:new l.S([tn]),sortKey:tn.sortKey,state:Zs,terrainData:Te})}else St.push({segments:te.segments,sortKey:0,state:Zs,terrainData:Te})}lt&&St.sort((Mt,Ct)=>Mt.sortKey-Ct.sortKey);for(let Mt of St){let Ct=Mt.state;if(F.activeTexture.set($.TEXTURE0),Ct.atlasTexture.bind(Ct.atlasInterpolation,$.CLAMP_TO_EDGE),Ct.atlasTextureIcon&&(F.activeTexture.set($.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ct.isSDF){let zt=Ct.uniformValues;Ct.hasHalo&&(zt.u_is_halo=1,Yl(Ct.buffers,Mt.segments,o,f,Ct.program,mt,A,L,zt,Mt.terrainData)),zt.u_is_halo=0}Yl(Ct.buffers,Mt.segments,o,f,Ct.program,mt,A,L,Ct.uniformValues,Mt.terrainData)}}function Yl(f,e,o,c,p,m,x,w,E,I){let A=c.context;p.draw(A,A.gl.TRIANGLES,m,x,w,ur.disabled,E,I,o.id,f.layoutVertexBuffer,f.indexBuffer,e,o.paint,c.transform.zoom,f.programConfigurations.get(o.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function aa(f,e,o,c,p){if(!o||!c||!c.imageAtlas)return;let m=c.imageAtlas.patternPositions,x=m[o.to.toString()],w=m[o.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){let E=p.getPaintProperty(e);x=m[E],w=m[E]}x&&w&&f.setConstantPatternPositions(x,w)}function Sa(f,e,o,c,p,m,x){let w=f.context.gl,E="fill-pattern",I=o.paint.get(E),A=I&&I.constantOr(1),L=o.getCrossfadeParameters(),F,$,Z,H,G;x?($=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):($=A?"fillPattern":"fill",F=w.TRIANGLES);let ot=I.constantOr(null);for(let dt of c){let K=e.getTile(dt);if(A&&!K.patternsLoaded())continue;let lt=K.getBucket(o);if(!lt)continue;let mt=lt.programConfigurations.get(o.id),gt=f.useProgram($,mt),St=f.style.map.terrain&&f.style.map.terrain.getTerrainData(dt);A&&(f.context.activeTexture.set(w.TEXTURE0),K.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),mt.updatePaintBuffers(L)),aa(mt,E,ot,K,o);let Mt=St?dt:null,Ct=f.translatePosMatrix(Mt?Mt.posMatrix:dt.posMatrix,K,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){H=lt.indexBuffer2,G=lt.segments2;let zt=[w.drawingBufferWidth,w.drawingBufferHeight];Z=$==="fillOutlinePattern"&&A?ct(Ct,f,L,K,zt):U(Ct,zt)}else H=lt.indexBuffer,G=lt.segments,Z=A?D(Ct,f,L,K):Gl(Ct);gt.draw(f.context,F,p,f.stencilModeForClipping(dt),m,ur.disabled,Z,St,o.id,lt.layoutVertexBuffer,H,G,o.paint,f.transform.zoom,mt)}}function Ea(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I="fill-extrusion-pattern",A=o.paint.get(I),L=A.constantOr(1),F=o.getCrossfadeParameters(),$=o.paint.get("fill-extrusion-opacity"),Z=A.constantOr(null);for(let H of c){let G=e.getTile(H),ot=G.getBucket(o);if(!ot)continue;let dt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(H),K=ot.programConfigurations.get(o.id),lt=f.useProgram(L?"fillExtrusionPattern":"fillExtrusion",K);L&&(f.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),K.updatePaintBuffers(F)),aa(K,I,Z,G,o);let mt=f.translatePosMatrix(H.posMatrix,G,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),gt=o.paint.get("fill-extrusion-vertical-gradient"),St=L?Vo(mt,f,gt,$,H,F,G):_u(mt,f,gt,$);lt.draw(w,w.gl.TRIANGLES,p,m,x,ur.backCCW,St,dt,o.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,o.paint,f.transform.zoom,K,f.style.map.terrain&&ot.centroidVertexBuffer)}}function zh(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I=o.fbo;if(!I)return;let A=f.useProgram("hillshade"),L=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get()),A.draw(w,E.TRIANGLES,p,m,x,ur.disabled,((F,$,Z,H)=>{let G=Z.paint.get("hillshade-shadow-color"),ot=Z.paint.get("hillshade-highlight-color"),dt=Z.paint.get("hillshade-accent-color"),K=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=F.transform.angle);let lt=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix($.tileID.toUnwrapped(),lt),u_image:0,u_latrange:ve(0,$.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),K],u_shadow:G,u_highlight:ot,u_accent:dt}})(f,o,c,L?e:null),L,c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Wl(f,e,o,c,p,m){let x=f.context,w=x.gl,E=e.dem;if(E&&E.data){let I=E.dim,A=E.stride,L=E.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(A),e.demTexture){let $=e.demTexture;$.update(L,{premultiply:!1}),$.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new je(x,L,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){let $=new je(x,{width:I,height:I,data:null},w.RGBA);$.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=x.createFramebuffer(I,I,!0,!1),F.colorAttachment.set($.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,I,I]),f.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,c,p,m,ur.disabled,(($,Z)=>{let H=Z.stride,G=l.Z();return l.aS(G,0,l.N,-l.N,0,0,1),l.$(G,G,[0,-l.N,0]),{u_matrix:G,u_image:1,u_dimension:[H,H],u_zoom:$.overscaledZ,u_unpack:Z.getUnpackVector()}})(e.tileID,E),null,o.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function rc(f,e,o,c,p,m){let x=c.paint.get("raster-fade-duration");if(!m&&x>0){let w=l.h.now(),E=(w-f.timeAdded)/x,I=e?(w-e.timeAdded)/x:-1,A=o.getSource(),L=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),$=F&&f.refreshedUponExpiration?1:l.ad(F?E:1-I,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}let Za=new l.aT(1,0,0,1),vl=new l.aT(0,1,0,1),Ts=new l.aT(0,0,1,1),Pc=new l.aT(1,0,1,1),Ta=new l.aT(0,1,1,1);function la(f,e,o,c){ua(f,0,e+o/2,f.transform.width,o,c)}function xl(f,e,o,c){ua(f,e-o/2,0,o,f.transform.height,c)}function ua(f,e,o,c,p,m){let x=f.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,o*f.pixelRatio,c*f.pixelRatio,p*f.pixelRatio),x.clear({color:m}),w.disable(w.SCISSOR_TEST)}function Tu(f,e,o){let c=f.context,p=c.gl,m=o.posMatrix,x=f.useProgram("debug"),w=Be.disabled,E=gr.disabled,I=f.colorModeForRenderPass(),A="$debug",L=f.style.map.terrain&&f.style.map.terrain.getTerrainData(o);c.activeTexture.set(p.TEXTURE0);let F=e.getTileByID(o.key).latestRawTileData,$=Math.floor((F&&F.byteLength||0)/1024),Z=e.getTile(o).tileSize,H=512/Math.min(Z,512)*(o.overscaledZ/f.transform.zoom)*.5,G=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(G+=` => ${o.overscaledZ}`),function(ot,dt){ot.initDebugOverlayCanvas();let K=ot.debugOverlayCanvas,lt=ot.context.gl,mt=ot.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,K.width,K.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(dt,5,5),mt.strokeText(dt,5,5),ot.debugOverlayTexture.update(K),ot.debugOverlayTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE)}(f,`${G} ${$}kB`),x.draw(c,p.TRIANGLES,w,E,wr.alphaBlended,ur.disabled,Lt(m,l.aT.transparent,H),null,A,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(c,p.LINE_STRIP,w,E,I,ur.disabled,Lt(m,l.aT.red),L,A,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Ir(f,e,o){let c=f.context,p=c.gl,m=f.colorModeForRenderPass(),x=new Be(p.LEQUAL,Be.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),E=e.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,f.width,f.height]);for(let I of o){let A=f.renderToTexture.getTexture(I),L=e.getTerrainData(I.tileID);c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A.texture);let F={u_matrix:f.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(f.transform.zoom)};w.draw(c,p.TRIANGLES,x,gr.disabled,m,ur.backCCW,F,L,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class ns{constructor(e,o){this.context=new ip(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=Vn.maxUnderzooming+Vn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ts}resize(e,o,c){if(this.width=Math.floor(e*c),this.height=Math.floor(o*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style._order)this.style._layers[p].resize()}setup(){let e=this.context,o=new l.a_;o.emplaceBack(0,0),o.emplaceBack(l.N,0),o.emplaceBack(0,l.N),o.emplaceBack(l.N,l.N),this.tileExtentBuffer=e.createVertexBuffer(o,cl.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);let c=new l.a_;c.emplaceBack(0,0),c.emplaceBack(l.N,0),c.emplaceBack(0,l.N),c.emplaceBack(l.N,l.N),this.debugBuffer=e.createVertexBuffer(c,cl.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);let p=new l.V;p.emplaceBack(0,0,0,0),p.emplaceBack(l.N,0,l.N,0),p.emplaceBack(0,l.N,0,l.N),p.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=e.createVertexBuffer(p,ln.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);let m=new l.a_;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,cl.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);let x=new l.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);let w=new l.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);let E=this.context.gl;this.stencilClearMode=new gr({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){let e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let c=l.Z();l.aS(c,0,this.width,this.height,0,0,1),l.a0(c,c,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Be.disabled,this.stencilClearMode,wr.disabled,ur.disabled,Rt(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;let c=this.context,p=c.gl;this.nextStencilID+o.length>256&&this.clearStencil(),c.setColorMode(wr.disabled),c.setDepthMode(Be.disabled);let m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let x of o){let w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);m.draw(c,p.TRIANGLES,Be.disabled,new gr({func:p.ALWAYS,mask:0},w,255,p.KEEP,p.KEEP,p.REPLACE),wr.disabled,ur.disabled,Rt(x.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,o=this.context.gl;return new gr({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){let o=this.context.gl;return new gr({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){let o=this.context.gl,c=e.sort((x,w)=>w.overscaledZ-x.overscaledZ),p=c[c.length-1].overscaledZ,m=c[0].overscaledZ-p+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();let x={};for(let w=0;w<m;w++)x[w+p]=new gr({func:o.GEQUAL,mask:255},w+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=m,[x,c]}return[{[p]:gr.disabled},c]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new wr([e.CONSTANT_COLOR,e.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wr.unblended:wr.alphaBlended}depthModeForSublayer(e,o,c){if(!this.opaquePassEnabledForLayer())return Be.disabled;let p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Be(c||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();let c=this.style._order,p=this.style.sourceCaches,m={},x={},w={};for(let E in p){let I=p[E];I.used&&I.prepare(this.context),m[E]=I.getVisibleCoordinates(),x[E]=m[E].slice().reverse(),w[E]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<c.length;E++)if(this.style._layers[c[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(I,A){let L=I.context,F=L.gl,$=wr.unblended,Z=new Be(F.LEQUAL,Be.ReadWrite,[0,1]),H=A.getTerrainMesh(),G=A.sourceCache.getRenderableTiles(),ot=I.useProgram("terrainDepth");L.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),L.clear({color:l.aT.transparent,depth:1});for(let dt of G){let K=A.getTerrainData(dt.tileID),lt={u_matrix:I.transform.calculatePosMatrix(dt.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(I.transform.zoom)};ot.draw(L,F.TRIANGLES,Z,gr.disabled,$,ur.backCCW,lt,K,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain),function(I,A){let L=I.context,F=L.gl,$=wr.unblended,Z=new Be(F.LEQUAL,Be.ReadWrite,[0,1]),H=A.getTerrainMesh(),G=A.getCoordsTexture(),ot=A.sourceCache.getRenderableTiles(),dt=I.useProgram("terrainCoords");L.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),L.clear({color:l.aT.transparent,depth:1}),A.coordsIndex=[];for(let K of ot){let lt=A.getTerrainData(K.tileID);L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.texture);let mt={u_matrix:I.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(I.transform.zoom)};dt.draw(L,F.TRIANGLES,Z,gr.disabled,$,ur.backCCW,mt,lt,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),A.coordsIndex.push(K.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(let E of c){let I=this.style._layers[E];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;let A=x[I.source];(I.type==="custom"||A.length)&&this.renderLayer(this,p[I.source],I,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){let E=this.style._layers[c[this.currentLayer]],I=p[E.source],A=m[E.source];this._renderTileClippingMasks(E,A),this.renderLayer(this,I,E,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){let E=this.style._layers[c[this.currentLayer]],I=p[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;let A=(E.type==="symbol"?w:x)[E.source];this._renderTileClippingMasks(E,m[E.source]),this.renderLayer(this,I,E,A)}if(this.options.showTileBoundaries){let E=function(I,A){let L=null,F=Object.values(I._layers).flatMap(G=>G.source&&!G.isHidden(A)?[I.sourceCaches[G.source]]:[]),$=F.filter(G=>G.getSource().type==="vector"),Z=F.filter(G=>G.getSource().type!=="vector"),H=G=>{(!L||L.getSource().maxzoom<G.getSource().maxzoom)&&(L=G)};return $.forEach(G=>H(G)),L||Z.forEach(G=>H(G)),L}(this.style,this.transform.zoom);E&&function(I,A,L){for(let F=0;F<L.length;F++)Tu(I,A,L[F])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){let I=E.transform.padding;la(E,E.transform.height-(I.top||0),3,Za),la(E,I.bottom||0,3,vl),xl(E,I.left||0,3,Ts),xl(E,E.transform.width-(I.right||0),3,Pc);let A=E.transform.centerPoint;(function(L,F,$,Z){ua(L,F-1,$-10,2,20,Z),ua(L,F-10,$-1,20,2,Z)})(E,A.x,E.transform.height-A.y,Ta)}(this),this.context.setDefault()}renderLayer(e,o,c,p){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(p||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(m,x,w,E,I){if(m.renderPass!=="translucent")return;let A=gr.disabled,L=m.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,$,Z,H,G,ot,dt){let K=$.transform,lt=G==="map",mt=ot==="map";for(let gt of F){let St=H.getTile(gt),Mt=St.getBucket(Z);if(!Mt||!Mt.text||!Mt.text.segments.get().length)continue;let Ct=l.ah(Mt.textSizeData,K.zoom),zt=nt(St,1,$.transform.zoom),te=Ot(gt.posMatrix,mt,lt,$.transform,zt),ze=Z.layout.get("icon-text-fit")!=="none"&&Mt.hasIconData();if(Ct){let Ut=Math.pow(2,K.zoom-St.tileID.overscaledZ);_l(Mt,lt,mt,dt,K,te,gt.posMatrix,Ut,Ct,ze,$.style.map.terrain?(pe,re)=>$.style.map.terrain.getElevation(gt,pe,re):null)}}}(E,m,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),I),w.paint.get("icon-opacity").constantOr(1)!==0&&Vs(m,x,w,E,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),A,L),w.paint.get("text-opacity").constantOr(1)!==0&&Vs(m,x,w,E,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),A,L),x.map.showCollisionBoxes&&(wa(m,x,w,E,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),wa(m,x,w,E,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(e,o,c,p,this.style.placement.variableOffsets);break;case"circle":(function(m,x,w,E){if(m.renderPass!=="translucent")return;let I=w.paint.get("circle-opacity"),A=w.paint.get("circle-stroke-width"),L=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(A.constantOr(1)===0||L.constantOr(1)===0))return;let $=m.context,Z=$.gl,H=m.depthModeForSublayer(0,Be.ReadOnly),G=gr.disabled,ot=m.colorModeForRenderPass(),dt=[];for(let K=0;K<E.length;K++){let lt=E[K],mt=x.getTile(lt),gt=mt.getBucket(w);if(!gt)continue;let St=gt.programConfigurations.get(w.id),Mt=m.useProgram("circle",St),Ct=gt.layoutVertexBuffer,zt=gt.indexBuffer,te=m.style.map.terrain&&m.style.map.terrain.getTerrainData(lt),ze={programConfiguration:St,program:Mt,layoutVertexBuffer:Ct,indexBuffer:zt,uniformValues:vt(m,lt,mt,w),terrainData:te};if(F){let Ut=gt.segments.get();for(let pe of Ut)dt.push({segments:new l.S([pe]),sortKey:pe.sortKey,state:ze})}else dt.push({segments:gt.segments,sortKey:0,state:ze})}F&&dt.sort((K,lt)=>K.sortKey-lt.sortKey);for(let K of dt){let{programConfiguration:lt,program:mt,layoutVertexBuffer:gt,indexBuffer:St,uniformValues:Mt,terrainData:Ct}=K.state;mt.draw($,Z.TRIANGLES,H,G,ot,ur.disabled,Mt,Ct,w.id,gt,St,K.segments,w.paint,m.transform.zoom,lt)}})(e,o,c,p);break;case"heatmap":(function(m,x,w,E){if(w.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let I=m.context,A=I.gl,L=gr.disabled,F=new wr([A.ONE,A.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function($,Z,H){let G=$.gl;$.activeTexture.set(G.TEXTURE1),$.viewport.set([0,0,Z.width/4,Z.height/4]);let ot=H.heatmapFbo;if(ot)G.bindTexture(G.TEXTURE_2D,ot.colorAttachment.get()),$.bindFramebuffer.set(ot.framebuffer);else{let dt=G.createTexture();G.bindTexture(G.TEXTURE_2D,dt),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ot=H.heatmapFbo=$.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(K,lt,mt,gt){var St,Mt;let Ct=K.gl,zt=(St=K.HALF_FLOAT)!==null&&St!==void 0?St:Ct.UNSIGNED_BYTE,te=(Mt=K.RGBA16F)!==null&&Mt!==void 0?Mt:Ct.RGBA;Ct.texImage2D(Ct.TEXTURE_2D,0,te,lt.width/4,lt.height/4,0,Ct.RGBA,zt,null),gt.colorAttachment.set(mt)}($,Z,dt,ot)}})(I,m,w),I.clear({color:l.aT.transparent});for(let $=0;$<E.length;$++){let Z=E[$];if(x.hasRenderableParent(Z))continue;let H=x.getTile(Z),G=H.getBucket(w);if(!G)continue;let ot=G.programConfigurations.get(w.id),dt=m.useProgram("heatmap",ot),{zoom:K}=m.transform;dt.draw(I,A.TRIANGLES,Be.disabled,L,F,ur.disabled,fe(Z.posMatrix,H,K,w.paint.get("heatmap-intensity")),null,w.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,w.paint,m.transform.zoom,ot)}I.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(I,A){let L=I.context,F=L.gl,$=A.heatmapFbo;if(!$)return;L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,$.colorAttachment.get()),L.activeTexture.set(F.TEXTURE1);let Z=A.colorRampTexture;Z||(Z=A.colorRampTexture=new je(L,A.colorRamp,F.RGBA)),Z.bind(F.LINEAR,F.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(L,F.TRIANGLES,Be.disabled,gr.disabled,I.colorModeForRenderPass(),ur.disabled,((H,G,ot,dt)=>{let K=l.Z();l.aS(K,0,H.width,H.height,0,0,1);let lt=H.context.gl;return{u_matrix:K,u_world:[lt.drawingBufferWidth,lt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(I,A),null,A.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,A.paint,I.transform.zoom)}(m,w))})(e,o,c,p);break;case"line":(function(m,x,w,E){if(m.renderPass!=="translucent")return;let I=w.paint.get("line-opacity"),A=w.paint.get("line-width");if(I.constantOr(1)===0||A.constantOr(1)===0)return;let L=m.depthModeForSublayer(0,Be.ReadOnly),F=m.colorModeForRenderPass(),$=w.paint.get("line-dasharray"),Z=w.paint.get("line-pattern"),H=Z.constantOr(1),G=w.paint.get("line-gradient"),ot=w.getCrossfadeParameters(),dt=H?"linePattern":$?"lineSDF":G?"lineGradient":"line",K=m.context,lt=K.gl,mt=!0;for(let gt of E){let St=x.getTile(gt);if(H&&!St.patternsLoaded())continue;let Mt=St.getBucket(w);if(!Mt)continue;let Ct=Mt.programConfigurations.get(w.id),zt=m.context.program.get(),te=m.useProgram(dt,Ct),ze=mt||te.program!==zt,Ut=m.style.map.terrain&&m.style.map.terrain.getTerrainData(gt),pe=Z.constantOr(null);if(pe&&St.imageAtlas){let De=St.imageAtlas,Te=De.patternPositions[pe.to.toString()],Re=De.patternPositions[pe.from.toString()];Te&&Re&&Ct.setConstantPatternPositions(Te,Re)}let re=Ut?gt:null,or=H?Ie(m,St,w,ot,re):$?dr(m,St,w,$,ot,re):G?Ae(m,St,w,Mt.lineClipsArray.length,re):Ce(m,St,w,re);if(H)K.activeTexture.set(lt.TEXTURE0),St.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),Ct.updatePaintBuffers(ot);else if($&&(ze||m.lineAtlas.dirty))K.activeTexture.set(lt.TEXTURE0),m.lineAtlas.bind(K);else if(G){let De=Mt.gradients[w.id],Te=De.texture;if(w.gradientVersion!==De.version){let Re=256;if(w.stepInterpolant){let Rr=x.getSource().maxzoom,pr=gt.canonical.z===Rr?Math.ceil(1<<m.transform.maxZoom-gt.canonical.z):1;Re=l.ad(l.aY(Mt.maxLineLength/l.N*1024*pr),256,K.maxTextureSize)}De.gradient=l.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:De.gradient||void 0,clips:Mt.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new je(K,De.gradient,lt.RGBA),De.version=w.gradientVersion,Te=De.texture}K.activeTexture.set(lt.TEXTURE0),Te.bind(w.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}te.draw(K,lt.TRIANGLES,L,m.stencilModeForClipping(gt),F,ur.disabled,or,Ut,w.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,w.paint,m.transform.zoom,Ct,Mt.layoutVertexBuffer2),mt=!1}})(e,o,c,p);break;case"fill":(function(m,x,w,E){let I=w.paint.get("fill-color"),A=w.paint.get("fill-opacity");if(A.constantOr(1)===0)return;let L=m.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),$=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&I.constantOr(l.aT.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===$){let Z=m.depthModeForSublayer(1,m.renderPass==="opaque"?Be.ReadWrite:Be.ReadOnly);Sa(m,x,w,E,Z,L,!1)}if(m.renderPass==="translucent"&&w.paint.get("fill-antialias")){let Z=m.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Be.ReadOnly);Sa(m,x,w,E,Z,L,!0)}})(e,o,c,p);break;case"fill-extrusion":(function(m,x,w,E){let I=w.paint.get("fill-extrusion-opacity");if(I!==0&&m.renderPass==="translucent"){let A=new Be(m.context.gl.LEQUAL,Be.ReadWrite,m.depthRangeFor3D);if(I!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ea(m,x,w,E,A,gr.disabled,wr.disabled),Ea(m,x,w,E,A,m.stencilModeFor3D(),m.colorModeForRenderPass());else{let L=m.colorModeForRenderPass();Ea(m,x,w,E,A,gr.disabled,L)}}})(e,o,c,p);break;case"hillshade":(function(m,x,w,E){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;let I=m.context,A=m.depthModeForSublayer(0,Be.ReadOnly),L=m.colorModeForRenderPass(),[F,$]=m.renderPass==="translucent"?m.stencilConfigForOverlap(E):[{},E];for(let Z of $){let H=x.getTile(Z);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&m.renderPass==="offscreen"?Wl(m,H,w,A,gr.disabled,L):m.renderPass==="translucent"&&zh(m,Z,H,w,A,F[Z.overscaledZ],L)}I.viewport.set([0,0,m.width,m.height])})(e,o,c,p);break;case"raster":(function(m,x,w,E){if(m.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!E.length)return;let I=m.context,A=I.gl,L=x.getSource(),F=m.useProgram("raster"),$=m.colorModeForRenderPass(),[Z,H]=L instanceof Qe?[{},E]:m.stencilConfigForOverlap(E),G=H[H.length-1].overscaledZ,ot=!m.options.moving;for(let dt of H){let K=m.depthModeForSublayer(dt.overscaledZ-G,w.paint.get("raster-opacity")===1?Be.ReadWrite:Be.ReadOnly,A.LESS),lt=x.getTile(dt);lt.registerFadeDuration(w.paint.get("raster-fade-duration"));let mt=x.findLoadedParent(dt,0),gt=rc(lt,mt,x,w,m.transform,m.style.map.terrain),St,Mt,Ct=w.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),lt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(A.TEXTURE1),mt?(mt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),St=Math.pow(2,mt.tileID.overscaledZ-lt.tileID.overscaledZ),Mt=[lt.tileID.canonical.x*St%1,lt.tileID.canonical.y*St%1]):lt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);let zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(dt),te=zt?dt:null,ze=te?te.posMatrix:m.transform.calculatePosMatrix(dt.toUnwrapped(),ot),Ut=Mi(ze,Mt||[0,0],St||1,gt,w);L instanceof Qe?F.draw(I,A.TRIANGLES,K,gr.disabled,$,ur.disabled,Ut,zt,w.id,L.boundsBuffer,m.quadTriangleIndexBuffer,L.boundsSegments):F.draw(I,A.TRIANGLES,K,Z[dt.overscaledZ],$,ur.disabled,Ut,zt,w.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(e,o,c,p);break;case"background":(function(m,x,w,E){let I=w.paint.get("background-color"),A=w.paint.get("background-opacity");if(A===0)return;let L=m.context,F=L.gl,$=m.transform,Z=$.tileSize,H=w.paint.get("background-pattern");if(m.isPatternMissing(H))return;let G=!H&&I.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==G)return;let ot=gr.disabled,dt=m.depthModeForSublayer(0,G==="opaque"?Be.ReadWrite:Be.ReadOnly),K=m.colorModeForRenderPass(),lt=m.useProgram(H?"backgroundPattern":"background"),mt=E||$.coveringTiles({tileSize:Z,terrain:m.style.map.terrain});H&&(L.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context));let gt=w.getCrossfadeParameters();for(let St of mt){let Mt=E?St.posMatrix:m.transform.calculatePosMatrix(St.toUnwrapped()),Ct=H?ni(Mt,A,m,H,{tileID:St,tileSize:Z},gt):Qn(Mt,A,I),zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(St);lt.draw(L,F.TRIANGLES,dt,ot,K,ur.disabled,Ct,zt,w.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(e,0,c,p);break;case"custom":(function(m,x,w){let E=m.context,I=w.implementation;if(m.renderPass==="offscreen"){let A=I.prerender;A&&(m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),A.call(I,E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),E.setStencilMode(gr.disabled);let A=I.renderingMode==="3d"?new Be(m.context.gl.LEQUAL,Be.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Be.ReadOnly);E.setDepthMode(A),I.render(E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,c)}}translatePosMatrix(e,o,c,p,m){if(!c[0]&&!c[1])return e;let x=m?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){let I=Math.sin(x),A=Math.cos(x);c=[c[0]*A-c[1]*I,c[0]*I+c[1]*A]}let w=[m?c[0]:nt(o,c[0],this.transform.zoom),m?c[1]:nt(o,c[1],this.transform.zoom),0],E=new Float32Array(16);return l.$(E,e,w),E}saveTileTexture(e){let o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let o=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!o||!c}useProgram(e,o){this.cache=this.cache||{};let c=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new Va(this.context,br[e],o,hl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class On{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,c){let p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let E=1/(w=l.ag([],w,e))[3]/o*p;return l.b3(w,w,[E,E,1/w[3],E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let E=function(F,$){var Z=$[0],H=$[1],G=$[2],ot=Z*Z+H*H+G*G;return ot>0&&(ot=1/Math.sqrt(ot)),F[0]=$[0]*ot,F[1]=$[1]*ot,F[2]=$[2]*ot,F}([],function(F,$,Z){var H=$[0],G=$[1],ot=$[2],dt=Z[0],K=Z[1],lt=Z[2];return F[0]=G*lt-ot*K,F[1]=ot*dt-H*lt,F[2]=H*K-G*dt,F}([],ke([],m[w[0]],m[w[1]]),ke([],m[w[2]],m[w[1]]))),I=-((A=E)[0]*(L=m[w[1]])[0]+A[1]*L[1]+A[2]*L[2]);var A,L;return E.concat(I)});return new On(m,x)}}class Uo{constructor(e,o){this.min=e,this.max=o,this.center=function(c,p,m){return c[0]=.5*p[0],c[1]=.5*p[1],c[2]=.5*p[2],c}([],function(c,p,m){return c[0]=p[0]+m[0],c[1]=p[1]+m[1],c[2]=p[2]+m[2],c}([],this.min,this.max))}quadrant(e){let o=[e%2==0,e<2],c=le(this.min),p=le(this.max);for(let m=0;m<o.length;m++)c[m]=o[m]?this.min[m]:this.center[m],p[m]=o[m]?this.center[m]:this.max[m];return p[2]=this.max[2],new Uo(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],c=!0;for(let p=0;p<e.planes.length;p++){let m=e.planes[p],x=0;for(let w=0;w<o.length;w++)l.b4(m,o[w])>=0&&x++;if(x===0)return 0;x!==o.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let m=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){let E=e.points[w][p]-this.min[p];m=Math.min(m,E),x=Math.max(x,E)}if(x<0||m>this.max[p]-this.min[p])return 0}return 1}}class ca{constructor(e=0,o=0,c=0,p=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=c,this.right=p}interpolate(e,o,c){return o.top!=null&&e.top!=null&&(this.top=l.B.number(e.top,o.top,c)),o.bottom!=null&&e.bottom!=null&&(this.bottom=l.B.number(e.bottom,o.bottom,c)),o.left!=null&&e.left!=null&&(this.left=l.B.number(e.left,o.left,c)),o.right!=null&&e.right!=null&&(this.right=l.B.number(e.right,o.right,c)),this}getCenter(e,o){let c=l.ad((this.left+e-this.right)/2,0,e),p=l.ad((this.top+o-this.bottom)/2,0,o);return new l.P(c,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class bl{constructor(e,o,c,p,m){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let e=new bl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let o=-l.b5(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var c=new l.A(4);return l.A!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,p,m){var x=p[0],w=p[1],E=p[2],I=p[3],A=Math.sin(m),L=Math.cos(m);c[0]=x*L+E*A,c[1]=w*L+I*A,c[2]=x*-A+E*L,c[3]=w*-A+I*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let o=l.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,c){this._unmodified=!1,this._edgeInsets.interpolate(e,o,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){let o=[new l.b6(0,e)];if(this._renderWorldCopies){let c=this.pointCoordinate(new l.P(0,0)),p=this.pointCoordinate(new l.P(this.width,0)),m=this.pointCoordinate(new l.P(this.width,this.height)),x=this.pointCoordinate(new l.P(0,this.height)),w=Math.floor(Math.min(c.x,p.x,m.x,x.x)),E=Math.floor(Math.max(c.x,p.x,m.x,x.x)),I=1;for(let A=w-I;A<=E+I;A++)A!==0&&o.push(new l.b6(A,e))}return o}coveringTiles(e){var o,c;let p=this.coveringZoomLevel(e),m=p;if(e.minzoom!==void 0&&p<e.minzoom)return[];e.maxzoom!==void 0&&p>e.maxzoom&&(p=e.maxzoom);let x=this.pointCoordinate(this.getCameraPoint()),w=l.U.fromLngLat(this.center),E=Math.pow(2,p),I=[E*x.x,E*x.y,0],A=[E*w.x,E*w.y,0],L=On.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p),F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=p);let $=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,Z=K=>({aabb:new Uo([K*E,0,0],[(K+1)*E,E,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),H=[],G=[],ot=p,dt=e.reparseOverscaled?m:p;if(this._renderWorldCopies)for(let K=1;K<=3;K++)H.push(Z(-K)),H.push(Z(K));for(H.push(Z(0));H.length>0;){let K=H.pop(),lt=K.x,mt=K.y,gt=K.fullyVisible;if(!gt){let te=K.aabb.intersects(L);if(te===0)continue;gt=te===2}let St=e.terrain?I:A,Mt=K.aabb.distanceX(St),Ct=K.aabb.distanceY(St),zt=Math.max(Math.abs(Mt),Math.abs(Ct));if(K.zoom===ot||zt>$+(1<<ot-K.zoom)-2&&K.zoom>=F){let te=ot-K.zoom,ze=I[0]-.5-(lt<<te),Ut=I[1]-.5-(mt<<te);G.push({tileID:new l.O(K.zoom===ot?dt:K.zoom,K.wrap,K.zoom,lt,mt),distanceSq:er([A[0]-.5-lt,A[1]-.5-mt]),tileDistanceToCamera:Math.sqrt(ze*ze+Ut*Ut)})}else for(let te=0;te<4;te++){let ze=(lt<<1)+te%2,Ut=(mt<<1)+(te>>1),pe=K.zoom+1,re=K.aabb.quadrant(te);if(e.terrain){let or=new l.O(pe,K.wrap,pe,ze,Ut),De=e.terrain.getMinMaxElevation(or),Te=(o=De.minElevation)!==null&&o!==void 0?o:this.elevation,Re=(c=De.maxElevation)!==null&&c!==void 0?c:this.elevation;re=new Uo([re.min[0],re.min[1],Te],[re.max[0],re.max[1],Re])}H.push({aabb:re,zoom:pe,x:ze,y:Ut,wrap:K.wrap,fullyVisible:gt})}}return G.sort((K,lt)=>K.distanceSq-lt.distanceSq).map(K=>K.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let o=l.ad(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(e.lng)*this.worldSize,l.H(o)*this.worldSize)}unproject(e){return new l.U(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let o=this.pointLocation(this.centerPoint,e),c=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-c))return;let p=this.getCameraPosition(),m=l.U.fromLngLat(p.lngLat,p.altitude),x=l.U.fromLngLat(o,c),w=m.x-x.x,E=m.y-x.y,I=m.z-x.z,A=Math.sqrt(w*w+E*E+I*I),L=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=c,this._center=o,this.zoom=L}setLocationAtPoint(e,o){let c=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),x=new l.U(m.x-(c.x-p.x),m.y-(c.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return l.U.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){let F=o.pointCoordinate(e);if(F!=null)return F}let c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];l.ag(c,c,this.pixelMatrixInverse),l.ag(p,p,this.pixelMatrixInverse);let m=c[3],x=p[3],w=c[1]/m,E=p[1]/x,I=c[2]/m,A=p[2]/x,L=I===A?0:(0-I)/(A-I);return new l.U(l.B.number(c[0]/m,p[0]/x,L)/this.worldSize,l.B.number(w,E,L)/this.worldSize)}coordinatePoint(e,o=0,c=this.pixelMatrix){let p=[e.x*this.worldSize,e.y*this.worldSize,o,1];return l.ag(p,p,c),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new l.P(0,e))).extend(this.pointLocation(new l.P(this.width,e))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,o=!1){let c=e.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];let m=e.canonical,x=this.worldSize/this.zoomScale(m.z),w=m.x+Math.pow(2,m.z)*e.wrap,E=l.ao(new Float64Array(16));return l.$(E,E,[w*x,m.y*x,0]),l.a0(E,E,[x/l.N,x/l.N,1]),l.a1(E,o?this.alignedProjMatrix:this.projMatrix,E),p[c]=new Float32Array(E),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,o,c,p,m=-90,x=90,w=-180,E=180,I=this.size,A=this._unmodified;if(this.latRange){let $=this.latRange;m=l.H($[1])*this.worldSize,x=l.H($[0])*this.worldSize,e=x-m<I.y?I.y/(x-m):0}if(this.lngRange){let $=this.lngRange;w=l.b5(l.G($[0])*this.worldSize,0,this.worldSize),E=l.b5(l.G($[1])*this.worldSize,0,this.worldSize),E<w&&(E+=this.worldSize),o=E-w<I.x?I.x/(E-w):0}let L=this.point,F=Math.max(o||0,e||0);if(F)return this.center=this.unproject(new l.P(o?(E+w)/2:L.x,e?(x+m)/2:L.y)),this.zoom+=this.scaleZoom(F),this._unmodified=A,void(this._constraining=!1);if(this.latRange){let $=L.y,Z=I.y/2;$-Z<m&&(p=m+Z),$+Z>x&&(p=x-Z)}if(this.lngRange){let $=(w+E)/2,Z=l.b5(L.x,$-this.worldSize/2,$+this.worldSize/2),H=I.x/2;Z-H<w&&(c=w+H),Z+H>E&&(c=E-H)}c===void 0&&p===void 0||(this.center=this.unproject(new l.P(c!==void 0?c:L.x,p!==void 0?p:L.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,o=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let p=l.ao(new Float64Array(16));l.a0(p,p,[this.width/2,-this.height/2,1]),l.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.ao(new Float64Array(16)),l.a0(p,p,[1,-1,1]),l.$(p,p,[-1,-1,0]),l.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;let m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=m-x*this._pixelPerMeter/Math.cos(this._pitch),E=x<0?w:m,I=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),L=Math.sin(A)*E/Math.sin(l.ad(Math.PI-I-A,.01,Math.PI-.01)),F=this.getHorizon(),$=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),Z=Math.sin($)*E/Math.sin(l.ad(Math.PI-I-$,.01,Math.PI-.01)),H=Math.min(L,Z),G=1.01*(Math.cos(Math.PI/2-this._pitch)*H+E),ot=this.height/50;p=new Float64Array(16),l.b8(p,this._fov,this.width/this.height,ot,G),p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,l.a0(p,p,[1,-1,1]),l.$(p,p,[0,0,-this.cameraToCenterDistance]),l.b9(p,p,this._pitch),l.ae(p,p,this.angle),l.$(p,p,[-o,-c,0]),this.mercatorMatrix=l.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),l.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,p),l.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.as([],p),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,p);let dt=this.width%2/2,K=this.height%2/2,lt=Math.cos(this.angle),mt=Math.sin(this.angle),gt=o-Math.round(o)+lt*dt+mt*K,St=c-Math.round(c)+lt*K+mt*dt,Mt=new Float64Array(p);if(l.$(Mt,Mt,[gt>.5?gt-1:gt,St>.5?St-1:St,0]),this.alignedProjMatrix=Mt,p=l.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new l.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.ag(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,e))}getCameraQueryGeometry(e){let o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let c=o.x,p=o.y,m=o.x,x=o.y;for(let w of e)c=Math.min(c,w.x),p=Math.min(p,w.y),m=Math.max(m,w.x),x=Math.max(x,w.y);return[new l.P(c,p),new l.P(m,p),new l.P(m,x),new l.P(c,x),new l.P(c,p)]}}}function kt(f,e){let o,c=!1,p=null,m=null,x=()=>{p=null,c&&(f.apply(m,o),p=setTimeout(x,e),c=!1)};return(...w)=>(c=!0,m=this,o=w,p||x(),p)}class Wt{constructor(e){this._getCurrentHash=()=>{let o=window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{let o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){let c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=kt(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){let o=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,p),x=Math.round(o.lng*m)/m,w=Math.round(o.lat*m)/m,E=this._map.getBearing(),I=this._map.getPitch(),A="";if(A+=e?`/${x}/${w}/${c}`:`${c}/${w}/${x}`,(E||I)&&(A+="/"+Math.round(10*E)/10),I&&(A+=`/${Math.round(I)}`),this._hashName){let L=this._hashName,F=!1,$=window.location.hash.slice(1).split("&").map(Z=>{let H=Z.split("=")[0];return H===L?(F=!0,`${H}=${A}`):Z}).filter(Z=>Z);return F||$.push(`${L}=${A}`),`#${$.join("&")}`}return`#${A}`}}let we={linearity:.3,easing:l.ba(0,0,.3,1)},rr=l.e({deceleration:2500,maxSpeed:1400},we),jn=l.e({deceleration:20,maxSpeed:1400},we),$r=l.e({deceleration:1e3,maxSpeed:360},we),yi=l.e({deceleration:1e3,maxSpeed:90},we);class Di{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,o=l.h.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:m}of this._inertiaBuffer)o.zoom+=m.zoomDelta||0,o.bearing+=m.bearingDelta||0,o.pitch+=m.pitchDelta||0,m.panDelta&&o.pan._add(m.panDelta),m.around&&(o.around=m.around),m.pinchAround&&(o.pinchAround=m.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){let m=Gn(o.pan.mag(),c,l.e({},rr,e||{}));p.offset=o.pan.mult(m.amount/o.pan.mag()),p.center=this._map.transform.center,Tn(p,m)}if(o.zoom){let m=Gn(o.zoom,c,jn);p.zoom=this._map.transform.zoom+m.amount,Tn(p,m)}if(o.bearing){let m=Gn(o.bearing,c,$r);p.bearing=this._map.transform.bearing+l.ad(m.amount,-179,179),Tn(p,m)}if(o.pitch){let m=Gn(o.pitch,c,yi);p.pitch=this._map.transform.pitch+m.amount,Tn(p,m)}if(p.zoom||p.bearing){let m=o.pinchAround===void 0?o.around:o.pinchAround;p.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function Tn(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Gn(f,e,o){let{maxSpeed:c,linearity:p,deceleration:m}=o,x=l.ad(f*p/(e/1e3),-c,c),w=Math.abs(x)/(m*p);return{easing:o.easing,duration:1e3*w,amount:x*(w/2)}}class Mr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c,p={}){let m=R.mousePos(o.getCanvasContainer(),c),x=o.unproject(m);super(e,l.e({point:m,lngLat:x,originalEvent:c},p)),this._defaultPrevented=!1,this.target=o}}class so extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c){let p=e==="touchend"?c.changedTouches:c.touches,m=R.touchPos(o.getCanvasContainer(),p),x=m.map(E=>o.unproject(E)),w=m.reduce((E,I,A,L)=>E.add(I.div(L.length)),new l.P(0,0));super(e,{points:m,point:w,lngLats:x,lngLat:o.unproject(w),originalEvent:c}),this._defaultPrevented=!1}}class Us extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class go{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Us(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Mr(e.type,this._map,e))}mouseup(e){this._map.fire(new Mr(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Mr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mr(e.type,this._map,e))}mouseover(e){this._map.fire(new Mr(e.type,this._map,e))}mouseout(e){this._map.fire(new Mr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new so(e.type,this._map,e))}touchmove(e){this._map.fire(new so(e.type,this._map,e))}touchend(e){this._map.fire(new so(e.type,this._map,e))}touchcancel(e){this._map.fire(new so(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class js{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ki{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(l.P.convert(e),this._map.terrain)}}class Jl{constructor(e,o){this._map=e,this._tr=new ki(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(R.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;let c=o;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;let p=this._startPos;this._lastPos=c,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let m=Math.min(p.x,c.x),x=Math.max(p.x,c.x),w=Math.min(p.y,c.y),E=Math.max(p.y,c.y);R.setTransform(this._box,`translate(${m}px,${w}px)`),this._box.style.width=x-m+"px",this._box.style.height=E-w+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;let c=this._startPos,p=o;if(this.reset(),R.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(c,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new l.k(e,{originalEvent:o}))}}function Fn(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);let o={};for(let c=0;c<f.length;c++)o[f[c].identifier]=e[c];return o}class Fi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){let m=new l.P(0,0);for(let x of p)m._add(x);return m.div(p.length)}(o),this.touches=Fn(c,o)))}touchmove(e,o,c){if(this.aborted||!this.centroid)return;let p=Fn(c,o);for(let m in this.touches){let x=p[m];(!x||x.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,o,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Xa{constructor(e){this.singleTap=new Fi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,c){this.singleTap.touchstart(e,o,c)}touchmove(e,o,c){this.singleTap.touchmove(e,o,c)}touchend(e,o,c){let p=this.singleTap.touchend(e,o,c);if(p){let m=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(m&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class yo{constructor(e){this._tr=new ki(e),this._zoomIn=new Xa({numTouches:1,numTaps:2}),this._zoomOut=new Xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,c){this._zoomIn.touchstart(e,o,c),this._zoomOut.touchstart(e,o,c)}touchmove(e,o,c){this._zoomIn.touchmove(e,o,c),this._zoomOut.touchmove(e,o,c)}touchend(e,o,c){let p=this._zoomIn.touchend(e,o,c),m=this._zoomOut.touchend(e,o,c),x=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _o{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;let c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let p=o.length?o[0]:o;return!this._moved&&p.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(c,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&R.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let qn={0:1,2:2};class hn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let o=R.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,c){let p=qn[c];return o.buttons===void 0||(o.buttons&p)!==p}(e,this._eventButton)}isValidEndEvent(e){return R.mouseButton(e)===this._eventButton}}class Kl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let is=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=function(e){e.preventDefault()}},fs=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{let c=new hn({checkCorrectEvent:p=>R.mouseButton(p)===0&&p.ctrlKey||R.mouseButton(p)===2});return new _o({clickTolerance:e,move:(p,m)=>({bearingDelta:(m.x-p.x)*o}),moveStateManager:c,enable:f,assignEvents:is})},Nn=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{let c=new hn({checkCorrectEvent:p=>R.mouseButton(p)===0&&p.ctrlKey||R.mouseButton(p)===2});return new _o({clickTolerance:e,move:(p,m)=>({pitchDelta:(m.y-p.y)*o}),moveStateManager:c,enable:f,assignEvents:is})};class Ht{constructor(e,o){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,o,c){return this._calculateTransform(e,o,c)}touchmove(e,o,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,o,c)}touchend(e,o,c){this._calculateTransform(e,o,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,c){c.length>0&&(this._active=!0);let p=Fn(c,o),m=new l.P(0,0),x=new l.P(0,0),w=0;for(let I in p){let A=p[I],L=this._touches[I];L&&(m._add(A),x._add(A.sub(L)),w++,p[I]=A)}if(this._touches=p,w<this._minTouches||!x.mag())return;let E=x.div(w);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(w),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class os{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,c){if(!this._firstTwoTouches)return;e.preventDefault();let[p,m]=this._firstTwoTouches,x=Wi(c,o,p),w=Wi(c,o,m);if(!x||!w)return;let E=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],E,e)}touchend(e,o,c){if(!this._firstTwoTouches)return;let[p,m]=this._firstTwoTouches,x=Wi(c,o,p),w=Wi(c,o,m);x&&w||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wi(f,e,o){for(let c=0;c<f.length;c++)if(f[c].identifier===o)return e[c]}function ss(f,e){return Math.log(f/e)/Math.LN2}class Ha extends os{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){let c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ss(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ss(this._distance,c),pinchAround:o}}}function Gt(f,e){return 180*f.angleWith(e)/Math.PI}class Ql extends os{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o){let c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gt(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let o=25/(Math.PI*this._minDiameter)*360,c=Gt(e,this._startVector);return Math.abs(c)<o}}function Ya(f){return Math.abs(f.y)>Math.abs(f.x)}class Ac extends os{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,c){super.touchstart(e,o,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Ya(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let p=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,m,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,c){if(this._valid!==void 0)return this._valid;let p=e.mag()>=2,m=o.mag()>=2;if(!p&&!m)return;if(!p||!m)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;let x=e.y>0==o.y>0;return Ya(e)&&Ya(o)&&x}}let Wa={panStep:100,bearingStep:15,pitchStep:10};class tu{constructor(e){this._tr=new ki(e);let o=Wa;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,c=0,p=0,m=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:w=>{let E=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:nc,zoom:o?Math.round(E.zoom)+o*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+c*this._bearingStep,pitch:E.pitch+p*this._pitchStep,offset:[-m*this._panStep,-x*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nc(f){return f*(2-f)}let eu=4.000244140625;class ic{constructor(e,o){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new ki(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,c=l.h.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,o!==0&&o%eu==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=R.mousePos(this._el,e),c=this._tr;this._around=l.L.convert(this._aroundCenter?c.center:c.unproject(o)),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let w=this._type==="wheel"&&Math.abs(this._delta)>eu?this._wheelZoomRate:this._defaultZoomRate,E=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&E!==0&&(E=1/E);let I=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(I*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,c=this._startZoom,p=this._easing,m,x=!1;if(this._type==="wheel"&&c&&p){let w=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),E=p(w);m=l.B.number(c,o,E),w<1?this._frameId||(this._frameId=!0):x=!0}else m=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=l.bb;if(this._prevEase){let c=this._prevEase,p=(l.h.now()-c.start)/c.duration,m=c.easing(p+.01)-c.easing(p),x=.27/Math.sqrt(m*m+1e-4)*.01,w=Math.sqrt(.0729-x*x);o=l.ba(x,w,.25,1)}return this._prevEase={start:l.h.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Lc{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mc{constructor(e){this._tr=new ki(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dc{constructor(){this._tap=new Xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,c){if(!this._swipePoint)if(this._tapTime){let p=o[0],m=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;m&&x?c.length>0&&(this._swipePoint=p,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,o,c)}touchmove(e,o,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let p=o[0],m=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,o,c)}touchend(e,o,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{let p=this._tap.touchend(e,o,c);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kc{constructor(e,o,c){this._el=e,this._mousePan=o,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ii{constructor(e,o,c){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ms{constructor(e,o,c,p){this._el=e,this._touchZoom=o,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let wl=f=>f.zoom||f.drag||f.pitch||f.rotate;class zc extends l.k{}function Sl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Rc{constructor(e,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,m)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let x=p.type==="renderFrame"?void 0:p,w={needsRenderFrame:!1},E={},I={},A=p.touches,L=A?this._getMapTouches(A):void 0,F=L?R.touchPos(this._el,L):R.mousePos(this._el,p);for(let{handlerName:H,handler:G,allowed:ot}of this._handlers){if(!G.isEnabled())continue;let dt;this._blockedByActive(I,ot,H)?G.reset():G[m||p.type]&&(dt=G[m||p.type](p,F,L),this.mergeHandlerResult(w,E,dt,H,x),dt&&dt.needsRenderFrame&&this._triggerRenderFrame()),(dt||G.isActive())&&(I[H]=G)}let $={};for(let H in this._previousActiveHandlers)I[H]||($[H]=x);this._previousActiveHandlers=I,(Object.keys($).length||Sl(w))&&(this._changes.push([w,E,$]),this._triggerRenderFrame()),(Object.keys(I).length||Sl(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Di(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[p,m,x]of this._listeners)R.addEventListener(p,m,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(let[e,o,c]of this._listeners)R.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){let o=this._map,c=o.getCanvasContainer();this._add("mapEvent",new go(o,e));let p=o.boxZoom=new Jl(o,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();let m=new yo(o),x=new Mc(o);o.doubleClickZoom=new Lc(x,m),this._add("tapZoom",m),this._add("clickZoom",x),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();let w=new Dc;this._add("tapDragZoom",w);let E=o.touchPitch=new Ac(o);this._add("touchPitch",E),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);let I=fs(e),A=Nn(e);o.dragRotate=new ii(e,I,A),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();let L=(({enable:ot,clickTolerance:dt})=>{let K=new hn({checkCorrectEvent:lt=>R.mouseButton(lt)===0&&!lt.ctrlKey});return new _o({clickTolerance:dt,move:(lt,mt)=>({around:mt,panDelta:mt.sub(lt)}),activateOnStart:!0,moveStateManager:K,enable:ot,assignEvents:is})})(e),F=new Ht(e,o);o.dragPan=new kc(c,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);let $=new Ql,Z=new Ha;o.touchZoomRotate=new ms(c,Z,$,w),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);let H=o.scrollZoom=new ic(o,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);let G=o.keyboard=new tu(o);this._add("keyboard",G),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new js(o))}_add(e,o,c){this._handlers.push({handlerName:e,handler:o,allowed:c}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wl(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,c){for(let p in e)if(p!==c&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(e){let o=[];for(let c of e)this._el.contains(c.target)&&o.push(c);return o}mergeHandlerResult(e,o,c,p,m){if(!c)return;l.e(e,c);let x={handlerName:p,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(o.zoom=x),c.panDelta!==void 0&&(o.drag=x),c.pitchDelta!==void 0&&(o.pitch=x),c.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){let e={},o={},c={};for(let[p,m,x]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),l.e(o,m),l.e(c,x);this._updateMapTransform(e,o,c),this._changes=[]}_updateMapTransform(e,o,c){let p=this._map,m=p._getTransformForUpdate(),x=p.terrain;if(!(Sl(e)||x&&this._terrainMovement))return this._fireEvents(o,c,!0);let{panDelta:w,zoomDelta:E,bearingDelta:I,pitchDelta:A,around:L,pinchAround:F}=e;F!==void 0&&(L=F),p._stop(!0),L=L||p.transform.centerPoint;let $=m.pointLocation(w?L.sub(w):L);I&&(m.bearing+=I),A&&(m.pitch+=A),E&&(m.zoom+=E),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(w)):m.setLocationAtPoint($,L):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint($,L),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(p.terrain)})):m.setLocationAtPoint($,L),p._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,c,!0)}_fireEvents(e,o,c){let p=wl(this._eventsInProgress),m=wl(e),x={};for(let A in e){let{originalEvent:L}=e[A];this._eventsInProgress[A]||(x[`${A}start`]=L),this._eventsInProgress[A]=e[A]}!p&&m&&this._fireEvent("movestart",m.originalEvent);for(let A in x)this._fireEvent(A,x[A]);m&&this._fireEvent("move",m.originalEvent);for(let A in e){let{originalEvent:L}=e[A];this._fireEvent(A,L)}let w={},E;for(let A in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[A];this._handlersById[L].isActive()||(delete this._eventsInProgress[A],E=o[L]||F,w[`${A}end`]=E)}for(let A in w)this._fireEvent(A,w[A]);let I=wl(this._eventsInProgress);if(c&&(p||m)&&!I){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!A||!A.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:E})),L(this._map.getBearing())&&this._map.resetNorth()):(L(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new l.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new zc("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class op extends l.E{constructor(e,o){super(),this._renderFrameCallback=()=>{let c=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,c){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},o),c)}panTo(e,o,c){return this.easeTo(l.e({center:e},o),c)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,c){return this.easeTo(l.e({zoom:e},o),c)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,c){return this.easeTo(l.e({bearing:e},o),c)}resetNorth(e,o){return this.rotateTo(0,l.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=Ne.convert(e);let c=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,o)}_cameraForBoxAndBearing(e,o,c,p){let m={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){let mt=p.padding;p.padding={top:mt,bottom:mt,right:mt,left:mt}}p.padding=l.e(m,p.padding);let x=this.transform,w=x.padding,E=x.project(l.L.convert(e)),I=x.project(l.L.convert(o)),A=E.rotate(-c*Math.PI/180),L=I.rotate(-c*Math.PI/180),F=new l.P(Math.max(A.x,L.x),Math.max(A.y,L.y)),$=new l.P(Math.min(A.x,L.x),Math.min(A.y,L.y)),Z=F.sub($),H=(x.width-(w.left+w.right+p.padding.left+p.padding.right))/Z.x,G=(x.height-(w.top+w.bottom+p.padding.top+p.padding.bottom))/Z.y;if(G<0||H<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ot=Math.min(x.scaleZoom(x.scale*Math.min(H,G)),p.maxZoom),dt=l.P.convert(p.offset),K=new l.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),lt=dt.add(K).mult(x.scale/x.zoomScale(ot));return{center:x.unproject(E.add(I).div(2).sub(lt)),zoom:ot,bearing:c}}fitBounds(e,o,c){return this._fitInternal(this.cameraForBounds(e,o),o,c)}fitScreenCoordinates(e,o,c,p,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(e)),this.transform.pointLocation(l.P.convert(o)),c,p),p,m)}_fitInternal(e,o,c){return e?(delete(o=l.e(e,o)).padding,o.linear?this.easeTo(o,c):this.flyTo(o,c)):this}jumpTo(e,o){this.stop();let c=this._getTransformForUpdate(),p=!1,m=!1,x=!1;return"zoom"in e&&c.zoom!==+e.zoom&&(p=!0,c.zoom=+e.zoom),e.center!==void 0&&(c.center=l.L.convert(e.center)),"bearing"in e&&c.bearing!==+e.bearing&&(m=!0,c.bearing=+e.bearing),"pitch"in e&&c.pitch!==+e.pitch&&(x=!0,c.pitch=+e.pitch),e.padding==null||c.isPaddingEqual(e.padding)||(c.padding=e.padding),this._applyUpdatedTransform(c),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),p&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),m&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),x&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(e,o,c,p=0){let m=l.U.fromLngLat(e,o),x=l.U.fromLngLat(c,p),w=x.x-m.x,E=x.y-m.y,I=x.z-m.z,A=Math.hypot(w,E,I);if(A===0)throw new Error("Can't calculate camera options with same From and To");let L=Math.hypot(w,E),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),$=180*Math.atan2(w,-E)/Math.PI,Z=180*Math.acos(L/A)/Math.PI;return Z=I<0?90-Z:90+Z,{center:x.toLngLat(),zoom:F,pitch:Z,bearing:$}}easeTo(e,o){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.bb},e)).animate===!1||!e.essential&&l.h.prefersReducedMotion)&&(e.duration=0);let c=this._getTransformForUpdate(),p=this.getZoom(),m=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in e?+e.zoom:p,I="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:x,L="padding"in e?e.padding:c.padding,F=l.P.convert(e.offset),$=c.centerPoint.add(F),Z=c.pointLocation($),H=l.L.convert(e.center||Z);this._normalizeCenter(H);let G=c.project(Z),ot=c.project(H).sub(G),dt=c.zoomScale(E-p),K,lt;e.around&&(K=l.L.convert(e.around),lt=c.locationPoint(K));let mt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==p,this._rotating=this._rotating||m!==I,this._pitching=this._pitching||A!==x,this._padding=!c.isPaddingEqual(L),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,mt),this.terrain&&this._prepareElevation(H),this._ease(gt=>{if(this._zooming&&(c.zoom=l.B.number(p,E,gt)),this._rotating&&(c.bearing=l.B.number(m,I,gt)),this._pitching&&(c.pitch=l.B.number(x,A,gt)),this._padding&&(c.interpolatePadding(w,L,gt),$=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(gt),K)c.setLocationAtPoint(K,lt);else{let St=c.zoomScale(c.zoom-p),Mt=E>p?Math.min(2,dt):Math.max(.5,dt),Ct=Math.pow(Mt,1-gt),zt=c.unproject(G.add(ot.mult(gt*Ct)).mult(St));c.setLocationAtPoint(c.renderWorldCopies?zt.wrap():zt,$)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},gt=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,gt)},e),this}_prepareEase(e,o,c={}){this._moving=!0,o||c.moving||this.fire(new l.k("movestart",e)),this._zooming&&!c.zooming&&this.fire(new l.k("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new l.k("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new l.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){let c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(o-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;let o=e.clone(),{center:c,zoom:p,pitch:m,bearing:x,elevation:w}=this.transformCameraUpdate(o);c&&(o.center=c),p!==void 0&&(o.zoom=p),m!==void 0&&(o.pitch=m),x!==void 0&&(o.bearing=x),w!==void 0&&(o.elevation=w),this.transform.apply(o)}_fireMoveEvents(e){this.fire(new l.k("move",e)),this._zooming&&this.fire(new l.k("zoom",e)),this._rotating&&this.fire(new l.k("rotate",e)),this._pitching&&this.fire(new l.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;let c=this._zooming,p=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new l.k("zoomend",e)),p&&this.fire(new l.k("rotateend",e)),m&&this.fire(new l.k("pitchend",e)),this.fire(new l.k("moveend",e))}flyTo(e,o){if(!e.essential&&l.h.prefersReducedMotion){let re=l.F(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(re,o)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},e);let c=this._getTransformForUpdate(),p=this.getZoom(),m=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in e?l.ad(+e.zoom,c.minZoom,c.maxZoom):p,I="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:x,L="padding"in e?e.padding:c.padding,F=c.zoomScale(E-p),$=l.P.convert(e.offset),Z=c.centerPoint.add($),H=c.pointLocation(Z),G=l.L.convert(e.center||H);this._normalizeCenter(G);let ot=c.project(H),dt=c.project(G).sub(ot),K=e.curve,lt=Math.max(c.width,c.height),mt=lt/F,gt=dt.mag();if("minZoom"in e){let re=l.ad(Math.min(e.minZoom,p,E),c.minZoom,c.maxZoom),or=lt/c.zoomScale(re-p);K=Math.sqrt(or/gt*2)}let St=K*K;function Mt(re){let or=(mt*mt-lt*lt+(re?-1:1)*St*St*gt*gt)/(2*(re?mt:lt)*St*gt);return Math.log(Math.sqrt(or*or+1)-or)}function Ct(re){return(Math.exp(re)-Math.exp(-re))/2}function zt(re){return(Math.exp(re)+Math.exp(-re))/2}let te=Mt(!1),ze=function(re){return zt(te)/zt(te+K*re)},Ut=function(re){return lt*((zt(te)*(Ct(or=te+K*re)/zt(or))-Ct(te))/St)/gt;var or},pe=(Mt(!0)-te)/K;if(Math.abs(gt)<1e-6||!isFinite(pe)){if(Math.abs(lt-mt)<1e-6)return this.easeTo(e,o);let re=mt<lt?-1:1;pe=Math.abs(Math.log(mt/lt))/K,Ut=function(){return 0},ze=function(or){return Math.exp(re*K*or)}}return e.duration="duration"in e?+e.duration:1e3*pe/("screenSpeed"in e?+e.screenSpeed/K:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==I,this._pitching=A!==x,this._padding=!c.isPaddingEqual(L),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(G),this._ease(re=>{let or=re*pe,De=1/ze(or);c.zoom=re===1?E:p+c.scaleZoom(De),this._rotating&&(c.bearing=l.B.number(m,I,re)),this._pitching&&(c.pitch=l.B.number(x,A,re)),this._padding&&(c.interpolatePadding(w,L,re),Z=c.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(re);let Te=re===1?G:c.unproject(ot.add(dt.mult(Ut(or))).mult(De));c.setLocationAtPoint(c.renderWorldCopies?Te.wrap():Te,Z),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}if(!e){let c=this.handlers;c&&c.stop(!1)}return this}_ease(e,o,c){c.animate===!1||c.duration===0?(e(1),o()):(this._easeStart=l.h.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=l.b5(e,-180,180);let c=Math.abs(e-o);return Math.abs(e-360-o)<c&&(e-=360),Math.abs(e+360-o)<c&&(e+=360),e}_normalizeCenter(e){let o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;let c=e.lng-o.center.lng;e.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class _i{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){let c=this._map._getUIString(`AttributionControl.${o}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}let o=this._map.style.sourceCaches;for(let p in o){let m=o[p];if(m.used||m.usedForTerrain){let x=m.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,m)=>p.length-m.length),e=e.filter((p,m)=>{for(let x=m+1;x<e.length;x++)if(e[x].indexOf(p)>=0)return!1;return!0});let c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yr{constructor(e={}){this._updateCompact=()=>{let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");let o=R.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Iu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){let o=this._currentlyRunning,c=o?this._queue.concat(o):this._queue;for(let p of c)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let o=this._currentlyRunning=this._queue;this._queue=[];for(let c of o)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let Oc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var sp=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ap extends l.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];let c={};for(let p of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))c[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.aS(p.posMatrix,0,l.N,0,l.N,0,1),this._tiles[p.key]=new No(p,this.tileSize));for(let p in this._tiles)c[p]||delete this._tiles[p]}freeRtt(e){for(let o in this._tiles){let c=this._tiles[o];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let o={};for(let c of this._renderableTilesKeys){let p=this._tiles[c].tileID;if(p.canonical.equals(e.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16),l.aS(m.posMatrix,0,l.N,0,l.N,0,1),o[c]=m}else if(p.canonical.isChildOf(e.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16);let x=p.canonical.z-e.canonical.z,w=p.canonical.x-(p.canonical.x>>x<<x),E=p.canonical.y-(p.canonical.y>>x<<x),I=l.N>>x;l.aS(m.posMatrix,0,I,0,I,0,1),l.$(m.posMatrix,m.posMatrix,[-w*I,-E*I,0]),o[c]=m}else if(e.canonical.isChildOf(p.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16);let x=e.canonical.z-p.canonical.z,w=e.canonical.x-(e.canonical.x>>x<<x),E=e.canonical.y-(e.canonical.y>>x<<x),I=l.N>>x;l.aS(m.posMatrix,0,l.N,0,l.N,0,1),l.$(m.posMatrix,m.posMatrix,[w*I,E*I,0]),l.a0(m.posMatrix,m.posMatrix,[1/2**x,1/2**x,0]),o[c]=m}}return o}getSourceTile(e,o){let c=this.sourceCache._source,p=e.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&o)for(;p>=c.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(p--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class lp{constructor(e,o,c){this.painter=e,this.sourceCache=new ap(o),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,c,p=l.N){var m;if(!(o>=0&&o<p&&c>=0&&c<p))return 0;let x=this.getTerrainData(e),w=(m=x.tile)===null||m===void 0?void 0:m.dem;if(!w)return 0;let E=function(Z,H,G){var ot=H[0],dt=H[1];return Z[0]=G[0]*ot+G[4]*dt+G[12],Z[1]=G[1]*ot+G[5]*dt+G[13],Z}([],[o/p*l.N,c/p*l.N],x.u_terrain_matrix),I=[E[0]*w.dim,E[1]*w.dim],A=Math.floor(I[0]),L=Math.floor(I[1]),F=I[0]-A,$=I[1]-L;return w.get(A,L)*(1-F)*(1-$)+w.get(A+1,L)*F*(1-$)+w.get(A,L+1)*(1-F)*$+w.get(A+1,L+1)*F*$}getElevationForLngLatZoom(e,o){let{tileID:c,mercatorX:p,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(c,p%l.N,m%l.N,l.N)}getElevation(e,o,c,p=l.N){return this.getDEMElevation(e,o,c,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let p=this.painter.context,m=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new je(p,m,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new je(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}let o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){let p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new je(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}let c=o&&o+o.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){let p=this.sourceCache.sourceCache._source.maxzoom,m=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?m=e.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let x=e.canonical.x-(e.canonical.x>>m<<m),w=e.canonical.y-(e.canonical.y>>m<<m),E=l.bc(new Float64Array(16),[1/(l.N<<m),1/(l.N<<m),0]);l.$(E,E,[x*l.N,w*l.N,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){let o=this.painter,c=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new je(o.context,{width:c,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new je(o.context,{width:c,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(c,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,x=0;m<this._coordsTextureSize;m++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)o[x+0]=255&w,o[x+1]=255&m,o[x+2]=w>>8<<4|m>>8,o[x+3]=0;let c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new je(e,c,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){let o=new Uint8Array(4),c=this.painter.context,p=c.gl;c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),c.bindFramebuffer.set(null);let m=o[0]+(o[2]>>4<<8),x=o[1]+((15&o[2])<<8),w=this.coordsIndex[255-o[3]],E=w&&this.sourceCache.getTileByID(w);if(!E)return null;let I=this._coordsTextureSize,A=(1<<E.tileID.canonical.z)*I;return new l.U(this._allowMercatorOverflow(e,(E.tileID.canonical.x*I+m)/A),(E.tileID.canonical.y*I+x)/A,this.getElevation(E.tileID,m,x,I))}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,o=new l.bd,c=new l.b0,p=this.meshSize,m=l.N/p,x=p*p;for(let L=0;L<=p;L++)for(let F=0;F<=p;F++)o.emplaceBack(F*m,L*m,0);for(let L=0;L<x;L+=p+1)for(let F=0;F<p;F++)c.emplaceBack(F+L,p+F+L+1,p+F+L+2),c.emplaceBack(F+L,p+F+L+2,F+L+1);let w=o.length,E=w+2*(p+1);for(let L of[0,1])for(let F=0;F<=p;F++)for(let $ of[0,1])o.emplaceBack(F*m,L*l.N,$);for(let L=0;L<2*p;L+=2)c.emplaceBack(E+L,E+L+1,E+L+3),c.emplaceBack(E+L,E+L+3,E+L+2),c.emplaceBack(w+L,w+L+3,w+L+1),c.emplaceBack(w+L,w+L+2,w+L+3);let I=o.length,A=I+2*(p+1);for(let L of[0,1])for(let F=0;F<=p;F++)for(let $ of[0,1])o.emplaceBack(L*l.N,F*m,$);for(let L=0;L<2*p;L+=2)c.emplaceBack(I+L,I+L+1,I+L+3),c.emplaceBack(I+L,I+L+3,I+L+2),c.emplaceBack(A+L,A+L+3,A+L+1),c.emplaceBack(A+L,A+L+2,A+L+3);return this._mesh={indexBuffer:e.createIndexBuffer(c),vertexBuffer:e.createVertexBuffer(o,sp.members),segments:l.S.simpleSegment(0,0,o.length,c.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*l.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var c;let{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(c=this.getMinMaxElevation(p).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){let o=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return o&&o.dem&&(c.minElevation=o.dem.min*this.exaggeration,c.maxElevation=o.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,o){let c=l.U.fromLngLat(e.wrap()),p=(1<<o)*l.N,m=c.x*p,x=c.y*p,w=Math.floor(m/l.N),E=Math.floor(x/l.N);return{tileID:new l.O(o,0,o,w,E),mercatorX:m,mercatorY:x}}_allowMercatorOverflow(e,o){let c=e.x<this.painter.width/2,p=l.bf(o),m=this.painter.transform.center.lng;return c&&Math.sign(p)>0&&Math.sign(m)<0||!c&&Math.sign(p)<0&&Math.sign(m)>0?(p=360*Math.sign(m)+p,l.G(p)):o}}class gd{constructor(e,o,c){this._context=e,this._size=o,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(c.texture),{id:e,fbo:o,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let $n={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cu{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new gd(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(c=>!e._layers[c].isHidden(o)),this._coordsDescendingInv={};for(let c in e.sourceCaches){this._coordsDescendingInv[c]={};let p=e.sourceCaches[c].getVisibleCoordinates();for(let m of p){let x=this.terrain.sourceCache.getTerrainCoords(m);for(let w in x)this._coordsDescendingInv[c][w]||(this._coordsDescendingInv[c][w]=[]),this._coordsDescendingInv[c][w].push(x[w])}}this._coordsDescendingInvStr={};for(let c of e._order){let p=e._layers[c],m=p.source;if($n[p.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(let x in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][x]=this._coordsDescendingInv[m][x].map(w=>w.key).sort().join()}}for(let c of this._renderableTiles)for(let p in this._coordsDescendingInvStr){let m=this._coordsDescendingInvStr[p][c.tileID.key];m&&m!==c.rttCoords[p]&&(c.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let o=e.type,c=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($n[o]&&(this._prevType&&$n[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!p))return!0;if($n[this._prevType]||$n[o]&&p){this._prevType=o;let m=this._stacks.length-1,x=this._stacks[m]||[];for(let w of this._renderableTiles){if(this.pool.isFull()&&(Ir(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[m]){let I=this.pool.getObjectForId(w.rtt[m].id);if(I.stamp===w.rtt[m].stamp){this.pool.useObject(I);continue}}let E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),w.rtt[m]={id:E.id,stamp:E.stamp},c.context.bindFramebuffer.set(E.fbo.framebuffer),c.context.clear({color:l.aT.transparent,stencil:0}),c.currentStencilSource=void 0;for(let I=0;I<x.length;I++){let A=c.style._layers[x[I]],L=A.source?this._coordsDescendingInv[A.source][w.tileID.key]:[w.tileID];c.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),c._renderTileClippingMasks(A,L),c.renderLayer(c,c.style.sourceCaches[A.source],A,L),A.source&&(w.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][w.tileID.key])}}return Ir(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$n[o]}return!1}}let ie=V,he={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},El=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Fc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nc{constructor(e,o,c=!1){this.mousedown=x=>{this.startMouse(l.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),R.mousePos(this.element,x)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,R.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let p=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=fs({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:E=.8})=>{let I=new Kl;return new _o({clickTolerance:w,move:(A,L)=>({bearingDelta:(L.x-A.x)*E}),moveStateManager:I,enable:x,assignEvents:El})})({clickTolerance:p,enable:!0}),this.map=e,c&&(this.mousePitch=Nn({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:E=-.5})=>{let I=new Kl;return new _o({clickTolerance:w,move:(A,L)=>({pitchDelta:(L.y-A.y)*E}),moveStateManager:I,enable:x,assignEvents:El})})({clickTolerance:m,enable:!0})),R.addEventListener(o,"mousedown",this.mousedown),R.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),R.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),R.disableDrag()}moveMouse(e,o){let c=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(e,o)||{};if(p&&c.setBearing(c.getBearing()+p),this.mousePitch){let{pitchDelta:m}=this.mousePitch.dragMove(e,o)||{};m&&c.setPitch(c.getPitch()+m)}}moveTouch(e,o){let c=this.map,{bearingDelta:p}=this.touchRotate.dragMove(e,o)||{};if(p&&c.setBearing(c.getBearing()+p),this.touchPitch){let{pitchDelta:m}=this.touchPitch.dragMove(e,o)||{};m&&c.setPitch(c.getPitch()+m)}}off(){let e=this.element;R.removeEventListener(e,"mousedown",this.mousedown),R.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Ur;function Bc(f,e,o){if(f=new l.L(f.lng,f.lat),e){let c=new l.L(f.lng-360,f.lat),p=new l.L(f.lng+360,f.lat),m=o.locationPoint(f).distSqr(e);o.locationPoint(c).distSqr(e)<m?f=c:o.locationPoint(p).distSqr(e)<m&&(f=p)}for(;Math.abs(f.lng-o.center.lng)>180;){let c=o.locationPoint(f);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}let Ni={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function up(f,e,o){let c=f.classList;for(let p in Ni)c.remove(`maplibregl-${o}-anchor-${p}`);c.add(`maplibregl-${o}-anchor-${e}`)}class Gs extends l.E{constructor(e){if(super(),this._onKeyPress=o=>{let c=o.code,p=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{let c=o.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()},this._update=o=>{if(!this._map)return;let c=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!c)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Bc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Ni[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=o=>{if(!this._isDragging){let c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");let o=R.createNS("http://www.w3.org/2000/svg","svg"),c=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${c}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${c}`);let m=R.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");let x=R.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");let w=R.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");let E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let ot of E){let dt=R.createNS("http://www.w3.org/2000/svg","ellipse");dt.setAttributeNS(null,"opacity","0.04"),dt.setAttributeNS(null,"cx","10.5"),dt.setAttributeNS(null,"cy","5.80029008"),dt.setAttributeNS(null,"rx",ot.rx),dt.setAttributeNS(null,"ry",ot.ry),w.appendChild(dt)}let I=R.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);let A=R.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(A);let L=R.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");let F=R.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(F);let $=R.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");let Z=R.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");let H=R.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");let G=R.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),Z.appendChild(H),Z.appendChild(G),x.appendChild(w),x.appendChild(I),x.appendChild(L),x.appendChild($),x.appendChild(Z),o.appendChild(x),o.setAttributeNS(null,"height",c*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),up(this._element,this._anchor,"marker"),e&&e.className)for(let o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.L.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let Dr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Pr=0,Ia=!1,Tl={maxWidth:100,unit:"metric"};function Il(f,e,o){let c=o&&o.maxWidth||100,p=f._container.clientHeight/2,m=f.unproject([0,p]),x=f.unproject([c,p]),w=m.distanceTo(x);if(o&&o.unit==="imperial"){let E=3.2808*w;E>5280?qs(e,c,E/5280,f._getUIString("ScaleControl.Miles")):qs(e,c,E,f._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?qs(e,c,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?qs(e,c,w/1e3,f._getUIString("ScaleControl.Kilometers")):qs(e,c,w,f._getUIString("ScaleControl.Meters"))}function qs(f,e,o,c){let p=function(m){let x=Math.pow(10,`${Math.floor(m)}`.length-1),w=m/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){let I=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*I)/I}(w),x*w}(o);f.style.width=e*(p/o)+"px",f.innerHTML=`${p}&nbsp;${c}`}let Vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ca(f){if(f){if(typeof f=="number"){let e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,f),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-f),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(f,0),right:new l.P(-f,0)}}if(f instanceof l.P||Array.isArray(f)){let e=l.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(f.center||[0,0]),top:l.P.convert(f.top||[0,0]),"top-left":l.P.convert(f["top-left"]||[0,0]),"top-right":l.P.convert(f["top-right"]||[0,0]),bottom:l.P.convert(f.bottom||[0,0]),"bottom-left":l.P.convert(f["bottom-left"]||[0,0]),"bottom-right":l.P.convert(f["bottom-right"]||[0,0]),left:l.P.convert(f.left||[0,0]),right:l.P.convert(f.right||[0,0])}}return Ca(new l.P(0,0))}let jc={extend:(f,...e)=>l.e(f,...e),run(f){f()},logToElement(f,e=!1,o="log"){let c=window.document.getElementById(o);c&&(e&&(c.innerHTML=""),c.innerHTML+=`<br>${f}`)}},Gc=V;class Je{static get version(){return Gc}static get workerCount(){return ji.workerCount}static set workerCount(e){ji.workerCount=e}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){l.c.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(e){l.c.WORKER_URL=e}static addProtocol(e,o){l.c.REGISTERED_PROTOCOLS[e]=o}static removeProtocol(e){delete l.c.REGISTERED_PROTOCOLS[e]}}return Je.Map=class extends op{constructor(f){if(l.bg.mark(l.bh.create),(f=l.e({},he,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bl(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Iu,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},Oc,f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this._imageQueueHandle=Pt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qt(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let e=!1,o=kt(c=>{this._trackResize&&!this._removed&&this.resize(c)._update()},50);this._resizeObserver=new ResizeObserver(c=>{e?o(c):e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Rc(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new Wt(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.e({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new _i({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new yr,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update(e.dataType==="style"),this.fire(new l.k(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new l.k(`${e.dataType}dataloading`,e))}),this.on("dataabort",e=>{this.fire(new l.k("sourcedataabort",e))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=f.onAdd(this);this._controls.push(f);let c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(o,c.firstChild):c.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,o,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,o,c)}resize(f){var e;let o=this._containerDimensions(),c=o[0],p=o[1],m=this._getClampedPixelRatio(c,p);if(this._resizeCanvas(c,p,m),this.painter.resize(c,p,m),this.painter.overLimit()){let w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];let E=this._getClampedPixelRatio(c,p);this._resizeCanvas(c,p,E),this.painter.resize(c,p,E)}this.transform.resize(c,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(c,p);let x=!this._moving;return x&&(this.stop(),this.fire(new l.k("movestart",f)).fire(new l.k("move",f))),this.fire(new l.k("resize",f)),x&&this.fire(new l.k("moveend",f)),this}_getClampedPixelRatio(f,e){let{0:o,1:c}=this._maxCanvasSize,p=this.getPixelRatio(),m=f*p,x=e*p;return Math.min(m>o?o/m:1,x>c?c/x:1)*p}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Ne.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(f){return this.transform.locationPoint(l.L.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(l.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,o){if(f==="mouseenter"||f==="mouseover"){let c=!1;return{layer:e,listener:o,delegates:{mousemove:p=>{let m=this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[];m.length?c||(c=!0,o.call(this,new Mr(f,this,p.originalEvent,{features:m}))):c=!1},mouseout:()=>{c=!1}}}}if(f==="mouseleave"||f==="mouseout"){let c=!1;return{layer:e,listener:o,delegates:{mousemove:p=>{(this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[]).length?c=!0:c&&(c=!1,o.call(this,new Mr(f,this,p.originalEvent)))},mouseout:p=>{c&&(c=!1,o.call(this,new Mr(f,this,p.originalEvent)))}}}}{let c=p=>{let m=this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[];m.length&&(p.features=m,o.call(this,p),delete p.features)};return{layer:e,listener:o,delegates:{[f]:c}}}}on(f,e,o){if(o===void 0)return super.on(f,e);let c=this._createDelegatedListener(f,e,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(c);for(let p in c.delegates)this.on(p,c.delegates[p]);return this}once(f,e,o){if(o===void 0)return super.once(f,e);let c=this._createDelegatedListener(f,e,o);for(let p in c.delegates)this.once(p,c.delegates[p]);return this}off(f,e,o){return o===void 0?super.off(f,e):(this._delegatedListeners&&this._delegatedListeners[f]&&(c=>{let p=this._delegatedListeners[f];for(let m=0;m<p.length;m++){let x=p[m];if(x.layer===e&&x.listener===o){for(let w in x.delegates)this.off(w,x.delegates[w]);return p.splice(m,1),this}}})(),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let o,c=f instanceof l.P||Array.isArray(f),p=c?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:f)||{},p instanceof l.P||typeof p[0]=="number")o=[l.P.convert(p)];else{let m=l.P.convert(p[0]),x=l.P.convert(p[1]);o=[m,new l.P(x.x,m.y),x,new l.P(m.x,x.y),m]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){let e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));let o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new un(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,o):this.style.loadJSON(f,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new un(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){let o=this._requestManager.transformRequest(f,qt.Style);l.f(o,(c,p)=>{c?this.fire(new l.j(c)):p&&this._updateDiff(p,e)})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){let e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new l.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){let e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);for(let o in this.style._layers){let c=this.style._layers[o];c.type==="hillshade"&&c.source===f.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new lp(this.painter,e,f),this.painter.renderToTexture=new Cu(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==f.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let f=this.style&&this.style.sourceCaches;for(let e in f){let o=f[e]._tiles;for(let c in o){let p=o[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(f,e,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,e,o)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,o={}){let{pixelRatio:c=1,sdf:p=!1,stretchX:m,stretchY:x,content:w}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.a(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:E,height:I,data:A}=e,L=e;return this.style.addImage(f,{data:new l.R({width:E,height:I},new Uint8Array(A)),pixelRatio:c,stretchX:m,stretchY:x,content:w,sdf:p,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f),this}}{let{width:E,height:I,data:A}=l.h.getImageData(e);this.style.addImage(f,{data:new l.R({width:E,height:I},A),pixelRatio:c,stretchX:m,stretchY:x,content:w,sdf:p,version:0})}}updateImage(f,e){let o=this.style.getImage(f);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let c=e instanceof HTMLImageElement||l.a(e)?l.h.getImageData(e):e,{width:p,height:m,data:x}=c;if(p===void 0||m===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||m!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let w=!(e instanceof HTMLImageElement||l.a(e));return o.data.replace(x,w),this.style.updateImage(f,o),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,e){Pt.getImage(this._requestManager.transformRequest(f,qt.Image),e)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,o){return this.style.setLayerZoomRange(f,e,o),this._update(!0)}setFilter(f,e,o={}){return this.style.setFilter(f,e,o),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,o,c={}){return this.style.setPaintProperty(f,e,o,c),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,o,c={}){return this.style.setLayoutProperty(f,e,o,c),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,o,c=>{c||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,o=>{o||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){let f=this._container;f.classList.add("maplibregl-map");let e=this._canvasContainer=R.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let o=this._containerDimensions(),c=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],c);let p=this._controlContainer=R.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=R.create("div",`maplibregl-ctrl-${x} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=R.create("div","maplibregl-cooperative-gesture-screen",this._container);let f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${f}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){R.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(f,e,o){this._canvas.width=Math.floor(o*f),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{e={requestedAttributes:f},c&&(e.statusMessage=c.statusMessage,e.type=c.type)},{once:!0});let o=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!o){let c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new ns(o,this.transform),et.testSupport(o)}_onCooperativeGesture(f,e,o){return!e&&o<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let p=this.transform.zoom,m=l.h.now();this.style.zoomHistory.update(p,m);let x=new l.a8(p,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(o=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Pt.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(f=>{l.bg.frame(f),this._frame=null,this._render(f)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return ie}getCameraTargetElevation(){return this.transform.elevation}},Je.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{let e=this._map.getZoom(),o=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{let c=this._map._getUIString(`NavigationControl.${o}`);e.title=c,e.setAttribute("aria-label",c)},this.options=l.e({},Fc,f),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){let o=R.create("button",f,this._container);return o.type="button",o.addEventListener("click",e),o}},Je.GeolocateControl=class extends l.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let o=new l.L(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,p=this._map.getBearing(),m=l.e({bearing:p},this.options.fitBoundsOptions),x=Ne.fromLngLat(o,c);this._map.fitBounds(x,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let o=new l.L(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ia)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gs({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Dr,f)}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,o=!1){Ur===void 0||o?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(c=>{Ur=c.state!=="denied",e(Ur)}).catch(()=>{Ur=!!window.navigator.geolocation,e(Ur)}):(Ur=!!window.navigator.geolocation,e(Ur)):e(Ur)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Pr=0,Ia=!1}_isOutOfMapMaxBounds(f){let e=this._map.getMaxBounds(),o=f.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let f=this._map.getBounds(),e=f.getSouthEast(),o=f.getNorthEast(),c=e.distanceTo(o),p=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pr--,Ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pr++,Pr>1?(f={maximumAge:6e5,timeout:0},Ia=!0):(f=this.options.positionOptions,Ia=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Je.AttributionControl=_i,Je.LogoControl=yr,Je.ScaleControl=class{constructor(f){this._onMove=()=>{Il(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Il(this._map,this._container,this.options)},this.options=l.e({},Tl,f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Je.FullscreenControl=class extends l.E{constructor(f={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let f=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Je.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=f}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Je.Popup=class extends l.E{constructor(f){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;let o=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),c=this.options.anchor,p=Ca(this.options.offset);if(!c){let x=this._container.offsetWidth,w=this._container.offsetHeight,E;E=o.y+p.bottom.y<w?["top"]:o.y>this._map.transform.height-w?["bottom"]:[],o.x<x/2?E.push("left"):o.x>this._map.transform.width-x/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}let m=o.add(p[c]).round();R.setTransform(this._container,`${Ni[c]} translate(${m.x}px,${m.y}px)`),up(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Vc),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=l.L.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let e=document.createDocumentFragment(),o=document.createElement("body"),c;for(o.innerHTML=f;c=o.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(Uc);f&&f.focus()}},Je.Marker=Gs,Je.Style=un,Je.LngLat=l.L,Je.LngLatBounds=Ne,Je.Point=l.P,Je.MercatorCoordinate=l.U,Je.Evented=l.E,Je.AJAXError=l.bi,Je.config=l.c,Je.CanvasSource=Fo,Je.GeoJSONSource=oo,Je.ImageSource=Qe,Je.RasterDEMTileSource=Os,Je.RasterTileSource=Ci,Je.VectorTileSource=zn,Je.VideoSource=na,Je.setRTLTextPlugin=l.bj,Je.getRTLTextPluginStatus=l.bk,Je.prewarm=function(){ia().acquire(Ze)},Je.clearPrewarmedResources=function(){let f=Zi;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Ze),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},jc.extend(Je,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Je});var C=_;return C})})(H1);var VI=H1.exports,J2=l_(VI);var hh=_e(Ee(),1),K2=_e(Wp(),1);var UI=Object.defineProperty,jI=(i,s,u)=>s in i?UI(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,Y1=(i,s,u)=>(jI(i,typeof s!="symbol"?s+"":s,u),u),W1=class{constructor(s){Y1(this,"_map",null),Y1(this,"_container"),Y1(this,"_redraw"),this._redraw=s}onAdd(s){return this._map=s,s.on("move",this._redraw),this._container=document.createElement("div"),this._container.className="maplibregl-ctrl-group maplibregl-ctrl",this._redraw(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._redraw),this._map=null}getMap(){return this._map}getElement(){return this._container}},J1=i=>{let[,s]=(0,hh.useState)(0),u=(0,hh.useCallback)(()=>s(C=>C+1),[]),d=nu(()=>new W1(u),{position:i.position}),_=d.getMap(),b=hh.Children.map(tl.compact(hh.Children.toArray(i.children)),C=>(0,hh.cloneElement)(C,{map:_}));return(0,hh.useEffect)(()=>{i.mapRef&&(i.mapRef.current=_)},[_,i.mapRef]),_&&(0,K2.createPortal)(b,d.getElement())};var GI=30,Q2=i=>{let[s,u]=(0,pa.useState)(0),[d,_]=(0,pa.useState)(),[b,C]=(0,pa.useState)(!1),l=(0,pa.useRef)(),V=(0,pa.useCallback)(yt=>i.names&&i.names.length>yt&&i.names[yt],[i.names]),R=(0,pa.useCallback)(yt=>tl.includes(d,yt),[d]),et=(0,pa.useMemo)(()=>pa.Children.toArray(i.children),[i.children]),at=(0,pa.useMemo)(()=>tl.filter(et,(yt,xt)=>R(xt)),[et,R]),st=(0,pa.useCallback)(yt=>{let xt;R(yt)?xt=tl.without(d,yt):xt=[...d,yt],_(xt)},[R,d]);return(0,pa.useEffect)(()=>{_(tl.times(et.length,yt=>yt))},[]),(0,pa.useEffect)(()=>{let{current:yt}=l;if(yt&&yt._canvas){let{offsetHeight:xt=0}=l.current._canvas;u(xt)}},[l.current]),tl.isEmpty(et)?null:Xo.jsxs(Xo.Fragment,{children:[Xo.jsxs(J1,{mapRef:l,position:i.position,children:[Xo.jsx("button",{className:"mapbox-gl-draw_ctrl-draw-btn layer-button",onClick:()=>C(yt=>!yt),type:"button",children:Xo.jsx(H2,{size:"1.25em"})}),b&&Xo.jsx("div",{className:"layer-menu",style:{maxHeight:`calc(${s}px - ${GI}px)`},children:Xo.jsx("div",{className:"menu",children:tl.map(et,(yt,xt)=>Xo.jsxs("div",{"aria-selected":R(xt),className:"option",role:"option",onClick:()=>st(xt),onKeyDown:()=>st(xt),tabIndex:xt,children:[Xo.jsx("div",{className:"checkmark-container",children:R(xt)&&Xo.jsx(Y2,{size:"1em"})}),V(xt)]}))})})]}),at]})};Q2.defaultProps={position:"top-left"};var K1={exports:{}};var rm={};var eS=_e(Ee(),1);var tS;function rS(){if(tS)return rm;tS=1;var i=eS.default,s=Symbol.for("react.element"),u=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,_=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function C(l,V,R){var et,at={},st=null,yt=null;R!==void 0&&(st=""+R),V.key!==void 0&&(st=""+V.key),V.ref!==void 0&&(yt=V.ref);for(et in V)d.call(V,et)&&!b.hasOwnProperty(et)&&(at[et]=V[et]);if(l&&l.defaultProps)for(et in V=l.defaultProps,V)at[et]===void 0&&(at[et]=V[et]);return{$$typeof:s,type:l,key:st,ref:yt,props:at,_owner:_.current}}return rm.Fragment=u,rm.jsx=C,rm.jsxs=C,rm}var X8=_e(Ee(),1);K1.exports=rS();var td=K1.exports;var aE=_e(Ee(),1);function kl(){return kl=Object.assign?Object.assign.bind():function(i){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(i[d]=u[d])}return i},kl.apply(this,arguments)}var w0=_e(Ee(),1);var nS=_e(Ee(),1);function qI(i,s){typeof i=="function"?i(s):i!=null&&(i.current=s)}function u0(...i){return s=>i.forEach(u=>qI(u,s))}function jh(...i){return(0,nS.useCallback)(u0(...i),i)}var ph=_e(Ee(),1);function Gh(i,s=[]){let u=[];function d(b,C){let l=(0,ph.createContext)(C),V=u.length;u=[...u,C];function R(at){let{scope:st,children:yt,...xt}=at,It=st?.[i][V]||l,Pt=(0,ph.useMemo)(()=>xt,Object.values(xt));return(0,ph.createElement)(It.Provider,{value:Pt},yt)}function et(at,st){let yt=st?.[i][V]||l,xt=(0,ph.useContext)(yt);if(xt)return xt;if(C!==void 0)return C;throw new Error(`\`${at}\` must be used within \`${b}\``)}return R.displayName=b+"Provider",[R,et]}let _=()=>{let b=u.map(C=>(0,ph.createContext)(C));return function(C){let l=C?.[i]||b;return(0,ph.useMemo)(()=>({[`__scope${i}`]:{...C,[i]:l}}),[C,l])}};return _.scopeName=i,[d,$I(_,...s)]}function $I(...i){let s=i[0];if(i.length===1)return s;let u=()=>{let d=i.map(_=>({useScope:_(),scopeName:_.scopeName}));return function(_){let b=d.reduce((C,{useScope:l,scopeName:V})=>{let R=l(_)[`__scope${V}`];return{...C,...R}},{});return(0,ph.useMemo)(()=>({[`__scope${s.scopeName}`]:b}),[b])}};return u.scopeName=s.scopeName,u}var c0=_e(Ee(),1);var Q1=_e(Ee(),1);var im=_e(Ee(),1),YI=_e(Wp(),1);var Ho=_e(Ee(),1);var hf=(0,Ho.forwardRef)((i,s)=>{let{children:u,...d}=i,_=Ho.Children.toArray(u),b=_.find(XI);if(b){let C=b.props.children,l=_.map(V=>V===b?Ho.Children.count(C)>1?Ho.Children.only(null):(0,Ho.isValidElement)(C)?C.props.children:null:V);return(0,Ho.createElement)(tb,kl({},d,{ref:s}),(0,Ho.isValidElement)(C)?(0,Ho.cloneElement)(C,void 0,l):null)}return(0,Ho.createElement)(tb,kl({},d,{ref:s}),u)});hf.displayName="Slot";var tb=(0,Ho.forwardRef)((i,s)=>{let{children:u,...d}=i;return(0,Ho.isValidElement)(u)?(0,Ho.cloneElement)(u,{...HI(d,u.props),ref:s?u0(s,u.ref):u.ref}):Ho.Children.count(u)>1?Ho.Children.only(null):null});tb.displayName="SlotClone";var ZI=({children:i})=>(0,Ho.createElement)(Ho.Fragment,null,i);function XI(i){return(0,Ho.isValidElement)(i)&&i.type===ZI}function HI(i,s){let u={...s};for(let d in s){let _=i[d],b=s[d];/^on[A-Z]/.test(d)?_&&b?u[d]=(...C)=>{b(...C),_(...C)}:_&&(u[d]=_):d==="style"?u[d]={..._,...b}:d==="className"&&(u[d]=[_,b].filter(Boolean).join(" "))}return{...i,...u}}var WI=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ed=WI.reduce((i,s)=>{let u=(0,im.forwardRef)((d,_)=>{let{asChild:b,...C}=d,l=b?hf:s;return(0,im.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,im.createElement)(l,kl({},C,{ref:_}))});return u.displayName=`Primitive.${s}`,{...i,[s]:u}},{});var ff=_e(Ee(),1);var dh=_e(Ee(),1);function h0(i){let s=i+"CollectionProvider",[u,d]=Gh(s),[_,b]=u(s,{collectionRef:{current:null},itemMap:new Map}),C=yt=>{let{scope:xt,children:It}=yt,Pt=dh.default.useRef(null),qt=dh.default.useRef(new Map).current;return dh.default.createElement(_,{scope:xt,itemMap:qt,collectionRef:Pt},It)},l=i+"CollectionSlot",V=dh.default.forwardRef((yt,xt)=>{let{scope:It,children:Pt}=yt,qt=b(l,It),Qt=jh(xt,qt.collectionRef);return dh.default.createElement(hf,{ref:Qt},Pt)}),R=i+"CollectionItemSlot",et="data-radix-collection-item",at=dh.default.forwardRef((yt,xt)=>{let{scope:It,children:Pt,...qt}=yt,Qt=dh.default.useRef(null),se=jh(xt,Qt),le=b(R,It);return dh.default.useEffect(()=>(le.itemMap.set(Qt,{ref:Qt,...qt}),()=>void le.itemMap.delete(Qt))),dh.default.createElement(hf,{[et]:"",ref:se},Pt)});function st(yt){let xt=b(i+"CollectionConsumer",yt);return dh.default.useCallback(()=>{let It=xt.collectionRef.current;if(!It)return[];let Pt=Array.from(It.querySelectorAll(`[${et}]`));return Array.from(xt.itemMap.values()).sort((qt,Qt)=>Pt.indexOf(qt.ref.current)-Pt.indexOf(Qt.ref.current))},[xt.collectionRef,xt.itemMap])}return[{Provider:C,Slot:V,ItemSlot:at},st,d]}var iS=_e(Ee(),1);var pf=_e(Ee(),1);var JI=_e(Ee(),1);var QI=_e(Ee(),1);var om=_e(Ee(),1);var zV=tC();function tC(){let i=[];return{add(s){let u=i[0];s!==u&&u?.pause(),i=oS(i,s),i.unshift(s)},remove(s){var u;i=oS(i,s),(u=i[0])===null||u===void 0||u.resume()}}}function oS(i,s){let u=[...i],d=u.indexOf(s);return d!==-1&&u.splice(d,1),u}var Cy=_e(Ee(),1);var p0=_e(Ee(),1),sS=_e(Ee(),1),hC=_e(Wp(),1);var aS=_e(Ee(),1);var lS=_e(Ee(),1),sm=globalThis!=null&&globalThis.document?lS.useLayoutEffect:()=>{};var pC=_e(Ee(),1);var uS="Popper",[cS,rb]=Gh(uS),[ij,oj]=cS(uS);var dC="PopperContent",[sj,aj]=cS(dC);var hS=_e(Ee(),1),fC=_e(Wp(),1);var el=_e(Ee(),1),pS=_e(Wp(),1);function mC(i,s){return(0,el.useReducer)((u,d)=>s[u][d]??u,i)}var dS=i=>{let{present:s,children:u}=i,d=gC(s),_=typeof u=="function"?u({present:d.isPresent}):el.Children.only(u),b=jh(d.ref,_.ref);return typeof u=="function"||d.isPresent?(0,el.cloneElement)(_,{ref:b}):null};dS.displayName="Presence";function gC(i){let[s,u]=(0,el.useState)(),d=(0,el.useRef)({}),_=(0,el.useRef)(i),b=(0,el.useRef)("none"),C=i?"mounted":"unmounted",[l,V]=mC(C,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,el.useEffect)(()=>{let R=d0(d.current);b.current=l==="mounted"?R:"none"},[l]),sm(()=>{let R=d.current,et=_.current;if(et!==i){let at=b.current,st=d0(R);i?V("MOUNT"):st==="none"||R?.display==="none"?V("UNMOUNT"):V(et&&at!==st?"ANIMATION_OUT":"UNMOUNT"),_.current=i}},[i,V]),sm(()=>{if(s){let R=at=>{let st=d0(d.current).includes(at.animationName);at.target===s&&st&&(0,pS.flushSync)(()=>V("ANIMATION_END"))},et=at=>{at.target===s&&(b.current=d0(d.current))};return s.addEventListener("animationstart",et),s.addEventListener("animationcancel",R),s.addEventListener("animationend",R),()=>{s.removeEventListener("animationstart",et),s.removeEventListener("animationcancel",R),s.removeEventListener("animationend",R)}}else V("ANIMATION_END")},[s,V]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:(0,el.useCallback)(R=>{R&&(d.current=getComputedStyle(R)),u(R)},[])}}function d0(i){return i?.animationName||"none"}var am=_e(Ee(),1);var fS=_e(Ee(),1);var nb="RovingFocusGroup",[Cj,Pj,xC]=h0(nb),[bC,ib]=Gh(nb,[xC]),[Aj,Lj]=bC(nb);var au=function(){return au=Object.assign||function(i){for(var s,u=1,d=arguments.length;u<d;u++){s=arguments[u];for(var _ in s)Object.prototype.hasOwnProperty.call(s,_)&&(i[_]=s[_])}return i},au.apply(this,arguments)};function f0(i,s){var u={};for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&s.indexOf(d)<0&&(u[d]=i[d]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,d=Object.getOwnPropertySymbols(i);_<d.length;_++)s.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(i,d[_])&&(u[d[_]]=i[d[_]]);return u}function mS(i,s,u){if(u||arguments.length===2)for(var d=0,_=s.length,b;d<_;d++)(b||!(d in s))&&(b||(b=Array.prototype.slice.call(s,0,d)),b[d]=s[d]);return i.concat(b||Array.prototype.slice.call(s))}var x0=_e(Ee(),1);var rl=_e(Ee(),1);var lm="right-scroll-bar-position",um="width-before-scroll-bar",gS="with-scroll-bars-hidden",yS="--removed-body-scroll-bar-size";function wC(i){return i}function SC(i,s){s===void 0&&(s=wC);var u=[],d=!1,_={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return u.length?u[u.length-1]:i},useMedium:function(b){var C=s(b,d);return u.push(C),function(){u=u.filter(function(l){return l!==C})}},assignSyncMedium:function(b){for(d=!0;u.length;){var C=u;u=[],C.forEach(b)}u={push:function(l){return b(l)},filter:function(){return u}}},assignMedium:function(b){d=!0;var C=[];if(u.length){var l=u;u=[],l.forEach(b),C=u}var V=function(){var et=C;C=[],et.forEach(b)},R=function(){return Promise.resolve().then(V)};R(),u={push:function(et){C.push(et),R()},filter:function(et){return C=C.filter(et),u}}}};return _}function _S(i){i===void 0&&(i={});var s=SC(null);return s.options=au({async:!0,ssr:!1},i),s}var m0=_S();var wS=_e(Ee(),1);function g0(i,s){return typeof i=="function"?i(s):i&&(i.current=s),i}var vS=_e(Ee(),1);function xS(i,s){var u=(0,vS.useState)(function(){return{value:i,callback:s,facade:{get current(){return u.value},set current(d){var _=u.value;_!==d&&(u.value=d,u.callback(d,_))}}}})[0];return u.callback=s,u.facade}var bS=new WeakMap;function SS(i,s){var u=xS(s||null,function(d){return i.forEach(function(_){return g0(_,d)})});return wS.useLayoutEffect(function(){var d=bS.get(u);if(d){var _=new Set(d),b=new Set(i),C=u.current;_.forEach(function(l){b.has(l)||g0(l,null)}),b.forEach(function(l){_.has(l)||g0(l,C)})}bS.set(u,i)},[i]),u}var ob=function(){},Py=rl.forwardRef(function(i,s){var u=rl.useRef(null),d=rl.useState({onScrollCapture:ob,onWheelCapture:ob,onTouchMoveCapture:ob}),_=d[0],b=d[1],C=i.forwardProps,l=i.children,V=i.className,R=i.removeScrollBar,et=i.enabled,at=i.shards,st=i.sideCar,yt=i.noIsolation,xt=i.inert,It=i.allowPinchZoom,Pt=i.as,qt=Pt===void 0?"div":Pt,Qt=f0(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),se=st,le=SS([u,s]),Ue=au(au({},Qt),_);return rl.createElement(rl.Fragment,null,et&&rl.createElement(se,{sideCar:m0,removeScrollBar:R,shards:at,noIsolation:yt,inert:xt,setCallbacks:b,allowPinchZoom:!!It,lockRef:u}),C?rl.cloneElement(rl.Children.only(l),au(au({},Ue),{ref:le})):rl.createElement(qt,au({},Ue,{className:V,ref:le}),l))});Py.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Py.classNames={fullWidth:um,zeroRight:lm};var Io=_e(Ee(),1);var _0=_e(Ee(),1);var IS=_e(Ee(),1);var ES=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function EC(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var s=ES();return s&&i.setAttribute("nonce",s),i}function TC(i,s){i.styleSheet?i.styleSheet.cssText=s:i.appendChild(document.createTextNode(s))}function IC(i){var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(i)}var TS=function(){var i=0,s=null;return{add:function(u){i==0&&(s=EC())&&(TC(s,u),IC(s)),i++},remove:function(){i--,!i&&s&&(s.parentNode&&s.parentNode.removeChild(s),s=null)}}};var CS=function(){var i=TS();return function(s,u){IS.useEffect(function(){return i.add(s),function(){i.remove()}},[s&&u])}};var y0=function(){var i=CS(),s=function(u){var d=u.styles,_=u.dynamic;return i(d,_),null};return s};var CC={left:0,top:0,right:0,gap:0},sb=function(i){return parseInt(i||"",10)||0},PC=function(i){var s=window.getComputedStyle(document.body),u=s[i==="padding"?"paddingLeft":"marginLeft"],d=s[i==="padding"?"paddingTop":"marginTop"],_=s[i==="padding"?"paddingRight":"marginRight"];return[sb(u),sb(d),sb(_)]},PS=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return CC;var s=PC(i),u=document.documentElement.clientWidth,d=window.innerWidth;return{left:s[0],top:s[1],right:s[2],gap:Math.max(0,d-u+s[2]-s[0])}};var AC=y0(),LC=function(i,s,u,d){var _=i.left,b=i.top,C=i.right,l=i.gap;return u===void 0&&(u="margin"),`
  .`.concat(gS,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(l,"px ").concat(d,`;
  }
  body {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([s&&"position: relative ".concat(d,";"),u==="margin"&&`
    padding-left: `.concat(_,`px;
    padding-top: `).concat(b,`px;
    padding-right: `).concat(C,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(d,`;
    `),u==="padding"&&"padding-right: ".concat(l,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(lm,` {
    right: `).concat(l,"px ").concat(d,`;
  }
  
  .`).concat(um,` {
    margin-right: `).concat(l,"px ").concat(d,`;
  }
  
  .`).concat(lm," .").concat(lm,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(um," .").concat(um,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body {
    `).concat(yS,": ").concat(l,`px;
  }
`)},AS=function(i){var s=i.noRelative,u=i.noImportant,d=i.gapMode,_=d===void 0?"margin":d,b=_0.useMemo(function(){return PS(_)},[_]);return _0.createElement(AC,{styles:LC(b,!s,_,u?"":"!important")})};var ab=!1;if(typeof window<"u")try{Ay=Object.defineProperty({},"passive",{get:function(){return ab=!0,!0}}),window.addEventListener("test",Ay,Ay),window.removeEventListener("test",Ay,Ay)}catch{ab=!1}var Ay,df=ab?{passive:!1}:!1;var MC=function(i){return i.tagName==="TEXTAREA"},LS=function(i,s){var u=window.getComputedStyle(i);return u[s]!=="hidden"&&!(u.overflowY===u.overflowX&&!MC(i)&&u[s]==="visible")},DC=function(i){return LS(i,"overflowY")},kC=function(i){return LS(i,"overflowX")},lb=function(i,s){var u=s;do{typeof ShadowRoot<"u"&&u instanceof ShadowRoot&&(u=u.host);var d=MS(i,u);if(d){var _=DS(i,u),b=_[1],C=_[2];if(b>C)return!0}u=u.parentNode}while(u&&u!==document.body);return!1},zC=function(i){var s=i.scrollTop,u=i.scrollHeight,d=i.clientHeight;return[s,u,d]},RC=function(i){var s=i.scrollLeft,u=i.scrollWidth,d=i.clientWidth;return[s,u,d]},MS=function(i,s){return i==="v"?DC(s):kC(s)},DS=function(i,s){return i==="v"?zC(s):RC(s)},OC=function(i,s){return i==="h"&&s==="rtl"?-1:1},kS=function(i,s,u,d,_){var b=OC(i,window.getComputedStyle(s).direction),C=b*d,l=u.target,V=s.contains(l),R=!1,et=C>0,at=0,st=0;do{var yt=DS(i,l),xt=yt[0],It=yt[1],Pt=yt[2],qt=It-Pt-b*xt;(xt||qt)&&MS(i,l)&&(at+=qt,st+=xt),l=l.parentNode}while(!V&&l!==document.body||V&&(s.contains(l)||s===l));return(et&&(_&&at===0||!_&&C>at)||!et&&(_&&st===0||!_&&-C>st))&&(R=!0),R};var v0=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},zS=function(i){return[i.deltaX,i.deltaY]},RS=function(i){return i&&"current"in i?i.current:i},FC=function(i,s){return i[0]===s[0]&&i[1]===s[1]},NC=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},BC=0,cm=[];function OS(i){var s=Io.useRef([]),u=Io.useRef([0,0]),d=Io.useRef(),_=Io.useState(BC++)[0],b=Io.useState(function(){return y0()})[0],C=Io.useRef(i);Io.useEffect(function(){C.current=i},[i]),Io.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(_));var It=mS([i.lockRef.current],(i.shards||[]).map(RS),!0).filter(Boolean);return It.forEach(function(Pt){return Pt.classList.add("allow-interactivity-".concat(_))}),function(){document.body.classList.remove("block-interactivity-".concat(_)),It.forEach(function(Pt){return Pt.classList.remove("allow-interactivity-".concat(_))})}}},[i.inert,i.lockRef.current,i.shards]);var l=Io.useCallback(function(It,Pt){if("touches"in It&&It.touches.length===2)return!C.current.allowPinchZoom;var qt=v0(It),Qt=u.current,se="deltaX"in It?It.deltaX:Qt[0]-qt[0],le="deltaY"in It?It.deltaY:Qt[1]-qt[1],Ue,ke=It.target,er=Math.abs(se)>Math.abs(le)?"h":"v";if("touches"in It&&er==="h"&&ke.type==="range")return!1;var Le=lb(er,ke);if(!Le)return!0;if(Le?Ue=er:(Ue=er==="v"?"h":"v",Le=lb(er,ke)),!Le)return!1;if(!d.current&&"changedTouches"in It&&(se||le)&&(d.current=Ue),!Ue)return!0;var lr=d.current||Ue;return kS(lr,Pt,It,lr==="h"?se:le,!0)},[]),V=Io.useCallback(function(It){var Pt=It;if(!(!cm.length||cm[cm.length-1]!==b)){var qt="deltaY"in Pt?zS(Pt):v0(Pt),Qt=s.current.filter(function(Ue){return Ue.name===Pt.type&&Ue.target===Pt.target&&FC(Ue.delta,qt)})[0];if(Qt&&Qt.should){Pt.cancelable&&Pt.preventDefault();return}if(!Qt){var se=(C.current.shards||[]).map(RS).filter(Boolean).filter(function(Ue){return Ue.contains(Pt.target)}),le=se.length>0?l(Pt,se[0]):!C.current.noIsolation;le&&Pt.cancelable&&Pt.preventDefault()}}},[]),R=Io.useCallback(function(It,Pt,qt,Qt){var se={name:It,delta:Pt,target:qt,should:Qt};s.current.push(se),setTimeout(function(){s.current=s.current.filter(function(le){return le!==se})},1)},[]),et=Io.useCallback(function(It){u.current=v0(It),d.current=void 0},[]),at=Io.useCallback(function(It){R(It.type,zS(It),It.target,l(It,i.lockRef.current))},[]),st=Io.useCallback(function(It){R(It.type,v0(It),It.target,l(It,i.lockRef.current))},[]);Io.useEffect(function(){return cm.push(b),i.setCallbacks({onScrollCapture:at,onWheelCapture:at,onTouchMoveCapture:st}),document.addEventListener("wheel",V,df),document.addEventListener("touchmove",V,df),document.addEventListener("touchstart",et,df),function(){cm=cm.filter(function(It){return It!==b}),document.removeEventListener("wheel",V,df),document.removeEventListener("touchmove",V,df),document.removeEventListener("touchstart",et,df)}},[]);var yt=i.removeScrollBar,xt=i.inert;return Io.createElement(Io.Fragment,null,xt?Io.createElement(b,{styles:NC(_)}):null,yt?Io.createElement(AS,{gapMode:"margin"}):null)}var FS=_e(Ee(),1),NS=function(i){var s=i.sideCar,u=f0(i,["sideCar"]);if(!s)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=s.read();if(!d)throw new Error("Sidecar medium not found");return FS.createElement(d,au({},u))};NS.isSideCarExport=!0;function BS(i,s){return i.useMedium(s),NS}var VS=BS(m0,OS);var VC=x0.forwardRef(function(i,s){return x0.createElement(Py,au({},i,{ref:s,sideCar:VS}))});VC.classNames=Py.classNames;var UC=["ArrowDown","PageUp","Home"],jC=["ArrowUp","PageDown","End"],tq=[...UC,...jC],b0="Menu",[eq,rq,GC]=h0(b0),[mf,ub]=Gh(b0,[GC,rb,ib]),nq=rb(),iq=ib(),[oq,sq]=mf(b0),[aq,lq]=mf(b0);var qC="MenuPortal",[uq,cq]=mf(qC,{forceMount:void 0});var $C="MenuContent",[hq,pq]=mf($C);var ZC="MenuRadioGroup";mf(ZC,{value:void 0,onValueChange:()=>{}});var XC="MenuItemIndicator",[dq,fq]=mf(XC,{checked:!1});var HC="MenuSub";mf(HC);var US="DropdownMenu",[YC,Dq]=Gh(US,[ub]),kq=ub(),[zq,Rq]=YC(US);var E0=_e(Ee(),1);var gf=_e(Ee(),1);var jS=_e(Ee(),1),GS=(0,jS.createContext)({color:"currentColor",size:"1em",weight:"regular",mirrored:!1});var WC=Object.defineProperty,S0=Object.getOwnPropertySymbols,XS=Object.prototype.hasOwnProperty,HS=Object.prototype.propertyIsEnumerable,qS=(i,s,u)=>s in i?WC(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,$S=(i,s)=>{for(var u in s||(s={}))XS.call(s,u)&&qS(i,u,s[u]);if(S0)for(var u of S0(s))HS.call(s,u)&&qS(i,u,s[u]);return i},ZS=(i,s)=>{var u={};for(var d in i)XS.call(i,d)&&s.indexOf(d)<0&&(u[d]=i[d]);if(i!=null&&S0)for(var d of S0(i))s.indexOf(d)<0&&HS.call(i,d)&&(u[d]=i[d]);return u},fh=(0,gf.forwardRef)((i,s)=>{let u=i,{alt:d,color:_,size:b,weight:C,mirrored:l,children:V,weights:R}=u,et=ZS(u,["alt","color","size","weight","mirrored","children","weights"]),at=(0,gf.useContext)(GS),{color:st="currentColor",size:yt,weight:xt="regular",mirrored:It=!1}=at,Pt=ZS(at,["color","size","weight","mirrored"]);return gf.default.createElement("svg",$S($S({ref:s,xmlns:"http://www.w3.org/2000/svg",width:b??yt,height:b??yt,fill:_??st,viewBox:"0 0 256 256",transform:l||It?"scale(-1, 1)":void 0},Pt),et),!!d&&gf.default.createElement("title",null,d),V,R.get(C??xt))});fh.displayName="IconBase";var Is=_e(Ee(),1),YS=new Map([["bold",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M176.49,95.51a12,12,0,0,1,0,17l-56,56a12,12,0,0,1-17,0l-24-24a12,12,0,1,1,17-17L112,143l47.51-47.52A12,12,0,0,1,176.49,95.51ZM236,128A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Z"}))],["duotone",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),Is.default.createElement("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["fill",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm45.66,85.66-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35a8,8,0,0,1,11.32,11.32Z"}))],["light",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M172.24,99.76a6,6,0,0,1,0,8.48l-56,56a6,6,0,0,1-8.48,0l-24-24a6,6,0,0,1,8.48-8.48L112,151.51l51.76-51.75A6,6,0,0,1,172.24,99.76ZM230,128A102,102,0,1,1,128,26,102.12,102.12,0,0,1,230,128Zm-12,0a90,90,0,1,0-90,90A90.1,90.1,0,0,0,218,128Z"}))],["regular",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M173.66,98.34a8,8,0,0,1,0,11.32l-56,56a8,8,0,0,1-11.32,0l-24-24a8,8,0,0,1,11.32-11.32L112,148.69l50.34-50.35A8,8,0,0,1,173.66,98.34ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"}))],["thin",Is.default.createElement(Is.default.Fragment,null,Is.default.createElement("path",{d:"M170.83,101.17a4,4,0,0,1,0,5.66l-56,56a4,4,0,0,1-5.66,0l-24-24a4,4,0,0,1,5.66-5.66L112,154.34l53.17-53.17A4,4,0,0,1,170.83,101.17ZM228,128A100,100,0,1,1,128,28,100.11,100.11,0,0,1,228,128Zm-8,0a92,92,0,1,0-92,92A92.1,92.1,0,0,0,220,128Z"}))]]);var JC=Object.defineProperty,KC=Object.defineProperties,QC=Object.getOwnPropertyDescriptors,WS=Object.getOwnPropertySymbols,tP=Object.prototype.hasOwnProperty,eP=Object.prototype.propertyIsEnumerable,JS=(i,s,u)=>s in i?JC(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,rP=(i,s)=>{for(var u in s||(s={}))tP.call(s,u)&&JS(i,u,s[u]);if(WS)for(var u of WS(s))eP.call(s,u)&&JS(i,u,s[u]);return i},nP=(i,s)=>KC(i,QC(s)),KS=(0,E0.forwardRef)((i,s)=>E0.default.createElement(fh,nP(rP({ref:s},i),{weights:YS})));KS.displayName="CheckCircle";var T0=_e(Ee(),1);var Cs=_e(Ee(),1),QS=new Map([["bold",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"}))],["duotone",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M224,128a96,96,0,1,1-96-96A96,96,0,0,1,224,128Z",opacity:"0.2"}),Cs.default.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Z"}))],["fill",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"}))],["light",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M128,26A102,102,0,1,0,230,128,102.12,102.12,0,0,0,128,26Zm0,192a90,90,0,1,1,90-90A90.1,90.1,0,0,1,128,218Z"}))],["regular",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Z"}))],["thin",Cs.default.createElement(Cs.default.Fragment,null,Cs.default.createElement("path",{d:"M128,28A100,100,0,1,0,228,128,100.11,100.11,0,0,0,128,28Zm0,192a92,92,0,1,1,92-92A92.1,92.1,0,0,1,128,220Z"}))]]);var iP=Object.defineProperty,oP=Object.defineProperties,sP=Object.getOwnPropertyDescriptors,tE=Object.getOwnPropertySymbols,aP=Object.prototype.hasOwnProperty,lP=Object.prototype.propertyIsEnumerable,eE=(i,s,u)=>s in i?iP(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,uP=(i,s)=>{for(var u in s||(s={}))aP.call(s,u)&&eE(i,u,s[u]);if(tE)for(var u of tE(s))lP.call(s,u)&&eE(i,u,s[u]);return i},cP=(i,s)=>oP(i,sP(s)),rE=(0,T0.forwardRef)((i,s)=>T0.default.createElement(fh,cP(uP({ref:s},i),{weights:QS})));rE.displayName="Circle";var I0=_e(Ee(),1);var as=_e(Ee(),1),nE=new Map([["bold",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"}))],["duotone",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M224,80l-96,56L32,80l96-56Z",opacity:"0.2"}),as.default.createElement("path",{d:"M230.91,172A8,8,0,0,1,228,182.91l-96,56a8,8,0,0,1-8.06,0l-96-56A8,8,0,0,1,36,169.09l92,53.65,92-53.65A8,8,0,0,1,230.91,172ZM220,121.09l-92,53.65L36,121.09A8,8,0,0,0,28,134.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,121.09ZM24,80a8,8,0,0,1,4-6.91l96-56a8,8,0,0,1,8.06,0l96,56a8,8,0,0,1,0,13.82l-96,56a8,8,0,0,1-8.06,0l-96-56A8,8,0,0,1,24,80Zm23.88,0L128,126.74,208.12,80,128,33.26Z"}))],["fill",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M220,169.09l-92,53.65L36,169.09A8,8,0,0,0,28,182.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,169.09Z"}),as.default.createElement("path",{d:"M220,121.09l-92,53.65L36,121.09A8,8,0,0,0,28,134.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,121.09Z"}),as.default.createElement("path",{d:"M28,86.91l96,56a8,8,0,0,0,8.06,0l96-56a8,8,0,0,0,0-13.82l-96-56a8,8,0,0,0-8.06,0l-96,56a8,8,0,0,0,0,13.82Z"}))],["light",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M229.18,173a6,6,0,0,1-2.16,8.2l-96,56a6,6,0,0,1-6,0l-96-56a6,6,0,0,1,6-10.36l93,54.23,93-54.23A6,6,0,0,1,229.18,173ZM221,122.82l-93,54.23L35,122.82a6,6,0,0,0-6,10.36l96,56a6,6,0,0,0,6,0l96-56a6,6,0,0,0-6-10.36ZM26,80a6,6,0,0,1,3-5.18l96-56a6,6,0,0,1,6,0l96,56a6,6,0,0,1,0,10.36l-96,56a6,6,0,0,1-6,0l-96-56A6,6,0,0,1,26,80Zm17.91,0L128,129.05,212.09,80,128,31Z"}))],["regular",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M230.91,172A8,8,0,0,1,228,182.91l-96,56a8,8,0,0,1-8.06,0l-96-56A8,8,0,0,1,36,169.09l92,53.65,92-53.65A8,8,0,0,1,230.91,172ZM220,121.09l-92,53.65L36,121.09A8,8,0,0,0,28,134.91l96,56a8,8,0,0,0,8.06,0l96-56A8,8,0,1,0,220,121.09ZM24,80a8,8,0,0,1,4-6.91l96-56a8,8,0,0,1,8.06,0l96,56a8,8,0,0,1,0,13.82l-96,56a8,8,0,0,1-8.06,0l-96-56A8,8,0,0,1,24,80Zm23.88,0L128,126.74,208.12,80,128,33.26Z"}))],["thin",as.default.createElement(as.default.Fragment,null,as.default.createElement("path",{d:"M227.45,174a4,4,0,0,1-1.44,5.48l-96,56a4,4,0,0,1-4,0l-96-56a4,4,0,0,1,4-6.92l94,54.83,94-54.83A4,4,0,0,1,227.45,174ZM222,124.54l-94,54.83L34,124.54a4,4,0,0,0-4,6.92l96,56a4,4,0,0,0,4,0l96-56a4,4,0,0,0-4-6.92ZM28,80a4,4,0,0,1,2-3.46l96-56a4,4,0,0,1,4,0l96,56a4,4,0,0,1,0,6.92l-96,56a4,4,0,0,1-4,0l-96-56A4,4,0,0,1,28,80Zm11.94,0L128,131.37,216.06,80,128,28.63Z"}))]]);var hP=Object.defineProperty,pP=Object.defineProperties,dP=Object.getOwnPropertyDescriptors,iE=Object.getOwnPropertySymbols,fP=Object.prototype.hasOwnProperty,mP=Object.prototype.propertyIsEnumerable,oE=(i,s,u)=>s in i?hP(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,gP=(i,s)=>{for(var u in s||(s={}))fP.call(s,u)&&oE(i,u,s[u]);if(iE)for(var u of iE(s))mP.call(s,u)&&oE(i,u,s[u]);return i},yP=(i,s)=>pP(i,dP(s)),sE=(0,I0.forwardRef)((i,s)=>I0.default.createElement(fh,yP(gP({ref:s},i),{weights:nE})));sE.displayName="Stack";var gE=_e(Ee(),1);var cb={exports:{}};var hm={};var uE=_e(Ee(),1);var lE;function cE(){if(lE)return hm;lE=1;var i=uE.default,s=Symbol.for("react.element"),u=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,_=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,b={key:!0,ref:!0,__self:!0,__source:!0};function C(l,V,R){var et,at={},st=null,yt=null;R!==void 0&&(st=""+R),V.key!==void 0&&(st=""+V.key),V.ref!==void 0&&(yt=V.ref);for(et in V)d.call(V,et)&&!b.hasOwnProperty(et)&&(at[et]=V[et]);if(l&&l.defaultProps)for(et in V=l.defaultProps,V)at[et]===void 0&&(at[et]=V[et]);return{$$typeof:s,type:l,key:st,ref:yt,props:at,_owner:_.current}}return hm.Fragment=u,hm.jsx=C,hm.jsxs=C,hm}var v$=_e(Ee(),1);cb.exports=cE();var mh=cb.exports;var Ly=_e(Ee(),1),P$=(0,Ly.createContext)(void 0);var My=_e(Ee(),1);var C0=(i=>(i.MOBILE="MOBILE",i.DESKTOP="DESKTOP",i))(C0||{});var _P="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,R$=(0,My.createContext)({size:C0.DESKTOP,isTouchDevice:_P});var Dy=_e(Ee(),1),j$=(0,Dy.createContext)(void 0);var wP=_e(Ee(),1);var P0=_e(Ee(),1),SP=(0,P0.createContext)(void 0);var hb=_e(Ee(),1),A0=(0,hb.createContext)(void 0);var L0=_e(Ee(),1),EP=(0,L0.createContext)(void 0);var hE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};var pb={exports:{}};(function(i,s){(function(u,d){i.exports=d()})(hE,function(){var u,d,_;function b(l,V){if(!u)u=V;else if(!d)d=V;else{var R="var sharedChunk = {}; ("+u+")(sharedChunk); ("+d+")(sharedChunk);",et={};u(et),_=V(et),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}b(["exports"],function(l){function V(r,t,n,a){return new(n||(n=Promise))(function(h,g){function y(T){try{S(a.next(T))}catch(P){g(P)}}function v(T){try{S(a.throw(T))}catch(P){g(P)}}function S(T){var P;T.done?h(T.value):(P=T.value,P instanceof n?P:new n(function(M){M(P)})).then(y,v)}S((a=a.apply(r,t||[])).next())})}function R(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var et=at;function at(r,t){this.x=r,this.y=t}at.prototype={clone:function(){return new at(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,t){var n=Math.cos(r),a=Math.sin(r),h=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},at.convert=function(r){return r instanceof at?r:Array.isArray(r)?new at(r[0],r[1]):r};var st=R(et),yt=xt;function xt(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}xt.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var h=this.sampleCurveX(n)-r;if(Math.abs(h)<t)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,v=1;for(n=r,a=0;a<20&&(h=this.sampleCurveX(n),!(Math.abs(h-r)<t));a++)r>h?y=n:v=n,n=.5*(v-y)+y;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var It=R(yt);let Pt,qt;function Qt(){return Pt==null&&(Pt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pt}function se(){if(qt==null&&(qt=!1,Qt())){let r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let n=0;n<5*5;n++){let a=4*n;r.fillStyle=`rgb(${a},${a+1},${a+2})`,r.fillRect(n%5,Math.floor(n/5),1,1)}let t=r.getImageData(0,0,5,5).data;for(let n=0;n<5*5*4;n++)if(n%4!=3&&t[n]!==n){qt=!0;break}}}return qt||!1}function le(r,t,n,a){let h=new It(r,t,n,a);return function(g){return h.solve(g)}}let Ue=le(.25,.1,.25,1);function ke(r,t,n){return Math.min(n,Math.max(t,r))}function er(r,t,n){let a=n-t,h=((r-t)%a+a)%a+t;return h===t?n:h}function Le(r,...t){for(let n of t)for(let a in n)r[a]=n[a];return r}let lr=1;function je(r,t,n){let a={};for(let h in r)a[h]=t.call(n||this,r[h],h,r);return a}function zr(r,t,n){let a={};for(let h in r)t.call(n||this,r[h],h,r)&&(a[h]=r[h]);return a}function nr(r){return Array.isArray(r)?r.map(nr):typeof r=="object"&&r?je(r,nr):r}let fn={};function de(r){fn[r]||(typeof console<"u"&&console.warn(r),fn[r]=!0)}function Ke(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Er(r){let t=0;for(let n,a,h=0,g=r.length,y=g-1;h<g;y=h++)n=r[h],a=r[y],t+=(a.x-n.x)*(n.y+a.y);return t}function Ar(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let xn=null;function pi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}let Qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ri(r,t,n,a,h){return V(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let g=new VideoFrame(r,{timestamp:0});try{let y=g?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let v=y.startsWith("BGR"),S=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(S,function(T,P,M,z,N){let B=4*Math.max(-P,0),q=(Math.max(0,M)-M)*z*4+B,W=4*z,Q=Math.max(0,P),ut=Math.max(0,M);return{rect:{x:Q,y:ut,width:Math.min(T.width,P+z)-Q,height:Math.min(T.height,M+N)-ut},layout:[{offset:q,stride:W}]}}(r,t,n,a,h)),v)for(let T=0;T<S.length;T+=4){let P=S[T];S[T]=S[T+2],S[T+2]=P}return S}finally{g.close()}})}let Sn,Ne,qr,zn,Ci={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){let t=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(r,t=0){return this.getImageCanvasContext(r).getImageData(-t,-t,r.width+2*t,r.height+2*t)},getImageCanvasContext(r){let t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=r.width,t.height=r.height,n.drawImage(r,0,0,r.width,r.height),n},resolveURL:r=>(qr||(qr=document.createElement("a")),qr.href=r,qr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(zn==null&&(zn=matchMedia("(prefers-reduced-motion: reduce)")),zn.matches)}},Os={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class oo extends Error{constructor(t,n,a,h){super(`AJAXError: ${n} (${t}): ${a}`),this.status=t,this.statusText=n,this.url=a,this.body=h}}let ln=Ar()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Qe=r=>Os.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))];function na(r,t){let n=new AbortController,a=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,cache:r.cache,referrer:ln(),signal:n.signal}),h=!1,g=!1;return r.type==="json"&&a.headers.set("Accept","application/json"),g||fetch(a).then(y=>y.ok?(v=>{(r.type==="arrayBuffer"||r.type==="image"?v.arrayBuffer():r.type==="json"?v.json():v.text()).then(S=>{g||(h=!0,t(null,S,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(S=>{g||t(new Error(S.message))})})(y):y.blob().then(v=>t(new oo(y.status,y.statusText,r.url,v)))).catch(y=>{y.code!==20&&t(new Error(y.message))}),{cancel:()=>{g=!0,h||n.abort()}}}let Fo=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t);if(!Ar())return(Qe(r.url)||na)(r,t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(ln())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return na(r,t);if(Ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t,void 0,!0)}var n;return function(a,h){let g=new XMLHttpRequest;g.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(g.responseType="arraybuffer");for(let y in a.headers)g.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=a.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(a.type==="json")try{y=JSON.parse(g.response)}catch(v){return h(v)}h(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else{let y=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});h(new oo(g.status,g.statusText,a.url,y))}},g.send(a.body),{cancel:()=>g.abort()}}(r,t)},ba=function(r,t){return Fo(Le(r,{type:"arrayBuffer"}),t)};function Oi(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;let t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Fs(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Zr(r,t,n){if(n&&n[r]){let a=n[r].indexOf(t);a!==-1&&n[r].splice(a,1)}}class Mo{constructor(t,n={}){Le(this,n),this.type=t}}class No extends Mo{constructor(t,n={}){super("error",Le({error:t},n))}}class ls{on(t,n){return this._listeners=this._listeners||{},Fs(t,n,this._listeners),this}off(t,n){return Zr(t,n,this._listeners),Zr(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Fs(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){typeof t=="string"&&(t=new Mo(t,n||{}));let a=t.type;if(this.listens(a)){t.target=this;let h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(let v of h)v.call(this,t);let g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(let v of g)Zr(a,v,this._oneTimeListeners),v.call(this,t);let y=this._eventedParent;y&&(Le(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(t))}else t instanceof No&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var _t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let Vn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function fi(r,t){let n={};for(let a in r)a!=="ref"&&(n[a]=r[a]);return Vn.forEach(a=>{a in t&&(n[a]=t[a])}),n}function ar(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!ar(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(let n in r)if(!ar(r[n],t[n]))return!1;return!0}return r===t}let Ze={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ji(r,t,n){n.push({command:Ze.addSource,args:[r,t[r]]})}function ho(r,t,n){t.push({command:Ze.removeSource,args:[r]}),n[r]=!0}function Zi(r,t,n,a){ho(r,n,a),ji(r,t,n)}function ia(r,t,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!ar(r[n][a],t[n][a]))return!1;for(a in t[n])if(Object.prototype.hasOwnProperty.call(t[n],a)&&a!=="data"&&!ar(r[n][a],t[n][a]))return!1;return!0}function us(r,t,n,a,h,g){let y;for(y in t=t||{},r=r||{})Object.prototype.hasOwnProperty.call(r,y)&&(ar(r[y],t[y])||n.push({command:g,args:[a,y,t[y],h]}));for(y in t)Object.prototype.hasOwnProperty.call(t,y)&&!Object.prototype.hasOwnProperty.call(r,y)&&(ar(r[y],t[y])||n.push({command:g,args:[a,y,t[y],h]}))}function Xi(r){return r.id}function Do(r,t){return r[t.id]=t,r}class Ot{constructor(t,n,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function Pi(r,...t){for(let n of t)for(let a in n)r[a]=n[a];return r}class Cr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class cs{constructor(t,n=[]){this.parent=t,this.bindings={};for(let[a,h]of n)this.bindings[a]=h}concat(t){return new cs(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}let Ai={kind:"null"},Nt={kind:"number"},Se={kind:"string"},ge={kind:"boolean"},bn={kind:"color"},Li={kind:"object"},ye={kind:"value"},Gi={kind:"collator"},X={kind:"formatted"},k={kind:"padding"},O={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function Y(r,t){return{kind:"array",itemType:r,N:t}}function J(r){if(r.kind==="array"){let t=J(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}let ht=[Ai,Nt,Se,ge,bn,X,Li,Y(ye),k,O,j];function nt(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!nt(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(let n of ht)if(!nt(n,t))return null}}return`Expected ${J(r)} but found ${J(t)} instead.`}function tt(r,t){return t.some(n=>n.kind===r.kind)}function it(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function bt(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}let wt=.96422,Tt=.82521,oe=4/29,me=6/29,Kt=3*me*me,ae=me*me*me,xe=Math.PI/180,We=180/Math.PI;function qe(r){return(r%=360)<0&&(r+=360),r}function $e([r,t,n,a]){let h,g,y=mn((.2225045*(r=Ge(r))+.7168786*(t=Ge(t))+.0606169*(n=Ge(n)))/1);r===t&&t===n?h=g=y:(h=mn((.4360747*r+.3850649*t+.1430804*n)/wt),g=mn((.0139322*r+.0971045*t+.7141733*n)/Tt));let v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-g),a]}function Ge(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function mn(r){return r>ae?Math.pow(r,1/3):r/Kt+oe}function hr([r,t,n,a]){let h=(r+16)/116,g=isNaN(t)?h:h+t/500,y=isNaN(n)?h:h-n/200;return h=1*Kr(h),g=wt*Kr(g),y=Tt*Kr(y),[Vr(3.1338561*g-1.6168667*h-.4906146*y),Vr(-.9787684*g+1.9161415*h+.033454*y),Vr(.0719453*g-.2289914*h+1.4052427*y),a]}function Vr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Kr(r){return r>me?r*r*r:Kt*(r-oe)}function mi(r){return parseInt(r.padEnd(2,r),16)/255}function Ul(r,t){return hs(t?r/100:r,0,1)}function hs(r,t,n){return Math.min(Math.max(t,r),n)}function ps(r){return!r.some(Number.isNaN)}let Hi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class tr{constructor(t,n,a,h=1,g=!0){this.r=t,this.g=n,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,a,h]))}static parse(t){if(t instanceof tr)return t;if(typeof t!="string")return;let n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];let h=Hi[a];if(h){let[y,v,S]=h;return[y/255,v/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){let y=a.length<6?1:2,v=1;return[mi(a.slice(v,v+=y)),mi(a.slice(v,v+=y)),mi(a.slice(v,v+=y)),mi(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){let y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[v,S,T,P,M,z,N,B,q,W,Q,ut]=y,rt=[P||" ",N||" ",W].join("");if(rt==="  "||rt==="  /"||rt===",,"||rt===",,,"){let pt=[T,z,q].join(""),ft=pt==="%%%"?100:pt===""?255:0;if(ft){let Et=[hs(+S/ft,0,1),hs(+M/ft,0,1),hs(+B/ft,0,1),Q?Ul(+Q,ut):1];if(ps(Et))return Et}}return}}let g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){let[y,v,S,T,P,M,z,N,B]=g,q=[S||" ",P||" ",z].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){let W=[+v,hs(+T,0,100),hs(+M,0,100),N?Ul(+N,B):1];if(ps(W))return function([Q,ut,rt,pt]){function ft(Et){let Zt=(Et+Q/30)%12,ee=ut*Math.min(rt,1-rt);return rt-ee*Math.max(-1,Math.min(Zt-3,9-Zt,1))}return Q=qe(Q),ut/=100,rt/=100,[ft(0),ft(8),ft(4),pt]}(W)}}}(t);return n?new tr(...n,!1):void 0}get rgb(){let{r:t,g:n,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,n/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){let[n,a,h,g]=$e(t),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?qe(Math.atan2(h,a)*We):NaN,y,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",$e(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){let[t,n,a,h]=this.rgb;return`rgba(${[t,n,a].map(g=>Math.round(255*g)).join(",")},${h})`}}tr.black=new tr(0,0,0,1),tr.white=new tr(1,1,1,1),tr.transparent=new tr(0,0,0,0),tr.red=new tr(1,0,0,1);class jl{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ts{constructor(t,n,a,h,g){this.text=t,this.image=n,this.scale=a,this.fontStack=h,this.textColor=g}}class Br{constructor(t){this.sections=t}static fromString(t){return new Br([new ts(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Br?t:Br.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(let n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Rn(t)}}toString(){return JSON.stringify(this.values)}}let ul=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class En{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof En)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){let a=t[n],h=t[n+1];if(typeof a!="string"||!ul.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new En(t)}}toString(){return JSON.stringify(this.values)}}class un{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new un({name:t,available:!1}):null}}function cl(r,t,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,n,a]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ns(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof tr||r instanceof jl||r instanceof Br||r instanceof Rn||r instanceof En||r instanceof un)return!0;if(Array.isArray(r)){for(let t of r)if(!Ns(t))return!1;return!0}if(typeof r=="object"){for(let t in r)if(!Ns(r[t]))return!1;return!0}return!1}function br(r){if(r===null)return Ai;if(typeof r=="string")return Se;if(typeof r=="boolean")return ge;if(typeof r=="number")return Nt;if(r instanceof tr)return bn;if(r instanceof jl)return Gi;if(r instanceof Br)return X;if(r instanceof Rn)return k;if(r instanceof En)return j;if(r instanceof un)return O;if(Array.isArray(r)){let t=r.length,n;for(let a of r){let h=br(a);if(n){if(n===h)continue;n=ye;break}n=h}return Y(n||ye,t)}return Li}function He(r){let t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof tr||r instanceof Br||r instanceof Rn||r instanceof En||r instanceof un?r.toString():JSON.stringify(r)}class Bo{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ns(t[1]))return n.error("invalid value");let a=t[1],h=br(a),g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Bo(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Tr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}let Va={string:Se,number:Nt,boolean:ge,object:Li};class gi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,h=1,g=t[0];if(g==="array"){let v,S;if(t.length>2){let T=t[1];if(typeof T!="string"||!(T in Va)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=Va[T],h++}else v=ye;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}a=Y(v,S)}else{if(!Va[g])throw new Error(`Types doesn't contain name = ${g}`);a=Va[g]}let y=[];for(;h<t.length;h++){let v=n.parse(t[h],h,ye);if(!v)return null;y.push(v)}return new gi(a,y)}evaluate(t){for(let n=0;n<this.args.length;n++){let a=this.args[n].evaluate(t);if(!nt(this.type,br(a)))return a;if(n===this.args.length-1)throw new Tr(`Expected value to be of type ${J(this.type)}, but found ${J(br(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let _u={"to-boolean":ge,"to-color":bn,"to-number":Nt,"to-string":Se};class Vo{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a=t[0];if(!_u[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");let h=_u[a],g=[];for(let y=1;y<t.length;y++){let v=n.parse(t[y],y,ye);if(!v)return null;g.push(v)}return new Vo(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,a;for(let h of this.args){if(n=h.evaluate(t),a=null,n instanceof tr)return n;if(typeof n=="string"){let g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:cl(n[0],n[1],n[2],n[3]),!a))return new tr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Tr(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(let a of this.args){n=a.evaluate(t);let h=Rn.parse(n);if(h)return h}throw new Tr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(let a of this.args){n=a.evaluate(t);let h=En.parse(n);if(h)return h}throw new Tr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(let a of this.args){if(n=a.evaluate(t),n===null)return 0;let h=Number(n);if(!isNaN(h))return h}throw new Tr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Br.fromString(He(this.args[0].evaluate(t)));case"resolvedImage":return un.fromString(He(this.args[0].evaluate(t)));default:return He(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}let Gl=["Unknown","Point","LineString","Polygon"];class D{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Gl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=tr.parse(t)),n}}class U{constructor(t,n,a=[],h,g=new cs,y=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=y,this.expectedType=h,this._isConstant=n}parse(t,n,a,h,g={}){return n?this.concat(n,a,h)._parse(t,g):this._parse(t,g)}_parse(t,n){function a(h,g,y){return y==="assert"?new gi(g,[h]):y==="coerce"?new Vo(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let g=this.registry[h];if(g){let y=g.parse(t,this);if(!y)return null;if(this.expectedType){let v=this.expectedType,S=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(v.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(v,S))return null}else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"coerce");else y=a(y,v,n.typeAnnotation||"assert")}if(!(y instanceof Bo)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let v=new D;try{y=new Bo(y.type,y.evaluate(v))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){let h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new U(this.registry,this._isConstant,h,n||null,g,this.errors)}error(t,...n){let a=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Cr(a,t))}checkSubtype(t,n){let a=nt(t,n);return a&&this.error(a),a}}class ct{constructor(t,n,a){this.type=Gi,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");let a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");let h=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ge);if(!h)return null;let g=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ge);if(!g)return null;let y=null;return a.locale&&(y=n.parse(a.locale,1,Se),!y)?null:new ct(h,g,y)}evaluate(t){return new jl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}let vt=8192;function At(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Lt(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Rt(r,t){let n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*vt),Math.round(a*h*vt)]}function fe(r,t,n){let a=r[0]-t[0],h=r[1]-t[1],g=r[0]-n[0],y=r[1]-n[1];return a*y-g*h==0&&a*g<=0&&h*y<=0}function ve(r,t){let n=!1;for(let y=0,v=t.length;y<v;y++){let S=t[y];for(let T=0,P=S.length;T<P-1;T++){if(fe(r,S[T],S[T+1]))return!1;(h=S[T])[1]>(a=r)[1]!=(g=S[T+1])[1]>a[1]&&a[0]<(g[0]-h[0])*(a[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var a,h,g;return n}function Ce(r,t){for(let n=0;n<t.length;n++)if(ve(r,t[n]))return!0;return!1}function Ae(r,t,n,a){let h=a[0]-n[0],g=a[1]-n[1],y=(r[0]-n[0])*g-h*(r[1]-n[1]),v=(t[0]-n[0])*g-h*(t[1]-n[1]);return y>0&&v<0||y<0&&v>0}function Ie(r,t,n){for(let T of n)for(let P=0;P<T.length-1;++P)if((v=[(y=T[P+1])[0]-(g=T[P])[0],y[1]-g[1]])[0]*(S=[(h=t)[0]-(a=r)[0],h[1]-a[1]])[1]-v[1]*S[0]!=0&&Ae(a,h,g,y)&&Ae(g,y,a,h))return!0;var a,h,g,y,v,S;return!1}function dr(r,t){for(let n=0;n<r.length;++n)if(!ve(r[n],t))return!1;for(let n=0;n<r.length-1;++n)if(Ie(r[n],r[n+1],t))return!1;return!0}function ri(r,t){for(let n=0;n<t.length;n++)if(dr(r,t[n]))return!0;return!1}function fr(r,t,n){let a=[];for(let h=0;h<r.length;h++){let g=[];for(let y=0;y<r[h].length;y++){let v=Rt(r[h][y],n);At(t,v),g.push(v)}a.push(g)}return a}function Mi(r,t,n){let a=[];for(let h=0;h<r.length;h++){let g=fr(r[h],t,n);a.push(g)}return a}function ce(r,t,n,a){if(r[0]<n[0]||r[0]>n[2]){let h=.5*a,g=r[0]-n[0]>h?-a:n[0]-r[0]>h?a:0;g===0&&(g=r[0]-n[2]>h?-a:n[2]-r[0]>h?a:0),r[0]+=g}At(t,r)}function Xe(r,t,n,a){let h=Math.pow(2,a.z)*vt,g=[a.x*vt,a.y*vt],y=[];for(let v of r)for(let S of v){let T=[S.x+g[0],S.y+g[1]];ce(T,t,n,h),y.push(T)}return y}function cn(r,t,n,a){let h=Math.pow(2,a.z)*vt,g=[a.x*vt,a.y*vt],y=[];for(let S of r){let T=[];for(let P of S){let M=[P.x+g[0],P.y+g[1]];At(t,M),T.push(M)}y.push(T)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(let S of y)for(let T of S)ce(T,t,n,h)}var v;return y}class wn{constructor(t,n){this.type=ge,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ns(t[1])){let a=t[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){let g=a.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new wn(a,a.features[h].geometry)}else if(a.type==="Feature"){let h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new wn(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){let h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){let v=fr(a.coordinates,g,y),S=Xe(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!ve(T,v))return!1}if(a.type==="MultiPolygon"){let v=Mi(a.coordinates,g,y),S=Xe(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!Ce(T,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){let h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(a.type==="Polygon"){let v=fr(a.coordinates,g,y),S=cn(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!dr(T,v))return!1}if(a.type==="MultiPolygon"){let v=Mi(a.coordinates,g,y),S=cn(n.geometry(),h,g,y);if(!Lt(h,g))return!1;for(let T of S)if(!ri(T,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Qn{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let a=t[1];return n.scope.has(a)?new Qn(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ni{constructor(t,n,a,h){this.name=t,this.type=n,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){let a=t[0],h=ni.definitions[a];if(!h)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);let g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([T])=>!Array.isArray(T)||T.length===t.length-1),S=null;for(let[T,P]of v){S=new U(n.registry,hl,n.path,null,n.scope);let M=[],z=!1;for(let N=1;N<t.length;N++){let B=t[N],q=Array.isArray(T)?T[N-1]:T.type,W=S.parse(B,1+M.length,q);if(!W){z=!0;break}M.push(W)}if(!z)if(Array.isArray(T)&&T.length!==M.length)S.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let N=0;N<M.length;N++){let B=Array.isArray(T)?T[N]:T.type,q=M[N];S.concat(N+1).checkSubtype(B,q.type)}if(S.errors.length===0)return new ni(a,g,P,M)}}if(v.length===1)n.errors.push(...S.errors);else{let T=(v.length?v:y).map(([M])=>{return z=M,Array.isArray(z)?`(${z.map(J).join(", ")})`:`(${J(z.type)}...)`;var z}).join(" | "),P=[];for(let M=1;M<t.length;M++){let z=n.parse(t[M],1+P.length);if(!z)return null;P.push(J(z.type))}n.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(t,n){ni.definitions=n;for(let a in n)t[a]=ni}}function hl(r){if(r instanceof Qn)return hl(r.boundExpression);if(r instanceof ni&&r.name==="error"||r instanceof ct||r instanceof wn)return!1;let t=r instanceof Vo||r instanceof gi,n=!0;return r.eachChild(a=>{n=t?n&&hl(a):n&&a instanceof Bo}),!!n&&gn(r)&&pl(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function gn(r){if(r instanceof ni&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof wn)return!1;let t=!0;return r.eachChild(n=>{t&&!gn(n)&&(t=!1)}),t}function oa(r){if(r instanceof ni&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!oa(n)&&(t=!1)}),t}function pl(r,t){if(r instanceof ni&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!pl(a,t)&&(n=!1)}),n}function Yi(r,t){let n=r.length-1,a,h,g=0,y=n,v=0;for(;g<=y;)if(v=Math.floor((g+y)/2),a=r[v],h=r[v+1],a<=t){if(v===n||t<h)return v;g=v+1}else{if(!(a>t))throw new Tr("Input is not a number.");y=v-1}return 0}class ko{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(let[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");let a=n.parse(t[1],1,Nt);if(!a)return null;let h=[],g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let y=1;y<t.length;y+=2){let v=y===1?-1/0:t[y],S=t[y+1],T=y,P=y+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);let M=n.parse(S,P,g);if(!M)return null;g=g||M.type,h.push([v,M])}return new ko(g,a,h)}evaluate(t){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);let g=n.length;return h>=n[g-1]?a[g-1].evaluate(t):a[Yi(n,h)].evaluate(t)}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Oe(r,t,n){return r+n*(t-r)}function Ua(r,t,n){return r.map((a,h)=>Oe(a,t[h],n))}let Un={number:Oe,color:function(r,t,n,a="rgb"){switch(a){case"rgb":{let[h,g,y,v]=Ua(r.rgb,t.rgb,n);return new tr(h,g,y,v,!1)}case"hcl":{let[h,g,y,v]=r.hcl,[S,T,P,M]=t.hcl,z,N;if(isNaN(h)||isNaN(S))isNaN(h)?isNaN(S)?z=NaN:(z=S,y!==1&&y!==0||(N=T)):(z=h,P!==1&&P!==0||(N=g));else{let ut=S-h;S>h&&ut>180?ut-=360:S<h&&h-S>180&&(ut+=360),z=h+n*ut}let[B,q,W,Q]=function([ut,rt,pt,ft]){return ut=isNaN(ut)?0:ut*xe,hr([pt,Math.cos(ut)*rt,Math.sin(ut)*rt,ft])}([z,N??Oe(g,T,n),Oe(y,P,n),Oe(v,M,n)]);return new tr(B,q,W,Q,!1)}case"lab":{let[h,g,y,v]=hr(Ua(r.lab,t.lab,n));return new tr(h,g,y,v,!1)}}},array:Ua,padding:function(r,t,n){return new Rn(Ua(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){let a=r.values,h=t.values;if(a.length!==h.length)throw new Tr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);let g=[];for(let y=0;y<a.length;y+=2){if(a[y]!==h[y])throw new Tr(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${h[y]}`);g.push(a[y]);let[v,S]=a[y+1],[T,P]=h[y+1];g.push([Oe(v,T,n),Oe(S,P,n)])}return new En(g)}};class ti{constructor(t,n,a,h,g){this.type=t,this.operator=n,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(let[y,v]of g)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(t,n,a,h){let g=0;if(t.name==="exponential")g=ql(n,t.base,a,h);else if(t.name==="linear")g=ql(n,1,a,h);else if(t.name==="cubic-bezier"){let y=t.controlPoints;g=new It(y[0],y[1],y[2],y[3]).solve(ql(n,1,a,h))}return g}static parse(t,n){let[a,h,g,...y]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){let T=h[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{let T=h.slice(1);if(T.length!==4||T.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Nt),!g)return null;let v=[],S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=bn:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let T=0;T<y.length;T+=2){let P=y[T],M=y[T+1],z=T+3,N=T+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);let B=n.parse(M,N,S);if(!B)return null;S=S||B.type,v.push([P,B])}return bt(S,Nt)||bt(S,bn)||bt(S,k)||bt(S,j)||bt(S,Y(Nt))?new ti(S,a,h,g,v):n.error(`Type ${J(S)} is not interpolatable.`)}evaluate(t){let n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);let h=this.input.evaluate(t);if(h<=n[0])return a[0].evaluate(t);let g=n.length;if(h>=n[g-1])return a[g-1].evaluate(t);let y=Yi(n,h),v=ti.interpolationFactor(this.interpolation,h,n[y],n[y+1]),S=a[y].evaluate(t),T=a[y+1].evaluate(t);switch(this.operator){case"interpolate":return Un[this.type.kind](S,T,v);case"interpolate-hcl":return Un.color(S,T,v,"hcl");case"interpolate-lab":return Un.color(S,T,v,"lab")}}eachChild(t){t(this.input);for(let n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function ql(r,t,n,a){let h=a-n,g=r-n;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class dl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null,h=n.expectedType;h&&h.kind!=="value"&&(a=h);let g=[];for(let v of t.slice(1)){let S=n.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,g.push(S)}if(!a)throw new Error("No output type");let y=h&&g.some(v=>nt(h,v.type));return new dl(y?ye:a,g)}evaluate(t){let n,a=null,h=0;for(let g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof un&&!a.available&&(n||(n=a.name),a=null,h===this.args.length&&(a=n)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class fl{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(let n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);let a=[];for(let g=1;g<t.length-1;g+=2){let y=t[g];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);let v=n.parse(t[g+1],g+1);if(!v)return null;a.push([y,v])}let h=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return h?new fl(a,h):null}outputDefined(){return this.result.outputDefined()}}class vu{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,Nt),h=n.parse(t[2],2,Y(n.expectedType||ye));return a&&h?new vu(h.type.itemType,a,h):null}evaluate(t){let n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new Tr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new Tr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new Tr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class $l{constructor(t,n){this.type=ge,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,ye);return a&&h?tt(a.type,[ge,Se,Nt,Ai,ye])?new $l(a,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`):null}evaluate(t){let n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!it(n,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${J(br(n))} instead.`);if(!it(a,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${J(br(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ja{constructor(t,n,a){this.type=Nt,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,ye);if(!a||!h)return null;if(!tt(a.type,[ge,Se,Nt,Ai,ye]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(a.type)} instead`);if(t.length===4){let g=n.parse(t[3],3,Nt);return g?new ja(a,h,g):null}return new ja(a,h)}evaluate(t){let n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!it(n,["boolean","string","number","null"]))throw new Tr(`Expected first argument to be of type boolean, string, number or null, but found ${J(br(n))} instead.`);if(!it(a,["string","array"]))throw new Tr(`Expected second argument to be of type array or string, but found ${J(br(a))} instead.`);if(this.fromIndex){let h=this.fromIndex.evaluate(t);return a.indexOf(n,h)}return a.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Zl{constructor(t,n,a,h,g,y){this.inputType=t,this.type=n,this.input=a,this.cases=h,this.outputs=g,this.otherwise=y}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);let g={},y=[];for(let T=2;T<t.length-1;T+=2){let P=t[T],M=t[T+1];Array.isArray(P)||(P=[P]);let z=n.concat(T);if(P.length===0)return z.error("Expected at least one branch label.");for(let B of P){if(typeof B!="number"&&typeof B!="string")return z.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,br(B)))return null}else a=br(B);if(g[String(B)]!==void 0)return z.error("Branch labels must be unique.");g[String(B)]=y.length}let N=n.parse(M,T,h);if(!N)return null;h=h||N.type,y.push(N)}let v=n.parse(t[1],1,ye);if(!v)return null;let S=n.parse(t[t.length-1],t.length-1,h);return S?v.type.kind!=="value"&&n.concat(1).checkSubtype(a,v.type)?null:new Zl(a,h,v,g,y,S):null}evaluate(t){let n=this.input.evaluate(t);return(br(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class xu{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);let h=[];for(let y=1;y<t.length-1;y+=2){let v=n.parse(t[y],y,ge);if(!v)return null;let S=n.parse(t[y+1],y+1,a);if(!S)return null;h.push([v,S]),a=a||S.type}let g=n.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new xu(a,h,g)}evaluate(t){for(let[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(let[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class ml{constructor(t,n,a,h){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);let a=n.parse(t[1],1,ye),h=n.parse(t[2],2,Nt);if(!a||!h)return null;if(!tt(a.type,[Y(ye),Se,ye]))return n.error(`Expected first argument to be of type array or string, but found ${J(a.type)} instead`);if(t.length===4){let g=n.parse(t[3],3,Nt);return g?new ml(a.type,a,h,g):null}return new ml(a.type,a,h)}evaluate(t){let n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);if(!it(n,["string","array"]))throw new Tr(`Expected first argument to be of type array or string, but found ${J(br(n))} instead.`);if(this.endIndex){let h=this.endIndex.evaluate(t);return n.slice(a,h)}return n.slice(a)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Xl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function bu(r,t,n,a){return a.compare(t,n)===0}function Ss(r,t,n){let a=r!=="=="&&r!=="!=";return class pE{constructor(g,y,v){this.type=ge,this.lhs=g,this.rhs=y,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");let v=g[0],S=y.parse(g[1],1,ye);if(!S)return null;if(!Xl(v,S.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${J(S.type)}'.`);let T=y.parse(g[2],2,ye);if(!T)return null;if(!Xl(v,T.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${J(T.type)}'.`);if(S.type.kind!==T.type.kind&&S.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${J(S.type)}' and '${J(T.type)}'.`);a&&(S.type.kind==="value"&&T.type.kind!=="value"?S=new gi(T.type,[S]):S.type.kind!=="value"&&T.type.kind==="value"&&(T=new gi(S.type,[T])));let P=null;if(g.length===4){if(S.type.kind!=="string"&&T.type.kind!=="string"&&S.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(P=y.parse(g[3],3,Gi),!P)return null}return new pE(S,T,P)}evaluate(g){let y=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){let S=br(y),T=br(v);if(S.kind!==T.kind||S.kind!=="string"&&S.kind!=="number")throw new Tr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){let S=br(y),T=br(v);if(S.kind!=="string"||T.kind!=="string")return t(g,y,v)}return this.collator?n(g,y,v,this.collator.evaluate(g)):t(g,y,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}let sa=Ss("==",function(r,t,n){return t===n},bu),Mh=Ss("!=",function(r,t,n){return t!==n},function(r,t,n,a){return!bu(0,t,n,a)}),Dh=Ss("<",function(r,t,n){return t<n},function(r,t,n,a){return a.compare(t,n)<0}),np=Ss(">",function(r,t,n){return t>n},function(r,t,n,a){return a.compare(t,n)>0}),kh=Ss("<=",function(r,t,n){return t<=n},function(r,t,n,a){return a.compare(t,n)<=0}),ec=Ss(">=",function(r,t,n){return t>=n},function(r,t,n,a){return a.compare(t,n)>=0});class Hl{constructor(t,n,a,h,g){this.type=Se,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");let a=n.parse(t[1],1,Nt);if(!a)return null;let h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,Se),!g))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,Se),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,Nt),!v))return null;let S=null;return h["max-fraction-digits"]&&(S=n.parse(h["max-fraction-digits"],1,Nt),!S)?null:new Hl(a,g,y,v,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ga{constructor(t){this.type=X,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");let h=[],g=!1;for(let y=1;y<=t.length-1;++y){let v=t[y];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let S=null;if(v["font-scale"]&&(S=n.parse(v["font-scale"],1,Nt),!S))return null;let T=null;if(v["text-font"]&&(T=n.parse(v["text-font"],1,Y(Se)),!T))return null;let P=null;if(v["text-color"]&&(P=n.parse(v["text-color"],1,bn),!P))return null;let M=h[h.length-1];M.scale=S,M.font=T,M.textColor=P}else{let S=n.parse(t[y],1,ye);if(!S)return null;let T=S.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new Ga(h)}evaluate(t){return new Br(this.sections.map(n=>{let a=n.content.evaluate(t);return br(a)===O?new ts("",a,null,null,null):new ts(He(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(let n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class wu{constructor(t){this.type=O,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");let a=n.parse(t[1],1,Se);return a?new wu(a):n.error("No image name provided.")}evaluate(t){let n=this.input.evaluate(t),a=un.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Bs{constructor(t){this.type=Nt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);let a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${J(a.type)} instead.`):new Bs(a):null}evaluate(t){let n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Tr(`Expected value to be of type string or array, but found ${J(br(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}let Es={"==":sa,"!=":Mh,">":np,"<":Dh,">=":ec,"<=":kh,array:gi,at:vu,boolean:gi,case:xu,coalesce:dl,collator:ct,format:Ga,image:wu,in:$l,"index-of":ja,interpolate:ti,"interpolate-hcl":ti,"interpolate-lab":ti,length:Bs,let:fl,literal:Bo,match:Zl,number:gi,"number-format":Hl,object:gi,slice:ml,step:ko,string:gi,"to-boolean":Vo,"to-color":Vo,"to-number":Vo,"to-string":Vo,var:Qn,within:wn};function Ic(r,[t,n,a,h]){t=t.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);let g=h?h.evaluate(r):1,y=cl(t,n,a,g);if(y)throw new Tr(y);return new tr(t/255,n/255,a/255,g,!1)}function Cc(r,t){return r in t}function gl(r,t){let n=t[r];return n===void 0?null:n}function po(r){return{type:r}}function Su(r){return{result:"success",value:r}}function fo(r){return{result:"error",value:r}}function ds(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function yl(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Eu(r){return!!r.expression&&r.expression.interpolated}function Ye(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function wr(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function ip(r){return r}function Be(r,t){let n=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),g=r.type||(Eu(t)?"exponential":"interval");if(n||t.type==="padding"){let P=n?tr.parse:Rn.parse;(r=Pi({},r)).stops&&(r.stops=r.stops.map(M=>[M[0],P(M[1])])),r.default=P(r.default?r.default:t.default)}if(r.colorSpace&&(y=r.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var y;let v,S,T;if(g==="exponential")v=mo;else if(g==="interval")v=ur;else if(g==="categorical"){v=gr,S=Object.create(null);for(let P of r.stops)S[P[0]]=P[1];T=typeof r.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=wa}if(a){let P={},M=[];for(let B=0;B<r.stops.length;B++){let q=r.stops[B],W=q[0].zoom;P[W]===void 0&&(P[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},M.push(W)),P[W].stops.push([q[0].value,q[1]])}let z=[];for(let B of M)z.push([P[B].zoom,Be(P[B],t)]);let N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:ti.interpolationFactor.bind(void 0,N),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},q)=>mo({stops:z,base:r.base},t,B).evaluate(B,q)}}if(h){let P=g==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ti.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map(M=>M[0]),evaluate:({zoom:M})=>v(r,t,M,S,T)}}return{kind:"source",evaluate(P,M){let z=M&&M.properties?M.properties[r.property]:void 0;return z===void 0?es(r.default,t.default):v(r,t,z,S,T)}}}function es(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function gr(r,t,n,a,h){return es(typeof n===h?a[n]:void 0,r.default,t.default)}function ur(r,t,n){if(Ye(n)!=="number")return es(r.default,t.default);let a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];let h=Yi(r.stops.map(g=>g[0]),n);return r.stops[h][1]}function mo(r,t,n){let a=r.base!==void 0?r.base:1;if(Ye(n)!=="number")return es(r.default,t.default);let h=r.stops.length;if(h===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[h-1][0])return r.stops[h-1][1];let g=Yi(r.stops.map(P=>P[0]),n),y=function(P,M,z,N){let B=N-z,q=P-z;return B===0?0:M===1?q/B:(Math.pow(M,q)-1)/(Math.pow(M,B)-1)}(n,a,r.stops[g][0],r.stops[g+1][0]),v=r.stops[g][1],S=r.stops[g+1][1],T=Un[t.type]||ip;return typeof v.evaluate=="function"?{evaluate(...P){let M=v.evaluate.apply(void 0,P),z=S.evaluate.apply(void 0,P);if(M!==void 0&&z!==void 0)return T(M,z,y,r.colorSpace)}}:T(v,S,y,r.colorSpace)}function wa(r,t,n){switch(t.type){case"color":n=tr.parse(n);break;case"formatted":n=Br.fromString(n.toString());break;case"resolvedImage":n=un.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;default:Ye(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return es(n,r.default,t.default)}ni.register(Es,{error:[{kind:"error"},[Se],(r,[t])=>{throw new Tr(t.evaluate(r))}],typeof:[Se,[ye],(r,[t])=>J(br(t.evaluate(r)))],"to-rgba":[Y(Nt,4),[bn],(r,[t])=>{let[n,a,h,g]=t.evaluate(r).rgb;return[255*n,255*a,255*h,g]}],rgb:[bn,[Nt,Nt,Nt],Ic],rgba:[bn,[Nt,Nt,Nt,Nt],Ic],has:{type:ge,overloads:[[[Se],(r,[t])=>Cc(t.evaluate(r),r.properties())],[[Se,Li],(r,[t,n])=>Cc(t.evaluate(r),n.evaluate(r))]]},get:{type:ye,overloads:[[[Se],(r,[t])=>gl(t.evaluate(r),r.properties())],[[Se,Li],(r,[t,n])=>gl(t.evaluate(r),n.evaluate(r))]]},"feature-state":[ye,[Se],(r,[t])=>gl(t.evaluate(r),r.featureState||{})],properties:[Li,[],r=>r.properties()],"geometry-type":[Se,[],r=>r.geometryType()],id:[ye,[],r=>r.id()],zoom:[Nt,[],r=>r.globals.zoom],"heatmap-density":[Nt,[],r=>r.globals.heatmapDensity||0],"line-progress":[Nt,[],r=>r.globals.lineProgress||0],accumulated:[ye,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Nt,po(Nt),(r,t)=>{let n=0;for(let a of t)n+=a.evaluate(r);return n}],"*":[Nt,po(Nt),(r,t)=>{let n=1;for(let a of t)n*=a.evaluate(r);return n}],"-":{type:Nt,overloads:[[[Nt,Nt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Nt],(r,[t])=>-t.evaluate(r)]]},"/":[Nt,[Nt,Nt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Nt,[Nt,Nt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Nt,[],()=>Math.LN2],pi:[Nt,[],()=>Math.PI],e:[Nt,[],()=>Math.E],"^":[Nt,[Nt,Nt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Nt,[Nt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))],log2:[Nt,[Nt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Nt,[Nt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Nt,[Nt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Nt,[Nt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Nt,[Nt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Nt,[Nt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Nt,[Nt],(r,[t])=>Math.atan(t.evaluate(r))],min:[Nt,po(Nt),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Nt,po(Nt),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Nt,[Nt],(r,[t])=>Math.abs(t.evaluate(r))],round:[Nt,[Nt],(r,[t])=>{let n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Nt,[Nt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Nt,[Nt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[ge,[Se,ye],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[ge,[ye],(r,[t])=>r.id()===t.value],"filter-type-==":[ge,[Se],(r,[t])=>r.geometryType()===t.value],"filter-<":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a<h}],"filter-id-<":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a>h}],"filter-id->":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[ge,[Se,ye],(r,[t,n])=>{let a=r.properties()[t.value],h=n.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[ge,[ye],(r,[t])=>{let n=r.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[ge,[ye],(r,[t])=>t.value in r.properties()],"filter-has-id":[ge,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ge,[Y(Se)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[ge,[Y(ye)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[ge,[Se,Y(ye)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[ge,[Se,Y(ye)],(r,[t,n])=>function(a,h,g,y){for(;g<=y;){let v=g+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:g=v+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ge,overloads:[[[ge,ge],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[po(ge),(r,t)=>{for(let n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:ge,overloads:[[[ge,ge],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[po(ge),(r,t)=>{for(let n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[ge,[ge],(r,[t])=>!t.evaluate(r)],"is-supported-script":[ge,[Se],(r,[t])=>{let n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[Se,[Se],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Se,[Se],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Se,po(ye),(r,t)=>t.map(n=>He(n.evaluate(r))).join("")],"resolved-locale":[Se,[Gi],(r,[t])=>t.evaluate(r).resolvedLocale()]});class qa{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new D,this._defaultValue=n?(a=n).type==="color"&&wr(a.default)?new tr(0,0,0,0):a.type==="color"?tr.parse(a.default)||null:a.type==="padding"?Rn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?En.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,h,g,y){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{let v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Tr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function rs(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Es}function _l(r,t){let n=new U(Es,hl,[],t?function(h){let g={color:bn,string:Se,number:Nt,enum:Se,boolean:ge,formatted:X,padding:k,resolvedImage:O,variableAnchorOffsetCollection:j};return h.type==="array"?Y(g[h.value]||ye,h.length):g[h.type]}(t):void 0),a=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Su(new qa(a,t)):fo(n.errors)}class $a{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!oa(n.expression)}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,g,y)}evaluate(t,n,a,h,g,y){return this._styleExpression.evaluate(t,n,a,h,g,y)}}class Vs{constructor(t,n,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!oa(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,a,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,h,g,y)}evaluate(t,n,a,h,g,y){return this._styleExpression.evaluate(t,n,a,h,g,y)}interpolationFactor(t,n,a){return this.interpolationType?ti.interpolationFactor(this.interpolationType,t,n,a):0}}function Yl(r,t){let n=_l(r,t);if(n.result==="error")return n;let a=n.value.expression,h=gn(a);if(!h&&!ds(t))return fo([new Cr("","data expressions not supported")]);let g=pl(a,["zoom"]);if(!g&&!yl(t))return fo([new Cr("","zoom expressions not supported")]);let y=Sa(a);return y||g?y instanceof Cr?fo([y]):y instanceof ti&&!Eu(t)?fo([new Cr("",'"interpolate" expressions cannot be used with this property')]):Su(y?new Vs(h?"camera":"composite",n.value,y.labels,y instanceof ti?y.interpolation:void 0):new $a(h?"constant":"source",n.value)):fo([new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class aa{constructor(t,n){this._parameters=t,this._specification=n,Pi(this,Be(this._parameters,this._specification))}static deserialize(t){return new aa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Sa(r){let t=null;if(r instanceof fl)t=Sa(r.result);else if(r instanceof dl){for(let n of r.args)if(t=Sa(n),t)break}else(r instanceof ko||r instanceof ti)&&r.input instanceof ni&&r.input.name==="zoom"&&(t=r);return t instanceof Cr||r.eachChild(n=>{let a=Sa(n);a instanceof Cr?t=a:!t&&a?t=new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new Cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ea(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let t of r.slice(1))if(!Ea(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}let zh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Ea(r)||(r=vl(r));let t=_l(r,zh);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,h)=>t.value.evaluate(n,a,{},h),needGeometry:Za(r)}}function rc(r,t){return r<t?-1:r>t?1:0}function Za(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let t=1;t<r.length;t++)if(Za(r[t]))return!0;return!1}function vl(r){if(!r)return!0;let t=r[0];return r.length<=1?t!=="any":t==="=="?Ts(r[1],r[2],"=="):t==="!="?la(Ts(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ts(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(vl))):t==="all"?["all"].concat(r.slice(1).map(vl)):t==="none"?["all"].concat(r.slice(1).map(vl).map(la)):t==="in"?Pc(r[1],r.slice(2)):t==="!in"?la(Pc(r[1],r.slice(2))):t==="has"?Ta(r[1]):t==="!has"?la(Ta(r[1])):t!=="within"||r;var n}function Ts(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Pc(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(rc)]]:["filter-in-small",r,["literal",t]]}}function Ta(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function la(r){return["!",r]}function xl(r){let t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let h="[";for(let g of r)h+=`${xl(g)},`;return`${h}]`}let n=Object.keys(r).sort(),a="{";for(let h=0;h<n.length;h++)a+=`${JSON.stringify(n[h])}:${xl(r[n[h]])},`;return`${a}}`}function ua(r){let t="";for(let n of Vn)t+=`/${xl(r[n])}`;return t}function Tu(r){let t=r.value;return t?[new Ot(r.key,t,"constants have been deprecated as of v8")]:[]}function Ir(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ns(r){if(Array.isArray(r))return r.map(ns);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let t={};for(let n in r)t[n]=ns(r[n]);return t}return Ir(r)}function On(r){let t=r.key,n=r.value,a=r.valueSpec||{},h=r.objectElementValidators||{},g=r.style,y=r.styleSpec,v=r.validateSpec,S=[],T=Ye(n);if(T!=="object")return[new Ot(t,n,`object expected, ${T} found`)];for(let P in n){let M=P.split(".")[0],z=a[M]||a["*"],N;if(h[M])N=h[M];else if(a[M])N=v;else if(h["*"])N=h["*"];else{if(!a["*"]){S.push(new Ot(t,n[P],`unknown property "${P}"`));continue}N=v}S=S.concat(N({key:(t&&`${t}.`)+P,value:n[P],valueSpec:z,style:g,styleSpec:y,object:n,objectKey:P,validateSpec:v},n))}for(let P in a)h[P]||a[P].required&&a[P].default===void 0&&n[P]===void 0&&S.push(new Ot(t,n,`missing required property "${P}"`));return S}function Uo(r){let t=r.value,n=r.valueSpec,a=r.style,h=r.styleSpec,g=r.key,y=r.arrayElementValidator||r.validateSpec;if(Ye(t)!=="array")return[new Ot(g,t,`array expected, ${Ye(t)} found`)];if(n.length&&t.length!==n.length)return[new Ot(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ot(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};h.$version<7&&(v.function=n.function),Ye(n.value)==="object"&&(v=n.value);let S=[];for(let T=0;T<t.length;T++)S=S.concat(y({array:t,arrayIndex:T,value:t[T],valueSpec:v,validateSpec:r.validateSpec,style:a,styleSpec:h,key:`${g}[${T}]`}));return S}function ca(r){let t=r.key,n=r.value,a=r.valueSpec,h=Ye(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Ot(t,n,`number expected, ${h} found`)]:"minimum"in a&&n<a.minimum?[new Ot(t,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new Ot(t,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function bl(r){let t=r.valueSpec,n=Ir(r.value.type),a,h,g,y={},v=n!=="categorical"&&r.value.property===void 0,S=!v,T=Ye(r.value.stops)==="array"&&Ye(r.value.stops[0])==="array"&&Ye(r.value.stops[0][0])==="object",P=On({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(N){if(n==="identity")return[new Ot(N.key,N.value,'identity function may not have a "stops" property')];let B=[],q=N.value;return B=B.concat(Uo({key:N.key,value:q,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:M})),Ye(q)==="array"&&q.length===0&&B.push(new Ot(N.key,q,"array must have at least one stop")),B},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return n==="identity"&&v&&P.push(new Ot(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||P.push(new Ot(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Eu(r.valueSpec)&&P.push(new Ot(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!ds(r.valueSpec)?P.push(new Ot(r.key,r.value,"property functions not supported")):v&&!yl(r.valueSpec)&&P.push(new Ot(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!T||r.value.property!==void 0||P.push(new Ot(r.key,r.value,'"property" property is required')),P;function M(N){let B=[],q=N.value,W=N.key;if(Ye(q)!=="array")return[new Ot(W,q,`array expected, ${Ye(q)} found`)];if(q.length!==2)return[new Ot(W,q,`array length 2 expected, length ${q.length} found`)];if(T){if(Ye(q[0])!=="object")return[new Ot(W,q,`object expected, ${Ye(q[0])} found`)];if(q[0].zoom===void 0)return[new Ot(W,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Ot(W,q,"object stop key must have value")];if(g&&g>Ir(q[0].zoom))return[new Ot(W,q[0].zoom,"stop zoom values must appear in ascending order")];Ir(q[0].zoom)!==g&&(g=Ir(q[0].zoom),h=void 0,y={}),B=B.concat(On({key:`${W}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:ca,value:z}}))}else B=B.concat(z({key:`${W}[0]`,value:q[0],valueSpec:{},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},q));return rs(ns(q[1]))?B.concat([new Ot(`${W}[1]`,q[1],"expressions are not allowed in function stops.")]):B.concat(N.validateSpec({key:`${W}[1]`,value:q[1],valueSpec:t,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function z(N,B){let q=Ye(N.value),W=Ir(N.value),Q=N.value!==null?N.value:B;if(a){if(q!==a)return[new Ot(N.key,Q,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Ot(N.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let ut=`number expected, ${q} found`;return ds(t)&&n===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(N.key,Q,ut)]}return n!=="categorical"||q!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&q==="number"&&h!==void 0&&W<h?[new Ot(N.key,Q,"stop domain values must appear in ascending order")]:(h=W,n==="categorical"&&W in y?[new Ot(N.key,Q,"stop domain values must be unique")]:(y[W]=!0,[])):[new Ot(N.key,Q,`integer expected, found ${W}`)]}}function kt(r){let t=(r.expressionContext==="property"?Yl:_l)(ns(r.value),r.valueSpec);if(t.result==="error")return t.value.map(a=>new Ot(`${r.key}${a.key}`,r.value,a.message));let n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ot(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!oa(n))return[new Ot(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!oa(n))return[new Ot(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!pl(n,["zoom","feature-state"]))return[new Ot(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!gn(n))return[new Ot(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wt(r){let t=r.key,n=r.value,a=r.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Ir(n))===-1&&h.push(new Ot(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(Ir(n))===-1&&h.push(new Ot(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function we(r){return Ea(ns(r.value))?kt(Pi({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rr(r)}function rr(r){let t=r.value,n=r.key;if(Ye(t)!=="array")return[new Ot(n,t,`array expected, ${Ye(t)} found`)];let a=r.styleSpec,h,g=[];if(t.length<1)return[new Ot(n,t,"filter array must have at least 1 element")];switch(g=g.concat(Wt({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ir(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ir(t[1])==="$type"&&g.push(new Ot(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ot(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Ye(t[1]),h!=="string"&&g.push(new Ot(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let y=2;y<t.length;y++)h=Ye(t[y]),Ir(t[1])==="$type"?g=g.concat(Wt({key:`${n}[${y}]`,value:t[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ot(`${n}[${y}]`,t[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)g=g.concat(rr({key:`${n}[${y}]`,value:t[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Ye(t[1]),t.length!==2?g.push(new Ot(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ot(`${n}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=Ye(t[1]),t.length!==2?g.push(new Ot(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&g.push(new Ot(`${n}[1]`,t[1],`object expected, ${h} found`))}return g}function jn(r,t){let n=r.key,a=r.validateSpec,h=r.style,g=r.styleSpec,y=r.value,v=r.objectKey,S=g[`${t}_${r.layerType}`];if(!S)return[];let T=v.match(/^(.*)-transition$/);if(t==="paint"&&T&&S[T[1]]&&S[T[1]].transition)return a({key:n,value:y,valueSpec:g.transition,style:h,styleSpec:g});let P=r.valueSpec||S[v];if(!P)return[new Ot(n,y,`unknown property "${v}"`)];let M;if(Ye(y)==="string"&&ds(P)&&!P.tokens&&(M=/^{([^}]+)}$/.exec(y)))return[new Ot(n,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];let z=[];return r.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&z.push(new Ot(n,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&wr(ns(y))&&Ir(y.type)==="identity"&&z.push(new Ot(n,y,'"text-font" does not support identity functions'))),z.concat(a({key:r.key,value:y,valueSpec:P,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function $r(r){return jn(r,"paint")}function yi(r){return jn(r,"layout")}function Di(r){let t=[],n=r.value,a=r.key,h=r.style,g=r.styleSpec;n.type||n.ref||t.push(new Ot(a,n,'either "type" or "ref" is required'));let y=Ir(n.type),v=Ir(n.ref);if(n.id){let S=Ir(n.id);for(let T=0;T<r.arrayIndex;T++){let P=h.layers[T];Ir(P.id)===S&&t.push(new Ot(a,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&t.push(new Ot(a,n[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{Ir(T.id)===v&&(S=T)}),S?S.ref?t.push(new Ot(a,n.ref,"ref cannot reference another ref layer")):y=Ir(S.type):t.push(new Ot(a,n.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(n.source){let S=h.sources&&h.sources[n.source],T=S&&Ir(S.type);S?T==="vector"&&y==="raster"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&y==="hillshade"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&y!=="raster"?t.push(new Ot(a,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&y!=="hillshade"?t.push(new Ot(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&S.lineMetrics||t.push(new Ot(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ot(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ot(a,n.source,`source "${n.source}" not found`))}else t.push(new Ot(a,n,'missing required property "source"'));return t=t.concat(On({key:a,value:n,valueSpec:g.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:g.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:we,layout:S=>On({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":T=>yi(Pi({layerType:y},T))}}),paint:S=>On({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":T=>$r(Pi({layerType:y},T))}})}})),t}function Tn(r){let t=r.value,n=r.key,a=Ye(t);return a!=="string"?[new Ot(n,t,`string expected, ${a} found`)]:[]}let Gn={promoteId:function({key:r,value:t}){if(Ye(t)==="string")return Tn({key:r,value:t});{let n=[];for(let a in t)n.push(...Tn({key:`${r}.${a}`,value:t[a]}));return n}}};function Mr(r){let t=r.value,n=r.key,a=r.styleSpec,h=r.style,g=r.validateSpec;if(!t.type)return[new Ot(n,t,'"type" is required')];let y=Ir(t.type),v;switch(y){case"vector":case"raster":return v=On({key:n,value:t,valueSpec:a[`source_${y.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Gn,validateSpec:g}),v;case"raster-dem":return v=function(S){var T;let P=(T=S.sourceName)!==null&&T!==void 0?T:"",M=S.value,z=S.styleSpec,N=z.source_raster_dem,B=S.style,q=[],W=Ye(M);if(M===void 0)return q;if(W!=="object")return q.push(new Ot("source_raster_dem",M,`object expected, ${W} found`)),q;let Q=Ir(M.encoding)==="custom",ut=["redFactor","greenFactor","blueFactor","baseShift"],rt=S.value.encoding?`"${S.value.encoding}"`:"Default";for(let pt in M)!Q&&ut.includes(pt)?q.push(new Ot(pt,M[pt],`In "${P}": "${pt}" is only valid when "encoding" is set to "custom". ${rt} encoding found`)):N[pt]?q=q.concat(S.validateSpec({key:pt,value:M[pt],valueSpec:N[pt],validateSpec:S.validateSpec,style:B,styleSpec:z})):q.push(new Ot(pt,M[pt],`unknown property "${pt}"`));return q}({sourceName:n,value:t,style:r.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=On({key:n,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:Gn}),t.cluster)for(let S in t.clusterProperties){let[T,P]=t.clusterProperties[S],M=typeof T=="string"?[T,["accumulated"],["get",S]]:T;v.push(...kt({key:`${n}.${S}.map`,value:P,validateSpec:g,expressionContext:"cluster-map"})),v.push(...kt({key:`${n}.${S}.reduce`,value:M,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return On({key:n,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return On({key:n,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Ot(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wt({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:a})}}function so(r){let t=r.value,n=r.styleSpec,a=n.light,h=r.style,g=[],y=Ye(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ot("light",t,`object expected, ${y} found`)]),g;for(let v in t){let S=v.match(/^(.*)-transition$/);g=g.concat(S&&a[S[1]]&&a[S[1]].transition?r.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:r.validateSpec,style:h,styleSpec:n}):a[v]?r.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Ot(v,t[v],`unknown property "${v}"`)])}return g}function Us(r){let t=r.value,n=r.styleSpec,a=n.terrain,h=r.style,g=[],y=Ye(t);if(t===void 0)return g;if(y!=="object")return g=g.concat([new Ot("terrain",t,`object expected, ${y} found`)]),g;for(let v in t)g=g.concat(a[v]?r.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:r.validateSpec,style:h,styleSpec:n}):[new Ot(v,t[v],`unknown property "${v}"`)]);return g}function go(r){let t=[],n=r.value,a=r.key;if(Array.isArray(n)){let h=[],g=[];for(let y in n)n[y].id&&h.includes(n[y].id)&&t.push(new Ot(a,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&g.includes(n[y].url)&&t.push(new Ot(a,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),g.push(n[y].url),t=t.concat(On({key:`${a}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Tn({key:a,value:n})}let js={"*":()=>[],array:Uo,boolean:function(r){let t=r.value,n=r.key,a=Ye(t);return a!=="boolean"?[new Ot(n,t,`boolean expected, ${a} found`)]:[]},number:ca,color:function(r){let t=r.key,n=r.value,a=Ye(n);return a!=="string"?[new Ot(t,n,`color expected, ${a} found`)]:tr.parse(String(n))?[]:[new Ot(t,n,`color expected, "${n}" found`)]},constants:Tu,enum:Wt,filter:we,function:bl,layer:Di,object:On,source:Mr,light:so,terrain:Us,string:Tn,formatted:function(r){return Tn(r).length===0?[]:kt(r)},resolvedImage:function(r){return Tn(r).length===0?[]:kt(r)},padding:function(r){let t=r.key,n=r.value;if(Ye(n)==="array"){if(n.length<1||n.length>4)return[new Ot(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];let a={type:"number"},h=[];for(let g=0;g<n.length;g++)h=h.concat(r.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:r.validateSpec,valueSpec:a}));return h}return ca({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){let t=r.key,n=r.value,a=Ye(n),h=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new Ot(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let y=0;y<n.length;y+=2)g=g.concat(Wt({key:`${t}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(Uo({key:`${t}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:h}));return g},sprite:go};function ki(r){let t=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=ki,n.expression&&wr(Ir(t))?bl(r):n.expression&&rs(ns(t))?kt(r):n.type&&js[n.type]?js[n.type](r):On(Pi({},r,{valueSpec:n.type?a[n.type]:n}))}function Jl(r){let t=r.value,n=r.key,a=Tn(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ot(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ot(n,t,'"glyphs" url must include a "{range}" token'))),a}function Fn(r,t=_t){let n=[];return n=n.concat(ki({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:ki,objectElementValidators:{glyphs:Jl,"*":()=>[]}})),r.constants&&(n=n.concat(Tu({key:"constants",value:r.constants,style:r,styleSpec:t,validateSpec:ki}))),Xa(n)}function Fi(r){return function(t){return r({...t,validateSpec:ki})}}function Xa(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function yo(r){return function(...t){return Xa(r.apply(this,t))}}Fn.source=yo(Fi(Mr)),Fn.sprite=yo(Fi(go)),Fn.glyphs=yo(Fi(Jl)),Fn.light=yo(Fi(so)),Fn.terrain=yo(Fi(Us)),Fn.layer=yo(Fi(Di)),Fn.filter=yo(Fi(we)),Fn.paintProperty=yo(Fi($r)),Fn.layoutProperty=yo(Fi(yi));let _o=Fn,qn=_o.light,hn=_o.paintProperty,Kl=_o.layoutProperty;function is(r,t){let n=!1;if(t&&t.length)for(let a of t)r.fire(new No(new Error(a.message))),n=!0;return n}class fs{constructor(t,n,a){let h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;let y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(n=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){let T=y[3+S],P=y[3+S+1];h.push(T===P?null:y.subarray(T,P))}let v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;let g=a/n*t;this.min=-g,this.max=t+g}insert(t,n,a,h,g){this._forEachCell(n,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,a,h,g,y){this.cells[g].push(y)}query(t,n,a,h,g){let y=this.min,v=this.max;if(t<=y&&n<=y&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{let S=[];return this._forEachCell(t,n,a,h,this._queryCell,S,{},g),S}}_queryCell(t,n,a,h,g,y,v,S){let T=this.cells[g];if(T!==null){let P=this.keys,M=this.bboxes;for(let z=0;z<T.length;z++){let N=T[z];if(v[N]===void 0){let B=4*N;(S?S(M[B+0],M[B+1],M[B+2],M[B+3]):t<=M[B+2]&&n<=M[B+3]&&a>=M[B+0]&&h>=M[B+1])?(v[N]=!0,y.push(P[N])):v[N]=!1}}}}_forEachCell(t,n,a,h,g,y,v,S){let T=this._convertToCellCoord(t),P=this._convertToCellCoord(n),M=this._convertToCellCoord(a),z=this._convertToCellCoord(h);for(let N=T;N<=M;N++)for(let B=P;B<=z;B++){let q=this.d*B+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(B),this._convertFromCellCoord(N+1),this._convertFromCellCoord(B+1)))&&g.call(this,t,n,a,h,q,y,v,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let t=this.cells,n=3+this.cells.length+1+1,a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;let h=new Int32Array(n+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let y=0;y<t.length;y++){let v=t[y];h[3+y]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,n){let a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(t){return new fs(t.buffer)}}let Nn={};function Ht(r,t,n={}){if(Nn[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Nn[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",fs),Ht("Color",tr),Ht("Error",Error),Ht("AJAXError",oo),Ht("ResolvedImage",un),Ht("StylePropertyFunction",aa),Ht("StyleExpression",qa,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Vs),Ht("ZoomConstantExpression",$a),Ht("CompoundExpression",ni,{omit:["_evaluate"]});for(let r in Es)Es[r]._classRegistryKey||Ht(`Expression_${r}`,Es[r]);function os(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Wi(r,t){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(os(r)||pi(r))return t&&t.push(r),r;if(ArrayBuffer.isView(r)){let n=r;return t&&t.push(n.buffer),n}if(r instanceof ImageData)return t&&t.push(r.data.buffer),r;if(Array.isArray(r)){let n=[];for(let a of r)n.push(Wi(a,t));return n}if(typeof r=="object"){let n=r.constructor,a=n._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Nn[a])throw new Error(`${a} is not registered.`);let h=n.serialize?n.serialize(r,t):{};if(n.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let g in r){if(!r.hasOwnProperty(g)||Nn[a].omit.indexOf(g)>=0)continue;let y=r[g];h[g]=Nn[a].shallow.indexOf(g)>=0?y:Wi(y,t)}r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function ss(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||os(r)||pi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(ss);if(typeof r=="object"){let t=r.$name||"Object";if(!Nn[t])throw new Error(`can't deserialize unregistered class ${t}`);let{klass:n}=Nn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);let a=Object.create(n.prototype);for(let h of Object.keys(r)){if(h==="$name")continue;let g=r[h];a[h]=Nn[t].shallow.indexOf(h)>=0?g:ss(g)}return a}throw new Error("can't deserialize object of type "+typeof r)}class Ha{constructor(){this.first=!0}update(t,n){let a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}let Gt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Ql(r){for(let t of r)if(Wa(t.charCodeAt(0)))return!0;return!1}function Ya(r){for(let t of r)if(!Ac(t.charCodeAt(0)))return!1;return!0}function Ac(r){return!(Gt.Arabic(r)||Gt["Arabic Supplement"](r)||Gt["Arabic Extended-A"](r)||Gt["Arabic Presentation Forms-A"](r)||Gt["Arabic Presentation Forms-B"](r))}function Wa(r){return!(r!==746&&r!==747&&(r<4352||!(Gt["Bopomofo Extended"](r)||Gt.Bopomofo(r)||Gt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Gt["CJK Compatibility Ideographs"](r)||Gt["CJK Compatibility"](r)||Gt["CJK Radicals Supplement"](r)||Gt["CJK Strokes"](r)||!(!Gt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Gt["CJK Unified Ideographs Extension A"](r)||Gt["CJK Unified Ideographs"](r)||Gt["Enclosed CJK Letters and Months"](r)||Gt["Hangul Compatibility Jamo"](r)||Gt["Hangul Jamo Extended-A"](r)||Gt["Hangul Jamo Extended-B"](r)||Gt["Hangul Jamo"](r)||Gt["Hangul Syllables"](r)||Gt.Hiragana(r)||Gt["Ideographic Description Characters"](r)||Gt.Kanbun(r)||Gt["Kangxi Radicals"](r)||Gt["Katakana Phonetic Extensions"](r)||Gt.Katakana(r)&&r!==12540||!(!Gt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Gt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Gt["Unified Canadian Aboriginal Syllabics"](r)||Gt["Unified Canadian Aboriginal Syllabics Extended"](r)||Gt["Vertical Forms"](r)||Gt["Yijing Hexagram Symbols"](r)||Gt["Yi Syllables"](r)||Gt["Yi Radicals"](r))))}function tu(r){return!(Wa(r)||function(t){return!!(Gt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Gt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Gt["Letterlike Symbols"](t)||Gt["Number Forms"](t)||Gt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Gt["Control Pictures"](t)&&t!==9251||Gt["Optical Character Recognition"](t)||Gt["Enclosed Alphanumerics"](t)||Gt["Geometric Shapes"](t)||Gt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Gt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Gt["CJK Symbols and Punctuation"](t)||Gt.Katakana(t)||Gt["Private Use Area"](t)||Gt["CJK Compatibility Forms"](t)||Gt["Small Form Variants"](t)||Gt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}function nc(r){return r>=1424&&r<=2303||Gt["Arabic Presentation Forms-A"](r)||Gt["Arabic Presentation Forms-B"](r)}function eu(r,t){return!(!t&&nc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Gt.Khmer(r))}function ic(r){for(let t of r)if(nc(t.charCodeAt(0)))return!0;return!1}let Lc="deferred",Mc="loading",Dc="loaded",kc=null,ii="unavailable",ms=null,wl=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ii="error"),kc&&kc(r)};function zc(){Sl.fire(new Mo("pluginStateChange",{pluginStatus:ii,pluginURL:ms}))}let Sl=new ls,Rc=function(){return ii},op=function(){if(ii!==Lc||!ms)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ii=Mc,zc(),ms&&ba({url:ms},r=>{r?wl(r):(ii=Dc,zc())})},_i={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ii===Dc||_i.applyArabicShaping!=null,isLoading:()=>ii===Mc,setState(r){if(!Ar())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ii=r.pluginStatus,ms=r.pluginURL},isParsed(){if(!Ar())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return _i.applyArabicShaping!=null&&_i.processBidirectionalText!=null&&_i.processStyledBidirectionalText!=null},getPluginURL(){if(!Ar())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ms}};class yr{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ha,this.transition={})}isSupportedScript(t){return function(n,a){for(let h of n)if(!eu(h.charCodeAt(0),a))return!1;return!0}(t,_i.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class Iu{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,h){if(wr(a))return new aa(a,h);if(rs(a)){let g=Yl(a,h);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=tr.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=En.parse(a)):g=Rn.parse(a),{kind:"constant",evaluate:()=>g}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class Oc{constructor(t){this.property=t,this.value=new Iu(t,void 0)}transitioned(t,n){return new ap(this.property,this.value,n,Le({},t.transition,this.transition),t.now)}untransitioned(){return new ap(this.property,this.value,null,{},0)}}class sp{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return nr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Oc(this._values[t].property)),this._values[t].value=new Iu(this._values[t].property,n===null?void 0:nr(n))}getTransition(t){return nr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Oc(this._values[t].property)),this._values[t].transition=nr(n)||void 0}serialize(){let t={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(t[n]=a);let h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){let a=new lp(this._properties);for(let h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,n._values[h]);return a}untransitioned(){let t=new lp(this._properties);for(let n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ap{constructor(t,n,a,h,g){this.property=t,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){let h=t.now||0,g=this.value.possiblyEvaluate(t,n,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(t,n,a);{let v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(t,n,a),g,function(S){if(S<=0)return 0;if(S>=1)return 1;let T=S*S,P=T*S;return 4*(S<.5?P:3*(S-T)+P-.75)}(v))}}return g}}class lp{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){let h=new Cu(this._properties);for(let g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,a);return h}hasTransition(){for(let t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class gd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return nr(this._values[t].value)}setValue(t,n){this._values[t]=new Iu(this._values[t].property,n===null?void 0:nr(n))}serialize(){let t={};for(let n of Object.keys(this._values)){let a=this.getValue(n);a!==void 0&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){let h=new Cu(this._properties);for(let g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,a);return h}}class $n{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,a,h){return this.property.evaluate(this.value,this.parameters,t,n,a,h)}}class Cu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ie{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,a){let h=Un[this.specification.type];return h?h(t,n,a):t}}class he{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,h){return new $n(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,h)}:t.expression,n)}interpolate(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new $n(this,{kind:"constant",value:void 0},t.parameters);let h=Un[this.specification.type];if(h){let g=h(t.value.value,n.value.value,a);return new $n(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,a,h,g,y){return t.kind==="constant"?t.value:t.evaluate(n,a,h,g,y)}}class El extends he{possiblyEvaluate(t,n,a,h){if(t.value===void 0)return new $n(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){let g=t.expression.evaluate(n,null,{},a,h),y=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(y,y,y,n);return new $n(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){let g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new $n(this,{kind:"constant",value:g},n)}return new $n(this,t.expression,n)}evaluate(t,n,a,h,g,y){if(t.kind==="source"){let v=t.evaluate(n,a,h,g,y);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,h),t.evaluate({zoom:Math.floor(n.zoom)},a,h),t.evaluate({zoom:Math.floor(n.zoom)+1},a,h),n):t.value}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Fc{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){let g=t.expression.evaluate(n,null,{},a,h);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new yr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new yr(Math.floor(n.zoom),n)),t.expression.evaluate(new yr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class Nc{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,h){return!!t.expression.evaluate(n,null,{},a,h)}interpolate(){return!1}}class Ur{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let n in t){let a=t[n];a.specification.overridable&&this.overridableProperties.push(n);let h=this.defaultPropertyValues[n]=new Iu(a,void 0),g=this.defaultTransitionablePropertyValues[n]=new Oc(a);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Ht("DataDrivenProperty",he),Ht("DataConstantProperty",ie),Ht("CrossFadedDataDrivenProperty",El),Ht("CrossFadedProperty",Fc),Ht("ColorRampProperty",Nc);let Bc="-transition";class Ni extends ls{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new gd(n.layout)),n.paint)){this._transitionablePaint=new sp(n.paint);for(let a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(let a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cu(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){n!=null&&this._validate(Kl,`layers.${this.id}.layout.${t}`,t,n,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(Bc)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(n!=null&&this._validate(hn,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(t.endsWith(Bc))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{let h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);let S=this._transitionablePaint._values[t].value;return S.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(t,v,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){let t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),zr(t,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(t,n,a,h,g={}){return(!g||g.validate!==!1)&&is(this,t.call(_o,{key:n,layerType:this.type,objectKey:a,value:h,styleSpec:_t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let t in this.paint._values){let n=this.paint.get(t);if(n instanceof $n&&ds(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let up={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gs{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){let n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Pr(r,t=1){let n=0,a=0;return{members:r.map(h=>{let g=up[h.type].BYTES_PER_ELEMENT,y=n=Ia(n,Math.max(t,g)),v=h.components||1;return a=Math.max(a,g),n+=g*v,{name:h.name,type:h.type,components:v,offset:y}}),size:Ia(n,Math.max(a,t)),alignment:t}}function Ia(r,t){return Math.ceil(r/t)*t}class Tl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.int16[h+0]=n,this.int16[h+1]=a,t}}Tl.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",Tl);class Il extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=h,t}}Il.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",Il);class qs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=4*t;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=g,t}}qs.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",qs);class Vc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=6*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,t}}Vc.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",Vc);class Uc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=4*t,T=8*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.uint8[T+4]=h,this.uint8[T+5]=g,this.uint8[T+6]=y,this.uint8[T+7]=v,t}}Uc.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",Uc);class Ca extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.float32[h+0]=n,this.float32[h+1]=a,t}}Ca.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",Ca);class jc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P){let M=this.length;return this.resize(M+1),this.emplace(M,t,n,a,h,g,y,v,S,T,P)}emplace(t,n,a,h,g,y,v,S,T,P,M){let z=10*t;return this.uint16[z+0]=n,this.uint16[z+1]=a,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=y,this.uint16[z+5]=v,this.uint16[z+6]=S,this.uint16[z+7]=T,this.uint16[z+8]=P,this.uint16[z+9]=M,t}}jc.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",jc);class Gc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z){let N=this.length;return this.resize(N+1),this.emplace(N,t,n,a,h,g,y,v,S,T,P,M,z)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N){let B=12*t;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=y,this.uint16[B+5]=v,this.uint16[B+6]=S,this.uint16[B+7]=T,this.int16[B+8]=P,this.int16[B+9]=M,this.int16[B+10]=z,this.int16[B+11]=N,t}}Gc.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",Gc);class Je extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,t}}Je.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",Je);class f extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}f.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",f);class e extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T){let P=this.length;return this.resize(P+1),this.emplace(P,t,n,a,h,g,y,v,S,T)}emplace(t,n,a,h,g,y,v,S,T,P){let M=10*t,z=5*t;return this.int16[M+0]=n,this.int16[M+1]=a,this.int16[M+2]=h,this.int16[M+3]=g,this.int16[M+4]=y,this.int16[M+5]=v,this.uint32[z+3]=S,this.uint16[M+8]=T,this.uint16[M+9]=P,t}}e.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",e);class o extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y){let v=this.length;return this.resize(v+1),this.emplace(v,t,n,a,h,g,y)}emplace(t,n,a,h,g,y,v){let S=6*t;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=g,this.int16[S+4]=y,this.int16[S+5]=v,t}}o.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",o);class c extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,h,g)}emplace(t,n,a,h,g,y){let v=4*t,S=8*t;return this.float32[v+0]=n,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[S+6]=g,this.int16[S+7]=y,t}}c.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",c);class p extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=12*t,v=3*t;return this.uint8[y+0]=n,this.uint8[y+1]=a,this.float32[v+1]=h,this.float32[v+2]=g,t}}p.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",p);class m extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}m.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",m);class x extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q){let ut=this.length;return this.resize(ut+1),this.emplace(ut,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut){let rt=24*t,pt=12*t,ft=48*t;return this.int16[rt+0]=n,this.int16[rt+1]=a,this.uint16[rt+2]=h,this.uint16[rt+3]=g,this.uint32[pt+2]=y,this.uint32[pt+3]=v,this.uint32[pt+4]=S,this.uint16[rt+10]=T,this.uint16[rt+11]=P,this.uint16[rt+12]=M,this.float32[pt+7]=z,this.float32[pt+8]=N,this.uint8[ft+36]=B,this.uint8[ft+37]=q,this.uint8[ft+38]=W,this.uint32[pt+10]=Q,this.int16[rt+22]=ut,t}}x.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt){let Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt)}emplace(t,n,a,h,g,y,v,S,T,P,M,z,N,B,q,W,Q,ut,rt,pt,ft,Et,Zt,ee,$t,jt,Ft,Yt,Bt){let Dt=32*t,ue=16*t;return this.int16[Dt+0]=n,this.int16[Dt+1]=a,this.int16[Dt+2]=h,this.int16[Dt+3]=g,this.int16[Dt+4]=y,this.int16[Dt+5]=v,this.int16[Dt+6]=S,this.int16[Dt+7]=T,this.uint16[Dt+8]=P,this.uint16[Dt+9]=M,this.uint16[Dt+10]=z,this.uint16[Dt+11]=N,this.uint16[Dt+12]=B,this.uint16[Dt+13]=q,this.uint16[Dt+14]=W,this.uint16[Dt+15]=Q,this.uint16[Dt+16]=ut,this.uint16[Dt+17]=rt,this.uint16[Dt+18]=pt,this.uint16[Dt+19]=ft,this.uint16[Dt+20]=Et,this.uint16[Dt+21]=Zt,this.uint16[Dt+22]=ee,this.uint32[ue+12]=$t,this.float32[ue+13]=jt,this.float32[ue+14]=Ft,this.uint16[Dt+30]=Yt,this.uint16[Dt+31]=Bt,t}}w.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",w);class E extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}E.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",E);class I extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=a,this.float32[g+2]=h,t}}I.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",I);class A extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,t,n,a)}emplace(t,n,a,h){let g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}A.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",A);class L extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){let a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){let h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=a,t}}L.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",L);class F extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){let n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}F.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",F);class $ extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,h){let g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,h)}emplace(t,n,a,h,g){let y=4*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=g,t}}$.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",$);class Z extends Gs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new st(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class H extends e{get(t){return new Z(this,t)}}Ht("CollisionBoxArray",H);class G extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class ot extends x{get(t){return new G(this,t)}}Ht("PlacedSymbolArray",ot);class dt extends Gs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}dt.prototype.size=64;class K extends w{get(t){return new dt(this,t)}}Ht("SymbolInstanceArray",K);class lt extends E{getoffsetX(t){return this.float32[1*t+0]}}Ht("GlyphOffsetArray",lt);class mt extends Il{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ht("SymbolLineVertexArray",mt);class gt extends Gs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}gt.prototype.size=12;class St extends I{get(t){return new gt(this,t)}}Ht("TextAnchorOffsetArray",St);class Mt extends Gs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Mt.prototype.size=8;class Ct extends A{get(t){return new Mt(this,t)}}Ht("FeatureIndexArray",Ct);class zt extends Tl{}class te extends Tl{}class ze extends Tl{}class Ut extends Vc{}class pe extends Uc{}class re extends Ca{}class or extends jc{}class De extends Gc{}class Te extends Je{}class Re extends f{}class Rr extends o{}class pr extends p{}class yn extends m{}class Qr extends L{}let jr=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:vi}=jr;class _r{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,h){let g=this.segments[this.segments.length-1];return t>_r.MAX_VERTEX_ARRAY_LENGTH&&de(`Max vertices per segment is ${_r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>_r.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(let t of this.segments)for(let n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,h){return new _r([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function vo(r,t){return 256*(r=ke(Math.floor(r),0,255))+ke(Math.floor(t),0,255)}_r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",_r);let xo=Pr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gs={exports:{}},$s={exports:{}};$s.exports=function(r,t){var n,a,h,g,y,v,S,T;for(a=r.length-(n=3&r.length),h=t,y=3432918353,v=461845907,T=0;T<a;)S=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,h=27492+(65535&(g=5*(65535&(h=(h^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&r.charCodeAt(T+2))<<16;case 2:S^=(255&r.charCodeAt(T+1))<<8;case 1:h^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(T)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295}return h^=r.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Pa=$s.exports,In={exports:{}};In.exports=function(r,t){for(var n,a=r.length,h=t^a,g=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&r.charCodeAt(g+2))<<16;case 2:h^=(255&r.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&r.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var _n=Pa,Zn=In.exports;gs.exports=_n,gs.exports.murmur3=_n,gs.exports.murmur2=Zn;var Zs=R(gs.exports);class Or{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,h){this.ids.push(tn(t)),this.positions.push(n,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let n=tn(t),a=0,h=this.ids.length-1;for(;a<h;){let y=a+h>>1;this.ids[y]>=n?h=y:a=y+1}let g=[];for(;this.ids[a]===n;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,n){let a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return oi(a,h,0,a.length-1),n&&n.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){let n=new Or;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function tn(r){let t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Zs(String(r))}function oi(r,t,n,a){for(;n<a;){let h=r[n+a>>1],g=n-1,y=a+1;for(;;){do g++;while(r[g]<h);do y--;while(r[y]>h);if(g>=y)break;Fr(r,g,y),Fr(t,3*g,3*y),Fr(t,3*g+1,3*y+1),Fr(t,3*g+2,3*y+2)}y-n<a-y?(oi(r,t,n,y),n=y+1):(oi(r,t,y+1,a),a=y)}}function Fr(r,t,n){let a=r[t];r[t]=r[n],r[n]=a}Ht("FeaturePositionMap",Or);class Xs{constructor(t,n){this.gl=t.gl,this.location=n}}class Pu extends Xs{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class cp extends Xs{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class hp extends Xs{constructor(t,n){super(t,n),this.current=tr.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}let yd=new Float32Array(16);function qc(r){return[vo(255*r.r,255*r.g),vo(255*r.b,255*r.a)]}class bo{constructor(t,n,a){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return this.type==="color"?new hp(t,n):new Pu(t,n)}}class Hs{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,a,h){let g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,n,a){return a.substr(0,9)==="u_pattern"?new cp(t,n):new Pu(t,n)}}class wo{constructor(t,n,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,a,h,g){let y=this.paintVertexArray.length,v=this.expression.evaluate(new yr(0),n,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(y,t,v)}updatePaintArray(t,n,a,h){let g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,n,g)}_setPaintValue(t,n,a){if(this.type==="color"){let h=qc(a);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bi{constructor(t,n,a,h,g,y){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(t,n,a,h,g){let y=this.expression.evaluate(new yr(this.zoom),n,{},h,[],g),v=this.expression.evaluate(new yr(this.zoom+1),n,{},h,[],g),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,y,v)}updatePaintArray(t,n,a,h){let g=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,n,g,y)}_setPaintValue(t,n,a,h){if(this.type==="color"){let g=qc(a),y=qc(h);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],y[0],y[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){let a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=ke(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,a){return new Pu(t,n)}}class So{constructor(t,n,a,h,g,y){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,a){let h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,h,g){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,n,a,h){if(!h||!a)return;let{min:g,mid:y,max:v}=a,S=h[g],T=h[y],P=h[v];if(S&&T&&P)for(let M=t;M<n;M++)this.zoomInPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],T.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],T.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,xo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,xo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $c{constructor(t,n,a){this.binders={},this._buffers=[];let h=[];for(let g in t.paint._values){if(!a(g))continue;let y=t.paint.get(g);if(!(y instanceof $n&&ds(y.property.specification)))continue;let v=xv(g,t.type),S=y.value,T=y.property.specification.type,P=y.property.useIntegerZoom,M=y.property.specification["property-type"],z=M==="cross-faded"||M==="cross-faded-data-driven";if(S.kind==="constant")this.binders[g]=z?new Hs(S.value,v):new bo(S.value,v,T),h.push(`/u_${g}`);else if(S.kind==="source"||z){let N=Bm(g,T,"source");this.binders[g]=z?new So(S,T,P,n,N,t.id):new wo(S,v,T,N),h.push(`/a_${g}`)}else{let N=Bm(g,T,"composite");this.binders[g]=new Bi(S,v,T,P,n,N),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){let n=this.binders[t];return n instanceof wo||n instanceof Bi?n.maxValue:0}populatePaintArrays(t,n,a,h,g){for(let y in this.binders){let v=this.binders[y];(v instanceof wo||v instanceof Bi||v instanceof So)&&v.populatePaintArray(t,n,a,h,g)}}setConstantPatternPositions(t,n){for(let a in this.binders){let h=this.binders[a];h instanceof Hs&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,a,h,g){let y=!1;for(let v in t){let S=n.getPositions(v);for(let T of S){let P=a.feature(T.index);for(let M in this.binders){let z=this.binders[M];if((z instanceof wo||z instanceof Bi||z instanceof So)&&z.expression.isStateDependent===!0){let N=h.paint.get(M);z.expression=N.value,z.updatePaintArray(T.start,T.end,P,t[v],g),y=!0}}}}return y}defines(){let t=[];for(let n in this.binders){let a=this.binders[n];(a instanceof bo||a instanceof Hs)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){let t=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof wo||a instanceof Bi)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof So)for(let h=0;h<xo.members.length;h++)t.push(xo.members[h].name)}return t}getBinderUniforms(){let t=[];for(let n in this.binders){let a=this.binders[n];if(a instanceof bo||a instanceof Hs||a instanceof Bi)for(let h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){let a=[];for(let h in this.binders){let g=this.binders[h];if(g instanceof bo||g instanceof Hs||g instanceof Bi){for(let y of g.uniformNames)if(n[y]){let v=g.getBinding(t,n[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(t,n,a,h){for(let{name:g,property:y,binding:v}of n)this.binders[y].setUniform(v,h,a.get(y),g)}updatePaintBuffers(t){this._buffers=[];for(let n in this.binders){let a=this.binders[n];if(t&&a instanceof So){let h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof wo||a instanceof Bi)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(let n in this.binders){let a=this.binders[n];(a instanceof wo||a instanceof Bi||a instanceof So)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(let t in this.binders){let n=this.binders[t];(n instanceof wo||n instanceof Bi||n instanceof So)&&n.destroy()}}}class jo{constructor(t,n,a=()=>!0){this.programConfigurations={};for(let h of t)this.programConfigurations[h.id]=new $c(h,n,a);this.needsUpload=!1,this._featureMap=new Or,this._bufferOffset=0}populatePaintArrays(t,n,a,h,g,y){for(let v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,h,g,y);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,h){for(let g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(let t in this.programConfigurations)this.programConfigurations[t].destroy()}}function xv(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Bm(r,t,n){let a={color:{source:Ca,composite:$},number:{source:E,composite:Ca}},h=function(g){return{"line-pattern":{source:or,composite:or},"fill-pattern":{source:or,composite:or},"fill-extrusion-pattern":{source:or,composite:or}}[g]}(r);return h&&h[n]||a[t][n]}Ht("ConstantBinder",bo),Ht("CrossFadedConstantBinder",Hs),Ht("SourceExpressionBinder",wo),Ht("CrossFadedCompositeBinder",So),Ht("CompositeExpressionBinder",Bi),Ht("ProgramConfiguration",$c,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",jo);let Xr=8192,_d=Math.pow(2,14)-1,Vm=-_d-1;function Cl(r){let t=Xr/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){let h=n[a];for(let g=0;g<h.length;g++){let y=h[g],v=Math.round(y.x*t),S=Math.round(y.y*t);y.x=ke(v,Vm,_d),y.y=ke(S,Vm,_d),(v<y.x||v>y.x+1||S<y.y||S>y.y+1)&&de("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Pl(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Cl(r):[]}}function pp(r,t,n,a,h){r.emplaceBack(2*t+(a+1)/2,2*n+(h+1)/2)}class vd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.indexArray=new yn,this.segments=new _r,this.programConfigurations=new jo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){let h=this.layers[0],g=[],y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(let{feature:S,id:T,index:P,sourceLayerIndex:M}of t){let z=this.layers[0]._featureFilter.needGeometry,N=Pl(S,z);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),N,a))continue;let B=v?y.evaluate(N,{},a):void 0,q={id:T,properties:S.properties,type:S.type,sourceLayerIndex:M,index:P,geometry:z?N.geometry:Cl(S),patterns:{},sortKey:B};g.push(q)}v&&g.sort((S,T)=>S.sortKey-T.sortKey);for(let S of g){let{geometry:T,index:P,sourceLayerIndex:M}=S,z=t[P].feature;this.addFeature(S,T,P,a),n.featureIndex.insert(z,T,P,M,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,h){for(let g of n)for(let y of g){let v=y.x,S=y.y;if(v<0||v>=Xr||S<0||S>=Xr)continue;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),P=T.vertexLength;pp(this.layoutVertexArray,v,S,-1,-1),pp(this.layoutVertexArray,v,S,1,-1),pp(this.layoutVertexArray,v,S,1,1),pp(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function Um(r,t){for(let n=0;n<r.length;n++)if(Au(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Au(r,t[n]))return!0;return!!xd(r,t)}function bv(r,t,n){return!!Au(r,t)||!!bd(t,r,n)}function jm(r,t){if(r.length===1)return qm(t,r[0]);for(let n=0;n<t.length;n++){let a=t[n];for(let h=0;h<a.length;h++)if(Au(r,a[h]))return!0}for(let n=0;n<r.length;n++)if(qm(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(xd(r,t[n]))return!0;return!1}function wv(r,t,n){if(r.length>1){if(xd(r,t))return!0;for(let a=0;a<t.length;a++)if(bd(t[a],r,n))return!0}for(let a=0;a<r.length;a++)if(bd(r[a],t,n))return!0;return!1}function xd(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){let a=r[n],h=r[n+1];for(let g=0;g<t.length-1;g++)if(Sv(a,h,t[g],t[g+1]))return!0}return!1}function Sv(r,t,n,a){return Ke(r,n,a)!==Ke(t,n,a)&&Ke(r,t,n)!==Ke(r,t,a)}function bd(r,t,n){let a=n*n;if(t.length===1)return r.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(Gm(r,t[h-1],t[h])<a)return!0;return!1}function Gm(r,t,n){let a=t.distSqr(n);if(a===0)return r.distSqr(t);let h=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/a;return r.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function qm(r,t){let n,a,h,g=!1;for(let y=0;y<r.length;y++){n=r[y];for(let v=0,S=n.length-1;v<n.length;S=v++)a=n[v],h=n[S],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Au(r,t){let n=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){let g=r[a],y=r[h];g.y>t.y!=y.y>t.y&&t.x<(y.x-g.x)*(t.y-g.y)/(y.y-g.y)+g.x&&(n=!n)}return n}function Ev(r,t,n){let a=n[0],h=n[2];if(r.x<a.x&&t.x<a.x||r.x>h.x&&t.x>h.x||r.y<a.y&&t.y<a.y||r.y>h.y&&t.y>h.y)return!1;let g=Ke(r,t,n[0]);return g!==Ke(r,t,n[1])||g!==Ke(r,t,n[2])||g!==Ke(r,t,n[3])}function Zc(r,t,n){let a=t.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(t.id).getMaxValue(r)}function dp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function fp(r,t,n,a,h){if(!t[0]&&!t[1])return r;let g=st.convert(t)._mult(h);n==="viewport"&&g._rotate(-a);let y=[];for(let v=0;v<r.length;v++)y.push(r[v].sub(g));return y}let $m,Zm;Ht("CircleBucket",vd,{omit:["layers"]});var Tv={get paint(){return Zm=Zm||new Ur({"circle-radius":new he(_t.paint_circle["circle-radius"]),"circle-color":new he(_t.paint_circle["circle-color"]),"circle-blur":new he(_t.paint_circle["circle-blur"]),"circle-opacity":new he(_t.paint_circle["circle-opacity"]),"circle-translate":new ie(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new ie(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ie(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ie(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new he(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new he(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new he(_t.paint_circle["circle-stroke-opacity"])})},get layout(){return $m=$m||new Ur({"circle-sort-key":new he(_t.layout_circle["circle-sort-key"])})}},si=1e-6,Lu=typeof Float32Array<"u"?Float32Array:Array;function wd(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Xm(r,t,n){var a=t[0],h=t[1],g=t[2],y=t[3],v=t[4],S=t[5],T=t[6],P=t[7],M=t[8],z=t[9],N=t[10],B=t[11],q=t[12],W=t[13],Q=t[14],ut=t[15],rt=n[0],pt=n[1],ft=n[2],Et=n[3];return r[0]=rt*a+pt*v+ft*M+Et*q,r[1]=rt*h+pt*S+ft*z+Et*W,r[2]=rt*g+pt*T+ft*N+Et*Q,r[3]=rt*y+pt*P+ft*B+Et*ut,r[4]=(rt=n[4])*a+(pt=n[5])*v+(ft=n[6])*M+(Et=n[7])*q,r[5]=rt*h+pt*S+ft*z+Et*W,r[6]=rt*g+pt*T+ft*N+Et*Q,r[7]=rt*y+pt*P+ft*B+Et*ut,r[8]=(rt=n[8])*a+(pt=n[9])*v+(ft=n[10])*M+(Et=n[11])*q,r[9]=rt*h+pt*S+ft*z+Et*W,r[10]=rt*g+pt*T+ft*N+Et*Q,r[11]=rt*y+pt*P+ft*B+Et*ut,r[12]=(rt=n[12])*a+(pt=n[13])*v+(ft=n[14])*M+(Et=n[15])*q,r[13]=rt*h+pt*S+ft*z+Et*W,r[14]=rt*g+pt*T+ft*N+Et*Q,r[15]=rt*y+pt*P+ft*B+Et*ut,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Xc,Iv=Xm;function mp(r,t,n){var a=t[0],h=t[1],g=t[2],y=t[3];return r[0]=n[0]*a+n[4]*h+n[8]*g+n[12]*y,r[1]=n[1]*a+n[5]*h+n[9]*g+n[13]*y,r[2]=n[2]*a+n[6]*h+n[10]*g+n[14]*y,r[3]=n[3]*a+n[7]*h+n[11]*g+n[15]*y,r}Xc=new Lu(4),Lu!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0);class Cv extends Ni{constructor(t){super(t,Tv)}createBucket(t){return new vd(t)}queryRadius(t){let n=t;return Zc("circle-radius",this,n)+Zc("circle-stroke-width",this,n)+dp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v,S){let T=fp(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),P=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),M=this.paint.get("circle-pitch-alignment")==="map",z=M?T:function(B,q){return B.map(W=>Hm(W,q))}(T,S),N=M?P*v:P;for(let B of h)for(let q of B){let W=M?q:Hm(q,S),Q=N,ut=mp([],[q.x,q.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=ut[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=y.cameraToCenterDistance/ut[3]),bv(z,W,Q))return!0}return!1}}function Hm(r,t){let n=mp([],[r.x,r.y,0,1],t);return new st(n[0]/n[3],n[1]/n[3])}class Ym extends vd{}let Wm;Ht("HeatmapBucket",Ym,{omit:["layers"]});var Pv={get paint(){return Wm=Wm||new Ur({"heatmap-radius":new he(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new he(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ie(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nc(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ie(_t.paint_heatmap["heatmap-opacity"])})}};function Sd(r,{width:t,height:n},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*a}`)}else h=new Uint8Array(t*n*a);return r.width=t,r.height=n,r.data=h,r}function Jm(r,{width:t,height:n},a){if(t===r.width&&n===r.height)return;let h=Sd({},{width:t,height:n},a);Ed(r,h,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},a),r.width=t,r.height=n,r.data=h.data}function Ed(r,t,n,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>r.width||h.height>r.height||n.x>r.width-h.width||n.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");let y=r.data,v=t.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<h.height;S++){let T=((n.y+S)*r.width+n.x)*g,P=((a.y+S)*t.width+a.x)*g;for(let M=0;M<h.width*g;M++)v[P+M]=y[T+M]}return t}class Hc{constructor(t,n){Sd(this,t,1,n)}resize(t){Jm(this,t,1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,g){Ed(t,n,a,h,g,1)}}class Ji{constructor(t,n){Sd(this,t,4,n)}resize(t){Jm(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ji({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,h,g){Ed(t,n,a,h,g,4)}}function Km(r){let t={},n=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new Ji({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);let g=(y,v,S)=>{t[r.evaluationKey]=S;let T=r.expression.evaluate(t);h.data[y+v+0]=Math.floor(255*T.r/T.a),h.data[y+v+1]=Math.floor(255*T.g/T.a),h.data[y+v+2]=Math.floor(255*T.b/T.a),h.data[y+v+3]=Math.floor(255*T.a)};if(r.clips)for(let y=0,v=0;y<a;++y,v+=4*n)for(let S=0,T=0;S<n;S++,T+=4){let P=S/(n-1),{start:M,end:z}=r.clips[y];g(v,T,M*(1-P)+z*P)}else for(let y=0,v=0;y<n;y++,v+=4)g(0,v,y/(n-1));return h}Ht("AlphaImage",Hc),Ht("RGBAImage",Ji);class Av extends Ni{createBucket(t){return new Ym(t)}constructor(t){super(t,Pv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Km({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Qm;var Lv={get paint(){return Qm=Qm||new Ur({"hillshade-illumination-direction":new ie(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ie(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ie(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ie(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ie(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ie(_t.paint_hillshade["hillshade-accent-color"])})}};class Mv extends Ni{constructor(t){super(t,Lv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Dv=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:kv}=Dv;var Td={exports:{}};function gp(r,t,n){n=n||2;var a,h,g,y,v,S,T,P=t&&t.length,M=P?t[0]*n:r.length,z=tg(r,0,M,n,!0),N=[];if(!z||z.next===z.prev)return N;if(P&&(z=function(q,W,Q,ut){var rt,pt,ft,Et=[];for(rt=0,pt=W.length;rt<pt;rt++)(ft=tg(q,W[rt]*ut,rt<pt-1?W[rt+1]*ut:q.length,ut,!1))===ft.next&&(ft.steiner=!0),Et.push(Uv(ft));for(Et.sort(Nv),rt=0;rt<Et.length;rt++)Q=Bv(Et[rt],Q);return Q}(r,t,z,n)),r.length>80*n){a=g=r[0],h=y=r[1];for(var B=n;B<M;B+=n)(v=r[B])<a&&(a=v),(S=r[B+1])<h&&(h=S),v>g&&(g=v),S>y&&(y=S);T=(T=Math.max(g-a,y-h))!==0?32767/T:0}return Yc(z,N,n,a,h,T,0),N}function tg(r,t,n,a,h){var g,y;if(h===Pd(r,t,n,a)>0)for(g=t;g<n;g+=a)y=ng(g,r[g],r[g+1],y);else for(g=n-a;g>=t;g-=a)y=ng(g,r[g],r[g+1],y);return y&&yp(y,y.next)&&(Jc(y),y=y.next),y}function Al(r,t){if(!r)return r;t||(t=r);var n,a=r;do if(n=!1,a.steiner||!yp(a,a.next)&&Gr(a.prev,a,a.next)!==0)a=a.next;else{if(Jc(a),(a=t=a.prev)===a.next)break;n=!0}while(n||a!==t);return t}function Yc(r,t,n,a,h,g,y){if(r){!y&&g&&function(P,M,z,N){var B=P;do B.z===0&&(B.z=Id(B.x,B.y,M,z,N)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==P);B.prevZ.nextZ=null,B.prevZ=null,function(q){var W,Q,ut,rt,pt,ft,Et,Zt,ee=1;do{for(Q=q,q=null,pt=null,ft=0;Q;){for(ft++,ut=Q,Et=0,W=0;W<ee&&(Et++,ut=ut.nextZ);W++);for(Zt=ee;Et>0||Zt>0&&ut;)Et!==0&&(Zt===0||!ut||Q.z<=ut.z)?(rt=Q,Q=Q.nextZ,Et--):(rt=ut,ut=ut.nextZ,Zt--),pt?pt.nextZ=rt:q=rt,rt.prevZ=pt,pt=rt;Q=ut}pt.nextZ=null,ee*=2}while(ft>1)}(B)}(r,a,h,g);for(var v,S,T=r;r.prev!==r.next;)if(v=r.prev,S=r.next,g?Rv(r,a,h,g):zv(r))t.push(v.i/n|0),t.push(r.i/n|0),t.push(S.i/n|0),Jc(r),r=S.next,T=S.next;else if((r=S)===T){y?y===1?Yc(r=Ov(Al(r),t,n),t,n,a,h,g,2):y===2&&Fv(r,t,n,a,h,g):Yc(Al(r),t,n,a,h,g,1);break}}}function zv(r){var t=r.prev,n=r,a=r.next;if(Gr(t,n,a)>=0)return!1;for(var h=t.x,g=n.x,y=a.x,v=t.y,S=n.y,T=a.y,P=h<g?h<y?h:y:g<y?g:y,M=v<S?v<T?v:T:S<T?S:T,z=h>g?h>y?h:y:g>y?g:y,N=v>S?v>T?v:T:S>T?S:T,B=a.next;B!==t;){if(B.x>=P&&B.x<=z&&B.y>=M&&B.y<=N&&Mu(h,v,g,S,y,T,B.x,B.y)&&Gr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Rv(r,t,n,a){var h=r.prev,g=r,y=r.next;if(Gr(h,g,y)>=0)return!1;for(var v=h.x,S=g.x,T=y.x,P=h.y,M=g.y,z=y.y,N=v<S?v<T?v:T:S<T?S:T,B=P<M?P<z?P:z:M<z?M:z,q=v>S?v>T?v:T:S>T?S:T,W=P>M?P>z?P:z:M>z?M:z,Q=Id(N,B,t,n,a),ut=Id(q,W,t,n,a),rt=r.prevZ,pt=r.nextZ;rt&&rt.z>=Q&&pt&&pt.z<=ut;){if(rt.x>=N&&rt.x<=q&&rt.y>=B&&rt.y<=W&&rt!==h&&rt!==y&&Mu(v,P,S,M,T,z,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0||(rt=rt.prevZ,pt.x>=N&&pt.x<=q&&pt.y>=B&&pt.y<=W&&pt!==h&&pt!==y&&Mu(v,P,S,M,T,z,pt.x,pt.y)&&Gr(pt.prev,pt,pt.next)>=0))return!1;pt=pt.nextZ}for(;rt&&rt.z>=Q;){if(rt.x>=N&&rt.x<=q&&rt.y>=B&&rt.y<=W&&rt!==h&&rt!==y&&Mu(v,P,S,M,T,z,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0)return!1;rt=rt.prevZ}for(;pt&&pt.z<=ut;){if(pt.x>=N&&pt.x<=q&&pt.y>=B&&pt.y<=W&&pt!==h&&pt!==y&&Mu(v,P,S,M,T,z,pt.x,pt.y)&&Gr(pt.prev,pt,pt.next)>=0)return!1;pt=pt.nextZ}return!0}function Ov(r,t,n){var a=r;do{var h=a.prev,g=a.next.next;!yp(h,g)&&eg(h,a,a.next,g)&&Wc(h,g)&&Wc(g,h)&&(t.push(h.i/n|0),t.push(a.i/n|0),t.push(g.i/n|0),Jc(a),Jc(a.next),a=r=g),a=a.next}while(a!==r);return Al(a)}function Fv(r,t,n,a,h,g){var y=r;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&jv(y,v)){var S=rg(y,v);return y=Al(y,y.next),S=Al(S,S.next),Yc(y,t,n,a,h,g,0),void Yc(S,t,n,a,h,g,0)}v=v.next}y=y.next}while(y!==r)}function Nv(r,t){return r.x-t.x}function Bv(r,t){var n=function(h,g){var y,v=g,S=h.x,T=h.y,P=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){var M=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(M<=S&&M>P&&(P=M,y=v.x<v.next.x?v:v.next,M===S))return y}v=v.next}while(v!==g);if(!y)return null;var z,N=y,B=y.x,q=y.y,W=1/0;v=y;do S>=v.x&&v.x>=B&&S!==v.x&&Mu(T<q?S:P,T,B,q,T<q?P:S,T,v.x,v.y)&&(z=Math.abs(T-v.y)/(S-v.x),Wc(v,h)&&(z<W||z===W&&(v.x>y.x||v.x===y.x&&Vv(y,v)))&&(y=v,W=z)),v=v.next;while(v!==N);return y}(r,t);if(!n)return t;var a=rg(n,r);return Al(a,a.next),Al(n,n.next)}function Vv(r,t){return Gr(r.prev,r,t.prev)<0&&Gr(t.next,r,r.next)<0}function Id(r,t,n,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Uv(r){var t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function Mu(r,t,n,a,h,g,y,v){return(h-y)*(t-v)>=(r-y)*(g-v)&&(r-y)*(a-v)>=(n-y)*(t-v)&&(n-y)*(g-v)>=(h-y)*(a-v)}function jv(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,a){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==a.i&&h.next.i!==a.i&&eg(h,h.next,n,a))return!0;h=h.next}while(h!==n);return!1}(r,t)&&(Wc(r,t)&&Wc(t,r)&&function(n,a){var h=n,g=!1,y=(n.x+a.x)/2,v=(n.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(r,t)&&(Gr(r.prev,r,t.prev)||Gr(r,t.prev,t))||yp(r,t)&&Gr(r.prev,r,r.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function yp(r,t){return r.x===t.x&&r.y===t.y}function eg(r,t,n,a){var h=vp(Gr(r,t,n)),g=vp(Gr(r,t,a)),y=vp(Gr(n,a,r)),v=vp(Gr(n,a,t));return h!==g&&y!==v||!(h!==0||!_p(r,n,t))||!(g!==0||!_p(r,a,t))||!(y!==0||!_p(n,r,a))||!(v!==0||!_p(n,t,a))}function _p(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function vp(r){return r>0?1:r<0?-1:0}function Wc(r,t){return Gr(r.prev,r,r.next)<0?Gr(r,t,r.next)>=0&&Gr(r,r.prev,t)>=0:Gr(r,t,r.prev)<0||Gr(r,r.next,t)<0}function rg(r,t){var n=new Cd(r.i,r.x,r.y),a=new Cd(t.i,t.x,t.y),h=r.next,g=t.prev;return r.next=t,t.prev=r,n.next=h,h.prev=n,a.next=n,n.prev=a,g.next=a,a.prev=g,a}function ng(r,t,n,a){var h=new Cd(r,t,n);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Jc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Cd(r,t,n){this.i=r,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pd(r,t,n,a){for(var h=0,g=t,y=n-a;g<n;g+=a)h+=(r[y]-r[g])*(r[g+1]+r[y+1]),y=g;return h}Td.exports=gp,Td.exports.default=gp,gp.deviation=function(r,t,n,a){var h=t&&t.length,g=Math.abs(Pd(r,0,h?t[0]*n:r.length,n));if(h)for(var y=0,v=t.length;y<v;y++)g-=Math.abs(Pd(r,t[y]*n,y<v-1?t[y+1]*n:r.length,n));var S=0;for(y=0;y<a.length;y+=3){var T=a[y]*n,P=a[y+1]*n,M=a[y+2]*n;S+=Math.abs((r[T]-r[M])*(r[P+1]-r[T+1])-(r[T]-r[P])*(r[M+1]-r[T+1]))}return g===0&&S===0?0:Math.abs((S-g)/g)},gp.flatten=function(r){for(var t=r[0][0].length,n={vertices:[],holes:[],dimensions:t},a=0,h=0;h<r.length;h++){for(var g=0;g<r[h].length;g++)for(var y=0;y<t;y++)n.vertices.push(r[h][g][y]);h>0&&n.holes.push(a+=r[h-1].length)}return n};var ig=R(Td.exports);function Gv(r,t,n,a,h){og(r,t,n||0,a||r.length-1,h||qv)}function og(r,t,n,a,h){for(;a>n;){if(a-n>600){var g=a-n+1,y=t-n+1,v=Math.log(g),S=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*S*(g-S)/g)*(y-g/2<0?-1:1);og(r,t,Math.max(n,Math.floor(t-y*S/g+T)),Math.min(a,Math.floor(t+(g-y)*S/g+T)),h)}var P=r[t],M=n,z=a;for(Kc(r,n,t),h(r[a],P)>0&&Kc(r,n,a);M<z;){for(Kc(r,M,z),M++,z--;h(r[M],P)<0;)M++;for(;h(r[z],P)>0;)z--}h(r[n],P)===0?Kc(r,n,z):Kc(r,++z,a),z<=t&&(n=z+1),t<=z&&(a=z-1)}}function Kc(r,t,n){var a=r[t];r[t]=r[n],r[n]=a}function qv(r,t){return r<t?-1:r>t?1:0}function Ad(r,t){let n=r.length;if(n<=1)return[r];let a=[],h,g;for(let y=0;y<n;y++){let v=Er(r[y]);v!==0&&(r[y].area=Math.abs(v),g===void 0&&(g=v<0),g===v<0?(h&&a.push(h),h=[r[y]]):h.push(r[y]))}if(h&&a.push(h),t>1)for(let y=0;y<a.length;y++)a[y].length<=t||(Gv(a[y],t,1,a[y].length-1,$v),a[y]=a[y].slice(0,t));return a}function $v(r,t){return t.area-r.area}function Ld(r,t,n){let a=n.patternDependencies,h=!1;for(let g of t){let y=g.paint.get(`${r}-pattern`);y.isConstant()||(h=!0);let v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Md(r,t,n,a,h){let g=h.patternDependencies;for(let y of t){let v=y.paint.get(`${r}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:a-1},n,{},h.availableImages),T=v.evaluate({zoom:a},n,{},h.availableImages),P=v.evaluate({zoom:a+1},n,{},h.availableImages);S=S&&S.name?S.name:S,T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,g[S]=!0,g[T]=!0,g[P]=!0,n.patterns[y.id]={min:S,mid:T,max:P}}}return n}class Dd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ze,this.indexArray=new yn,this.indexArray2=new Qr,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.segments2=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Ld("fill",this.layers,n);let h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),y=[];for(let{feature:v,id:S,index:T,sourceLayerIndex:P}of t){let M=this.layers[0]._featureFilter.needGeometry,z=Pl(v,M);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),z,a))continue;let N=g?h.evaluate(z,{},a,n.availableImages):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:P,index:T,geometry:M?z.geometry:Cl(v),patterns:{},sortKey:N};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(let v of y){let{geometry:S,index:T,sourceLayerIndex:P}=v;if(this.hasPattern){let M=Md("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,S,T,a,{});n.featureIndex.insert(t[T].feature,S,T,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,h,g){for(let y of Ad(n,500)){let v=0;for(let N of y)v+=N.length;let S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=S.vertexLength,P=[],M=[];for(let N of y){if(N.length===0)continue;N!==y[0]&&M.push(P.length/2);let B=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=B.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),P.push(N[0].x),P.push(N[0].y);for(let W=1;W<N.length;W++)this.layoutVertexArray.emplaceBack(N[W].x,N[W].y),this.indexArray2.emplaceBack(q+W-1,q+W),P.push(N[W].x),P.push(N[W].y);B.vertexLength+=N.length,B.primitiveLength+=N.length}let z=ig(P,M);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(T+z[N],T+z[N+1],T+z[N+2]);S.vertexLength+=v,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let sg,ag;Ht("FillBucket",Dd,{omit:["layers","patternFeatures"]});var Zv={get paint(){return ag=ag||new Ur({"fill-antialias":new ie(_t.paint_fill["fill-antialias"]),"fill-opacity":new he(_t.paint_fill["fill-opacity"]),"fill-color":new he(_t.paint_fill["fill-color"]),"fill-outline-color":new he(_t.paint_fill["fill-outline-color"]),"fill-translate":new ie(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new ie(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new El(_t.paint_fill["fill-pattern"])})},get layout(){return sg=sg||new Ur({"fill-sort-key":new he(_t.layout_fill["fill-sort-key"])})}};class Xv extends Ni{constructor(t){super(t,Zv)}recalculate(t,n){super.recalculate(t,n);let a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Dd(t)}queryRadius(){return dp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v){return jm(fp(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}let Hv=Pr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Yv=Pr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Wv}=Hv;var Aa={},Jv=et,lg=Du;function Du(r,t,n,a,h){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=h,r.readFields(Kv,this,t)}function Kv(r,t,n){r==1?t.id=n.readVarint():r==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function Qv(r){for(var t,n,a=0,h=0,g=r.length,y=g-1;h<g;y=h++)a+=((n=r[y]).x-(t=r[h]).x)*(t.y+n.y);return a}Du.types=["Unknown","Point","LineString","Polygon"],Du.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,a=1,h=0,g=0,y=0,v=[];r.pos<n;){if(h<=0){var S=r.readVarint();a=7&S,h=S>>3}if(h--,a===1||a===2)g+=r.readSVarint(),y+=r.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new Jv(g,y));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Du.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,a=0,h=0,g=0,y=1/0,v=-1/0,S=1/0,T=-1/0;r.pos<t;){if(a<=0){var P=r.readVarint();n=7&P,a=P>>3}if(a--,n===1||n===2)(h+=r.readSVarint())<y&&(y=h),h>v&&(v=h),(g+=r.readSVarint())<S&&(S=g),g>T&&(T=g);else if(n!==7)throw new Error("unknown command "+n)}return[y,S,v,T]},Du.prototype.toGeoJSON=function(r,t,n){var a,h,g=this.extent*Math.pow(2,n),y=this.extent*r,v=this.extent*t,S=this.loadGeometry(),T=Du.types[this.type];function P(N){for(var B=0;B<N.length;B++){var q=N[B];N[B]=[360*(q.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<S.length;a++)M[a]=S[a][0];P(S=M);break;case 2:for(a=0;a<S.length;a++)P(S[a]);break;case 3:for(S=function(N){var B=N.length;if(B<=1)return[N];for(var q,W,Q=[],ut=0;ut<B;ut++){var rt=Qv(N[ut]);rt!==0&&(W===void 0&&(W=rt<0),W===rt<0?(q&&Q.push(q),q=[N[ut]]):q.push(N[ut]))}return q&&Q.push(q),Q}(S),a=0;a<S.length;a++)for(h=0;h<S[a].length;h++)P(S[a][h])}S.length===1?S=S[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:S},properties:this.properties};return"id"in this&&(z.id=this.id),z};var tx=lg,ug=cg;function cg(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(ex,this,t),this.length=this._features.length}function ex(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(n))}cg.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new tx(this._pbf,t,this.extent,this._keys,this._values)};var rx=ug;function nx(r,t,n){if(r===3){var a=new rx(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}Aa.VectorTile=function(r,t){this.layers=r.readFields(nx,{},t)},Aa.VectorTileFeature=lg,Aa.VectorTileLayer=ug;let ix=Aa.VectorTileFeature.types,kd=Math.pow(2,13);function Qc(r,t,n,a,h,g,y,v){r.emplaceBack(t,n,2*Math.floor(a*kd)+y,h*kd*2,g*kd*2,Math.round(v))}class zd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ut,this.centroidVertexArray=new zt,this.indexArray=new yn,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.features=[],this.hasPattern=Ld("fill-extrusion",this.layers,n);for(let{feature:h,id:g,index:y,sourceLayerIndex:v}of t){let S=this.layers[0]._featureFilter.needGeometry,T=Pl(h,S);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),T,a))continue;let P={id:g,sourceLayerIndex:v,index:y,geometry:S?T.geometry:Cl(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Md("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,y,a,{}),n.featureIndex.insert(h,P.geometry,y,v,this.index,!0)}}addFeatures(t,n,a){for(let h of this.features){let{geometry:g}=h;this.addFeature(h,g,h.index,n,a)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wv),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Yv.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,a,h,g){let y={x:0,y:0,vertexCount:0};for(let v of Ad(n,500)){let S=0;for(let B of v)S+=B.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let B of v){if(B.length===0||sx(B))continue;let q=0;for(let W=0;W<B.length;W++){let Q=B[W];if(W>=1){let ut=B[W-1];if(!ox(Q,ut)){T.vertexLength+4>_r.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let rt=Q.sub(ut)._perp()._unit(),pt=ut.dist(Q);q+pt>32768&&(q=0),Qc(this.layoutVertexArray,Q.x,Q.y,rt.x,rt.y,0,0,q),Qc(this.layoutVertexArray,Q.x,Q.y,rt.x,rt.y,0,1,q),y.x+=2*Q.x,y.y+=2*Q.y,y.vertexCount+=2,q+=pt,Qc(this.layoutVertexArray,ut.x,ut.y,rt.x,rt.y,0,0,q),Qc(this.layoutVertexArray,ut.x,ut.y,rt.x,rt.y,0,1,q),y.x+=2*ut.x,y.y+=2*ut.y,y.vertexCount+=2;let ft=T.vertexLength;this.indexArray.emplaceBack(ft,ft+2,ft+1),this.indexArray.emplaceBack(ft+1,ft+2,ft+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+S>_r.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),ix[t.type]!=="Polygon")continue;let P=[],M=[],z=T.vertexLength;for(let B of v)if(B.length!==0){B!==v[0]&&M.push(P.length/2);for(let q=0;q<B.length;q++){let W=B[q];Qc(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),y.x+=W.x,y.y+=W.y,y.vertexCount+=1,P.push(W.x),P.push(W.y)}}let N=ig(P,M);for(let B=0;B<N.length;B+=3)this.indexArray.emplaceBack(z+N[B],z+N[B+2],z+N[B+1]);T.primitiveLength+=N.length/3,T.vertexLength+=S}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function ox(r,t){return r.x===t.x&&(r.x<0||r.x>Xr)||r.y===t.y&&(r.y<0||r.y>Xr)}function sx(r){return r.every(t=>t.x<0)||r.every(t=>t.x>Xr)||r.every(t=>t.y<0)||r.every(t=>t.y>Xr)}let hg;Ht("FillExtrusionBucket",zd,{omit:["layers","features"]});var ax={get paint(){return hg=hg||new Ur({"fill-extrusion-opacity":new ie(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new he(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ie(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ie(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new El(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new he(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new he(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ie(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lx extends Ni{constructor(t){super(t,ax)}createBucket(t){return new zd(t)}queryRadius(){return dp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,a,h,g,y,v,S){let T=fp(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),P=this.paint.get("fill-extrusion-height").evaluate(n,a),M=this.paint.get("fill-extrusion-base").evaluate(n,a),z=function(B,q,W,Q){let ut=[];for(let rt of B){let pt=[rt.x,rt.y,0,1];mp(pt,pt,q),ut.push(new st(pt[0]/pt[3],pt[1]/pt[3]))}return ut}(T,S),N=function(B,q,W,Q){let ut=[],rt=[],pt=Q[8]*q,ft=Q[9]*q,Et=Q[10]*q,Zt=Q[11]*q,ee=Q[8]*W,$t=Q[9]*W,jt=Q[10]*W,Ft=Q[11]*W;for(let Yt of B){let Bt=[],Dt=[];for(let ue of Yt){let ne=ue.x,Me=ue.y,vr=Q[0]*ne+Q[4]*Me+Q[12],Sr=Q[1]*ne+Q[5]*Me+Q[13],rn=Q[2]*ne+Q[6]*Me+Q[14],Vi=Q[3]*ne+Q[7]*Me+Q[15],ai=rn+Et,Hr=Vi+Zt,vn=vr+ee,Pn=Sr+$t,li=rn+jt,ui=Vi+Ft,nn=new st((vr+pt)/Hr,(Sr+ft)/Hr);nn.z=ai/Hr,Bt.push(nn);let on=new st(vn/ui,Pn/ui);on.z=li/ui,Dt.push(on)}ut.push(Bt),rt.push(Dt)}return[ut,rt]}(h,M,P,S);return function(B,q,W){let Q=1/0;jm(W,q)&&(Q=pg(W,q[0]));for(let ut=0;ut<q.length;ut++){let rt=q[ut],pt=B[ut];for(let ft=0;ft<rt.length-1;ft++){let Et=rt[ft],Zt=[Et,rt[ft+1],pt[ft+1],pt[ft],Et];Um(W,Zt)&&(Q=Math.min(Q,pg(W,Zt)))}}return Q!==1/0&&Q}(N[0],N[1],z)}}function th(r,t){return r.x*t.x+r.y*t.y}function pg(r,t){if(r.length===1){let n=0,a=t[n++],h;for(;!h||a.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){let g=t[n],y=r[0],v=h.sub(a),S=g.sub(a),T=y.sub(a),P=th(v,v),M=th(v,S),z=th(S,S),N=th(T,v),B=th(T,S),q=P*z-M*M,W=(z*N-M*B)/q,Q=(P*B-M*N)/q,ut=a.z*(1-W-Q)+h.z*W+g.z*Q;if(isFinite(ut))return ut}return 1/0}{let n=1/0;for(let a of t)n=Math.min(n,a.z);return n}}let ux=Pr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:cx}=ux,hx=Pr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:px}=hx,dx=Aa.VectorTileFeature.types,fx=Math.cos(Math.PI/180*37.5),dg=Math.pow(2,14)/.5;class Rd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new pe,this.layoutVertexArray2=new re,this.indexArray=new yn,this.programConfigurations=new jo(t.layers,t.zoom),this.segments=new _r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=Ld("line",this.layers,n);let h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),y=[];for(let{feature:v,id:S,index:T,sourceLayerIndex:P}of t){let M=this.layers[0]._featureFilter.needGeometry,z=Pl(v,M);if(!this.layers[0]._featureFilter.filter(new yr(this.zoom),z,a))continue;let N=g?h.evaluate(z,{},a):void 0,B={id:S,properties:v.properties,type:v.type,sourceLayerIndex:P,index:T,geometry:M?z.geometry:Cl(v),patterns:{},sortKey:N};y.push(B)}g&&y.sort((v,S)=>v.sortKey-S.sortKey);for(let v of y){let{geometry:S,index:T,sourceLayerIndex:P}=v;if(this.hasPattern){let M=Md("line",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,S,T,a,{});n.featureIndex.insert(t[T].feature,S,T,P,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(let h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,px)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cx),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,h,g){let y=this.layers[0].layout,v=y.get("line-join").evaluate(t,{}),S=y.get("line-cap"),T=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(let M of n)this.addLine(M,t,v,S,T,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,n,a,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<t.length-1;Q++)this.totalDistance+=t[Q].dist(t[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let v=dx[n.type]==="Polygon",S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let T=0;for(;T<S-1&&t[T].equals(t[T+1]);)T++;if(S<(v?3:2))return;a==="bevel"&&(g=1.05);let P=this.overscaling<=16?15*Xr/(512*this.overscaling):0,M=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray),z,N,B,q,W;this.e1=this.e2=-1,v&&(z=t[S-2],W=t[T].sub(z)._unit()._perp());for(let Q=T;Q<S;Q++){if(B=Q===S-1?v?t[T+1]:void 0:t[Q+1],B&&t[Q].equals(B))continue;W&&(q=W),z&&(N=z),z=t[Q],W=B?B.sub(z)._unit()._perp():q,q=q||W;let ut=q.add(W);ut.x===0&&ut.y===0||ut._unit();let rt=q.x*W.x+q.y*W.y,pt=ut.x*W.x+ut.y*W.y,ft=pt!==0?1/pt:1/0,Et=2*Math.sqrt(2-2*pt),Zt=pt<fx&&N&&B,ee=q.x*W.y-q.y*W.x>0;if(Zt&&Q>T){let Ft=z.dist(N);if(Ft>2*P){let Yt=z.sub(z.sub(N)._mult(P/Ft)._round());this.updateDistance(N,Yt),this.addCurrentVertex(Yt,q,0,0,M),N=Yt}}let $t=N&&B,jt=$t?a:v?"butt":h;if($t&&jt==="round"&&(ft<y?jt="miter":ft<=2&&(jt="fakeround")),jt==="miter"&&ft>g&&(jt="bevel"),jt==="bevel"&&(ft>2&&(jt="flipbevel"),ft<g&&(jt="miter")),N&&this.updateDistance(N,z),jt==="miter")ut._mult(ft),this.addCurrentVertex(z,ut,0,0,M);else if(jt==="flipbevel"){if(ft>100)ut=W.mult(-1);else{let Ft=ft*q.add(W).mag()/q.sub(W).mag();ut._perp()._mult(Ft*(ee?-1:1))}this.addCurrentVertex(z,ut,0,0,M),this.addCurrentVertex(z,ut.mult(-1),0,0,M)}else if(jt==="bevel"||jt==="fakeround"){let Ft=-Math.sqrt(ft*ft-1),Yt=ee?Ft:0,Bt=ee?0:Ft;if(N&&this.addCurrentVertex(z,q,Yt,Bt,M),jt==="fakeround"){let Dt=Math.round(180*Et/Math.PI/20);for(let ue=1;ue<Dt;ue++){let ne=ue/Dt;if(ne!==.5){let vr=ne-.5;ne+=ne*vr*(ne-1)*((1.0904+rt*(rt*(3.55645-1.43519*rt)-3.2452))*vr*vr+(.848013+rt*(.215638*rt-1.06021)))}let Me=W.sub(q)._mult(ne)._add(q)._unit()._mult(ee?-1:1);this.addHalfVertex(z,Me.x,Me.y,!1,ee,0,M)}}B&&this.addCurrentVertex(z,W,-Yt,-Bt,M)}else if(jt==="butt")this.addCurrentVertex(z,ut,0,0,M);else if(jt==="square"){let Ft=N?1:-1;this.addCurrentVertex(z,ut,Ft,Ft,M)}else jt==="round"&&(N&&(this.addCurrentVertex(z,q,0,0,M),this.addCurrentVertex(z,q,1,1,M,!0)),B&&(this.addCurrentVertex(z,W,-1,-1,M,!0),this.addCurrentVertex(z,W,0,0,M)));if(Zt&&Q<S-1){let Ft=z.dist(B);if(Ft>2*P){let Yt=z.add(B.sub(z)._mult(P/Ft)._round());this.updateDistance(z,Yt),this.addCurrentVertex(Yt,W,0,0,M),z=Yt}}}}addCurrentVertex(t,n,a,h,g,y=!1){let v=n.y*h-n.x,S=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,y,!1,a,g),this.addHalfVertex(t,v,S,y,!0,-h,g),this.distance>dg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,a,h,g,y))}addHalfVertex({x:t,y:n},a,h,g,y,v,S){let T=.5*(this.lineClips?this.scaledDistance*(dg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let P=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),S.primitiveLength++),y?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let fg,mg;Ht("LineBucket",Rd,{omit:["layers","patternFeatures"]});var gg={get paint(){return mg=mg||new Ur({"line-opacity":new he(_t.paint_line["line-opacity"]),"line-color":new he(_t.paint_line["line-color"]),"line-translate":new ie(_t.paint_line["line-translate"]),"line-translate-anchor":new ie(_t.paint_line["line-translate-anchor"]),"line-width":new he(_t.paint_line["line-width"]),"line-gap-width":new he(_t.paint_line["line-gap-width"]),"line-offset":new he(_t.paint_line["line-offset"]),"line-blur":new he(_t.paint_line["line-blur"]),"line-dasharray":new Fc(_t.paint_line["line-dasharray"]),"line-pattern":new El(_t.paint_line["line-pattern"]),"line-gradient":new Nc(_t.paint_line["line-gradient"])})},get layout(){return fg=fg||new Ur({"line-cap":new ie(_t.layout_line["line-cap"]),"line-join":new he(_t.layout_line["line-join"]),"line-miter-limit":new ie(_t.layout_line["line-miter-limit"]),"line-round-limit":new ie(_t.layout_line["line-round-limit"]),"line-sort-key":new he(_t.layout_line["line-sort-key"])})}};class mx extends he{possiblyEvaluate(t,n){return n=new yr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,a,h){return n=Le({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,a,h)}}let xp;class gx extends Ni{constructor(t){super(t,gg),this.gradientVersion=0,xp||(xp=new mx(gg.paint.properties["line-width"].specification),xp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=xp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Rd(t)}queryRadius(t){let n=t,a=yg(Zc("line-width",this,n),Zc("line-gap-width",this,n)),h=Zc("line-offset",this,n);return a/2+Math.abs(h)+dp(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,a,h,g,y,v){let S=fp(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),T=v/2*yg(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),P=this.paint.get("line-offset").evaluate(n,a);return P&&(h=function(M,z){let N=[];for(let B=0;B<M.length;B++){let q=M[B],W=[];for(let Q=0;Q<q.length;Q++){let ut=q[Q-1],rt=q[Q],pt=q[Q+1],ft=Q===0?new st(0,0):rt.sub(ut)._unit()._perp(),Et=Q===q.length-1?new st(0,0):pt.sub(rt)._unit()._perp(),Zt=ft._add(Et)._unit(),ee=Zt.x*Et.x+Zt.y*Et.y;ee!==0&&Zt._mult(1/ee),W.push(Zt._mult(z)._add(rt))}N.push(W)}return N}(h,P*v)),function(M,z,N){for(let B=0;B<z.length;B++){let q=z[B];if(M.length>=3){for(let W=0;W<q.length;W++)if(Au(M,q[W]))return!0}if(wv(M,q,N))return!0}return!1}(S,h,T)}isTileClipped(){return!0}}function yg(r,t){return t>0?t+2*r:r}let yx=Pr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_x=Pr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let vx=Pr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Pr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let _g=Pr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xx=Pr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bx(r,t,n){return r.sections.forEach(a=>{a.text=function(h,g,y){let v=g.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),_i.applyArabicShaping&&(h=_i.applyArabicShaping(h)),h}(a.text,t,n)}),r}Pr([{name:"triangle",components:3,type:"Uint16"}]),Pr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Pr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Pr([{type:"Float32",name:"offsetX"}]),Pr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Pr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let eh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var en=24,vg=cr,xg=function(r,t,n,a,h){var g,y,v=8*h-a-1,S=(1<<v)-1,T=S>>1,P=-7,M=n?h-1:0,z=n?-1:1,N=r[t+M];for(M+=z,g=N&(1<<-P)-1,N>>=-P,P+=v;P>0;g=256*g+r[t+M],M+=z,P-=8);for(y=g&(1<<-P)-1,g>>=-P,P+=a;P>0;y=256*y+r[t+M],M+=z,P-=8);if(g===0)g=1-T;else{if(g===S)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,a),g-=T}return(N?-1:1)*y*Math.pow(2,g-a)},bg=function(r,t,n,a,h,g){var y,v,S,T=8*g-h-1,P=(1<<T)-1,M=P>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=a?0:g-1,B=a?1:-1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,y=P):(y=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-y))<1&&(y--,S*=2),(t+=y+M>=1?z/S:z*Math.pow(2,1-M))*S>=2&&(y++,S/=2),y+M>=P?(v=0,y=P):y+M>=1?(v=(t*S-1)*Math.pow(2,h),y+=M):(v=t*Math.pow(2,M-1)*Math.pow(2,h),y=0));h>=8;r[n+N]=255&v,N+=B,v/=256,h-=8);for(y=y<<h|v,T+=h;T>0;r[n+N]=255&y,N+=B,y/=256,T-=8);r[n+N-B]|=128*q};function cr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}cr.Varint=0,cr.Fixed64=1,cr.Bytes=2,cr.Fixed32=5;var Od=4294967296,wg=1/Od,Sg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ys(r){return r.type===cr.Bytes?r.readVarint()+r.pos:r.pos+1}function wx(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Eg(r,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var h=n.pos-1;h>=r;h--)n.buf[h+a]=n.buf[h]}function Sx(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function Ex(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function Tx(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function Ix(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function Cx(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function Px(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function Ax(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function Lx(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function Mx(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function bp(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function ku(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function Tg(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}cr.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,r(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=bp(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Tg(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=bp(this.buf,this.pos)+bp(this.buf,this.pos+4)*Od;return this.pos+=8,r},readSFixed64:function(){var r=bp(this.buf,this.pos)+Tg(this.buf,this.pos+4)*Od;return this.pos+=8,r},readFloat:function(){var r=xg(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=xg(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(h,g,y){var v,S,T=y.buf;if(v=(112&(S=T[y.pos++]))>>4,S<128||(v|=(127&(S=T[y.pos++]))<<3,S<128)||(v|=(127&(S=T[y.pos++]))<<10,S<128)||(v|=(127&(S=T[y.pos++]))<<17,S<128)||(v|=(127&(S=T[y.pos++]))<<24,S<128)||(v|=(1&(S=T[y.pos++]))<<31,S<128))return wx(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&Sg?function(n,a,h){return Sg.decode(n.subarray(a,h))}(this.buf,t,r):function(n,a,h){for(var g="",y=a;y<h;){var v,S,T,P=n[y],M=null,z=P>239?4:P>223?3:P>191?2:1;if(y+z>h)break;z===1?P<128&&(M=P):z===2?(192&(v=n[y+1]))==128&&(M=(31&P)<<6|63&v)<=127&&(M=null):z===3?(S=n[y+2],(192&(v=n[y+1]))==128&&(192&S)==128&&((M=(15&P)<<12|(63&v)<<6|63&S)<=2047||M>=55296&&M<=57343)&&(M=null)):z===4&&(S=n[y+2],T=n[y+3],(192&(v=n[y+1]))==128&&(192&S)==128&&(192&T)==128&&((M=(15&P)<<18|(63&v)<<12|(63&S)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,z=1):M>65535&&(M-=65536,g+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),g+=String.fromCharCode(M),y+=z}return g}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==cr.Bytes)return r.push(this.readVarint(t));var n=Ys(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==cr.Bytes)return r.push(this.readSVarint());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==cr.Bytes)return r.push(this.readBoolean());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==cr.Bytes)return r.push(this.readFloat());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==cr.Bytes)return r.push(this.readDouble());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed32());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed32());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readFixed64());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==cr.Bytes)return r.push(this.readSFixed64());var t=Ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===cr.Varint)for(;this.buf[this.pos++]>127;);else if(t===cr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===cr.Fixed32)this.pos+=4;else{if(t!==cr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),ku(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),ku(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),ku(this.buf,-1&r,this.pos),ku(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),ku(this.buf,-1&r,this.pos),ku(this.buf,Math.floor(r*wg),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(g,y,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,n),function(g,y){var v=(7&g)<<4;y.buf[y.pos++]|=v|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var y,v,S=0;S<h.length;S++){if((y=h.charCodeAt(S))>55295&&y<57344){if(!v){y>56319||S+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=y;continue}if(y<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);y<128?a[g++]=y:(y<2048?a[g++]=y>>6|192:(y<65536?a[g++]=y>>12|224:(a[g++]=y>>18|240,a[g++]=y>>12&63|128),a[g++]=y>>6&63|128),a[g++]=63&y|128)}return g}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Eg(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),bg(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),bg(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var a=this.pos-n;a>=128&&Eg(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,n){this.writeTag(r,cr.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,Sx,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,Ex,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,Cx,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Tx,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,Ix,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Px,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Ax,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Lx,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Mx,t)},writeBytesField:function(r,t){this.writeTag(r,cr.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,cr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,cr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,cr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,cr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,cr.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,cr.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,cr.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,cr.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,cr.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var Fd=R(vg);let Nd=3;function Dx(r,t,n){r===1&&n.readMessage(kx,t)}function kx(r,t,n){if(r===3){let{id:a,bitmap:h,width:g,height:y,left:v,top:S,advance:T}=n.readMessage(zx,{});t.push({id:a,bitmap:new Hc({width:g+2*Nd,height:y+2*Nd},h),metrics:{width:g,height:y,left:v,top:S,advance:T}})}}function zx(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}let Ig=Nd;function Cg(r){let t=0,n=0;for(let y of r)t+=y.w*y.h,n=Math.max(n,y.w);r.sort((y,v)=>v.h-y.h);let a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}],h=0,g=0;for(let y of r)for(let v=a.length-1;v>=0;v--){let S=a[v];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===S.w&&y.h===S.h){let T=a.pop();v<a.length&&(a[v]=T)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}let xi=1;class Bd{constructor(t,{pixelRatio:n,version:a,stretchX:h,stretchY:g,content:y}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+xi,this.paddedRect.y+xi]}get br(){return[this.paddedRect.x+this.paddedRect.w-xi,this.paddedRect.y+this.paddedRect.h-xi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*xi)/this.pixelRatio,(this.paddedRect.h-2*xi)/this.pixelRatio]}}class Pg{constructor(t,n){let a={},h={};this.haveRenderCallbacks=[];let g=[];this.addImages(t,a,g),this.addImages(n,h,g);let{w:y,h:v}=Cg(g),S=new Ji({width:y||1,height:v||1});for(let T in t){let P=t[T],M=a[T].paddedRect;Ji.copy(P.data,S,{x:0,y:0},{x:M.x+xi,y:M.y+xi},P.data)}for(let T in n){let P=n[T],M=h[T].paddedRect,z=M.x+xi,N=M.y+xi,B=P.data.width,q=P.data.height;Ji.copy(P.data,S,{x:0,y:0},{x:z,y:N},P.data),Ji.copy(P.data,S,{x:0,y:q-1},{x:z,y:N-1},{width:B,height:1}),Ji.copy(P.data,S,{x:0,y:0},{x:z,y:N+q},{width:B,height:1}),Ji.copy(P.data,S,{x:B-1,y:0},{x:z-1,y:N},{width:1,height:q}),Ji.copy(P.data,S,{x:0,y:0},{x:z+B,y:N},{width:1,height:q})}this.image=S,this.iconPositions=a,this.patternPositions=h}addImages(t,n,a){for(let h in t){let g=t[h],y={x:0,y:0,w:g.data.width+2*xi,h:g.data.height+2*xi};a.push(y),n[h]=new Bd(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;let[h,g]=t.tl;a.update(n.data,void 0,{x:h,y:g})}}var La;Ht("ImagePosition",Bd),Ht("ImageAtlas",Pg),l.ai=void 0,(La=l.ai||(l.ai={}))[La.none=0]="none",La[La.horizontal=1]="horizontal",La[La.vertical=2]="vertical",La[La.horizontalOnly=3]="horizontalOnly";let rh=-17;class nh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){let a=new nh;return a.scale=t||1,a.fontStack=n,a}static forImage(t){let n=new nh;return n.imageName=t,n}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){let a=new zu;for(let h=0;h<t.sections.length;h++){let g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let a=0;a<t.length;a++){let h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;n+=h&&tu(h)&&!eh[t[a+1]]||g&&tu(g)&&!eh[t[a-1]]||!eh[t[a]]?t[a]:eh[t[a]]}return n}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&Sp[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&Sp[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){let a=new zu;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(nh.forText(t.scale,t.fontStack||n));let a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){let n=t.image?t.image.name:"";if(n.length===0)return void de("Can't add FormattedSection with an empty image.");let a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(nh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):de("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wp(r,t,n,a,h,g,y,v,S,T,P,M,z,N,B,q){let W=zu.fromFeature(r,h),Q;M===l.ai.vertical&&W.verticalizePunctuation();let{processBidirectionalText:ut,processStyledBidirectionalText:rt}=_i;if(ut&&W.sections.length===1){Q=[];let Et=ut(W.toString(),Vd(W,T,g,t,a,N,B));for(let Zt of Et){let ee=new zu;ee.text=Zt,ee.sections=W.sections;for(let $t=0;$t<Zt.length;$t++)ee.sectionIndex.push(0);Q.push(ee)}}else if(rt){Q=[];let Et=rt(W.text,W.sectionIndex,Vd(W,T,g,t,a,N,B));for(let Zt of Et){let ee=new zu;ee.text=Zt[0],ee.sectionIndex=Zt[1],ee.sections=W.sections,Q.push(ee)}}else Q=function(Et,Zt){let ee=[],$t=Et.text,jt=0;for(let Ft of Zt)ee.push(Et.substring(jt,Ft)),jt=Ft;return jt<$t.length&&ee.push(Et.substring(jt,$t.length)),ee}(W,Vd(W,T,g,t,a,N,B));let pt=[],ft={positionedLines:pt,text:W.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(Et,Zt,ee,$t,jt,Ft,Yt,Bt,Dt,ue,ne,Me){let vr=0,Sr=rh,rn=0,Vi=0,ai=Bt==="right"?1:Bt==="left"?0:.5,Hr=0;for(let nn of jt){nn.trim();let on=nn.getMaxScale(),Xn=(on-1)*en,ci={positionedGlyphs:[],lineOffset:0};Et.positionedLines[Hr]=ci;let Hn=ci.positionedGlyphs,bi=0;if(!nn.length()){Sr+=Ft,++Hr;continue}for(let sn=0;sn<nn.length();sn++){let Ve=nn.getSection(sn),Yn=nn.getSectionIndex(sn),An=nn.getCharCode(sn),an=0,Eo=null,Go=null,qo=null,Ws=en,To=!(Dt===l.ai.horizontal||!ne&&!Wa(An)||ne&&(Sp[An]||(vn=An,Gt.Arabic(vn)||Gt["Arabic Supplement"](vn)||Gt["Arabic Extended-A"](vn)||Gt["Arabic Presentation Forms-A"](vn)||Gt["Arabic Presentation Forms-B"](vn))));if(Ve.imageName){let Qi=$t[Ve.imageName];if(!Qi)continue;qo=Ve.imageName,Et.iconsInText=Et.iconsInText||!0,Go=Qi.paddedRect;let Si=Qi.displaySize;Ve.scale=Ve.scale*en/Me,Eo={width:Si[0],height:Si[1],left:xi,top:-Ig,advance:To?Si[1]:Si[0]},an=Xn+(en-Si[1]*Ve.scale),Ws=Eo.advance;let Js=To?Si[0]*Ve.scale-en*on:Si[1]*Ve.scale-en*on;Js>0&&Js>bi&&(bi=Js)}else{let Qi=ee[Ve.fontStack],Si=Qi&&Qi[An];if(Si&&Si.rect)Go=Si.rect,Eo=Si.metrics;else{let Js=Zt[Ve.fontStack],lh=Js&&Js[An];if(!lh)continue;Eo=lh.metrics}an=(on-Ve.scale)*en}To?(Et.verticalizable=!0,Hn.push({glyph:An,imageName:qo,x:vr,y:Sr+an,vertical:To,scale:Ve.scale,fontStack:Ve.fontStack,sectionIndex:Yn,metrics:Eo,rect:Go}),vr+=Ws*Ve.scale+ue):(Hn.push({glyph:An,imageName:qo,x:vr,y:Sr+an,vertical:To,scale:Ve.scale,fontStack:Ve.fontStack,sectionIndex:Yn,metrics:Eo,rect:Go}),vr+=Eo.advance*Ve.scale+ue)}Hn.length!==0&&(rn=Math.max(vr-ue,rn),Fx(Hn,0,Hn.length-1,ai,bi)),vr=0;let wi=Ft*on+bi;ci.lineOffset=Math.max(bi,Xn),Sr+=wi,Vi=Math.max(wi,Vi),++Hr}var vn;let Pn=Sr-rh,{horizontalAlign:li,verticalAlign:ui}=Ud(Yt);(function(nn,on,Xn,ci,Hn,bi,wi,sn,Ve){let Yn=(on-Xn)*Hn,An=0;An=bi!==wi?-sn*ci-rh:(-ci*Ve+.5)*wi;for(let an of nn)for(let Eo of an.positionedGlyphs)Eo.x+=Yn,Eo.y+=An})(Et.positionedLines,ai,li,ui,rn,Vi,Ft,Pn,jt.length),Et.top+=-ui*Pn,Et.bottom=Et.top+Pn,Et.left+=-li*rn,Et.right=Et.left+rn}(ft,t,n,a,Q,y,v,S,M,T,z,q),!function(Et){for(let Zt of Et)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(pt)&&ft}let Sp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ag(r,t,n,a,h,g){if(t.imageName){let y=a[t.imageName];return y?y.displaySize[0]*t.scale*en/g+h:0}{let y=n[t.fontStack],v=y&&y[r];return v?v.metrics.advance*t.scale+h:0}}function Lg(r,t,n,a){let h=Math.pow(r-t,2);return a?r<t?h/2:2*h:h+Math.abs(n)*n}function Ox(r,t,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function Mg(r,t,n,a,h,g){let y=null,v=Lg(t,n,h,g);for(let S of a){let T=Lg(t-S.x,n,h,g)+S.badness;T<=v&&(y=S,v=T)}return{index:r,x:t,priorBreak:y,badness:v}}function Dg(r){return r?Dg(r.priorBreak).concat(r.index):[]}function Vd(r,t,n,a,h,g,y){if(g!=="point")return[];if(!r)return[];let v=[],S=function(z,N,B,q,W,Q){let ut=0;for(let rt=0;rt<z.length();rt++){let pt=z.getSection(rt);ut+=Ag(z.getCharCode(rt),pt,q,W,N,Q)}return ut/Math.max(1,Math.ceil(ut/B))}(r,t,n,a,h,y),T=r.text.indexOf("\u200B")>=0,P=0;for(let z=0;z<r.length();z++){let N=r.getSection(z),B=r.getCharCode(z);if(Sp[B]||(P+=Ag(B,N,a,h,t,y)),z<r.length()-1){let q=!((M=B)<11904||!(Gt["Bopomofo Extended"](M)||Gt.Bopomofo(M)||Gt["CJK Compatibility Forms"](M)||Gt["CJK Compatibility Ideographs"](M)||Gt["CJK Compatibility"](M)||Gt["CJK Radicals Supplement"](M)||Gt["CJK Strokes"](M)||Gt["CJK Symbols and Punctuation"](M)||Gt["CJK Unified Ideographs Extension A"](M)||Gt["CJK Unified Ideographs"](M)||Gt["Enclosed CJK Letters and Months"](M)||Gt["Halfwidth and Fullwidth Forms"](M)||Gt.Hiragana(M)||Gt["Ideographic Description Characters"](M)||Gt["Kangxi Radicals"](M)||Gt["Katakana Phonetic Extensions"](M)||Gt.Katakana(M)||Gt["Vertical Forms"](M)||Gt["Yi Radicals"](M)||Gt["Yi Syllables"](M)));(Rx[B]||q||N.imageName)&&v.push(Mg(z+1,P,S,v,Ox(B,r.getCharCode(z+1),q&&T),!1))}}var M;return Dg(Mg(r.length(),P,S,v,0,!0))}function Ud(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Fx(r,t,n,a,h){if(!a&&!h)return;let g=r[n],y=(r[n].x+g.metrics.advance*g.scale)*a;for(let v=t;v<=n;v++)r[v].x-=y,r[v].y+=h}function Nx(r,t,n){let{horizontalAlign:a,verticalAlign:h}=Ud(n),g=t[0]-r.displaySize[0]*a,y=t[1]-r.displaySize[1]*h;return{image:r,top:y,bottom:y+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function kg(r,t,n,a,h,g){let y=r.image,v;if(y.content){let W=y.content,Q=y.pixelRatio||1;v=[W[0]/Q,W[1]/Q,y.displaySize[0]-W[2]/Q,y.displaySize[1]-W[3]/Q]}let S=t.left*g,T=t.right*g,P,M,z,N;n==="width"||n==="both"?(N=h[0]+S-a[3],M=h[0]+T+a[1]):(N=h[0]+(S+T-y.displaySize[0])/2,M=N+y.displaySize[0]);let B=t.top*g,q=t.bottom*g;return n==="height"||n==="both"?(P=h[1]+B-a[0],z=h[1]+q+a[2]):(P=h[1]+(B+q-y.displaySize[1])/2,z=P+y.displaySize[1]),{image:y,top:P,right:M,bottom:z,left:N,collisionPadding:v}}let ih=255,ys=128,Ma=ih*ys;function zg(r,t){let{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new yr(r+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:a,interpolationType:h}=n,g=0;for(;g<a.length&&a[g]<=r;)g++;g=Math.max(0,g-1);let y=g;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);let v=a[g],S=a[y];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:S,minSize:n.evaluate(new yr(v)),maxSize:n.evaluate(new yr(S)),interpolationType:h}}}function jd(r,t,n){let a="never",h=r.get(t);return h?a=h:r.get(n)&&(a="always"),a}let Bx=Aa.VectorTileFeature.types,Vx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ep(r,t,n,a,h,g,y,v,S,T,P,M,z){let N=v?Math.min(Ma,Math.round(v[0])):0,B=v?Math.min(Ma,Math.round(v[1])):0;r.emplaceBack(t,n,Math.round(32*a),Math.round(32*h),g,y,(N<<1)+(S?1:0),B,16*T,16*P,256*M,256*z)}function Gd(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Ux(r){for(let t of r.sections)if(ic(t.text))return!0;return!1}class qd{constructor(t){this.layoutVertexArray=new De,this.indexArray=new yn,this.programConfigurations=t,this.segments=new _r,this.dynamicLayoutVertexArray=new Te,this.opacityVertexArray=new Re,this.hasVisibleVertices=!1,this.placedSymbolArray=new ot}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,yx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_x.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Vx,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",qd);class $d{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new _r,this.collisionVertexArray=new pr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,vx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",$d);class Ru{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(y=>y.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wd([]),this.placementViewportMatrix=wd([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zg(this.zoom,n["text-size"]),this.iconSizeData=zg(this.zoom,n["icon-size"]);let a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=jd(a,"text-overlap","text-allow-overlap")!=="never"||jd(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>l.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=t.sourceID}createArrays(){this.text=new qd(new jo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new qd(new jo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new lt,this.lineVertexArray=new mt,this.symbolInstances=new K,this.textAnchorOffsets=new St}calculateGlyphDependencies(t,n,a,h,g){for(let y=0;y<t.length;y++)if(n[t.charCodeAt(y)]=!0,(a||h)&&g){let v=eh[t.charAt(y)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,a){let h=this.layers[0],g=h.layout,y=g.get("text-font"),v=g.get("text-field"),S=g.get("icon-image"),T=(v.value.kind!=="constant"||v.value.value instanceof Br&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),P=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,M=g.get("symbol-sort-key");if(this.features=[],!T&&!P)return;let z=n.iconDependencies,N=n.glyphDependencies,B=n.availableImages,q=new yr(this.zoom);for(let{feature:W,id:Q,index:ut,sourceLayerIndex:rt}of t){let pt=h._featureFilter.needGeometry,ft=Pl(W,pt);if(!h._featureFilter.filter(q,ft,a))continue;let Et,Zt;if(pt||(ft.geometry=Cl(W)),T){let $t=h.getValueAndResolveTokens("text-field",ft,a,B),jt=Br.factory($t);Ux(jt)&&(this.hasRTLText=!0),(!this.hasRTLText||Rc()==="unavailable"||this.hasRTLText&&_i.isParsed())&&(Et=bx(jt,h,ft))}if(P){let $t=h.getValueAndResolveTokens("icon-image",ft,a,B);Zt=$t instanceof un?$t:un.fromString($t)}if(!Et&&!Zt)continue;let ee=this.sortFeaturesByKey?M.evaluate(ft,{},a):void 0;if(this.features.push({id:Q,text:Et,icon:Zt,index:ut,sourceLayerIndex:rt,geometry:ft.geometry,properties:W.properties,type:Bx[W.type],sortKey:ee}),Zt&&(z[Zt.name]=!0),Et){let $t=y.evaluate(ft,{},a).join(","),jt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ai.vertical)>=0;for(let Ft of Et.sections)if(Ft.image)z[Ft.image.name]=!0;else{let Yt=Ql(Et.toString()),Bt=Ft.fontStack||$t,Dt=N[Bt]=N[Bt]||{};this.calculateGlyphDependencies(Ft.text,Dt,jt,this.allowVerticalPlacement,Yt)}}}g.get("symbol-placement")==="line"&&(this.features=function(W){let Q={},ut={},rt=[],pt=0;function ft($t){rt.push(W[$t]),pt++}function Et($t,jt,Ft){let Yt=ut[$t];return delete ut[$t],ut[jt]=Yt,rt[Yt].geometry[0].pop(),rt[Yt].geometry[0]=rt[Yt].geometry[0].concat(Ft[0]),Yt}function Zt($t,jt,Ft){let Yt=Q[jt];return delete Q[jt],Q[$t]=Yt,rt[Yt].geometry[0].shift(),rt[Yt].geometry[0]=Ft[0].concat(rt[Yt].geometry[0]),Yt}function ee($t,jt,Ft){let Yt=Ft?jt[0][jt[0].length-1]:jt[0][0];return`${$t}:${Yt.x}:${Yt.y}`}for(let $t=0;$t<W.length;$t++){let jt=W[$t],Ft=jt.geometry,Yt=jt.text?jt.text.toString():null;if(!Yt){ft($t);continue}let Bt=ee(Yt,Ft),Dt=ee(Yt,Ft,!0);if(Bt in ut&&Dt in Q&&ut[Bt]!==Q[Dt]){let ue=Zt(Bt,Dt,Ft),ne=Et(Bt,Dt,rt[ue].geometry);delete Q[Bt],delete ut[Dt],ut[ee(Yt,rt[ne].geometry,!0)]=ne,rt[ue].geometry=null}else Bt in ut?Et(Bt,Dt,Ft):Dt in Q?Zt(Bt,Dt,Ft):(ft($t),Q[Bt]=pt-1,ut[Dt]=pt-1)}return rt.filter($t=>$t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Q)=>W.sortKey-Q.sortKey)}update(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){let a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]),y={};for(let v=t.segment+1;v<n.length;v++)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)y[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){let S=y[v];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,h,g,y,v,S,T,P,M,z){let N=t.indexArray,B=t.layoutVertexArray,q=t.segments.prepareSegment(4*n.length,B,N,this.canOverlap?y.sortKey:void 0),W=this.glyphOffsetArray.length,Q=q.vertexLength,ut=this.allowVerticalPlacement&&v===l.ai.vertical?Math.PI/2:0,rt=y.text&&y.text.sections;for(let pt=0;pt<n.length;pt++){let{tl:ft,tr:Et,bl:Zt,br:ee,tex:$t,pixelOffsetTL:jt,pixelOffsetBR:Ft,minFontScaleX:Yt,minFontScaleY:Bt,glyphOffset:Dt,isSDF:ue,sectionIndex:ne}=n[pt],Me=q.vertexLength,vr=Dt[1];Ep(B,S.x,S.y,ft.x,vr+ft.y,$t.x,$t.y,a,ue,jt.x,jt.y,Yt,Bt),Ep(B,S.x,S.y,Et.x,vr+Et.y,$t.x+$t.w,$t.y,a,ue,Ft.x,jt.y,Yt,Bt),Ep(B,S.x,S.y,Zt.x,vr+Zt.y,$t.x,$t.y+$t.h,a,ue,jt.x,Ft.y,Yt,Bt),Ep(B,S.x,S.y,ee.x,vr+ee.y,$t.x+$t.w,$t.y+$t.h,a,ue,Ft.x,Ft.y,Yt,Bt),Gd(t.dynamicLayoutVertexArray,S,ut),N.emplaceBack(Me,Me+1,Me+2),N.emplaceBack(Me+1,Me+2,Me+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),pt!==n.length-1&&ne===n[pt+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,y,y.index,{},z,rt&&rt[ne])}t.placedSymbolArray.emplaceBack(S.x,S.y,W,this.glyphOffsetArray.length-W,Q,T,P,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,M)}_addCollisionDebugVertex(t,n,a,h,g,y){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(t,n,a,h,g,y,v){let S=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),T=S.vertexLength,P=g.layoutVertexArray,M=g.collisionVertexArray,z=v.anchorX,N=v.anchorY;this._addCollisionDebugVertex(P,M,y,z,N,new st(t,n)),this._addCollisionDebugVertex(P,M,y,z,N,new st(a,n)),this._addCollisionDebugVertex(P,M,y,z,N,new st(a,h)),this._addCollisionDebugVertex(P,M,y,z,N,new st(t,h)),S.vertexLength+=4;let B=g.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),S.primitiveLength+=4}addDebugCollisionBoxes(t,n,a,h){for(let g=t;g<n;g++){let y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $d(Rr,_g.members,Qr),this.iconCollisionBox=new $d(Rr,_g.members,Qr);for(let t=0;t<this.symbolInstances.length;t++){let n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,a,h,g,y,v,S,T){let P={};for(let M=n;M<a;M++){let z=t.get(M);P.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.textFeatureIndex=z.featureIndex;break}for(let M=h;M<g;M++){let z=t.get(M);P.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalTextFeatureIndex=z.featureIndex;break}for(let M=y;M<v;M++){let z=t.get(M);P.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.iconFeatureIndex=z.featureIndex;break}for(let M=S;M<T;M++){let z=t.get(M);P.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},P.verticalIconFeatureIndex=z.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){let a=t.placedSymbolArray.get(n),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(t),a=Math.cos(t),h=[],g=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);let S=this.symbolInstances.get(v);h.push(0|Math.round(n*S.anchorX+a*S.anchorY)),g.push(S.featureIndex)}return y.sort((v,S)=>h[v]-h[S]||g[S]-g[v]),y}addToSortKeyRanges(t,n){let a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,y)=>{h>=0&&y.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rg,Og;Ht("SymbolBucket",Ru,{omit:["layers","collisionBoxArray","features","compareText"]}),Ru.MAX_GLYPHS=65535,Ru.addDynamicAttributes=Gd;var Zd={get paint(){return Og=Og||new Ur({"icon-opacity":new he(_t.paint_symbol["icon-opacity"]),"icon-color":new he(_t.paint_symbol["icon-color"]),"icon-halo-color":new he(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new he(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new he(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new ie(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new ie(_t.paint_symbol["icon-translate-anchor"]),"text-opacity":new he(_t.paint_symbol["text-opacity"]),"text-color":new he(_t.paint_symbol["text-color"],{runtimeType:bn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new he(_t.paint_symbol["text-halo-color"]),"text-halo-width":new he(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new he(_t.paint_symbol["text-halo-blur"]),"text-translate":new ie(_t.paint_symbol["text-translate"]),"text-translate-anchor":new ie(_t.paint_symbol["text-translate-anchor"])})},get layout(){return Rg=Rg||new Ur({"symbol-placement":new ie(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new ie(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ie(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new he(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ie(_t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ie(_t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ie(_t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ie(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new ie(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ie(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new he(_t.layout_symbol["icon-size"]),"icon-text-fit":new ie(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ie(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new he(_t.layout_symbol["icon-image"]),"icon-rotate":new he(_t.layout_symbol["icon-rotate"]),"icon-padding":new he(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new ie(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new he(_t.layout_symbol["icon-offset"]),"icon-anchor":new he(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ie(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ie(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ie(_t.layout_symbol["text-rotation-alignment"]),"text-field":new he(_t.layout_symbol["text-field"]),"text-font":new he(_t.layout_symbol["text-font"]),"text-size":new he(_t.layout_symbol["text-size"]),"text-max-width":new he(_t.layout_symbol["text-max-width"]),"text-line-height":new ie(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new he(_t.layout_symbol["text-letter-spacing"]),"text-justify":new he(_t.layout_symbol["text-justify"]),"text-radial-offset":new he(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ie(_t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new he(_t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new he(_t.layout_symbol["text-anchor"]),"text-max-angle":new ie(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new ie(_t.layout_symbol["text-writing-mode"]),"text-rotate":new he(_t.layout_symbol["text-rotate"]),"text-padding":new ie(_t.layout_symbol["text-padding"]),"text-keep-upright":new ie(_t.layout_symbol["text-keep-upright"]),"text-transform":new he(_t.layout_symbol["text-transform"]),"text-offset":new he(_t.layout_symbol["text-offset"]),"text-allow-overlap":new ie(_t.layout_symbol["text-allow-overlap"]),"text-overlap":new ie(_t.layout_symbol["text-overlap"]),"text-ignore-placement":new ie(_t.layout_symbol["text-ignore-placement"]),"text-optional":new ie(_t.layout_symbol["text-optional"])})}};class Fg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ai,this.defaultValue=t}evaluate(t){if(t.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",Fg,{omit:["defaultValue"]});class Tp extends Ni{constructor(t){super(t,Zd)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let a=this.layout.get("text-writing-mode");if(a){let h=[];for(let g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,h){let g=this.layout.get(t).evaluate(n,{},a,h),y=this._unevaluatedLayout._values[t];return y.isDataDriven()||rs(y.value)||!g?g:function(v,S){return S.replace(/{([^{}]+)}/g,(T,P)=>v&&P in v?String(v[P]):"")}(n.properties,g)}createBucket(t){return new Ru(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let t of Zd.paint.overridableProperties){if(!Tp.hasPaintOverride(this.layout,t))continue;let n=this.paint.get(t),a=new Fg(n),h=new qa(a,n.property.specification),g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new $a("source",h):new Vs("composite",h,n.value.zoomStops),this.paint._values[t]=new $n(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Tp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){let a=t.get("text-field"),h=Zd.paint.properties[n],g=!1,y=v=>{for(let S of v)if(h.overrides&&h.overrides.hasOverride(S))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Br)y(a.value.value.sections);else if(a.value.kind==="source"){let v=T=>{g||(T instanceof Bo&&br(T.value)===X?y(T.value.sections):T instanceof Ga?y(T.sections):T.eachChild(v))},S=a.value;S._styleExpression&&v(S._styleExpression.expression)}return g}}let Ng;var jx={get paint(){return Ng=Ng||new Ur({"background-color":new ie(_t.paint_background["background-color"]),"background-pattern":new Fc(_t.paint_background["background-pattern"]),"background-opacity":new ie(_t.paint_background["background-opacity"])})}};class Gx extends Ni{constructor(t){super(t,jx)}}let Bg;var qx={get paint(){return Bg=Bg||new Ur({"raster-opacity":new ie(_t.paint_raster["raster-opacity"]),"raster-hue-rotate":new ie(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ie(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ie(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new ie(_t.paint_raster["raster-saturation"]),"raster-contrast":new ie(_t.paint_raster["raster-contrast"]),"raster-resampling":new ie(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new ie(_t.paint_raster["raster-fade-duration"])})}};class $x extends Ni{constructor(t){super(t,qx)}}class Zx extends Ni{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Xx{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}let Xd=63710088e-1;class Da{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Da(er(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){let n=Math.PI/180,a=this.lat*n,h=t.lat*n,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Xd*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Da)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Da(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Da(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Vg=2*Math.PI*Xd;function Ug(r){return Vg*Math.cos(r*Math.PI/180)}function jg(r){return(180+r)/360}function Gg(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function qg(r,t){return r/Ug(t)}function $g(r){return 360*r-180}function Hd(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ip{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){let a=Da.convert(t);return new Ip(jg(a.lng),Gg(a.lat),qg(n,a.lat))}toLngLat(){return new Da($g(this.x),Hd(this.y))}toAltitude(){return this.z*Ug(Hd(this.y))}meterInMercatorCoordinateUnits(){return 1/Vg*(t=Hd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Zg(r,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Yd{constructor(t,n,a){if(t<0||t>25||a<0||a>=Math.pow(2,t)||n<0||n>=Math.pow(2,t))throw new Error(`x=${n}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=a,this.key=oh(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,a){let h=(y=this.y,v=this.z,S=Zg(256*(g=this.x),256*(y=Math.pow(2,v)-y-1),v),T=Zg(256*(g+1),256*(y+1),v),S[0]+","+S[1]+","+T[0]+","+T[1]);var g,y,v,S,T;let P=function(M,z,N){let B,q="";for(let W=M;W>0;W--)B=1<<W-1,q+=(z&B?1:0)+(N&B?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){let n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){let n=Math.pow(2,this.z);return new st((t.x*n-this.x)*Xr,(t.y*n-this.y)*Xr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xg{constructor(t,n){this.wrap=t,this.canonical=n,this.key=oh(t,n.z,n.z,n.x,n.y)}}class Ki{constructor(t,n,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Yd(a,+h,+g),this.key=oh(n,t,a,h,g)}clone(){return new Ki(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let n=this.canonical.z-t;return t>this.canonical.z?new Ki(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ki(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-t;return t>this.canonical.z?oh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):oh(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;let n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Ki(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Ki(n,this.wrap,n,a,h),new Ki(n,this.wrap,n,a+1,h),new Ki(n,this.wrap,n,a,h+1),new Ki(n,this.wrap,n,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ki(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ki(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ip(t.x-this.wrap,t.y))}}function oh(r,t,n,a,h){(r*=2)<0&&(r=-1*r-1);let g=1<<n;return(g*g*r+g*h+a).toString(36)+n.toString(36)+t.toString(36)}Ht("CanonicalTileID",Yd),Ht("OverscaledTileID",Ki,{omit:["posMatrix"]});class Hg{constructor(t,n,a,h=1,g=1,y=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void de(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;let S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=y,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<S;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(S,T)]=this.data[this._idx(S-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,S)]=this.data[this._idx(T,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<S;T++)for(let P=0;P<S;P++){let M=this.get(T,P);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,n){let a=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,a){return t*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Ji({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}let S=-n*this.dim,T=-a*this.dim;for(let P=y;P<v;P++)for(let M=h;M<g;M++)this.data[this._idx(M,P)]=t.data[this._idx(M+S,P+T)]}}Ht("DEMData",Hg);class Yg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){let a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Wg{constructor(t,n,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){let t={geometry:this.geometry};for(let n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Jg{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new fs(Xr,16,0),this.grid3D=new fs(Xr,16,0),this.featureIndexArray=new Ct,this.promoteId=n}insert(t,n,a,h,g,y){let v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);let S=y?this.grid3D:this.grid;for(let T=0;T<n.length;T++){let P=n[T],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){let N=P[z];M[0]=Math.min(M[0],N.x),M[1]=Math.min(M[1],N.y),M[2]=Math.max(M[2],N.x),M[3]=Math.max(M[3],N.y)}M[0]<Xr&&M[1]<Xr&&M[2]>=0&&M[3]>=0&&S.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Aa.VectorTile(new Fd(this.rawTileData)).layers,this.sourceLayerCoder=new Yg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,a,h){this.loadVTLayers();let g=t.params||{},y=Xr/t.tileSize/t.scale,v=Wl(g.filter),S=t.queryGeometry,T=t.queryPadding*y,P=Qg(S),M=this.grid.query(P.minX-T,P.minY-T,P.maxX+T,P.maxY+T),z=Qg(t.cameraQueryGeometry),N=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,(W,Q,ut,rt)=>function(pt,ft,Et,Zt,ee){for(let jt of pt)if(ft<=jt.x&&Et<=jt.y&&Zt>=jt.x&&ee>=jt.y)return!0;let $t=[new st(ft,Et),new st(ft,ee),new st(Zt,ee),new st(Zt,Et)];if(pt.length>2){for(let jt of $t)if(Au(pt,jt))return!0}for(let jt=0;jt<pt.length-1;jt++)if(Ev(pt[jt],pt[jt+1],$t))return!0;return!1}(t.cameraQueryGeometry,W-T,Q-T,ut+T,rt+T));for(let W of N)M.push(W);M.sort(Hx);let B={},q;for(let W=0;W<M.length;W++){let Q=M[W];if(Q===q)continue;q=Q;let ut=this.featureIndexArray.get(Q),rt=null;this.loadMatchingFeature(B,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,v,g.layers,g.availableImages,n,a,h,(pt,ft,Et)=>(rt||(rt=Cl(pt)),ft.queryIntersectsFeature(S,pt,Et,rt,this.z,t.transform,y,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,a,h,g,y,v,S,T,P,M){let z=this.bucketLayerIDs[n];if(y&&!function(W,Q){for(let ut=0;ut<W.length;ut++)if(Q.indexOf(W[ut])>=0)return!0;return!1}(y,z))return;let N=this.sourceLayerCoder.decode(a),B=this.vtLayers[N].feature(h);if(g.needGeometry){let W=Pl(B,!0);if(!g.filter(new yr(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!g.filter(new yr(this.tileID.overscaledZ),B))return;let q=this.getId(B,N);for(let W=0;W<z.length;W++){let Q=z[W];if(y&&y.indexOf(Q)<0)continue;let ut=S[Q];if(!ut)continue;let rt={};q&&P&&(rt=P.getState(ut.sourceLayer||"_geojsonTileLayer",q));let pt=Le({},T[Q]);pt.paint=Kg(pt.paint,ut.paint,B,rt,v),pt.layout=Kg(pt.layout,ut.layout,B,rt,v);let ft=!M||M(B,ut,rt);if(!ft)continue;let Et=new Wg(B,this.z,this.x,this.y,q);Et.layer=pt;let Zt=t[Q];Zt===void 0&&(Zt=t[Q]=[]),Zt.push({featureIndex:h,feature:Et,intersectionZ:ft})}}lookupSymbolFeatures(t,n,a,h,g,y,v,S){let T={};this.loadVTLayers();let P=Wl(g);for(let M of t)this.loadMatchingFeature(T,a,h,M,P,y,v,S,n);return T}hasLayer(t){for(let n of this.bucketLayerIDs)for(let a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function Kg(r,t,n,a,h){return je(r,(g,y)=>{let v=t instanceof Cu?t.get(y):null;return v&&v.evaluate?v.evaluate(n,a,h):v})}function Qg(r){let t=1/0,n=1/0,a=-1/0,h=-1/0;for(let g of r)t=Math.min(t,g.x),n=Math.min(n,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:n,maxX:a,maxY:h}}function Hx(r,t){return t-r}function ty(r,t,n,a,h){let g=[];for(let y=0;y<r.length;y++){let v=r[y],S;for(let T=0;T<v.length-1;T++){let P=v[T],M=v[T+1];P.x<t&&M.x<t||(P.x<t?P=new st(t,P.y+(t-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x<t&&(M=new st(t,P.y+(t-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y<n&&M.y<n||(P.y<n?P=new st(P.x+(n-P.y)/(M.y-P.y)*(M.x-P.x),n)._round():M.y<n&&(M=new st(P.x+(n-P.y)/(M.y-P.y)*(M.x-P.x),n)._round()),P.x>=a&&M.x>=a||(P.x>=a?P=new st(a,P.y+(a-P.x)/(M.x-P.x)*(M.y-P.y))._round():M.x>=a&&(M=new st(a,P.y+(a-P.x)/(M.x-P.x)*(M.y-P.y))._round()),P.y>=h&&M.y>=h||(P.y>=h?P=new st(P.x+(h-P.y)/(M.y-P.y)*(M.x-P.x),h)._round():M.y>=h&&(M=new st(P.x+(h-P.y)/(M.y-P.y)*(M.x-P.x),h)._round()),S&&P.equals(S[S.length-1])||(S=[P],g.push(S)),S.push(M)))))}}return g}Ht("FeatureIndex",Jg,{omit:["rawTileData","sourceLayerCoder"]});class ka extends st{constructor(t,n,a,h){super(t,n),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new ka(this.x,this.y,this.angle,this.segment)}}function ey(r,t,n,a,h){if(t.segment===void 0||n===0)return!0;let g=t,y=t.segment+1,v=0;for(;v>-n/2;){if(y--,y<0)return!1;v-=r[y].dist(g),g=r[y]}v+=r[y].dist(r[y+1]),y++;let S=[],T=0;for(;v<n/2;){let P=r[y],M=r[y+1];if(!M)return!1;let z=r[y-1].angleTo(P)-P.angleTo(M);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:z}),T+=z;v-S[0].distance>a;)T-=S.shift().angleDelta;if(T>h)return!1;y++,v+=P.dist(M)}return!0}function ry(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function ny(r,t,n){return r?.6*t*n:0}function iy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Yx(r,t,n,a,h,g){let y=ny(n,h,g),v=iy(n,a)*g,S=0,T=ry(r)/2;for(let P=0;P<r.length-1;P++){let M=r[P],z=r[P+1],N=M.dist(z);if(S+N>T){let B=(T-S)/N,q=Un.number(M.x,z.x,B),W=Un.number(M.y,z.y,B),Q=new ka(q,W,z.angleTo(M),P);return Q._round(),!y||ey(r,Q,v,y,t)?Q:void 0}S+=N}}function Wx(r,t,n,a,h,g,y,v,S){let T=ny(a,g,y),P=iy(a,h),M=P*y,z=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return t-M<t/4&&(t=M+t/4),oy(r,z?t/2*v%t:(P/2+2*g)*y*v%t,t,T,n,M,z,!1,S)}function oy(r,t,n,a,h,g,y,v,S){let T=g/2,P=ry(r),M=0,z=t-n,N=[];for(let B=0;B<r.length-1;B++){let q=r[B],W=r[B+1],Q=q.dist(W),ut=W.angleTo(q);for(;z+n<M+Q;){z+=n;let rt=(z-M)/Q,pt=Un.number(q.x,W.x,rt),ft=Un.number(q.y,W.y,rt);if(pt>=0&&pt<S&&ft>=0&&ft<S&&z-T>=0&&z+T<=P){let Et=new ka(pt,ft,ut,B);Et._round(),a&&!ey(r,Et,g,a,h)||N.push(Et)}}M+=Q}return v||N.length||y||(N=oy(r,M/2,n,a,h,g,y,!0,S)),N}Ht("Anchor",ka);let Ou=xi;function sy(r,t,n,a){let h=[],g=r.image,y=g.pixelRatio,v=g.paddedRect.w-2*Ou,S=g.paddedRect.h-2*Ou,T=r.right-r.left,P=r.bottom-r.top,M=g.stretchX||[[0,v]],z=g.stretchY||[[0,S]],N=(Ft,Yt)=>Ft+Yt[1]-Yt[0],B=M.reduce(N,0),q=z.reduce(N,0),W=v-B,Q=S-q,ut=0,rt=B,pt=0,ft=q,Et=0,Zt=W,ee=0,$t=Q;if(g.content&&a){let Ft=g.content;ut=Cp(M,0,Ft[0]),pt=Cp(z,0,Ft[1]),rt=Cp(M,Ft[0],Ft[2]),ft=Cp(z,Ft[1],Ft[3]),Et=Ft[0]-ut,ee=Ft[1]-pt,Zt=Ft[2]-Ft[0]-rt,$t=Ft[3]-Ft[1]-ft}let jt=(Ft,Yt,Bt,Dt)=>{let ue=Pp(Ft.stretch-ut,rt,T,r.left),ne=Ap(Ft.fixed-Et,Zt,Ft.stretch,B),Me=Pp(Yt.stretch-pt,ft,P,r.top),vr=Ap(Yt.fixed-ee,$t,Yt.stretch,q),Sr=Pp(Bt.stretch-ut,rt,T,r.left),rn=Ap(Bt.fixed-Et,Zt,Bt.stretch,B),Vi=Pp(Dt.stretch-pt,ft,P,r.top),ai=Ap(Dt.fixed-ee,$t,Dt.stretch,q),Hr=new st(ue,Me),vn=new st(Sr,Me),Pn=new st(Sr,Vi),li=new st(ue,Vi),ui=new st(ne/y,vr/y),nn=new st(rn/y,ai/y),on=t*Math.PI/180;if(on){let Hn=Math.sin(on),bi=Math.cos(on),wi=[bi,-Hn,Hn,bi];Hr._matMult(wi),vn._matMult(wi),li._matMult(wi),Pn._matMult(wi)}let Xn=Ft.stretch+Ft.fixed,ci=Yt.stretch+Yt.fixed;return{tl:Hr,tr:vn,bl:li,br:Pn,tex:{x:g.paddedRect.x+Ou+Xn,y:g.paddedRect.y+Ou+ci,w:Bt.stretch+Bt.fixed-Xn,h:Dt.stretch+Dt.fixed-ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ui,pixelOffsetBR:nn,minFontScaleX:Zt/y/T,minFontScaleY:$t/y/P,isSDF:n}};if(a&&(g.stretchX||g.stretchY)){let Ft=ay(M,W,B),Yt=ay(z,Q,q);for(let Bt=0;Bt<Ft.length-1;Bt++){let Dt=Ft[Bt],ue=Ft[Bt+1];for(let ne=0;ne<Yt.length-1;ne++)h.push(jt(Dt,Yt[ne],ue,Yt[ne+1]))}}else h.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:S+1}));return h}function Cp(r,t,n){let a=0;for(let h of r)a+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return a}function ay(r,t,n){let a=[{fixed:-Ou,stretch:0}];for(let[h,g]of r){let y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return a.push({fixed:t+Ou,stretch:n}),a}function Pp(r,t,n,a){return r/t*n+a}function Ap(r,t,n,a){return r-t*n/a}class Lp{constructor(t,n,a,h,g,y,v,S,T,P){if(this.boxStartIndex=t.length,T){let M=y.top,z=y.bottom,N=y.collisionPadding;N&&(M-=N[1],z+=N[3]);let B=z-M;B>0&&(B=Math.max(10,B),this.circleDiameter=B)}else{let M=y.top*v-S[0],z=y.bottom*v+S[2],N=y.left*v-S[3],B=y.right*v+S[1],q=y.collisionPadding;if(q&&(N-=q[0]*v,M-=q[1]*v,B+=q[2]*v,z+=q[3]*v),P){let W=new st(N,M),Q=new st(B,M),ut=new st(N,z),rt=new st(B,z),pt=P*Math.PI/180;W._rotate(pt),Q._rotate(pt),ut._rotate(pt),rt._rotate(pt),N=Math.min(W.x,Q.x,ut.x,rt.x),B=Math.max(W.x,Q.x,ut.x,rt.x),M=Math.min(W.y,Q.y,ut.y,rt.y),z=Math.max(W.y,Q.y,ut.y,rt.y)}t.emplaceBack(n.x,n.y,N,M,B,z,a,h,g)}this.boxEndIndex=t.length}}class Jx{constructor(t=[],n=Kx){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:n,compare:a}=this,h=n[t];for(;t>0;){let g=t-1>>1,y=n[g];if(a(h,y)>=0)break;n[t]=y,t=g}n[t]=h}_down(t){let{data:n,compare:a}=this,h=this.length>>1,g=n[t];for(;t<h;){let y=1+(t<<1),v=n[y],S=y+1;if(S<this.length&&a(n[S],v)<0&&(y=S,v=n[S]),a(v,g)>=0)break;n[t]=v,t=y}n[t]=g}}function Kx(r,t){return r<t?-1:r>t?1:0}function Qx(r,t=1,n=!1){let a=1/0,h=1/0,g=-1/0,y=-1/0,v=r[0];for(let N=0;N<v.length;N++){let B=v[N];(!N||B.x<a)&&(a=B.x),(!N||B.y<h)&&(h=B.y),(!N||B.x>g)&&(g=B.x),(!N||B.y>y)&&(y=B.y)}let S=Math.min(g-a,y-h),T=S/2,P=new Jx([],t1);if(S===0)return new st(a,h);for(let N=a;N<g;N+=S)for(let B=h;B<y;B+=S)P.push(new Fu(N+T,B+T,T,r));let M=function(N){let B=0,q=0,W=0,Q=N[0];for(let ut=0,rt=Q.length,pt=rt-1;ut<rt;pt=ut++){let ft=Q[ut],Et=Q[pt],Zt=ft.x*Et.y-Et.x*ft.y;q+=(ft.x+Et.x)*Zt,W+=(ft.y+Et.y)*Zt,B+=3*Zt}return new Fu(q/B,W/B,0,N)}(r),z=P.length;for(;P.length;){let N=P.pop();(N.d>M.d||!M.d)&&(M=N,n&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,z)),N.max-M.d<=t||(T=N.h/2,P.push(new Fu(N.p.x-T,N.p.y-T,T,r)),P.push(new Fu(N.p.x+T,N.p.y-T,T,r)),P.push(new Fu(N.p.x-T,N.p.y+T,T,r)),P.push(new Fu(N.p.x+T,N.p.y+T,T,r)),z+=4)}return n&&(console.log(`num probes: ${z}`),console.log(`best distance: ${M.d}`)),M.p}function t1(r,t){return t.max-r.max}function Fu(r,t,n,a){this.p=new st(r,t),this.h=n,this.d=function(h,g){let y=!1,v=1/0;for(let S=0;S<g.length;S++){let T=g[S];for(let P=0,M=T.length,z=M-1;P<M;z=P++){let N=T[P],B=T[z];N.y>h.y!=B.y>h.y&&h.x<(B.x-N.x)*(h.y-N.y)/(B.y-N.y)+N.x&&(y=!y),v=Math.min(v,Gm(h,N,B))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Cn;l.aq=void 0,(Cn=l.aq||(l.aq={}))[Cn.center=1]="center",Cn[Cn.left=2]="left",Cn[Cn.right=3]="right",Cn[Cn.top=4]="top",Cn[Cn.bottom=5]="bottom",Cn[Cn["top-left"]=6]="top-left",Cn[Cn["top-right"]=7]="top-right",Cn[Cn["bottom-left"]=8]="bottom-left",Cn[Cn["bottom-right"]=9]="bottom-right";let za=7,Wd=Number.POSITIVE_INFINITY;function ly(r,t){return t[1]!==Wd?function(n,a,h){let g=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-za;break;case"bottom-right":case"bottom-left":case"bottom":y=-h+za}switch(n){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,y]}(r,t[0],t[1]):function(n,a){let h=0,g=0;a<0&&(a=0);let y=a/Math.SQRT2;switch(n){case"top-right":case"top-left":g=y-za;break;case"bottom-right":case"bottom-left":g=-y+za;break;case"bottom":g=-a+za;break;case"top":g=a-za}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(r,t[0])}function uy(r,t,n){var a;let h=r.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},n);if(g){let v=g.values,S=[];for(let T=0;T<v.length;T+=2){let P=S[T]=v[T],M=v[T+1].map(z=>z*en);P.startsWith("top")?M[1]-=za:P.startsWith("bottom")&&(M[1]+=za),S[T+1]=M}return new En(S)}let y=h.get("text-variable-anchor");if(y){let v;v=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},n)*en,Wd]:h.get("text-offset").evaluate(t,{},n).map(T=>T*en);let S=[];for(let T of y)S.push(T,ly(T,v));return new En(S)}return null}function Jd(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function e1(r,t,n,a,h,g,y,v,S,T,P){let M=g.textMaxSize.evaluate(t,{});M===void 0&&(M=y);let z=r.layers[0].layout,N=z.get("icon-offset").evaluate(t,{},P),B=hy(n.horizontal),q=y/24,W=r.tilePixelRatio*q,Q=r.tilePixelRatio*M/24,ut=r.tilePixelRatio*v,rt=r.tilePixelRatio*z.get("symbol-spacing"),pt=z.get("text-padding")*r.tilePixelRatio,ft=function(Dt,ue,ne,Me=1){let vr=Dt.get("icon-padding").evaluate(ue,{},ne),Sr=vr&&vr.values;return[Sr[0]*Me,Sr[1]*Me,Sr[2]*Me,Sr[3]*Me]}(z,t,P,r.tilePixelRatio),Et=z.get("text-max-angle")/180*Math.PI,Zt=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",ee=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",$t=z.get("symbol-placement"),jt=rt/2,Ft=z.get("icon-text-fit"),Yt;a&&Ft!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Yt=kg(a,n.vertical,Ft,z.get("icon-text-fit-padding"),N,q)),B&&(a=kg(a,B,Ft,z.get("icon-text-fit-padding"),N,q)));let Bt=(Dt,ue)=>{ue.x<0||ue.x>=Xr||ue.y<0||ue.y>=Xr||function(ne,Me,vr,Sr,rn,Vi,ai,Hr,vn,Pn,li,ui,nn,on,Xn,ci,Hn,bi,wi,sn,Ve,Yn,An,an,Eo){let Go=ne.addToLineVertexArray(Me,vr),qo,Ws,To,Qi,Si=0,Js=0,lh=0,my=0,sf=-1,af=-1,Ks={},gy=Zs("");if(ne.allowVerticalPlacement&&Sr.vertical){let Wn=Hr.layout.get("text-rotate").evaluate(Ve,{},an)+90;To=new Lp(vn,Me,Pn,li,ui,Sr.vertical,nn,on,Xn,Wn),ai&&(Qi=new Lp(vn,Me,Pn,li,ui,ai,Hn,bi,Xn,Wn))}if(rn){let Wn=Hr.layout.get("icon-rotate").evaluate(Ve,{}),to=Hr.layout.get("icon-text-fit")!=="none",Ll=sy(rn,Wn,An,to),Zo=ai?sy(ai,Wn,An,to):void 0;Ws=new Lp(vn,Me,Pn,li,ui,rn,Hn,bi,!1,Wn),Si=4*Ll.length;let Ml=ne.iconSizeData,_s=null;Ml.kind==="source"?(_s=[ys*Hr.layout.get("icon-size").evaluate(Ve,{})],_s[0]>Ma&&de(`${ne.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)):Ml.kind==="composite"&&(_s=[ys*Yn.compositeIconSizes[0].evaluate(Ve,{},an),ys*Yn.compositeIconSizes[1].evaluate(Ve,{},an)],(_s[0]>Ma||_s[1]>Ma)&&de(`${ne.layerIds[0]}: Value for "icon-size" is >= ${ih}. Reduce your "icon-size".`)),ne.addSymbols(ne.icon,Ll,_s,sn,wi,Ve,l.ai.none,Me,Go.lineStartIndex,Go.lineLength,-1,an),sf=ne.icon.placedSymbolArray.length-1,Zo&&(Js=4*Zo.length,ne.addSymbols(ne.icon,Zo,_s,sn,wi,Ve,l.ai.vertical,Me,Go.lineStartIndex,Go.lineLength,-1,an),af=ne.icon.placedSymbolArray.length-1)}let yy=Object.keys(Sr.horizontal);for(let Wn of yy){let to=Sr.horizontal[Wn];if(!qo){gy=Zs(to.text);let Zo=Hr.layout.get("text-rotate").evaluate(Ve,{},an);qo=new Lp(vn,Me,Pn,li,ui,to,nn,on,Xn,Zo)}let Ll=to.positionedLines.length===1;if(lh+=cy(ne,Me,to,Vi,Hr,Xn,Ve,ci,Go,Sr.vertical?l.ai.horizontal:l.ai.horizontalOnly,Ll?yy:[Wn],Ks,sf,Yn,an),Ll)break}Sr.vertical&&(my+=cy(ne,Me,Sr.vertical,Vi,Hr,Xn,Ve,ci,Go,l.ai.vertical,["vertical"],Ks,af,Yn,an));let i1=qo?qo.boxStartIndex:ne.collisionBoxArray.length,o1=qo?qo.boxEndIndex:ne.collisionBoxArray.length,s1=To?To.boxStartIndex:ne.collisionBoxArray.length,a1=To?To.boxEndIndex:ne.collisionBoxArray.length,l1=Ws?Ws.boxStartIndex:ne.collisionBoxArray.length,u1=Ws?Ws.boxEndIndex:ne.collisionBoxArray.length,c1=Qi?Qi.boxStartIndex:ne.collisionBoxArray.length,h1=Qi?Qi.boxEndIndex:ne.collisionBoxArray.length,$o=-1,Dp=(Wn,to)=>Wn&&Wn.circleDiameter?Math.max(Wn.circleDiameter,to):to;$o=Dp(qo,$o),$o=Dp(To,$o),$o=Dp(Ws,$o),$o=Dp(Qi,$o);let _y=$o>-1?1:0;_y&&($o*=Eo/en),ne.glyphOffsetArray.length>=Ru.MAX_GLYPHS&&de("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ve.sortKey!==void 0&&ne.addToSortKeyRanges(ne.symbolInstances.length,Ve.sortKey);let p1=uy(Hr,Ve,an),[d1,f1]=function(Wn,to){let Ll=Wn.length,Zo=to?.values;if(Zo?.length>0)for(let Ml=0;Ml<Zo.length;Ml+=2){let _s=Zo[Ml+1];Wn.emplaceBack(l.aq[Zo[Ml]],_s[0],_s[1])}return[Ll,Wn.length]}(ne.textAnchorOffsets,p1);ne.symbolInstances.emplaceBack(Me.x,Me.y,Ks.right>=0?Ks.right:-1,Ks.center>=0?Ks.center:-1,Ks.left>=0?Ks.left:-1,Ks.vertical||-1,sf,af,gy,i1,o1,s1,a1,l1,u1,c1,h1,Pn,lh,my,Si,Js,_y,0,nn,$o,d1,f1)}(r,ue,Dt,n,a,h,Yt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,W,[pt,pt,pt,pt],Zt,S,ut,ft,ee,N,t,g,T,P,y)};if($t==="line")for(let Dt of ty(t.geometry,0,0,Xr,Xr)){let ue=Wx(Dt,rt,Et,n.vertical||B,a,24,Q,r.overscaling,Xr);for(let ne of ue)B&&r1(r,B.text,jt,ne)||Bt(Dt,ne)}else if($t==="line-center"){for(let Dt of t.geometry)if(Dt.length>1){let ue=Yx(Dt,Et,n.vertical||B,a,24,Q);ue&&Bt(Dt,ue)}}else if(t.type==="Polygon")for(let Dt of Ad(t.geometry,0)){let ue=Qx(Dt,16);Bt(Dt[0],new ka(ue.x,ue.y,0))}else if(t.type==="LineString")for(let Dt of t.geometry)Bt(Dt,new ka(Dt[0].x,Dt[0].y,0));else if(t.type==="Point")for(let Dt of t.geometry)for(let ue of Dt)Bt([ue],new ka(ue.x,ue.y,0))}function cy(r,t,n,a,h,g,y,v,S,T,P,M,z,N,B){let q=function(ut,rt,pt,ft,Et,Zt,ee,$t){let jt=ft.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,Ft=[];for(let Yt of rt.positionedLines)for(let Bt of Yt.positionedGlyphs){if(!Bt.rect)continue;let Dt=Bt.rect||{},ue=Ig+1,ne=!0,Me=1,vr=0,Sr=(Et||$t)&&Bt.vertical,rn=Bt.metrics.advance*Bt.scale/2;if($t&&rt.verticalizable&&(vr=Yt.lineOffset/2-(Bt.imageName?-(en-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*en)),Bt.imageName){let sn=ee[Bt.imageName];ne=sn.sdf,Me=sn.pixelRatio,ue=xi/Me}let Vi=Et?[Bt.x+rn,Bt.y]:[0,0],ai=Et?[0,0]:[Bt.x+rn+pt[0],Bt.y+pt[1]-vr],Hr=[0,0];Sr&&(Hr=ai,ai=[0,0]);let vn=Bt.metrics.isDoubleResolution?2:1,Pn=(Bt.metrics.left-ue)*Bt.scale-rn+ai[0],li=(-Bt.metrics.top-ue)*Bt.scale+ai[1],ui=Pn+Dt.w/vn*Bt.scale/Me,nn=li+Dt.h/vn*Bt.scale/Me,on=new st(Pn,li),Xn=new st(ui,li),ci=new st(Pn,nn),Hn=new st(ui,nn);if(Sr){let sn=new st(-rn,rn-rh),Ve=-Math.PI/2,Yn=en/2-rn,An=new st(5-rh-Yn,-(Bt.imageName?Yn:0)),an=new st(...Hr);on._rotateAround(Ve,sn)._add(An)._add(an),Xn._rotateAround(Ve,sn)._add(An)._add(an),ci._rotateAround(Ve,sn)._add(An)._add(an),Hn._rotateAround(Ve,sn)._add(An)._add(an)}if(jt){let sn=Math.sin(jt),Ve=Math.cos(jt),Yn=[Ve,-sn,sn,Ve];on._matMult(Yn),Xn._matMult(Yn),ci._matMult(Yn),Hn._matMult(Yn)}let bi=new st(0,0),wi=new st(0,0);Ft.push({tl:on,tr:Xn,bl:ci,br:Hn,tex:Dt,writingMode:rt.writingMode,glyphOffset:Vi,sectionIndex:Bt.sectionIndex,isSDF:ne,pixelOffsetTL:bi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}return Ft}(0,n,v,h,g,y,a,r.allowVerticalPlacement),W=r.textSizeData,Q=null;W.kind==="source"?(Q=[ys*h.layout.get("text-size").evaluate(y,{})],Q[0]>Ma&&de(`${r.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)):W.kind==="composite"&&(Q=[ys*N.compositeTextSizes[0].evaluate(y,{},B),ys*N.compositeTextSizes[1].evaluate(y,{},B)],(Q[0]>Ma||Q[1]>Ma)&&de(`${r.layerIds[0]}: Value for "text-size" is >= ${ih}. Reduce your "text-size".`)),r.addSymbols(r.text,q,Q,v,g,y,T,t,S.lineStartIndex,S.lineLength,z,B);for(let ut of P)M[ut]=r.text.placedSymbolArray.length-1;return 4*q.length}function hy(r){for(let t in r)return r[t];return null}function r1(r,t,n,a){let h=r.compareText;if(t in h){let g=h[t];for(let y=g.length-1;y>=0;y--)if(a.dist(g[y])<n)return!0}else h[t]=[];return h[t].push(a),!1}let py=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,a]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);let g=py[15&a];if(!g)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Kd(v,y,g,t)}constructor(t,n=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let g=py.indexOf(this.ArrayType),y=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){let a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=n,a}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Qd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:g,coords:y,nodeSize:v}=this,S=[0,g.length-1,0],T=[];for(;S.length;){let P=S.pop()||0,M=S.pop()||0,z=S.pop()||0;if(M-z<=v){for(let W=z;W<=M;W++){let Q=y[2*W],ut=y[2*W+1];Q>=t&&Q<=a&&ut>=n&&ut<=h&&T.push(g[W])}continue}let N=z+M>>1,B=y[2*N],q=y[2*N+1];B>=t&&B<=a&&q>=n&&q<=h&&T.push(g[N]),(P===0?t<=B:n<=q)&&(S.push(z),S.push(N-1),S.push(1-P)),(P===0?a>=B:h>=q)&&(S.push(N+1),S.push(M),S.push(1-P))}return T}within(t,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:g,nodeSize:y}=this,v=[0,h.length-1,0],S=[],T=a*a;for(;v.length;){let P=v.pop()||0,M=v.pop()||0,z=v.pop()||0;if(M-z<=y){for(let W=z;W<=M;W++)fy(g[2*W],g[2*W+1],t,n)<=T&&S.push(h[W]);continue}let N=z+M>>1,B=g[2*N],q=g[2*N+1];fy(B,q,t,n)<=T&&S.push(h[N]),(P===0?t-a<=B:n-a<=q)&&(v.push(z),v.push(N-1),v.push(1-P)),(P===0?t+a>=B:n+a>=q)&&(v.push(N+1),v.push(M),v.push(1-P))}return S}}function Qd(r,t,n,a,h,g){if(h-a<=n)return;let y=a+h>>1;dy(r,t,y,a,h,g),Qd(r,t,n,a,y-1,1-g),Qd(r,t,n,y+1,h,1-g)}function dy(r,t,n,a,h,g){for(;h>a;){if(h-a>600){let T=h-a+1,P=n-a+1,M=Math.log(T),z=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*z*(T-z)/T)*(P-T/2<0?-1:1);dy(r,t,n,Math.max(a,Math.floor(n-P*z/T+N)),Math.min(h,Math.floor(n+(T-P)*z/T+N)),g)}let y=t[2*n+g],v=a,S=h;for(sh(r,t,a,n),t[2*h+g]>y&&sh(r,t,a,h);v<S;){for(sh(r,t,v,S),v++,S--;t[2*v+g]<y;)v++;for(;t[2*S+g]>y;)S--}t[2*a+g]===y?sh(r,t,a,S):(S++,sh(r,t,S,h)),S<=n&&(a=S+1),n<=S&&(h=S-1)}}function sh(r,t,n,a){tf(r,n,a),tf(t,2*n,2*a),tf(t,2*n+1,2*a+1)}function tf(r,t,n){let a=r[t];r[t]=r[n],r[n]=a}function fy(r,t,n,a){let h=r-n,g=t-a;return h*h+g*g}var ef;l.bh=void 0,(ef=l.bh||(l.bh={})).create="create",ef.load="load",ef.fullLoad="fullLoad";let Mp=null,ah=[],rf=1e3/60,nf="loadTime",of="fullLoadTime",n1={mark(r){performance.mark(r)},frame(r){let t=r;Mp!=null&&ah.push(t-Mp),Mp=t},clearMetrics(){Mp=null,ah=[],performance.clearMeasures(nf),performance.clearMeasures(of);for(let r in l.bh)performance.clearMarks(l.bh[r])},getPerformanceMetrics(){performance.measure(nf,l.bh.create,l.bh.load),performance.measure(of,l.bh.create,l.bh.fullLoad);let r=performance.getEntriesByName(nf)[0].duration,t=performance.getEntriesByName(of)[0].duration,n=ah.length,a=1/(ah.reduce((g,y)=>g+y,0)/n/1e3),h=ah.filter(g=>g>rf).reduce((g,y)=>g+(y-rf)/rf,0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};l.$=function(r,t,n){var a,h,g,y,v,S,T,P,M,z,N,B,q=n[0],W=n[1],Q=n[2];return t===r?(r[12]=t[0]*q+t[4]*W+t[8]*Q+t[12],r[13]=t[1]*q+t[5]*W+t[9]*Q+t[13],r[14]=t[2]*q+t[6]*W+t[10]*Q+t[14],r[15]=t[3]*q+t[7]*W+t[11]*Q+t[15]):(h=t[1],g=t[2],y=t[3],v=t[4],S=t[5],T=t[6],P=t[7],M=t[8],z=t[9],N=t[10],B=t[11],r[0]=a=t[0],r[1]=h,r[2]=g,r[3]=y,r[4]=v,r[5]=S,r[6]=T,r[7]=P,r[8]=M,r[9]=z,r[10]=N,r[11]=B,r[12]=a*q+v*W+M*Q+t[12],r[13]=h*q+S*W+z*Q+t[13],r[14]=g*q+T*W+N*Q+t[14],r[15]=y*q+P*W+B*Q+t[15]),r},l.A=Lu,l.B=Un,l.C=class{constructor(r,t,n){this.receive=a=>{let h=a.data,g=h.id;if(g&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[g];let y=this.cancelCallbacks[g];delete this.cancelCallbacks[g],y&&y()}else Ar()||h.mustQueue?(this.tasks[g]=h,this.taskQueue.push(g),this.invoker.trigger()):this.processTask(g,h)},this.process=()=>{if(!this.taskQueue.length)return;let a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)},this.target=r,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Xx(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ar()?r:window}send(r,t,n,a,h=!1){let g=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[g]=n);let y=[],v={id:g,type:r,hasCallback:!!n,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Wi(t,y)};return this.target.postMessage(v,{transfer:y}),{cancel:()=>{n&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(r,t){if(t.type==="<response>"){let n=this.callbacks[r];delete this.callbacks[r],n&&(t.error?n(ss(t.error)):n(null,ss(t.data)))}else{let n=!1,a=[],h=t.hasCallback?(v,S)=>{n=!0,delete this.cancelCallbacks[r];let T={id:r,type:"<response>",sourceMapId:this.mapId,error:v?Wi(v):null,data:Wi(S,a)};this.target.postMessage(T,{transfer:a})}:v=>{n=!0},g=null,y=ss(t.data);if(this.parent[t.type])g=this.parent[t.type](t.sourceMapId,y,h);else if("getWorkerSource"in this.parent){let v=t.type.split(".");g=this.parent.getWorkerSource(t.sourceMapId,v[0],y.source)[v[1]](y,h)}else h(new Error(`Could not find function ${t.type}`));!n&&g&&g.cancel&&(this.cancelCallbacks[r]=g.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.D=ie,l.E=ls,l.F=function(r,t){let n={};for(let a=0;a<t.length;a++){let h=t[a];h in r&&(n[h]=r[h])}return n},l.G=jg,l.H=Gg,l.I=Bd,l.J=Qt,l.K=se,l.L=Da,l.M=Ri,l.N=Xr,l.O=Ki,l.P=st,l.Q=Pr,l.R=Ji,l.S=_r,l.T=sp,l.U=Ip,l.V=class extends qs{},l.W=Yd,l.X=function(r,t){let n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let a=0;a<r.length;a++){let h=window.document.createElement("source");Oi(r[a])||(n.crossOrigin="Anonymous"),h.src=r[a],n.appendChild(h)}return{cancel:()=>{}}},l.Y=Ot,l.Z=function(){var r=new Lu(16);return Lu!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},l._=V,l.a=pi,l.a$=class extends F{},l.a0=function(r,t,n){var a=n[0],h=n[1],g=n[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*h,r[5]=t[5]*h,r[6]=t[6]*h,r[7]=t[7]*h,r[8]=t[8]*g,r[9]=t[9]*g,r[10]=t[10]*g,r[11]=t[11]*g,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.a1=Xm,l.a2=function(){return lr++},l.a3=H,l.a4=Ru,l.a5=function(){_i.isLoading()||_i.isLoaded()||Rc()!=="deferred"||op()},l.a6=Wl,l.a7=Pl,l.a8=yr,l.a9=Wg,l.aA=wl,l.aB=function(r){r=r.slice();let t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=fi(r[n],t[r[n].ref]));return r},l.aC=function(r){if(r.type==="custom")return new Zx(r);switch(r.type){case"background":return new Gx(r);case"circle":return new Cv(r);case"fill":return new Xv(r);case"fill-extrusion":return new lx(r);case"heatmap":return new Av(r);case"hillshade":return new Mv(r);case"line":return new gx(r);case"raster":return new $x(r);case"symbol":return new Tp(r)}},l.aD=nr,l.aE=function(r,t){if(!r)return[{command:Ze.setStyle,args:[t]}];let n=[];try{if(!ar(r.version,t.version))return[{command:Ze.setStyle,args:[t]}];ar(r.center,t.center)||n.push({command:Ze.setCenter,args:[t.center]}),ar(r.zoom,t.zoom)||n.push({command:Ze.setZoom,args:[t.zoom]}),ar(r.bearing,t.bearing)||n.push({command:Ze.setBearing,args:[t.bearing]}),ar(r.pitch,t.pitch)||n.push({command:Ze.setPitch,args:[t.pitch]}),ar(r.sprite,t.sprite)||n.push({command:Ze.setSprite,args:[t.sprite]}),ar(r.glyphs,t.glyphs)||n.push({command:Ze.setGlyphs,args:[t.glyphs]}),ar(r.transition,t.transition)||n.push({command:Ze.setTransition,args:[t.transition]}),ar(r.light,t.light)||n.push({command:Ze.setLight,args:[t.light]});let a={},h=[];(function(y,v,S,T){let P;for(P in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,P)&&(Object.prototype.hasOwnProperty.call(v,P)||ho(P,S,T));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(y,P)?ar(y[P],v[P])||(y[P].type==="geojson"&&v[P].type==="geojson"&&ia(y,v,P)?S.push({command:Ze.setGeoJSONSourceData,args:[P,v[P].data]}):Zi(P,v,S,T)):ji(P,v,S))})(r.sources,t.sources,h,a);let g=[];r.layers&&r.layers.forEach(y=>{a[y.source]?n.push({command:Ze.removeLayer,args:[y.id]}):g.push(y)}),n=n.concat(h),function(y,v,S){v=v||[];let T=(y=y||[]).map(Xi),P=v.map(Xi),M=y.reduce(Do,{}),z=v.reduce(Do,{}),N=T.slice(),B=Object.create(null),q,W,Q,ut,rt,pt,ft;for(q=0,W=0;q<T.length;q++)Q=T[q],Object.prototype.hasOwnProperty.call(z,Q)?W++:(S.push({command:Ze.removeLayer,args:[Q]}),N.splice(N.indexOf(Q,W),1));for(q=0,W=0;q<P.length;q++)Q=P[P.length-1-q],N[N.length-1-q]!==Q&&(Object.prototype.hasOwnProperty.call(M,Q)?(S.push({command:Ze.removeLayer,args:[Q]}),N.splice(N.lastIndexOf(Q,N.length-W),1)):W++,pt=N[N.length-q],S.push({command:Ze.addLayer,args:[z[Q],pt]}),N.splice(N.length-q,0,Q),B[Q]=!0);for(q=0;q<P.length;q++)if(Q=P[q],ut=M[Q],rt=z[Q],!B[Q]&&!ar(ut,rt))if(ar(ut.source,rt.source)&&ar(ut["source-layer"],rt["source-layer"])&&ar(ut.type,rt.type)){for(ft in us(ut.layout,rt.layout,S,Q,null,Ze.setLayoutProperty),us(ut.paint,rt.paint,S,Q,null,Ze.setPaintProperty),ar(ut.filter,rt.filter)||S.push({command:Ze.setFilter,args:[Q,rt.filter]}),ar(ut.minzoom,rt.minzoom)&&ar(ut.maxzoom,rt.maxzoom)||S.push({command:Ze.setLayerZoomRange,args:[Q,rt.minzoom,rt.maxzoom]}),ut)Object.prototype.hasOwnProperty.call(ut,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?us(ut[ft],rt[ft],S,Q,ft.slice(6),Ze.setPaintProperty):ar(ut[ft],rt[ft])||S.push({command:Ze.setLayerProperty,args:[Q,ft,rt[ft]]}));for(ft in rt)Object.prototype.hasOwnProperty.call(rt,ft)&&!Object.prototype.hasOwnProperty.call(ut,ft)&&ft!=="layout"&&ft!=="paint"&&ft!=="filter"&&ft!=="metadata"&&ft!=="minzoom"&&ft!=="maxzoom"&&(ft.indexOf("paint.")===0?us(ut[ft],rt[ft],S,Q,ft.slice(6),Ze.setPaintProperty):ar(ut[ft],rt[ft])||S.push({command:Ze.setLayerProperty,args:[Q,ft,rt[ft]]}))}else S.push({command:Ze.removeLayer,args:[Q]}),pt=N[N.lastIndexOf(Q)+1],S.push({command:Ze.addLayer,args:[rt,pt]})}(g,t.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:Ze.setStyle,args:[t]}]}return n},l.aF=function(r){let t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},l.aG=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],n[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(let a in t)if(!r(t[a],n[a]))return!1;return!0}return t===n},l.aH=je,l.aI=zr,l.aJ=Sl,l.aK=function(r){return r({pluginStatus:ii,pluginURL:ms}),Sl.on("pluginStateChange",r),r},l.aL=class extends Xs{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.aM=Pu,l.aN=class extends Xs{constructor(r,t){super(r,t),this.current=yd}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.aO=cp,l.aP=class extends Xs{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.aQ=class extends Xs{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.aR=hp,l.aS=function(r,t,n,a,h,g,y){var v=1/(t-n),S=1/(a-h),T=1/(g-y);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(t+n)*v,r[13]=(h+a)*S,r[14]=(y+g)*T,r[15]=1,r},l.aT=tr,l.aU=Iv,l.aV=class extends c{},l.aW=xx,l.aX=class extends m{},l.aY=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},l.aZ=Km,l.a_=zt,l.aa=function(r){let t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,h,g)=>{let y=h||g;return t[a]=!y||y.toLowerCase(),""}),t["max-age"]){let n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},l.ab=function(r,t){let n=[];for(let a in r)a in t||n.push(a);return n},l.ac=function(r){if(xn==null){let t=r.navigator?r.navigator.userAgent:null;xn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return xn},l.ad=ke,l.ae=function(r,t,n){var a=Math.sin(n),h=Math.cos(n),g=t[0],y=t[1],v=t[2],S=t[3],T=t[4],P=t[5],M=t[6],z=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=g*h+T*a,r[1]=y*h+P*a,r[2]=v*h+M*a,r[3]=S*h+z*a,r[4]=T*h-g*a,r[5]=P*h-y*a,r[6]=M*h-v*a,r[7]=z*h-S*a,r},l.af=function(r){var t=new Lu(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.ag=mp,l.ah=function(r,t){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){let{interpolationType:h,minZoom:g,maxZoom:y}=r,v=h?ke(ti.interpolationFactor(h,t,g,y),0,1):0;r.kind==="camera"?a=Un.number(r.minSize,r.maxSize,v):n=v}return{uSizeT:n,uSize:a}},l.aj=function(r,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/ys:r.kind==="composite"?Un.number(a/ys,h/ys,n):t},l.ak=Gd,l.al=function(r,t,n,a){let h=t.y-r.y,g=t.x-r.x,y=a.y-n.y,v=a.x-n.x,S=y*g-v*h;if(S===0)return null;let T=(v*(r.y-n.y)-y*(r.x-n.x))/S;return new st(r.x+T*g,r.y+T*h)},l.am=ty,l.an=Um,l.ao=wd,l.ap=en,l.ar=jd,l.as=function(r,t){var n=t[0],a=t[1],h=t[2],g=t[3],y=t[4],v=t[5],S=t[6],T=t[7],P=t[8],M=t[9],z=t[10],N=t[11],B=t[12],q=t[13],W=t[14],Q=t[15],ut=n*v-a*y,rt=n*S-h*y,pt=n*T-g*y,ft=a*S-h*v,Et=a*T-g*v,Zt=h*T-g*S,ee=P*q-M*B,$t=P*W-z*B,jt=P*Q-N*B,Ft=M*W-z*q,Yt=M*Q-N*q,Bt=z*Q-N*W,Dt=ut*Bt-rt*Yt+pt*Ft+ft*jt-Et*$t+Zt*ee;return Dt?(r[0]=(v*Bt-S*Yt+T*Ft)*(Dt=1/Dt),r[1]=(h*Yt-a*Bt-g*Ft)*Dt,r[2]=(q*Zt-W*Et+Q*ft)*Dt,r[3]=(z*Et-M*Zt-N*ft)*Dt,r[4]=(S*jt-y*Bt-T*$t)*Dt,r[5]=(n*Bt-h*jt+g*$t)*Dt,r[6]=(W*pt-B*Zt-Q*rt)*Dt,r[7]=(P*Zt-z*pt+N*rt)*Dt,r[8]=(y*Yt-v*jt+T*ee)*Dt,r[9]=(a*jt-n*Yt-g*ee)*Dt,r[10]=(B*Et-q*pt+Q*ut)*Dt,r[11]=(M*pt-P*Et-N*ut)*Dt,r[12]=(v*$t-y*Ft-S*ee)*Dt,r[13]=(n*Ft-a*$t+h*ee)*Dt,r[14]=(q*rt-B*ft-W*ut)*Dt,r[15]=(P*ft-M*rt+z*ut)*Dt,r):null},l.at=Jd,l.au=Ud,l.av=Kd,l.aw=function(){let r={},t=_t.$version;for(let n in _t.$root){let a=_t.$root[n];if(a.required){let h=null;h=n==="version"?t:a.type==="array"?[]:{},h!=null&&(r[n]=h)}}return r},l.ax=Ze,l.ay=Ha,l.az=ln,l.b=function(r,t){let n=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(n).then(a=>{t(null,a)}).catch(a=>{t(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.b0=yn,l.b1=function(r,t){var n=r[0],a=r[1],h=r[2],g=r[3],y=r[4],v=r[5],S=r[6],T=r[7],P=r[8],M=r[9],z=r[10],N=r[11],B=r[12],q=r[13],W=r[14],Q=r[15],ut=t[0],rt=t[1],pt=t[2],ft=t[3],Et=t[4],Zt=t[5],ee=t[6],$t=t[7],jt=t[8],Ft=t[9],Yt=t[10],Bt=t[11],Dt=t[12],ue=t[13],ne=t[14],Me=t[15];return Math.abs(n-ut)<=si*Math.max(1,Math.abs(n),Math.abs(ut))&&Math.abs(a-rt)<=si*Math.max(1,Math.abs(a),Math.abs(rt))&&Math.abs(h-pt)<=si*Math.max(1,Math.abs(h),Math.abs(pt))&&Math.abs(g-ft)<=si*Math.max(1,Math.abs(g),Math.abs(ft))&&Math.abs(y-Et)<=si*Math.max(1,Math.abs(y),Math.abs(Et))&&Math.abs(v-Zt)<=si*Math.max(1,Math.abs(v),Math.abs(Zt))&&Math.abs(S-ee)<=si*Math.max(1,Math.abs(S),Math.abs(ee))&&Math.abs(T-$t)<=si*Math.max(1,Math.abs(T),Math.abs($t))&&Math.abs(P-jt)<=si*Math.max(1,Math.abs(P),Math.abs(jt))&&Math.abs(M-Ft)<=si*Math.max(1,Math.abs(M),Math.abs(Ft))&&Math.abs(z-Yt)<=si*Math.max(1,Math.abs(z),Math.abs(Yt))&&Math.abs(N-Bt)<=si*Math.max(1,Math.abs(N),Math.abs(Bt))&&Math.abs(B-Dt)<=si*Math.max(1,Math.abs(B),Math.abs(Dt))&&Math.abs(q-ue)<=si*Math.max(1,Math.abs(q),Math.abs(ue))&&Math.abs(W-ne)<=si*Math.max(1,Math.abs(W),Math.abs(ne))&&Math.abs(Q-Me)<=si*Math.max(1,Math.abs(Q),Math.abs(Me))},l.b2=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.b3=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},l.b4=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},l.b5=er,l.b6=Xg,l.b7=qg,l.b8=function(r,t,n,a,h){var g,y=1/Math.tan(t/2);return r[0]=y/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+a)*(g=1/(a-h)),r[14]=2*h*a*g):(r[10]=-1,r[14]=-2*a),r},l.b9=function(r,t,n){var a=Math.sin(n),h=Math.cos(n),g=t[4],y=t[5],v=t[6],S=t[7],T=t[8],P=t[9],M=t[10],z=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=g*h+T*a,r[5]=y*h+P*a,r[6]=v*h+M*a,r[7]=S*h+z*a,r[8]=T*h-g*a,r[9]=P*h-y*a,r[10]=M*h-v*a,r[11]=z*h-S*a,r},l.bA=et,l.bB=vg,l.bC=_l,l.bD=_i,l.ba=le,l.bb=Ue,l.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.bd=class extends Il{},l.be=Xd,l.bf=$g,l.bg=n1,l.bi=oo,l.bj=function(r,t,n=!1){if(ii===Lc||ii===Mc||ii===Dc)throw new Error("setRTLTextPlugin cannot be called multiple times.");ms=Ci.resolveURL(r),ii=Lc,kc=t,zc(),n||op()},l.bk=Rc,l.bl=function(r,t){let n={};for(let h=0;h<r.length;h++){let g=t&&t[r[h].id]||ua(r[h]);t&&(t[r[h].id]=g);let y=n[g];y||(y=n[g]=[]),y.push(r[h])}let a=[];for(let h in n)a.push(n[h]);return a},l.bm=Ht,l.bn=Yg,l.bo=Jg,l.bp=Pg,l.bq=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Xr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;let t=r.bucket.layers[0],n=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new yr(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new yr(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new yr(18))};if(r.bucket.textSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=r.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new yr(T),r.canonical),a["text-size"].possiblyEvaluate(new yr(P),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){let{minZoom:T,maxZoom:P}=r.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new yr(T),r.canonical),a["icon-size"].possiblyEvaluate(new yr(P),r.canonical)]}let g=n.get("text-line-height")*en,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),S=n.get("text-size");for(let T of r.bucket.features){let P=n.get("text-font").evaluate(T,{},r.canonical).join(","),M=S.evaluate(T,{},r.canonical),z=h.layoutTextSize.evaluate(T,{},r.canonical),N=h.layoutIconSize.evaluate(T,{},r.canonical),B={horizontal:{},vertical:void 0},q=T.text,W,Q=[0,0];if(q){let pt=q.toString(),ft=n.get("text-letter-spacing").evaluate(T,{},r.canonical)*en,Et=Ya(pt)?ft:0,Zt=n.get("text-anchor").evaluate(T,{},r.canonical),ee=uy(t,T,r.canonical);if(!ee){let Bt=n.get("text-radial-offset").evaluate(T,{},r.canonical);Q=Bt?ly(Zt,[Bt*en,Wd]):n.get("text-offset").evaluate(T,{},r.canonical).map(Dt=>Dt*en)}let $t=y?"center":n.get("text-justify").evaluate(T,{},r.canonical),jt=n.get("symbol-placement"),Ft=jt==="point"?n.get("text-max-width").evaluate(T,{},r.canonical)*en:0,Yt=()=>{r.bucket.allowVerticalPlacement&&Ql(pt)&&(B.vertical=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,"left",Et,Q,l.ai.vertical,!0,jt,z,M))};if(!y&&ee){let Bt=new Set;if($t==="auto")for(let ue=0;ue<ee.values.length;ue+=2)Bt.add(Jd(ee.values[ue]));else Bt.add($t);let Dt=!1;for(let ue of Bt)if(!B.horizontal[ue])if(Dt)B.horizontal[ue]=B.horizontal[0];else{let ne=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,"center",ue,Et,Q,l.ai.horizontal,!1,jt,z,M);ne&&(B.horizontal[ue]=ne,Dt=ne.positionedLines.length===1)}Yt()}else{$t==="auto"&&($t=Jd(Zt));let Bt=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,$t,Et,Q,l.ai.horizontal,!1,jt,z,M);Bt&&(B.horizontal[$t]=Bt),Yt(),Ql(pt)&&y&&v&&(B.vertical=wp(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,Ft,g,Zt,$t,Et,Q,l.ai.vertical,!1,jt,z,M))}}let ut=!1;if(T.icon&&T.icon.name){let pt=r.imageMap[T.icon.name];pt&&(W=Nx(r.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},r.canonical),n.get("icon-anchor").evaluate(T,{},r.canonical)),ut=!!pt.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ut:r.bucket.sdfIcons!==ut&&de("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}let rt=hy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!rt&&rt.iconsInText,(rt||W)&&e1(r.bucket,T,B,W,r.imageMap,h,z,N,Q,ut,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},l.br=Rd,l.bs=Dd,l.bt=zd,l.bu=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},l.bv=Fd,l.bw=Aa,l.bx=function(r,t,n,a,h){return V(this,void 0,void 0,function*(){if(se())try{return yield Ri(r,t,n,a,h)}catch{}return function(g,y,v,S,T){let P=g.width,M=g.height;Sn&&Ne||(Sn=new OffscreenCanvas(P,M),Ne=Sn.getContext("2d",{willReadFrequently:!0})),Sn.width=P,Sn.height=M,Ne.drawImage(g,0,0,P,M);let z=Ne.getImageData(y,v,S,T);return Ne.clearRect(0,0,P,M),z.data}(r,t,n,a,h)})},l.by=Hg,l.bz=R,l.c=Os,l.d=function(r,t){let n=new Image;n.onload=()=>{t(null,n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame(()=>{n.src=Qo})},n.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let a=new Blob([new Uint8Array(r)],{type:"image/png"});n.src=r.byteLength?URL.createObjectURL(a):Qo},l.e=Le,l.f=function(r,t){return Fo(Le(r,{type:"json"}),t)},l.g=Qe,l.h=Ci,l.i=Ar,l.j=No,l.k=Mo,l.l=ba,l.m=Fo,l.n=function(r){return new Fd(r).readFields(Dx,[])},l.o=function(r,t,n){if(!r.length)return n(null,[]);let a=r.length,h=new Array(r.length),g=null;r.forEach((y,v)=>{t(y,(S,T)=>{S&&(g=S),h[v]=T,--a==0&&n(g,h)})})},l.p=Cg,l.q=Hc,l.r=Ur,l.s=Oi,l.t=qn,l.u=Gt,l.v=_t,l.w=de,l.x=is,l.y=_o,l.z=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}}}),b(["./shared"],function(l){class V{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,O){for(let Y of k){this._layerConfigs[Y.id]=Y;let J=this._layers[Y.id]=l.aC(Y);J._featureFilter=l.a6(J.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(let Y of O)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};let j=l.bl(Object.values(this._layerConfigs),this.keyCache);for(let Y of j){let J=Y.map(wt=>this._layers[wt.id]),ht=J[0];if(ht.visibility==="none")continue;let nt=ht.source||"",tt=this.familiesBySource[nt];tt||(tt=this.familiesBySource[nt]={});let it=ht.sourceLayer||"_geojsonTileLayer",bt=tt[it];bt||(bt=tt[it]=[]),bt.push(J)}}}class R{constructor(k){let O={},j=[];for(let nt in k){let tt=k[nt],it=O[nt]={};for(let bt in tt){let wt=tt[+bt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;let Tt={x:0,y:0,w:wt.bitmap.width+2,h:wt.bitmap.height+2};j.push(Tt),it[bt]={rect:Tt,metrics:wt.metrics}}}let{w:Y,h:J}=l.p(j),ht=new l.q({width:Y||1,height:J||1});for(let nt in k){let tt=k[nt];for(let it in tt){let bt=tt[+it];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;let wt=O[nt][it].rect;l.q.copy(bt.bitmap,ht,{x:0,y:0},{x:wt.x+1,y:wt.y+1},bt.bitmap)}}this.image=ht,this.positions=O}}l.bm("GlyphAtlas",R);class et{constructor(k){this.tileID=new l.O(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(k,O,j,Y,J){this.status="parsing",this.data=k,this.collisionBoxArray=new l.a3;let ht=new l.bn(Object.keys(k.layers).sort()),nt=new l.bo(this.tileID,this.promoteId);nt.bucketLayerIDs=[];let tt={},it={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},bt=O.familiesBySource[this.source];for(let $e in bt){let Ge=k.layers[$e];if(!Ge)continue;Ge.version===1&&l.w(`Vector tile source "${this.source}" layer "${$e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let mn=ht.encode($e),hr=[];for(let Vr=0;Vr<Ge.length;Vr++){let Kr=Ge.feature(Vr),mi=nt.getId(Kr,$e);hr.push({feature:Kr,id:mi,index:Vr,sourceLayerIndex:mn})}for(let Vr of bt[$e]){let Kr=Vr[0];Kr.source!==this.source&&l.w(`layer.source = ${Kr.source} does not equal this.source = ${this.source}`),Kr.minzoom&&this.zoom<Math.floor(Kr.minzoom)||Kr.maxzoom&&this.zoom>=Kr.maxzoom||Kr.visibility!=="none"&&(at(Vr,this.zoom,j),(tt[Kr.id]=Kr.createBucket({index:nt.bucketLayerIDs.length,layers:Vr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mn,sourceID:this.source})).populate(hr,it,this.tileID.canonical),nt.bucketLayerIDs.push(Vr.map(mi=>mi.id)))}}let wt,Tt,oe,me,Kt=l.aH(it.glyphDependencies,$e=>Object.keys($e).map(Number));this.inFlightDependencies.forEach($e=>$e?.cancel()),this.inFlightDependencies=[];let ae=++this.dependencySentinel;Object.keys(Kt).length?this.inFlightDependencies.push(Y.send("getGlyphs",{uid:this.uid,stacks:Kt,source:this.source,tileID:this.tileID,type:"glyphs"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,Tt=Ge,qe.call(this)))})):Tt={};let xe=Object.keys(it.iconDependencies);xe.length?this.inFlightDependencies.push(Y.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"icons"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,oe=Ge,qe.call(this)))})):oe={};let We=Object.keys(it.patternDependencies);function qe(){if(wt)return J(wt);if(Tt&&oe&&me){let $e=new R(Tt),Ge=new l.bp(oe,me);for(let mn in tt){let hr=tt[mn];hr instanceof l.a4?(at(hr.layers,this.zoom,j),l.bq({bucket:hr,glyphMap:Tt,glyphPositions:$e.positions,imageMap:oe,imagePositions:Ge.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):hr.hasPattern&&(hr instanceof l.br||hr instanceof l.bs||hr instanceof l.bt)&&(at(hr.layers,this.zoom,j),hr.addFeatures(it,this.tileID.canonical,Ge.patternPositions))}this.status="done",J(null,{buckets:Object.values(tt).filter(mn=>!mn.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$e.image,imageAtlas:Ge,glyphMap:this.returnDependencies?Tt:null,iconMap:this.returnDependencies?oe:null,glyphPositions:this.returnDependencies?$e.positions:null})}}We.length?this.inFlightDependencies.push(Y.send("getImages",{icons:We,source:this.source,tileID:this.tileID,type:"patterns"},($e,Ge)=>{ae===this.dependencySentinel&&(wt||(wt=$e,me=Ge,qe.call(this)))})):me={},qe.call(this)}}function at(X,k,O){let j=new l.a8(k);for(let Y of X)Y.recalculate(j,O)}function st(X,k){let O=l.l(X.request,(j,Y,J,ht)=>{if(j)k(j);else if(Y)try{let nt=new l.bw.VectorTile(new l.bv(Y));k(null,{vectorTile:nt,rawData:Y,cacheControl:J,expires:ht})}catch(nt){let tt=new Uint8Array(Y),it=`Unable to parse the tile at ${X.request.url}, `;it+=tt[0]===31&&tt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${nt.messge}`,k(new Error(it))}});return()=>{O.cancel(),k()}}class yt{constructor(k,O,j,Y){this.actor=k,this.layerIndex=O,this.availableImages=j,this.loadVectorData=Y||st,this.fetching={},this.loading={},this.loaded={}}loadTile(k,O){let j=k.uid;this.loading||(this.loading={});let Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.bu(k.request),J=this.loading[j]=new et(k);J.abort=this.loadVectorData(k,(ht,nt)=>{if(delete this.loading[j],ht||!nt)return J.status="done",this.loaded[j]=J,O(ht);let tt=nt.rawData,it={};nt.expires&&(it.expires=nt.expires),nt.cacheControl&&(it.cacheControl=nt.cacheControl);let bt={};if(Y){let wt=Y.finish();wt&&(bt.resourceTiming=JSON.parse(JSON.stringify(wt)))}J.vectorTile=nt.vectorTile,J.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(wt,Tt)=>{if(delete this.fetching[j],wt||!Tt)return O(wt);O(null,l.e({rawTileData:tt.slice(0)},Tt,it,bt))}),this.loaded=this.loaded||{},this.loaded[j]=J,this.fetching[j]={rawTileData:tt,cacheControl:it,resourceTiming:bt}})}reloadTile(k,O){let j=this.loaded,Y=k.uid;if(j&&j[Y]){let J=j[Y];J.showCollisionBoxes=k.showCollisionBoxes,J.status==="parsing"?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(ht,nt)=>{if(ht||!nt)return O(ht,nt);let tt;if(this.fetching[Y]){let{rawTileData:it,cacheControl:bt,resourceTiming:wt}=this.fetching[Y];delete this.fetching[Y],tt=l.e({rawTileData:it.slice(0)},nt,bt,wt)}else tt=nt;O(null,tt)}):J.status==="done"&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,O):O())}}abortTile(k,O){let j=this.loading,Y=k.uid;j&&j[Y]&&j[Y].abort&&(j[Y].abort(),delete j[Y]),O()}removeTile(k,O){let j=this.loaded,Y=k.uid;j&&j[Y]&&delete j[Y],O()}}class xt{constructor(){this.loaded={}}loadTile(k,O){return l._(this,void 0,void 0,function*(){let{uid:j,encoding:Y,rawImageData:J,redFactor:ht,greenFactor:nt,blueFactor:tt,baseShift:it}=k,bt=J.width+2,wt=J.height+2,Tt=l.a(J)?new l.R({width:bt,height:wt},yield l.bx(J,-1,-1,bt,wt)):J,oe=new l.by(j,Tt,Y,ht,nt,tt,it);this.loaded=this.loaded||{},this.loaded[j]=oe,O(null,oe)})}removeTile(k){let O=this.loaded,j=k.uid;O&&O[j]&&delete O[j]}}function It(X,k){if(X.length!==0){Pt(X[0],k);for(var O=1;O<X.length;O++)Pt(X[O],!k)}}function Pt(X,k){for(var O=0,j=0,Y=0,J=X.length,ht=J-1;Y<J;ht=Y++){var nt=(X[Y][0]-X[ht][0])*(X[ht][1]+X[Y][1]),tt=O+nt;j+=Math.abs(O)>=Math.abs(nt)?O-tt+nt:nt-tt+O,O=tt}O+j>=0!=!!k&&X.reverse()}var qt=l.bz(function X(k,O){var j,Y=k&&k.type;if(Y==="FeatureCollection")for(j=0;j<k.features.length;j++)X(k.features[j],O);else if(Y==="GeometryCollection")for(j=0;j<k.geometries.length;j++)X(k.geometries[j],O);else if(Y==="Feature")X(k.geometry,O);else if(Y==="Polygon")It(k.coordinates,O);else if(Y==="MultiPolygon")for(j=0;j<k.coordinates.length;j++)It(k.coordinates[j],O);return k});let Qt=l.bw.VectorTileFeature.prototype.toGeoJSON;var se={exports:{}},le=l.bA,Ue=l.bw.VectorTileFeature,ke=er;function er(X,k){this.options=k||{},this.features=X,this.length=X.length}function Le(X,k){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=k||4096}er.prototype.feature=function(X){return new Le(this.features[X],this.options.extent)},Le.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var k=0;k<X.length;k++){for(var O=X[k],j=[],Y=0;Y<O.length;Y++)j.push(new le(O[Y][0],O[Y][1]));this.geometry.push(j)}return this.geometry},Le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,k=1/0,O=-1/0,j=1/0,Y=-1/0,J=0;J<X.length;J++)for(var ht=X[J],nt=0;nt<ht.length;nt++){var tt=ht[nt];k=Math.min(k,tt.x),O=Math.max(O,tt.x),j=Math.min(j,tt.y),Y=Math.max(Y,tt.y)}return[k,j,O,Y]},Le.prototype.toGeoJSON=Ue.prototype.toGeoJSON;var lr=l.bB,je=ke;function zr(X){var k=new lr;return function(O,j){for(var Y in O.layers)j.writeMessage(3,nr,O.layers[Y])}(X,k),k.finish()}function nr(X,k){var O;k.writeVarintField(15,X.version||1),k.writeStringField(1,X.name||""),k.writeVarintField(5,X.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<X.length;O++)j.feature=X.feature(O),k.writeMessage(2,fn,j);var Y=j.keys;for(O=0;O<Y.length;O++)k.writeStringField(3,Y[O]);var J=j.values;for(O=0;O<J.length;O++)k.writeMessage(4,xn,J[O])}function fn(X,k){var O=X.feature;O.id!==void 0&&k.writeVarintField(1,O.id),k.writeMessage(2,de,X),k.writeVarintField(3,O.type),k.writeMessage(4,Ar,O)}function de(X,k){var O=X.feature,j=X.keys,Y=X.values,J=X.keycache,ht=X.valuecache;for(var nt in O.properties){var tt=O.properties[nt],it=J[nt];if(tt!==null){it===void 0&&(j.push(nt),J[nt]=it=j.length-1),k.writeVarint(it);var bt=typeof tt;bt!=="string"&&bt!=="boolean"&&bt!=="number"&&(tt=JSON.stringify(tt));var wt=bt+":"+tt,Tt=ht[wt];Tt===void 0&&(Y.push(tt),ht[wt]=Tt=Y.length-1),k.writeVarint(Tt)}}}function Ke(X,k){return(k<<3)+(7&X)}function Er(X){return X<<1^X>>31}function Ar(X,k){for(var O=X.loadGeometry(),j=X.type,Y=0,J=0,ht=O.length,nt=0;nt<ht;nt++){var tt=O[nt],it=1;j===1&&(it=tt.length),k.writeVarint(Ke(1,it));for(var bt=j===3?tt.length-1:tt.length,wt=0;wt<bt;wt++){wt===1&&j!==1&&k.writeVarint(Ke(2,bt-1));var Tt=tt[wt].x-Y,oe=tt[wt].y-J;k.writeVarint(Er(Tt)),k.writeVarint(Er(oe)),Y+=Tt,J+=oe}j===3&&k.writeVarint(Ke(7,1))}}function xn(X,k){var O=typeof X;O==="string"?k.writeStringField(1,X):O==="boolean"?k.writeBooleanField(7,X):O==="number"&&(X%1!=0?k.writeDoubleField(3,X):X<0?k.writeSVarintField(6,X):k.writeVarintField(5,X))}se.exports=zr,se.exports.fromVectorTileJs=zr,se.exports.fromGeojsonVt=function(X,k){k=k||{};var O={};for(var j in X)O[j]=new je(X[j].features,k),O[j].name=j,O[j].version=k.version,O[j].extent=k.extent;return zr({layers:O})},se.exports.GeoJSONWrapper=je;var pi=l.bz(se.exports);let Qo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},Ri=Math.fround||(Sn=new Float32Array(1),X=>(Sn[0]=+X,Sn[0]));var Sn;let Ne=3,qr=5,zn=6;class Ci{constructor(k){this.options=Object.assign(Object.create(Qo),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){let{log:O,minZoom:j,maxZoom:Y}=this.options;O&&console.time("total time");let J=`prepare ${k.length} points`;O&&console.time(J),this.points=k;let ht=[];for(let tt=0;tt<k.length;tt++){let it=k[tt];if(!it.geometry)continue;let[bt,wt]=it.geometry.coordinates,Tt=Ri(ln(bt)),oe=Ri(Qe(wt));ht.push(Tt,oe,1/0,tt,-1,1),this.options.reduce&&ht.push(0)}let nt=this.trees[Y+1]=this._createTree(ht);O&&console.timeEnd(J);for(let tt=Y;tt>=j;tt--){let it=+Date.now();nt=this.trees[tt]=this._createTree(this._cluster(nt,tt)),O&&console.log("z%d: %d clusters in %dms",tt,nt.numItems,+Date.now()-it)}return O&&console.timeEnd("total time"),this}getClusters(k,O){let j=((k[0]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,k[1])),J=k[2]===180?180:((k[2]+180)%360+360)%360-180,ht=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)j=-180,J=180;else if(j>J){let wt=this.getClusters([j,Y,180,ht],O),Tt=this.getClusters([-180,Y,J,ht],O);return wt.concat(Tt)}let nt=this.trees[this._limitZoom(O)],tt=nt.range(ln(j),Qe(ht),ln(J),Qe(Y)),it=nt.data,bt=[];for(let wt of tt){let Tt=this.stride*wt;bt.push(it[Tt+qr]>1?Os(it,Tt,this.clusterProps):this.points[it[Tt+Ne]])}return bt}getChildren(k){let O=this._getOriginId(k),j=this._getOriginZoom(k),Y="No cluster with the specified id.",J=this.trees[j];if(!J)throw new Error(Y);let ht=J.data;if(O*this.stride>=ht.length)throw new Error(Y);let nt=this.options.radius/(this.options.extent*Math.pow(2,j-1)),tt=J.within(ht[O*this.stride],ht[O*this.stride+1],nt),it=[];for(let bt of tt){let wt=bt*this.stride;ht[wt+4]===k&&it.push(ht[wt+qr]>1?Os(ht,wt,this.clusterProps):this.points[ht[wt+Ne]])}if(it.length===0)throw new Error(Y);return it}getLeaves(k,O,j){let Y=[];return this._appendLeaves(Y,k,O=O||10,j=j||0,0),Y}getTile(k,O,j){let Y=this.trees[this._limitZoom(k)],J=Math.pow(2,k),{extent:ht,radius:nt}=this.options,tt=nt/ht,it=(j-tt)/J,bt=(j+1+tt)/J,wt={features:[]};return this._addTileFeatures(Y.range((O-tt)/J,it,(O+1+tt)/J,bt),Y.data,O,j,J,wt),O===0&&this._addTileFeatures(Y.range(1-tt/J,it,1,bt),Y.data,J,j,J,wt),O===J-1&&this._addTileFeatures(Y.range(0,it,tt/J,bt),Y.data,-1,j,J,wt),wt.features.length?wt:null}getClusterExpansionZoom(k){let O=this._getOriginZoom(k)-1;for(;O<=this.options.maxZoom;){let j=this.getChildren(k);if(O++,j.length!==1)break;k=j[0].properties.cluster_id}return O}_appendLeaves(k,O,j,Y,J){let ht=this.getChildren(O);for(let nt of ht){let tt=nt.properties;if(tt&&tt.cluster?J+tt.point_count<=Y?J+=tt.point_count:J=this._appendLeaves(k,tt.cluster_id,j,Y,J):J<Y?J++:k.push(nt),k.length===j)break}return J}_createTree(k){let O=new l.av(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<k.length;j+=this.stride)O.add(k[j],k[j+1]);return O.finish(),O.data=k,O}_addTileFeatures(k,O,j,Y,J,ht){for(let nt of k){let tt=nt*this.stride,it=O[tt+qr]>1,bt,wt,Tt;if(it)bt=oo(O,tt,this.clusterProps),wt=O[tt],Tt=O[tt+1];else{let Kt=this.points[O[tt+Ne]];bt=Kt.properties;let[ae,xe]=Kt.geometry.coordinates;wt=ln(ae),Tt=Qe(xe)}let oe={type:1,geometry:[[Math.round(this.options.extent*(wt*J-j)),Math.round(this.options.extent*(Tt*J-Y))]],tags:bt},me;me=it||this.options.generateId?O[tt+Ne]:this.points[O[tt+Ne]].id,me!==void 0&&(oe.id=me),ht.features.push(oe)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,O){let{radius:j,extent:Y,reduce:J,minPoints:ht}=this.options,nt=j/(Y*Math.pow(2,O)),tt=k.data,it=[],bt=this.stride;for(let wt=0;wt<tt.length;wt+=bt){if(tt[wt+2]<=O)continue;tt[wt+2]=O;let Tt=tt[wt],oe=tt[wt+1],me=k.within(tt[wt],tt[wt+1],nt),Kt=tt[wt+qr],ae=Kt;for(let xe of me){let We=xe*bt;tt[We+2]>O&&(ae+=tt[We+qr])}if(ae>Kt&&ae>=ht){let xe,We=Tt*Kt,qe=oe*Kt,$e=-1,Ge=((wt/bt|0)<<5)+(O+1)+this.points.length;for(let mn of me){let hr=mn*bt;if(tt[hr+2]<=O)continue;tt[hr+2]=O;let Vr=tt[hr+qr];We+=tt[hr]*Vr,qe+=tt[hr+1]*Vr,tt[hr+4]=Ge,J&&(xe||(xe=this._map(tt,wt,!0),$e=this.clusterProps.length,this.clusterProps.push(xe)),J(xe,this._map(tt,hr)))}tt[wt+4]=Ge,it.push(We/ae,qe/ae,1/0,Ge,-1,ae),J&&it.push($e)}else{for(let xe=0;xe<bt;xe++)it.push(tt[wt+xe]);if(ae>1)for(let xe of me){let We=xe*bt;if(!(tt[We+2]<=O)){tt[We+2]=O;for(let qe=0;qe<bt;qe++)it.push(tt[We+qe])}}}}return it}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,O,j){if(k[O+qr]>1){let ht=this.clusterProps[k[O+zn]];return j?Object.assign({},ht):ht}let Y=this.points[k[O+Ne]].properties,J=this.options.map(Y);return j&&J===Y?Object.assign({},J):J}}function Os(X,k,O){return{type:"Feature",id:X[k+Ne],properties:oo(X,k,O),geometry:{type:"Point",coordinates:[(j=X[k],360*(j-.5)),na(X[k+1])]}};var j}function oo(X,k,O){let j=X[k+qr],Y=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,J=X[k+zn],ht=J===-1?{}:Object.assign({},O[J]);return Object.assign(ht,{cluster:!0,cluster_id:X[k+Ne],point_count:j,point_count_abbreviated:Y})}function ln(X){return X/360+.5}function Qe(X){let k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function na(X){let k=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function Fo(X,k,O,j){for(var Y,J=j,ht=O-k>>1,nt=O-k,tt=X[k],it=X[k+1],bt=X[O],wt=X[O+1],Tt=k+3;Tt<O;Tt+=3){var oe=ba(X[Tt],X[Tt+1],tt,it,bt,wt);if(oe>J)Y=Tt,J=oe;else if(oe===J){var me=Math.abs(Tt-ht);me<nt&&(Y=Tt,nt=me)}}J>j&&(Y-k>3&&Fo(X,k,Y,j),X[Y+2]=J,O-Y>3&&Fo(X,Y,O,j))}function ba(X,k,O,j,Y,J){var ht=Y-O,nt=J-j;if(ht!==0||nt!==0){var tt=((X-O)*ht+(k-j)*nt)/(ht*ht+nt*nt);tt>1?(O=Y,j=J):tt>0&&(O+=ht*tt,j+=nt*tt)}return(ht=X-O)*ht+(nt=k-j)*nt}function Oi(X,k,O,j){var Y={id:X===void 0?null:X,type:k,geometry:O,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var ht=J.geometry,nt=J.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Fs(J,ht);else if(nt==="Polygon"||nt==="MultiLineString")for(var tt=0;tt<ht.length;tt++)Fs(J,ht[tt]);else if(nt==="MultiPolygon")for(tt=0;tt<ht.length;tt++)for(var it=0;it<ht[tt].length;it++)Fs(J,ht[tt][it])}(Y),Y}function Fs(X,k){for(var O=0;O<k.length;O+=3)X.minX=Math.min(X.minX,k[O]),X.minY=Math.min(X.minY,k[O+1]),X.maxX=Math.max(X.maxX,k[O]),X.maxY=Math.max(X.maxY,k[O+1])}function Zr(X,k,O,j){if(k.geometry){var Y=k.geometry.coordinates,J=k.geometry.type,ht=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),nt=[],tt=k.id;if(O.promoteId?tt=k.properties[O.promoteId]:O.generateId&&(tt=j||0),J==="Point")Mo(Y,nt);else if(J==="MultiPoint")for(var it=0;it<Y.length;it++)Mo(Y[it],nt);else if(J==="LineString")No(Y,nt,ht,!1);else if(J==="MultiLineString"){if(O.lineMetrics){for(it=0;it<Y.length;it++)No(Y[it],nt=[],ht,!1),X.push(Oi(tt,"LineString",nt,k.properties));return}ls(Y,nt,ht,!1)}else if(J==="Polygon")ls(Y,nt,ht,!0);else{if(J!=="MultiPolygon"){if(J==="GeometryCollection"){for(it=0;it<k.geometry.geometries.length;it++)Zr(X,{id:tt,geometry:k.geometry.geometries[it],properties:k.properties},O,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<Y.length;it++){var bt=[];ls(Y[it],bt,ht,!0),nt.push(bt)}}X.push(Oi(tt,J,nt,k.properties))}}function Mo(X,k){k.push(_t(X[0])),k.push(Vn(X[1])),k.push(0)}function No(X,k,O,j){for(var Y,J,ht=0,nt=0;nt<X.length;nt++){var tt=_t(X[nt][0]),it=Vn(X[nt][1]);k.push(tt),k.push(it),k.push(0),nt>0&&(ht+=j?(Y*it-tt*J)/2:Math.sqrt(Math.pow(tt-Y,2)+Math.pow(it-J,2))),Y=tt,J=it}var bt=k.length-3;k[2]=1,Fo(k,0,bt,O),k[bt+2]=1,k.size=Math.abs(ht),k.start=0,k.end=k.size}function ls(X,k,O,j){for(var Y=0;Y<X.length;Y++){var J=[];No(X[Y],J,O,j),k.push(J)}}function _t(X){return X/360+.5}function Vn(X){var k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function fi(X,k,O,j,Y,J,ht,nt){if(j/=k,J>=(O/=k)&&ht<j)return X;if(ht<O||J>=j)return null;for(var tt=[],it=0;it<X.length;it++){var bt=X[it],wt=bt.geometry,Tt=bt.type,oe=Y===0?bt.minX:bt.minY,me=Y===0?bt.maxX:bt.maxY;if(oe>=O&&me<j)tt.push(bt);else if(!(me<O||oe>=j)){var Kt=[];if(Tt==="Point"||Tt==="MultiPoint")ar(wt,Kt,O,j,Y);else if(Tt==="LineString")Ze(wt,Kt,O,j,Y,!1,nt.lineMetrics);else if(Tt==="MultiLineString")ho(wt,Kt,O,j,Y,!1);else if(Tt==="Polygon")ho(wt,Kt,O,j,Y,!0);else if(Tt==="MultiPolygon")for(var ae=0;ae<wt.length;ae++){var xe=[];ho(wt[ae],xe,O,j,Y,!0),xe.length&&Kt.push(xe)}if(Kt.length){if(nt.lineMetrics&&Tt==="LineString"){for(ae=0;ae<Kt.length;ae++)tt.push(Oi(bt.id,Tt,Kt[ae],bt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Kt.length===1?(Tt="LineString",Kt=Kt[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Kt.length===3?"Point":"MultiPoint"),tt.push(Oi(bt.id,Tt,Kt,bt.tags))}}}return tt.length?tt:null}function ar(X,k,O,j,Y){for(var J=0;J<X.length;J+=3){var ht=X[J+Y];ht>=O&&ht<=j&&(k.push(X[J]),k.push(X[J+1]),k.push(X[J+2]))}}function Ze(X,k,O,j,Y,J,ht){for(var nt,tt,it=ji(X),bt=Y===0?ia:us,wt=X.start,Tt=0;Tt<X.length-3;Tt+=3){var oe=X[Tt],me=X[Tt+1],Kt=X[Tt+2],ae=X[Tt+3],xe=X[Tt+4],We=Y===0?oe:me,qe=Y===0?ae:xe,$e=!1;ht&&(nt=Math.sqrt(Math.pow(oe-ae,2)+Math.pow(me-xe,2))),We<O?qe>O&&(tt=bt(it,oe,me,ae,xe,O),ht&&(it.start=wt+nt*tt)):We>j?qe<j&&(tt=bt(it,oe,me,ae,xe,j),ht&&(it.start=wt+nt*tt)):Zi(it,oe,me,Kt),qe<O&&We>=O&&(tt=bt(it,oe,me,ae,xe,O),$e=!0),qe>j&&We<=j&&(tt=bt(it,oe,me,ae,xe,j),$e=!0),!J&&$e&&(ht&&(it.end=wt+nt*tt),k.push(it),it=ji(X)),ht&&(wt+=nt)}var Ge=X.length-3;oe=X[Ge],me=X[Ge+1],Kt=X[Ge+2],(We=Y===0?oe:me)>=O&&We<=j&&Zi(it,oe,me,Kt),Ge=it.length-3,J&&Ge>=3&&(it[Ge]!==it[0]||it[Ge+1]!==it[1])&&Zi(it,it[0],it[1],it[2]),it.length&&k.push(it)}function ji(X){var k=[];return k.size=X.size,k.start=X.start,k.end=X.end,k}function ho(X,k,O,j,Y,J){for(var ht=0;ht<X.length;ht++)Ze(X[ht],k,O,j,Y,J,!1)}function Zi(X,k,O,j){X.push(k),X.push(O),X.push(j)}function ia(X,k,O,j,Y,J){var ht=(J-k)/(j-k);return X.push(J),X.push(O+(Y-O)*ht),X.push(1),ht}function us(X,k,O,j,Y,J){var ht=(J-O)/(Y-O);return X.push(k+(j-k)*ht),X.push(J),X.push(1),ht}function Xi(X,k){for(var O=[],j=0;j<X.length;j++){var Y,J=X[j],ht=J.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")Y=Do(J.geometry,k);else if(ht==="MultiLineString"||ht==="Polygon"){Y=[];for(var nt=0;nt<J.geometry.length;nt++)Y.push(Do(J.geometry[nt],k))}else if(ht==="MultiPolygon")for(Y=[],nt=0;nt<J.geometry.length;nt++){for(var tt=[],it=0;it<J.geometry[nt].length;it++)tt.push(Do(J.geometry[nt][it],k));Y.push(tt)}O.push(Oi(J.id,ht,Y,J.tags))}return O}function Do(X,k){var O=[];O.size=X.size,X.start!==void 0&&(O.start=X.start,O.end=X.end);for(var j=0;j<X.length;j+=3)O.push(X[j]+k,X[j+1],X[j+2]);return O}function Ot(X,k){if(X.transformed)return X;var O,j,Y,J=1<<X.z,ht=X.x,nt=X.y;for(O=0;O<X.features.length;O++){var tt=X.features[O],it=tt.geometry,bt=tt.type;if(tt.geometry=[],bt===1)for(j=0;j<it.length;j+=2)tt.geometry.push(Pi(it[j],it[j+1],k,J,ht,nt));else for(j=0;j<it.length;j++){var wt=[];for(Y=0;Y<it[j].length;Y+=2)wt.push(Pi(it[j][Y],it[j][Y+1],k,J,ht,nt));tt.geometry.push(wt)}}return X.transformed=!0,X}function Pi(X,k,O,j,Y,J){return[Math.round(O*(X*j-Y)),Math.round(O*(k*j-J))]}function Cr(X,k,O,j,Y){for(var J=k===Y.maxZoom?0:Y.tolerance/((1<<k)*Y.extent),ht={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:j,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},nt=0;nt<X.length;nt++){ht.numFeatures++,cs(ht,X[nt],J,Y);var tt=X[nt].minX,it=X[nt].minY,bt=X[nt].maxX,wt=X[nt].maxY;tt<ht.minX&&(ht.minX=tt),it<ht.minY&&(ht.minY=it),bt>ht.maxX&&(ht.maxX=bt),wt>ht.maxY&&(ht.maxY=wt)}return ht}function cs(X,k,O,j){var Y=k.geometry,J=k.type,ht=[];if(J==="Point"||J==="MultiPoint")for(var nt=0;nt<Y.length;nt+=3)ht.push(Y[nt]),ht.push(Y[nt+1]),X.numPoints++,X.numSimplified++;else if(J==="LineString")Ai(ht,Y,X,O,!1,!1);else if(J==="MultiLineString"||J==="Polygon")for(nt=0;nt<Y.length;nt++)Ai(ht,Y[nt],X,O,J==="Polygon",nt===0);else if(J==="MultiPolygon")for(var tt=0;tt<Y.length;tt++){var it=Y[tt];for(nt=0;nt<it.length;nt++)Ai(ht,it[nt],X,O,!0,nt===0)}if(ht.length){var bt=k.tags||null;if(J==="LineString"&&j.lineMetrics){for(var wt in bt={},k.tags)bt[wt]=k.tags[wt];bt.mapbox_clip_start=Y.start/Y.size,bt.mapbox_clip_end=Y.end/Y.size}var Tt={geometry:ht,type:J==="Polygon"||J==="MultiPolygon"?3:J==="LineString"||J==="MultiLineString"?2:1,tags:bt};k.id!==null&&(Tt.id=k.id),X.features.push(Tt)}}function Ai(X,k,O,j,Y,J){var ht=j*j;if(j>0&&k.size<(Y?ht:j))O.numPoints+=k.length/3;else{for(var nt=[],tt=0;tt<k.length;tt+=3)(j===0||k[tt+2]>ht)&&(O.numSimplified++,nt.push(k[tt]),nt.push(k[tt+1])),O.numPoints++;Y&&function(it,bt){for(var wt=0,Tt=0,oe=it.length,me=oe-2;Tt<oe;me=Tt,Tt+=2)wt+=(it[Tt]-it[me])*(it[Tt+1]+it[me+1]);if(wt>0===bt)for(Tt=0,oe=it.length;Tt<oe/2;Tt+=2){var Kt=it[Tt],ae=it[Tt+1];it[Tt]=it[oe-2-Tt],it[Tt+1]=it[oe-1-Tt],it[oe-2-Tt]=Kt,it[oe-1-Tt]=ae}}(nt,J),X.push(nt)}}function Nt(X,k){var O=(k=this.options=function(Y,J){for(var ht in J)Y[ht]=J[ht];return Y}(Object.create(this.options),k)).debug;if(O&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(Y,J){var ht=[];if(Y.type==="FeatureCollection")for(var nt=0;nt<Y.features.length;nt++)Zr(ht,Y.features[nt],J,nt);else Zr(ht,Y.type==="Feature"?Y:{geometry:Y},J);return ht}(X,k);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(Y,J){var ht=J.buffer/J.extent,nt=Y,tt=fi(Y,1,-1-ht,ht,0,-1,2,J),it=fi(Y,1,1-ht,2+ht,0,-1,2,J);return(tt||it)&&(nt=fi(Y,1,-ht,1+ht,0,-1,2,J)||[],tt&&(nt=Xi(tt,1).concat(nt)),it&&(nt=nt.concat(Xi(it,-1)))),nt}(j,k),j.length&&this.splitTile(j,0,0,0),O&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Se(X,k,O){return 32*((1<<X)*O+k)+X}function ge(X,k){return k?X.properties[k]:X.id}function bn(X,k){if(X==null)return!0;if(X.type==="Feature")return ge(X,k)!=null;if(X.type==="FeatureCollection"){let O=new Set;for(let j of X.features){let Y=ge(j,k);if(Y==null||O.has(Y))return!1;O.add(Y)}return!0}return!1}function Li(X,k){let O=new Map;if(X!=null)if(X.type==="Feature")O.set(ge(X,k),X);else for(let j of X.features)O.set(ge(j,k),j);return O}Nt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nt.prototype.splitTile=function(X,k,O,j,Y,J,ht){for(var nt=[X,k,O,j],tt=this.options,it=tt.debug;nt.length;){j=nt.pop(),O=nt.pop(),k=nt.pop(),X=nt.pop();var bt=1<<k,wt=Se(k,O,j),Tt=this.tiles[wt];if(!Tt&&(it>1&&console.time("creation"),Tt=this.tiles[wt]=Cr(X,k,O,j,tt),this.tileCoords.push({z:k,x:O,y:j}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,O,j,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var oe="z"+k;this.stats[oe]=(this.stats[oe]||0)+1,this.total++}if(Tt.source=X,Y){if(k===tt.maxZoom||k===Y)continue;var me=1<<Y-k;if(O!==Math.floor(J/me)||j!==Math.floor(ht/me))continue}else if(k===tt.indexMaxZoom||Tt.numPoints<=tt.indexMaxPoints)continue;if(Tt.source=null,X.length!==0){it>1&&console.time("clipping");var Kt,ae,xe,We,qe,$e,Ge=.5*tt.buffer/tt.extent,mn=.5-Ge,hr=.5+Ge,Vr=1+Ge;Kt=ae=xe=We=null,qe=fi(X,bt,O-Ge,O+hr,0,Tt.minX,Tt.maxX,tt),$e=fi(X,bt,O+mn,O+Vr,0,Tt.minX,Tt.maxX,tt),X=null,qe&&(Kt=fi(qe,bt,j-Ge,j+hr,1,Tt.minY,Tt.maxY,tt),ae=fi(qe,bt,j+mn,j+Vr,1,Tt.minY,Tt.maxY,tt),qe=null),$e&&(xe=fi($e,bt,j-Ge,j+hr,1,Tt.minY,Tt.maxY,tt),We=fi($e,bt,j+mn,j+Vr,1,Tt.minY,Tt.maxY,tt),$e=null),it>1&&console.timeEnd("clipping"),nt.push(Kt||[],k+1,2*O,2*j),nt.push(ae||[],k+1,2*O,2*j+1),nt.push(xe||[],k+1,2*O+1,2*j),nt.push(We||[],k+1,2*O+1,2*j+1)}}},Nt.prototype.getTile=function(X,k,O){var j=this.options,Y=j.extent,J=j.debug;if(X<0||X>24)return null;var ht=1<<X,nt=Se(X,k=(k%ht+ht)%ht,O);if(this.tiles[nt])return Ot(this.tiles[nt],Y);J>1&&console.log("drilling down to z%d-%d-%d",X,k,O);for(var tt,it=X,bt=k,wt=O;!tt&&it>0;)it--,bt=Math.floor(bt/2),wt=Math.floor(wt/2),tt=this.tiles[Se(it,bt,wt)];return tt&&tt.source?(J>1&&console.log("found parent tile z%d-%d-%d",it,bt,wt),J>1&&console.time("drilling down"),this.splitTile(tt.source,it,bt,wt,X,k,O),J>1&&console.timeEnd("drilling down"),this.tiles[nt]?Ot(this.tiles[nt],Y):null):null};class ye extends yt{constructor(k,O,j,Y){super(k,O,j),this._dataUpdateable=new Map,this.loadGeoJSON=(J,ht)=>{let{promoteId:nt}=J;if(J.request)return l.f(J.request,(tt,it,bt,wt)=>{this._dataUpdateable=bn(it,nt)?Li(it,nt):void 0,ht(tt,it,bt,wt)});if(typeof J.data=="string")try{let tt=JSON.parse(J.data);this._dataUpdateable=bn(tt,nt)?Li(tt,nt):void 0,ht(null,tt)}catch{ht(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}else J.dataDiff?this._dataUpdateable?(function(tt,it,bt){var wt,Tt,oe,me;if(it.removeAll&&tt.clear(),it.remove)for(let Kt of it.remove)tt.delete(Kt);if(it.add)for(let Kt of it.add){let ae=ge(Kt,bt);ae!=null&&tt.set(ae,Kt)}if(it.update)for(let Kt of it.update){let ae=tt.get(Kt.id);if(ae==null)continue;let xe=!Kt.removeAllProperties&&(((wt=Kt.removeProperties)===null||wt===void 0?void 0:wt.length)>0||((Tt=Kt.addOrUpdateProperties)===null||Tt===void 0?void 0:Tt.length)>0);if((Kt.newGeometry||Kt.removeAllProperties||xe)&&(ae=Object.assign({},ae),tt.set(Kt.id,ae),xe&&(ae.properties=Object.assign({},ae.properties))),Kt.newGeometry&&(ae.geometry=Kt.newGeometry),Kt.removeAllProperties)ae.properties={};else if(((oe=Kt.removeProperties)===null||oe===void 0?void 0:oe.length)>0)for(let We of Kt.removeProperties)Object.prototype.hasOwnProperty.call(ae.properties,We)&&delete ae.properties[We];if(((me=Kt.addOrUpdateProperties)===null||me===void 0?void 0:me.length)>0)for(let{key:We,value:qe}of Kt.addOrUpdateProperties)ae.properties[We]=qe}}(this._dataUpdateable,J.dataDiff,nt),ht(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ht(new Error(`Cannot update existing geojson data in ${J.source}`)):ht(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Y&&(this.loadGeoJSON=Y)}loadGeoJSONTile(k,O){let j=k.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);let Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return O(null,null);let J=new class{constructor(nt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.N,this.length=nt.length,this._features=nt}feature(nt){return new class{constructor(tt){this._feature=tt,this.extent=l.N,this.type=tt.type,this.properties=tt.tags,"id"in tt&&!isNaN(tt.id)&&(this.id=parseInt(tt.id,10))}loadGeometry(){if(this._feature.type===1){let tt=[];for(let it of this._feature.geometry)tt.push([new l.P(it[0],it[1])]);return tt}{let tt=[];for(let it of this._feature.geometry){let bt=[];for(let wt of it)bt.push(new l.P(wt[0],wt[1]));tt.push(bt)}return tt}}toGeoJSON(tt,it,bt){return Qt.call(this,tt,it,bt)}}(this._features[nt])}}(Y.features),ht=pi(J);ht.byteOffset===0&&ht.byteLength===ht.buffer.byteLength||(ht=new Uint8Array(ht)),O(null,{vectorTile:J,rawData:ht.buffer})}loadData(k,O){var j;(j=this._pendingRequest)===null||j===void 0||j.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});let Y=!!(k&&k.request&&k.request.collectResourceTiming)&&new l.bu(k.request);this._pendingCallback=O,this._pendingRequest=this.loadGeoJSON(k,(J,ht)=>{if(delete this._pendingCallback,delete this._pendingRequest,J||!ht)return O(J);if(typeof ht!="object")return O(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{qt(ht,!0);try{if(k.filter){let tt=l.bC(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(tt.result==="error")throw new Error(tt.value.map(it=>`${it.key}: ${it.message}`).join(", "));ht={type:"FeatureCollection",features:ht.features.filter(it=>tt.value.evaluate({zoom:0},it))}}this._geoJSONIndex=k.cluster?new Ci(function({superclusterOptions:tt,clusterProperties:it}){if(!it||!tt)return tt;let bt={},wt={},Tt={accumulated:null,zoom:0},oe={properties:null},me=Object.keys(it);for(let Kt of me){let[ae,xe]=it[Kt],We=l.bC(xe),qe=l.bC(typeof ae=="string"?[ae,["accumulated"],["get",Kt]]:ae);bt[Kt]=We.value,wt[Kt]=qe.value}return tt.map=Kt=>{oe.properties=Kt;let ae={};for(let xe of me)ae[xe]=bt[xe].evaluate(Tt,oe);return ae},tt.reduce=(Kt,ae)=>{oe.properties=ae;for(let xe of me)Tt.accumulated=Kt[xe],Kt[xe]=wt[xe].evaluate(Tt,oe)},tt}(k)).load(ht.features):function(tt,it){return new Nt(tt,it)}(ht,k.geojsonVtOptions)}catch(tt){return O(tt)}this.loaded={};let nt={};if(Y){let tt=Y.finish();tt&&(nt.resourceTiming={},nt.resourceTiming[k.source]=JSON.parse(JSON.stringify(tt)))}O(null,nt)}})}reloadTile(k,O){let j=this.loaded;return j&&j[k.uid]?super.reloadTile(k,O):this.loadTile(k,O)}removeSource(k,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(k,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(j){O(j)}}getClusterChildren(k,O){try{O(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(j){O(j)}}getClusterLeaves(k,O){try{O(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(j){O(j)}}}class Gi{constructor(k){this.self=k,this.actor=new l.C(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:yt,geojson:ye},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,j)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=j},this.self.registerRTLTextPlugin=O=>{if(l.bD.isParsed())throw new Error("RTL text plugin already registered.");l.bD.applyArabicShaping=O.applyArabicShaping,l.bD.processBidirectionalText=O.processBidirectionalText,l.bD.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(k,O){this.referrer=O}setImages(k,O,j){this.availableImages[k]=O;for(let Y in this.workerSources[k]){let J=this.workerSources[k][Y];for(let ht in J)J[ht].availableImages=O}j()}setLayers(k,O,j){this.getLayerIndex(k).replace(O),j()}updateLayers(k,O,j){this.getLayerIndex(k).update(O.layers,O.removedIds),j()}loadTile(k,O,j){this.getWorkerSource(k,O.type,O.source).loadTile(O,j)}loadDEMTile(k,O,j){this.getDEMWorkerSource(k,O.source).loadTile(O,j)}reloadTile(k,O,j){this.getWorkerSource(k,O.type,O.source).reloadTile(O,j)}abortTile(k,O,j){this.getWorkerSource(k,O.type,O.source).abortTile(O,j)}removeTile(k,O,j){this.getWorkerSource(k,O.type,O.source).removeTile(O,j)}removeDEMTile(k,O){this.getDEMWorkerSource(k,O.source).removeTile(O)}removeSource(k,O,j){if(!this.workerSources[k]||!this.workerSources[k][O.type]||!this.workerSources[k][O.type][O.source])return;let Y=this.workerSources[k][O.type][O.source];delete this.workerSources[k][O.type][O.source],Y.removeSource!==void 0?Y.removeSource(O,j):j()}loadWorkerSource(k,O,j){try{this.self.importScripts(O.url),j()}catch(Y){j(Y.toString())}}syncRTLPluginState(k,O,j){try{l.bD.setState(O);let Y=l.bD.getPluginURL();if(l.bD.isLoaded()&&!l.bD.isParsed()&&Y!=null){this.self.importScripts(Y);let J=l.bD.isParsed();j(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),J)}}catch(Y){j(Y.toString())}}getAvailableImages(k){let O=this.availableImages[k];return O||(O=[]),O}getLayerIndex(k){let O=this.layerIndexes[k];return O||(O=this.layerIndexes[k]=new V),O}getWorkerSource(k,O,j){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][O]||(this.workerSources[k][O]={}),this.workerSources[k][O][j]||(this.workerSources[k][O][j]=new this.workerSourceTypes[O]({send:(Y,J,ht)=>{this.actor.send(Y,J,ht,k)}},this.getLayerIndex(k),this.getAvailableImages(k))),this.workerSources[k][O][j]}getDEMWorkerSource(k,O){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][O]||(this.demWorkerSources[k][O]=new xt),this.demWorkerSources[k][O]}}return l.i()&&(self.worker=new Gi(self)),Gi}),b(["./shared"],function(l){var V="3.6.2";class R{static testProp(e){if(!R.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in R.docStyle)return e[o];return e[0]}static create(e,o,c){let p=window.document.createElement(e);return o!==void 0&&(p.className=o),c&&c.appendChild(p),p}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(e,o){e.style[R.transformProp]=o}static addEventListener(e,o,c,p={}){e.addEventListener(o,c,"passive"in p?p:p.capture)}static removeEventListener(e,o,c,p={}){e.removeEventListener(o,c,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static mousePos(e,o){let c=e.getBoundingClientRect();return new l.P(o.clientX-c.left-e.clientLeft,o.clientY-c.top-e.clientTop)}static touchPos(e,o){let c=e.getBoundingClientRect(),p=[];for(let m=0;m<o.length;m++)p.push(new l.P(o[m].clientX-c.left-e.clientLeft,o[m].clientY-c.top-e.clientTop));return p}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);let et={supported:!1,testSupport:function(f){!yt&&st&&(xt?It(f):at=f)}},at,st,yt=!1,xt=!1;function It(f){let e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,st),f.isContextLost())return;et.supported=!0}catch{}f.deleteTexture(e),yt=!0}var Pt,qt;typeof document<"u"&&(st=document.createElement("img"),st.onload=function(){at&&It(at),at=null,xt=!0},st.onerror=function(){yt=!0,at=null},st.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,o,c,p;f.resetRequestQueue=()=>{e=[],o=0,c=0,p={}},f.addThrottleControl=I=>{let A=c++;return p[A]=I,A},f.removeThrottleControl=I=>{delete p[I],w()},f.getImage=(I,A,L=!0)=>{et.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*");let F={requestParameters:I,supportImageRefresh:L,callback:A,cancelled:!1,completed:!1,cancel:()=>{F.completed||F.cancelled||(F.cancelled=!0,F.innerRequest&&(F.innerRequest.cancel(),o--),w())}};return e.push(F),w(),F};let m=I=>{let{requestParameters:A,supportImageRefresh:L,callback:F}=I;return l.e(A,{type:"image"}),(L!==!1||l.i()||l.g(A.url)||A.headers&&!Object.keys(A.headers).reduce(($,Z)=>$&&Z==="accept",!0)?l.m:E)(A,($,Z,H,G)=>{x(I,F,$,Z,H,G)})},x=(I,A,L,F,$,Z)=>{L?A(L):F instanceof HTMLImageElement||l.a(F)?A(null,F):F&&((H,G)=>{typeof createImageBitmap=="function"?l.b(H,G):l.d(H,G)})(F,(H,G)=>{H!=null?A(H):G!=null&&A(null,G,{cacheControl:$,expires:Z})}),I.cancelled||(I.completed=!0,o--,w())},w=()=>{let I=(()=>{let A=Object.keys(p),L=!1;if(A.length>0){for(let F of A)if(L=p[F](),L)break}return L})()?l.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=o;A<I&&e.length>0;A++){let L=e.shift();if(L.cancelled){A--;continue}let F=m(L);o++,L.innerRequest=F}},E=(I,A)=>{let L=new Image,F=I.url,$=!1,Z=I.credentials;return Z&&Z==="include"?L.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!l.s(F))&&(L.crossOrigin="anonymous"),L.fetchPriority="high",L.onload=()=>{A(null,L),L.onerror=L.onload=null},L.onerror=()=>{$||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),L.onerror=L.onload=null},L.src=F,{cancel:()=>{$=!0,L.src=""}}}}(Pt||(Pt={})),Pt.resetRequestQueue(),function(f){f.Glyphs="Glyphs",f.Image="Image",f.Source="Source",f.SpriteImage="SpriteImage",f.SpriteJSON="SpriteJSON",f.Style="Style",f.Tile="Tile",f.Unknown="Unknown"}(qt||(qt={}));class Qt{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}normalizeSpriteURL(e,o,c){let p=function(m){let x=m.match(se);if(!x)throw new Error(`Unable to parse URL "${m}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(e);return p.path+=`${o}${c}`,function(m){let x=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${x}`}(p)}setTransformRequest(e){this._transformRequestFn=e}}let se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(f){var e=new l.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Ue,ke=function(f,e,o){return f[0]=e[0]-o[0],f[1]=e[1]-o[1],f[2]=e[2]-o[2],f};Ue=new l.A(3),l.A!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0);var er=function(f){var e=f[0],o=f[1];return e*e+o*o};function Le(f){let e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){let o=[];for(let{id:c,url:p}of f){let m=`${c}${p}`;o.indexOf(m)===-1&&(o.push(m),e.push({id:c,url:p}))}}return e}function lr(f,e,o,c,p){if(c)return void f(c);if(p!==Object.values(e).length||p!==Object.values(o).length)return;let m={};for(let x in e){m[x]={};let w=l.h.getImageCanvasContext(o[x]),E=e[x];for(let I in E){let{width:A,height:L,x:F,y:$,sdf:Z,pixelRatio:H,stretchX:G,stretchY:ot,content:dt}=E[I];m[x][I]={data:null,pixelRatio:H,sdf:Z,stretchX:G,stretchY:ot,content:dt,spriteData:{width:A,height:L,x:F,y:$,context:w}}}}f(null,m)}(function(){var f=new l.A(2);l.A!=Float32Array&&(f[0]=0,f[1]=0)})();class je{constructor(e,o,c,p){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(o,p)}update(e,o,c){let{width:p,height:m}=e,x=!(this.size&&this.size[0]===p&&this.size[1]===m||c),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[p,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.a(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,p,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{let{x:I,y:A}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.a(e)?E.texSubImage2D(E.TEXTURE_2D,0,I,A,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,I,A,p,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,o,c){let{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||e),this.filter=e),o!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function zr(f){let{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class nr extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:o,callback:c}of this.requestors)this._notify(o,c);this.requestors=[]}}getImage(e){let o=this.images[e];if(o&&!o.data&&o.spriteData){let c=o.spriteData;o.data=new l.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let c=!0,p=o.data||o.spriteData;return this._validateStretch(o.stretchX,p&&p.width)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(o.stretchY,p&&p.height)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(o.content,o)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,o){if(!e)return!0;let c=0;for(let p of e){if(p[0]<c||p[1]<p[0]||o<p[1])return!1;c=p[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;let c=o.spriteData,p=c&&c.width||o.data.width,m=c&&c.height||o.data.height;return!(e[0]<0||p<e[0]||e[1]<0||m<e[1]||e[2]<0||p<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,c=!0){let p=this.getImage(e);if(c&&(p.data.width!==o.data.width||p.data.height!==o.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=p.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){let o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,o){let c=!0;if(!this.isLoaded())for(let p of e)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(e,o):this.requestors.push({ids:e,callback:o})}_notify(e,o){let c={};for(let p of e){let m=this.getImage(p);m||(this.fire(new l.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?c[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:l.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,c)}getPixelSize(){let{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){let o=this.patterns[e],c=this.getImage(e);if(!c)return null;if(o&&o.position.version===c.version)return o.position;if(o)o.position.version=c.version;else{let p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},m=new l.I(p,c);this.patterns[e]={bin:p,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new je(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let m in this.patterns)e.push(this.patterns[m].bin);let{w:o,h:c}=l.p(e),p=this.atlasImage;p.resize({width:o||1,height:c||1});for(let m in this.patterns){let{bin:x}=this.patterns[m],w=x.x+1,E=x.y+1,I=this.getImage(m).data,A=I.width,L=I.height;l.R.copy(I,p,{x:0,y:0},{x:w,y:E},{width:A,height:L}),l.R.copy(I,p,{x:0,y:L-1},{x:w,y:E-1},{width:A,height:1}),l.R.copy(I,p,{x:0,y:0},{x:w,y:E+L},{width:A,height:1}),l.R.copy(I,p,{x:A-1,y:0},{x:w-1,y:E},{width:1,height:L}),l.R.copy(I,p,{x:0,y:0},{x:w+A,y:E},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;let c=this.getImage(o);c||l.w(`Image with ID: "${o}" was not found`),zr(c)&&this.updateImage(o,c)}}}let fn=1e20;function de(f,e,o,c,p,m,x,w,E){for(let I=e;I<e+c;I++)Ke(f,o*m+I,m,p,x,w,E);for(let I=o;I<o+p;I++)Ke(f,I*m+e,1,c,x,w,E)}function Ke(f,e,o,c,p,m,x){m[0]=0,x[0]=-fn,x[1]=fn,p[0]=f[e];for(let w=1,E=0,I=0;w<c;w++){p[w]=f[e+w*o];let A=w*w;do{let L=m[E];I=(p[w]-p[L]+A-L*L)/(w-L)/2}while(I<=x[E]&&--E>-1);E++,m[E]=w,x[E]=I,x[E+1]=fn}for(let w=0,E=0;w<c;w++){for(;x[E+1]<w;)E++;let I=m[E],A=w-I;f[e+w*o]=p[I]+A*A}}class Er{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e,o){let c=[];for(let p in e)for(let m of e[p])c.push({stack:p,id:m});l.o(c,({stack:p,id:m},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{}});let E=w.glyphs[m];if(E!==void 0)return void x(null,{stack:p,id:m,glyph:E});if(E=this._tinySDF(w,p,m),E)return w.glyphs[m]=E,void x(null,{stack:p,id:m,glyph:E});let I=Math.floor(m/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void x(null,{stack:p,id:m,glyph:E});if(!this.url)return void x(new Error("glyphsUrl is not set"));let A=w.requests[I];A||(A=w.requests[I]=[],Er.loadGlyphRange(p,I,this.url,this.requestManager,(L,F)=>{if(F){for(let $ in F)this._doesCharSupportLocalGlyph(+$)||(w.glyphs[+$]=F[+$]);w.ranges[I]=!0}for(let $ of A)$(L,F);delete w.requests[I]})),A.push((L,F)=>{L?x(L):F&&x(null,{stack:p,id:m,glyph:F[m]||null})})},(p,m)=>{if(p)o(p);else if(m){let x={};for(let{stack:w,id:E,glyph:I}of m)(x[w]||(x[w]={}))[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};o(null,x)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e))}_tinySDF(e,o,c){let p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let m=e.tinySDF;if(!m){let w="400";/bold/i.test(o)?w="900":/medium/i.test(o)?w="500":/light/i.test(o)&&(w="200"),m=e.tinySDF=new Er.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:w})}let x=m.draw(String.fromCharCode(c));return{id:c,bitmap:new l.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}Er.loadGlyphRange=function(f,e,o,c,p){let m=256*e,x=m+255,w=c.transformRequest(o.replace("{fontstack}",f).replace("{range}",`${m}-${x}`),qt.Glyphs);l.l(w,(E,I)=>{if(E)p(E);else if(I){let A={};for(let L of l.n(I))A[L.id]=L;p(null,A)}})},Er.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:o=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:m="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=o;let w=this.size=f+4*e,E=this._createCanvas(w),I=this.ctx=E.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${m} ${f}px ${p}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){let e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){let{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:m}=this.ctx.measureText(f),x=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-p))),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),I=w+2*this.buffer,A=E+2*this.buffer,L=Math.max(I*A,0),F=new Uint8ClampedArray(L),$={data:F,width:I,height:A,glyphWidth:w,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(w===0||E===0)return $;let{ctx:Z,buffer:H,gridInner:G,gridOuter:ot}=this;Z.clearRect(H,H,w,E),Z.fillText(f,H,H+x);let dt=Z.getImageData(H,H,w,E);ot.fill(fn,0,L),G.fill(0,0,L);for(let K=0;K<E;K++)for(let lt=0;lt<w;lt++){let mt=dt.data[4*(K*w+lt)+3]/255;if(mt===0)continue;let gt=(K+H)*I+lt+H;if(mt===1)ot[gt]=0,G[gt]=fn;else{let St=.5-mt;ot[gt]=St>0?St*St:0,G[gt]=St<0?St*St:0}}de(ot,0,0,I,A,I,this.f,this.v,this.z),de(G,H,H,w,E,I,this.f,this.v,this.z);for(let K=0;K<L;K++){let lt=Math.sqrt(ot[K])-Math.sqrt(G[K]);F[K]=Math.round(255-255*(lt/this.radius+this.cutoff))}return $}};class Ar{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,o){return l.z(e.expression.evaluate(o))}interpolate(e,o,c){return{x:l.B.number(e.x,o.x,c),y:l.B.number(e.y,o.y,c),z:l.B.number(e.z,o.z,c)}}}let xn;class pi extends l.E{constructor(e){super(),xn=xn||new l.r({anchor:new l.D(l.v.light.anchor),position:new Ar,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(xn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(l.t,e,o))for(let c in e){let p=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),p):this._transitionable.setValue(c,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,c){return(!c||c.validate!==!1)&&l.x(this,e.call(l.y,l.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}}class Qo{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){let c=e.join(",")+String(o);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,o)),this.dashEntry[c]}getDashRanges(e,o,c){let p=[],m=e.length%2==1?-e[e.length-1]*c:0,x=e[0]*c,w=!0;p.push({left:m,right:x,isDash:w,zeroLength:e[0]===0});let E=e[0];for(let I=1;I<e.length;I++){w=!w;let A=e[I];m=E*c,E+=A,x=E*c,p.push({left:m,right:x,isDash:w,zeroLength:A===0})}return p}addRoundDash(e,o,c){let p=o/2;for(let m=-c;m<=c;m++){let x=this.width*(this.nextRow+c+m),w=0,E=e[w];for(let I=0;I<this.width;I++){I/E.right>1&&(E=e[++w]);let A=Math.abs(I-E.left),L=Math.abs(I-E.right),F=Math.min(A,L),$,Z=m/c*(p+1);if(E.isDash){let H=p-Math.abs(Z);$=Math.sqrt(F*F+H*H)}else $=p-Math.sqrt(F*F+Z*Z);this.data[x+I]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){let E=e[w],I=e[w+1];E.zeroLength?e.splice(w,1):I&&I.isDash===E.isDash&&(I.left=E.left,e.splice(w,1))}let o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);let p=this.width*this.nextRow,m=0,x=e[m];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++m]);let E=Math.abs(w-x.left),I=Math.abs(w-x.right),A=Math.min(E,I);this.data[p+w]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(e,o){let c=o?7:0,p=2*c+1;if(this.nextRow+p>this.height)return l.w("LineAtlas out of space"),null;let m=0;for(let w=0;w<e.length;w++)m+=e[w];if(m!==0){let w=this.width/m,E=this.getDashRanges(e,this.width,w);o?this.addRoundDash(E,w,c):this.addRegularDash(E)}let x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:m};return this.nextRow+=p,this.dirty=!0,x}bind(e){let o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}class Ri{constructor(e,o,c){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=c;let p=this.workerPool.acquire(c);for(let m=0;m<p.length;m++){let x=new l.C(p[m],o,c);x.name=`Worker ${m}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o,c){l.o(this.actors,(p,m)=>{p.send(e,o,m)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}}function Sn(f,e,o){let c=function(p,m){if(p)return o(p);if(m){let x=l.F(l.e(m,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(x.vectorLayers=m.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),o(null,x)}};return f.url?l.f(e.transformRequest(f.url,qt.Source),c):l.h.frame(()=>c(null,f))}class Ne{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.L?new l.L(e.lng,e.lat):l.L.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.L?new l.L(e.lng,e.lat):l.L.convert(e),this}extend(e){let o=this._sw,c=this._ne,p,m;if(e instanceof l.L)p=e,m=e;else{if(!(e instanceof Ne))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ne.convert(e)):this.extend(l.L.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.L.convert(e)):this;if(p=e._sw,m=e._ne,!p||!m)return this}return o||c?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new l.L(p.lng,p.lat),this._ne=new l.L(m.lng,m.lat)),this}getCenter(){return new l.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.L(this.getWest(),this.getNorth())}getSouthEast(){return new l.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:o,lat:c}=l.L.convert(e),p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){return e instanceof Ne?e:e&&new Ne(e)}static fromLngLat(e,o=0){let c=360*o/40075017,p=c/Math.cos(Math.PI/180*e.lat);return new Ne(new l.L(e.lng-p,e.lat-c),new l.L(e.lng+p,e.lat+c))}}class qr{constructor(e,o,c){this.bounds=Ne.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let o=Math.pow(2,e.z),c=Math.floor(l.G(this.bounds.getWest())*o),p=Math.floor(l.H(this.bounds.getNorth())*o),m=Math.ceil(l.G(this.bounds.getEast())*o),x=Math.ceil(l.H(this.bounds.getSouth())*o);return e.x>=c&&e.x<m&&e.y>=p&&e.y<x}}class zn extends l.E{constructor(e,o,c,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Sn(this._options,this.map._requestManager,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),m?this.fire(new l.j(m)):x&&(l.e(this,x),x.bounds&&(this.tileBounds=new qr(x.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.e({},this._options),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.F(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,qt.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function m(x,w){return delete e.request,e.aborted?o(null):x&&x.status!==404?o(x):(w&&w.resourceTiming&&(e.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&e.setExpiryData(w),e.loadVectorData(w,this.map.painter),o(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=o:e.request=e.actor.send("reloadTile",p,m.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",p,m.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ci extends l.E{constructor(e,o,c,p){super(),this.id=e,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.F(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Sn(this._options,this.map._requestManager,(e,o)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new l.j(e)):o&&(l.e(this,o),o.bounds&&(this.tileBounds=new qr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=Pt.getImage(this.map._requestManager.transformRequest(c,qt.Tile),(p,m,x)=>{if(delete e.request,e.aborted)e.state="unloaded",o(null);else if(p)e.state="errored",o(p);else if(m){this.map._refreshExpiredTiles&&x&&e.setExpiryData(x);let w=this.map.painter.context,E=w.gl;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new je(w,m,E.RGBA,{useMipmap:!0}),e.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),e.state="loaded",o(null)}},this.map._refreshExpiredTiles)}abortTile(e,o){e.request&&(e.request.cancel(),delete e.request),o()}unloadTile(e,o){e.texture&&this.map.painter.saveTileTexture(e.texture),o()}hasTransition(){return!1}}class Os extends Ci{constructor(e,o,c,p){super(e,o,c,p),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e,o){let c=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(c,qt.Tile);function m(x,w){x&&(e.state="errored",o(x)),w&&(e.dem=w,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",o(null))}e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.request=Pt.getImage(p,(x,w,E)=>l._(this,void 0,void 0,function*(){if(delete e.request,e.aborted)e.state="unloaded",o(null);else if(x)e.state="errored",o(x);else if(w){this.map._refreshExpiredTiles&&e.setExpiryData(E);let I=l.a(w)&&l.J()?w:yield function(L){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.K()){let F=L.width+2,$=L.height+2;try{return new l.R({width:F,height:$},yield l.M(L,-1,-1,F,$))}catch{}}return l.h.getImageData(L,1)})}(w),A={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",A,m))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(e){let o=e.canonical,c=Math.pow(2,o.z),p=(o.x-1+c)%c,m=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+c)%c,w=o.x+1===c?e.wrap+1:e.wrap,E={};return E[new l.O(e.overscaledZ,m,o.z,p,o.y).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(E[new l.O(e.overscaledZ,m,o.z,p,o.y-1).key]={backfilled:!1},E[new l.O(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(E[new l.O(e.overscaledZ,m,o.z,p,o.y+1).key]={backfilled:!1},E[new l.O(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new l.O(e.overscaledZ,w,o.z,x,o.y+1).key]={backfilled:!1}),E}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class oo extends l.E{constructor(e,o,c,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.e({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let m=l.N/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*m,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*m,extent:l.N,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.N,radius:(o.clusterRadius||50)*m,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},o),this}getClusterChildren(e,o){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},o),this}getClusterLeaves(e,o,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:o,offset:c},p),this}_updateWorkerData(e){let o=l.e({},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(l.h.resolveURL(this._data),qt.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,o,(c,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let m=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0)),c)return void this.fire(new l.j(c));let x={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&l.e(x,{resourceTiming:m}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(e,o){let c=e.actor?"reloadTile":"loadTile";e.actor=this.actor;let p={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(c,p,(m,x)=>(delete e.request,e.unloadVectorData(),e.aborted?o(null):m?o(m):(e.loadVectorData(x,this.map.painter,c==="reloadTile"),o(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var ln=l.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qe extends l.E{constructor(e,o,c,p){super(),this.load=(m,x)=>{this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Pt.getImage(this.map._requestManager.transformRequest(this.url,qt.Image),(w,E)=>{this._request=null,this._loaded=!0,w?this.fire(new l.j(w)):E&&(this.image=E,m&&(this.coordinates=m),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;let m=this.map.painter.context,x=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new je(m,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(let E in this.tiles){let I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=o}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;let o=e.map(l.U.fromLngLat);this.tileID=function(p){let m=1/0,x=1/0,w=-1/0,E=-1/0;for(let F of p)m=Math.min(m,F.x),x=Math.min(x,F.y),w=Math.max(w,F.x),E=Math.max(E,F.y);let I=Math.max(w-m,E-x),A=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),L=Math.pow(2,A);return new l.W(A,Math.floor((m+w)/2*L),Math.floor((x+E)/2*L))}(o),this.minzoom=this.maxzoom=this.tileID.z;let c=o.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new l.V,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,l.N,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,l.N),this._boundsArray.emplaceBack(c[2].x,c[2].y,l.N,l.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}hasTransition(){return!1}}class na extends Qe{constructor(e,o,c,p){super(e,o,c,p),this.load=()=>{this._loaded=!1;let m=this.options;this.urls=[];for(let x of m.urls)this.urls.push(this.map._requestManager.transformRequest(x,qt.Source).url);l.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new l.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let m=this.map.painter.context,x=m.gl;this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new je(m,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(let E in this.tiles){let I=this.tiles[E];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,w=!0)}w&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=o}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new l.j(new l.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Fo extends Qe{constructor(e,o,c,p){super(e,o,c,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,ln.members)),this.boundsSegments||(this.boundsSegments=l.S.simpleSegment(0,0,4,2)),this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new je(x,this.canvas,w.RGBA,{premultiply:!0});let E=!1;for(let I in this.tiles){let A=this.tiles[I];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,E=!0)}E&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(x=>typeof x!="number"))||this.fire(new l.j(new l.Y(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.Y(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.j(new l.Y(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.Y(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.Y(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let ba={},Oi=f=>{switch(f){case"geojson":return oo;case"image":return Qe;case"raster":return Ci;case"raster-dem":return Os;case"vector":return zn;case"video":return na;case"canvas":return Fo}return ba[f]};function Fs(f,e){let o=l.Z();return l.$(o,o,[1,1,0]),l.a0(o,o,[.5*f.width,.5*f.height,1]),l.a1(o,o,f.calculatePosMatrix(e.toUnwrapped()))}function Zr(f,e,o,c,p,m){let x=function(L,F,$){if(L)for(let Z of L){let H=F[Z];if(H&&H.source===$&&H.type==="fill-extrusion")return!0}else for(let Z in F){let H=F[Z];if(H.source===$&&H.type==="fill-extrusion")return!0}return!1}(p&&p.layers,e,f.id),w=m.maxPitchScaleFactor(),E=f.tilesIn(c,w,x);E.sort(Mo);let I=[];for(let L of E)I.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,o,f._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,p,m,w,Fs(f.transform,L.tileID))});let A=function(L){let F={},$={};for(let Z of L){let H=Z.queryResults,G=Z.wrappedTileID,ot=$[G]=$[G]||{};for(let dt in H){let K=H[dt],lt=ot[dt]=ot[dt]||{},mt=F[dt]=F[dt]||[];for(let gt of K)lt[gt.featureIndex]||(lt[gt.featureIndex]=!0,mt.push(gt))}}return F}(I);for(let L in A)A[L].forEach(F=>{let $=F.feature,Z=f.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=Z});return A}function Mo(f,e){let o=f.tileID,c=e.tileID;return o.overscaledZ-c.overscaledZ||o.canonical.y-c.canonical.y||o.wrap-c.wrap||o.canonical.x-c.canonical.x}class No{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a2(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,m){let x={};if(!m)return x;for(let w of p){let E=w.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(E.length!==0){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(I=>E.filter(A=>A.id===I)[0]));for(let I of E)x[I.id]=w}}return x}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(let p in this.buckets){let m=this.buckets[p];if(m instanceof l.a4){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let p in this.buckets){let m=this.buckets[p];if(m instanceof l.a4&&m.hasRTLText){this.hasRTLText=!0,l.a5();break}}this.queryPadding=0;for(let p in this.buckets){let m=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(p).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a3}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let c in this.buckets){let p=this.buckets[c];p.uploadPending()&&p.upload(e)}let o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new je(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new je(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,c,p,m,x,w,E,I,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:m,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:w,queryPadding:this.queryPadding*I},e,o,c):{}}querySourceFeatures(e,o){let c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;let p=c.loadVTLayers(),m=o&&o.sourceLayer?o.sourceLayer:"",x=p._geojsonTileLayer||p[m];if(!x)return;let w=l.a6(o&&o.filter),{z:E,x:I,y:A}=this.tileID.canonical,L={z:E,x:I,y:A};for(let F=0;F<x.length;F++){let $=x.feature(F);if(w.needGeometry){let G=l.a7($,!0);if(!w.filter(new l.a8(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!w.filter(new l.a8(this.tileID.overscaledZ),$))continue;let Z=c.getId($,m),H=new l.a9($,E,I,A,Z);H.tile=L,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let o=this.expirationTime;if(e.cacheControl){let c=l.aa(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let c=Date.now(),p=!1;if(this.expirationTime>c)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{let m=this.expirationTime-o;m?this.expirationTime=c+Math.max(m,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let c=this.latestFeatureIndex.loadVTLayers();for(let p in this.buckets){if(!o.style.hasLayer(p))continue;let m=this.buckets[p],x=m.layers[0].sourceLayer||"_geojsonTileLayer",w=c[x],E=e[x];if(!w||!E||Object.keys(E).length===0)continue;m.update(E,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});let I=o&&o.style&&o.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=l.h.now()+e}setDependencies(e,o){let c={};for(let p of o)c[p]=!0;this.dependencies[e]=c}hasDependency(e,o){for(let c of e){let p=this.dependencies[c];if(p){for(let m of o)if(p[m])return!0}}return!1}}class ls{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(let e in this.data)for(let o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,c){let p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);let m={value:o,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},c)),this.data[p].push(m),this.order.push(p),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){let o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;let c=e.wrapped().key,p=o===void 0?0:this.data[c].indexOf(o),m=this.data[c][p];return this.data[c].splice(p,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){let o=[];for(let c in this.data)for(let p of this.data[c])e(p.value)||o.push(p);for(let c of o)this.remove(c.value.tileID,c)}}class _t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,c){let p=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},l.e(this.stateChanges[e][p],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(let m in this.state[e])m!==p&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(let m in this.state[e][p])c[m]||(this.deletedStates[e][p][m]=null)}else for(let m in c)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][m]===null&&delete this.deletedStates[e][p][m]}removeFeatureState(e,o,c){if(this.deletedStates[e]===null)return;let p=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&o!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][c]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(c in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][c]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,o){let c=String(o),p=l.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let m=this.deletedStates[e][o];if(m===null)return{};for(let x in m)delete p[x]}return p}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){let c={};for(let p in this.stateChanges){this.state[p]=this.state[p]||{};let m={};for(let x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),l.e(this.state[p][x],this.stateChanges[p][x]),m[x]=this.state[p][x];c[p]=m}for(let p in this.deletedStates){this.state[p]=this.state[p]||{};let m={};if(this.deletedStates[p]===null)for(let x in this.state[p])m[x]={},this.state[p][x]={};else for(let x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(let w of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][w];m[x]=this.state[p][x]}c[p]=c[p]||{},l.e(c[p],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(let p in e)e[p].setFeatureState(c,o)}}class Vn extends l.E{constructor(e,o,c){super(),this.id=e,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,m,x,w)=>{let E=new(Oi(m.type))(p,m,x,w);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return E})(e,o,c,this),this._tiles={},this._cache=new ls(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o){return this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new l.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let c=this._tiles[o];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(fi).map(e=>e.key)}getRenderableIds(e){let o=[];for(let c in this._tiles)this._isIdRenderable(c,e)&&o.push(this._tiles[c]);return e?o.sort((c,p)=>{let m=c.tileID,x=p.tileID,w=new l.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-x.overscaledZ||E.y-w.y||E.x-w.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(fi).map(c=>c.key)}hasRenderableParent(e){let o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,o){let c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,e,o)))}_tileLoaded(e,o,c,p){if(p)return e.state="errored",void(p.status!==404?this._source.fire(new l.j(p,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=l.h.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let o=this.getRenderableIds();for(let p=0;p<o.length;p++){let m=o[p];if(e.neighboringTiles&&e.neighboringTiles[m]){let x=this.getTileByID(m);c(e,x),c(x,e)}}function c(p,m){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=m.tileID.canonical.x-p.tileID.canonical.x,w=m.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),I=m.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),m.dem&&p.dem&&(p.dem.backfillBorder(m.dem,x,w),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,c,p){for(let m in this._tiles){let x=this._tiles[m];if(p[m]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>c)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){let I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(w=I)}let E=w;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){p[w.key]=w;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){let c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=e.overscaledZ-1;c>=o;c--){let p=e.scaledTo(c),m=this._getLoadedTile(p);if(m)return m}}_getLoadedTile(e){let o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let o=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(o*c*(this._maxTileCacheZoomLevels===null?l.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(m)}handleWrapJump(e){let o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){let c={};for(let p in this._tiles){let m=this._tiles[p];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),c[m.tileID.key]=m}this._tiles=c;for(let p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(let p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(e,o){if(this.transform=e,this.terrain=o,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new l.O(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(c=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o}),this._source.hasTile&&(c=c.filter(A=>this._source.hasTile(A)))):c=[];let p=e.coveringZoomLevel(this._source),m=Math.max(p-Vn.maxOverzooming,this._source.minzoom),x=Math.max(p+Vn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let A={};for(let L of c)if(L.canonical.z>this._source.minzoom){let F=L.scaledTo(L.canonical.z-1);A[F.key]=F;let $=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));A[$.key]=$}c=c.concat(Object.values(A))}let w=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let E=this._updateRetainedTiles(c,p);if(ar(this._source.type)){let A={},L={},F=Object.keys(E),$=l.h.now();for(let Z of F){let H=E[Z],G=this._tiles[Z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=$)continue;let ot=this.findLoadedParent(H,m);ot&&(this._addTile(ot.tileID),A[ot.tileID.key]=ot.tileID),L[Z]=H}this._retainLoadedChildren(L,p,x,E);for(let Z in A)E[Z]||(this._coveredTiles[Z]=!0,E[Z]=A[Z]);if(o){let Z={},H={};for(let G of c)this._tiles[G.key].hasData()?Z[G.key]=G:H[G.key]=G;for(let G in H){let ot=H[G].children(this._source.maxzoom);this._tiles[ot[0].key]&&this._tiles[ot[1].key]&&this._tiles[ot[2].key]&&this._tiles[ot[3].key]&&(Z[ot[0].key]=E[ot[0].key]=ot[0],Z[ot[1].key]=E[ot[1].key]=ot[1],Z[ot[2].key]=E[ot[2].key]=ot[2],Z[ot[3].key]=E[ot[3].key]=ot[3],delete H[G])}for(let G in H){let ot=this.findLoadedParent(H[G],this._source.minzoom);if(ot){Z[ot.tileID.key]=E[ot.tileID.key]=ot.tileID;for(let dt in Z)Z[dt].isChildOf(ot.tileID)&&delete Z[dt]}}for(let G in this._tiles)Z[G]||(this._coveredTiles[G]=!0)}}for(let A in E)this._tiles[A].clearFadeHold();let I=l.ab(this._tiles,E);for(let A of I){let L=this._tiles[A];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){let c={},p={},m=Math.max(o-Vn.maxOverzooming,this._source.minzoom),x=Math.max(o+Vn.maxUnderzooming,this._source.minzoom),w={};for(let E of e){let I=this._addTile(E);c[E.key]=E,I.hasData()||o<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,o,x,c);for(let E of e){let I=this._tiles[E.key];if(I.hasData())continue;if(o+1>this._source.maxzoom){let L=E.children(this._source.maxzoom)[0],F=this.getTile(L);if(F&&F.hasData()){c[L.key]=L;continue}}else{let L=E.children(this._source.maxzoom);if(c[L[0].key]&&c[L[1].key]&&c[L[2].key]&&c[L[3].key])continue}let A=I.wasRequested();for(let L=E.overscaledZ-1;L>=m;--L){let F=E.scaledTo(L);if(p[F.key])break;if(p[F.key]=!0,I=this.getTile(F),!I&&A&&(I=this._addTile(F)),I){let $=I.hasData();if((A||$)&&(c[F.key]=F),A=I.wasRequested(),$)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let o=[],c,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}o.push(p.key);let m=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;p=m}for(let m of o)this._loadedParentTiles[m]=c}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));let c=o;return o||(o=new No(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))),o.uses++,this._tiles[e.key]=o,c||this._source.fire(new l.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let c=o.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){let o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,c){let p=[],m=this.transform;if(!m)return p;let x=c?m.getCameraQueryGeometry(e):e,w=e.map(Z=>m.pointCoordinate(Z,this.terrain)),E=x.map(Z=>m.pointCoordinate(Z,this.terrain)),I=this.getIds(),A=1/0,L=1/0,F=-1/0,$=-1/0;for(let Z of E)A=Math.min(A,Z.x),L=Math.min(L,Z.y),F=Math.max(F,Z.x),$=Math.max($,Z.y);for(let Z=0;Z<I.length;Z++){let H=this._tiles[I[Z]];if(H.holdingForFade())continue;let G=H.tileID,ot=Math.pow(2,m.zoom-H.tileID.overscaledZ),dt=o*H.queryPadding*l.N/H.tileSize/ot,K=[G.getTilePoint(new l.U(A,L)),G.getTilePoint(new l.U(F,$))];if(K[0].x-dt<l.N&&K[0].y-dt<l.N&&K[1].x+dt>=0&&K[1].y+dt>=0){let lt=w.map(gt=>G.getTilePoint(gt)),mt=E.map(gt=>G.getTilePoint(gt));p.push({tile:H,tileID:G,queryGeometry:lt,cameraQueryGeometry:mt,scale:ot})}}return p}getVisibleCoordinates(e){let o=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(let c of o)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(ar(this._source.type)){let e=l.h.now();for(let o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,c){this._state.updateState(e=e||"_geojsonTileLayer",o,c)}removeFeatureState(e,o,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,c)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,c){let p=this._tiles[e];p&&p.setDependencies(o,c)}reloadTilesForDependencies(e,o){for(let c in this._tiles)this._tiles[c].hasDependency(e,o)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(e,o))}}function fi(f,e){let o=Math.abs(2*f.wrap)-+(f.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||c-o||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function ar(f){return f==="raster"||f==="image"||f==="video"}Vn.maxOverzooming=10,Vn.maxUnderzooming=3;let Ze="mapboxgl_preloaded_worker_pool";class ji{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ji.workerCount;)this.workers.push(new Worker(l.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}let ho=Math.floor(l.h.hardwareConcurrency/2),Zi;function ia(){return Zi||(Zi=new ji),Zi}ji.workerCount=l.ac(globalThis)?Math.max(Math.min(ho,3),1):1;class us{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ad(e,0,1);let o=1,c=this._distances[o],p=e*this.paddedLength+this.padding;for(;c<p&&o<this._distances.length;)c=this._distances[++o];let m=o-1,x=this._distances[m],w=c-x,E=w>0?(p-x)/w:0;return this.points[m].mult(1-E).add(this.points[o].mult(E))}}function Xi(f,e){let o=!0;return f==="always"||f!=="never"&&e!=="never"||(o=!1),o}class Do{constructor(e,o,c){let p=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(o/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,c,p,m){this._forEachCell(o,c,p,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m)}insertCircle(e,o,c,p){this._forEachCell(o-p,c-p,o+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(c),this.circles.push(p)}_insertBoxCell(e,o,c,p,m,x){this.boxCells[m].push(x)}_insertCircleCell(e,o,c,p,m,x){this.circleCells[m].push(x)}_query(e,o,c,p,m,x,w){if(c<0||e>this.width||p<0||o>this.height)return[];let E=[];if(e<=0&&o<=0&&this.width<=c&&this.height<=p){if(m)return[{key:null,x1:e,y1:o,x2:c,y2:p}];for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let A=this.circles[3*I],L=this.circles[3*I+1],F=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:A-F,y1:L-F,x2:A+F,y2:L+F})}}else this._forEachCell(e,o,c,p,this._queryCell,E,{hitTest:m,overlapMode:x,seenUids:{box:{},circle:{}}},w);return E}query(e,o,c,p){return this._query(e,o,c,p,!1,null)}hitTest(e,o,c,p,m,x){return this._query(e,o,c,p,!0,m,x).length>0}hitTestCircle(e,o,c,p,m){let x=e-c,w=e+c,E=o-c,I=o+c;if(w<0||x>this.width||I<0||E>this.height)return!1;let A=[];return this._forEachCell(x,E,w,I,this._queryCellCircle,A,{hitTest:!0,overlapMode:p,circle:{x:e,y:o,radius:c},seenUids:{box:{},circle:{}}},m),A.length>0}_queryCell(e,o,c,p,m,x,w,E){let{seenUids:I,hitTest:A,overlapMode:L}=w,F=this.boxCells[m];if(F!==null){let Z=this.bboxes;for(let H of F)if(!I.box[H]){I.box[H]=!0;let G=4*H,ot=this.boxKeys[H];if(e<=Z[G+2]&&o<=Z[G+3]&&c>=Z[G+0]&&p>=Z[G+1]&&(!E||E(ot))&&(!A||!Xi(L,ot.overlapMode))&&(x.push({key:ot,x1:Z[G],y1:Z[G+1],x2:Z[G+2],y2:Z[G+3]}),A))return!0}}let $=this.circleCells[m];if($!==null){let Z=this.circles;for(let H of $)if(!I.circle[H]){I.circle[H]=!0;let G=3*H,ot=this.circleKeys[H];if(this._circleAndRectCollide(Z[G],Z[G+1],Z[G+2],e,o,c,p)&&(!E||E(ot))&&(!A||!Xi(L,ot.overlapMode))){let dt=Z[G],K=Z[G+1],lt=Z[G+2];if(x.push({key:ot,x1:dt-lt,y1:K-lt,x2:dt+lt,y2:K+lt}),A)return!0}}}return!1}_queryCellCircle(e,o,c,p,m,x,w,E){let{circle:I,seenUids:A,overlapMode:L}=w,F=this.boxCells[m];if(F!==null){let Z=this.bboxes;for(let H of F)if(!A.box[H]){A.box[H]=!0;let G=4*H,ot=this.boxKeys[H];if(this._circleAndRectCollide(I.x,I.y,I.radius,Z[G+0],Z[G+1],Z[G+2],Z[G+3])&&(!E||E(ot))&&!Xi(L,ot.overlapMode))return x.push(!0),!0}}let $=this.circleCells[m];if($!==null){let Z=this.circles;for(let H of $)if(!A.circle[H]){A.circle[H]=!0;let G=3*H,ot=this.circleKeys[H];if(this._circlesCollide(Z[G],Z[G+1],Z[G+2],I.x,I.y,I.radius)&&(!E||E(ot))&&!Xi(L,ot.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,c,p,m,x,w,E){let I=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),L=this._convertToXCellCoord(c),F=this._convertToYCellCoord(p);for(let $=I;$<=L;$++)for(let Z=A;Z<=F;Z++)if(m.call(this,e,o,c,p,this.xCellCount*Z+$,x,w,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,c,p,m,x){let w=p-e,E=m-o,I=c+x;return I*I>w*w+E*E}_circleAndRectCollide(e,o,c,p,m,x,w){let E=(x-p)/2,I=Math.abs(e-(p+E));if(I>E+c)return!1;let A=(w-m)/2,L=Math.abs(o-(m+A));if(L>A+c)return!1;if(I<=E||L<=A)return!0;let F=I-E,$=L-A;return F*F+$*$<=c*c}}function Ot(f,e,o,c,p){let m=l.Z();return e?(l.a0(m,m,[1/p,1/p,1]),o||l.ae(m,m,c.angle)):l.a1(m,c.labelPlaneMatrix,f),m}function Pi(f,e,o,c,p){if(e){let m=l.af(f);return l.a0(m,m,[p,p,1]),o||l.ae(m,m,-c.angle),m}return c.glCoordMatrix}function Cr(f,e,o){let c;o?(c=[f.x,f.y,o(f.x,f.y),1],l.ag(c,c,e)):(c=[f.x,f.y,0,1],Y(c,c,e));let p=c[3];return{point:new l.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function cs(f,e){return .5+f/e*.5}function Ai(f,e){let o=f[0]/f[3],c=f[1]/f[3];return o>=-e[0]&&o<=e[0]&&c>=-e[1]&&c<=e[1]}function Nt(f,e,o,c,p,m,x,w,E,I){let A=c?f.textSizeData:f.iconSizeData,L=l.ah(A,o.transform.zoom),F=[256/o.width*2+1,256/o.height*2+1],$=c?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();let Z=f.lineVertexArray,H=c?f.text.placedSymbolArray:f.icon.placedSymbolArray,G=o.transform.width/o.transform.height,ot=!1;for(let dt=0;dt<H.length;dt++){let K=H.get(dt);if(K.hidden||K.writingMode===l.ai.vertical&&!ot){j(K.numGlyphs,$);continue}let lt;if(ot=!1,I?(lt=[K.anchorX,K.anchorY,I(K.anchorX,K.anchorY),1],l.ag(lt,lt,e)):(lt=[K.anchorX,K.anchorY,0,1],Y(lt,lt,e)),!Ai(lt,F)){j(K.numGlyphs,$);continue}let mt=cs(o.transform.cameraToCenterDistance,lt[3]),gt=l.aj(A,L,K),St=x?gt/mt:gt*mt,Mt=new l.P(K.anchorX,K.anchorY),Ct=Cr(Mt,p,I).point,zt={projections:{},offsets:{}},te=bn(K,St,!1,w,e,p,m,f.glyphOffsetArray,Z,$,Ct,Mt,zt,G,E,I);ot=te.useVertical,(te.notEnoughRoom||ot||te.needsFlipping&&bn(K,St,!0,w,e,p,m,f.glyphOffsetArray,Z,$,Ct,Mt,zt,G,E,I).notEnoughRoom)&&j(K.numGlyphs,$)}c?f.text.dynamicLayoutVertexBuffer.updateData($):f.icon.dynamicLayoutVertexBuffer.updateData($)}function Se(f,e,o,c,p,m,x,w,E,I,A,L,F){let $=w.glyphStartIndex+w.numGlyphs,Z=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,G=e.getoffsetX(w.glyphStartIndex),ot=e.getoffsetX($-1),dt=k(f*G,o,c,p,m,x,w.segment,Z,H,E,I,A,L,F);if(!dt)return null;let K=k(f*ot,o,c,p,m,x,w.segment,Z,H,E,I,A,L,F);return K?{first:dt,last:K}:null}function ge(f,e,o,c){return f===l.ai.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*c?{useVertical:!0}:(f===l.ai.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function bn(f,e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H){let G=e/24,ot=f.lineOffsetX*G,dt=f.lineOffsetY*G,K;if(f.numGlyphs>1){let lt=f.glyphStartIndex+f.numGlyphs,mt=f.lineStartIndex,gt=f.lineStartIndex+f.lineLength,St=Se(G,w,ot,dt,o,A,L,f,E,m,F,Z,H);if(!St)return{notEnoughRoom:!0};let Mt=Cr(St.first.point,x,H).point,Ct=Cr(St.last.point,x,H).point;if(c&&!o){let zt=ge(f.writingMode,Mt,Ct,$);if(zt)return zt}K=[St.first];for(let zt=f.glyphStartIndex+1;zt<lt-1;zt++)K.push(k(G*w.getoffsetX(zt),ot,dt,o,A,L,f.segment,mt,gt,E,m,F,Z,H));K.push(St.last)}else{if(c&&!o){let mt=Cr(L,p,H).point,gt=f.lineStartIndex+f.segment+1,St=new l.P(E.getx(gt),E.gety(gt)),Mt=Cr(St,p,H),Ct=Mt.signedDistanceFromCamera>0?Mt.point:Li(L,St,mt,1,p,H),zt=ge(f.writingMode,mt,Ct,$);if(zt)return zt}let lt=k(G*w.getoffsetX(f.glyphStartIndex),ot,dt,o,A,L,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,E,m,F,Z,H);if(!lt)return{notEnoughRoom:!0};K=[lt]}for(let lt of K)l.ak(I,lt.point,lt.angle);return{}}function Li(f,e,o,c,p,m){let x=Cr(f.add(f.sub(e)._unit()),p,m).point,w=o.sub(x);return o.add(w._mult(c/w.mag()))}function ye(f,e){let{projectionCache:o,lineVertexArray:c,labelPlaneMatrix:p,tileAnchorPoint:m,distanceFromAnchor:x,getElevation:w,previousVertex:E,direction:I,absOffsetX:A}=e;if(o.projections[f])return o.projections[f];let L=new l.P(c.getx(f),c.gety(f)),F=Cr(L,p,w);if(F.signedDistanceFromCamera>0)return o.projections[f]=F.point,F.point;let $=f-I;return Li(x===0?m:new l.P(c.getx($),c.gety($)),L,E,A-x+1,p,w)}function Gi(f,e,o){return f._unit()._perp()._mult(e*o)}function X(f,e,o,c,p,m,x,w){let{projectionCache:E,direction:I}=w;if(E.offsets[f])return E.offsets[f];let A=o.add(e);if(f+I<c||f+I>=p)return E.offsets[f]=A,A;let L=ye(f+I,w),F=Gi(L.sub(o),x,I),$=o.add(F),Z=L.add(F);return E.offsets[f]=l.al(m,A,$,Z)||A,E.offsets[f]}function k(f,e,o,c,p,m,x,w,E,I,A,L,F,$){let Z=c?f-e:f+e,H=Z>0?1:-1,G=0;c&&(H*=-1,G=Math.PI),H<0&&(G+=Math.PI);let ot,dt,K=H>0?w+x:w+x+1,lt=p,mt=p,gt=0,St=0,Mt=Math.abs(Z),Ct=[],zt;for(;gt+St<=Mt;){if(K+=H,K<w||K>=E)return null;gt+=St,mt=lt,dt=ot;let Ut={projectionCache:L,lineVertexArray:I,labelPlaneMatrix:A,tileAnchorPoint:m,distanceFromAnchor:gt,getElevation:$,previousVertex:mt,direction:H,absOffsetX:Mt};if(lt=ye(K,Ut),o===0)Ct.push(mt),zt=lt.sub(mt);else{let pe,re=lt.sub(mt);pe=re.mag()===0?Gi(ye(K+H,Ut).sub(lt),o,H):Gi(re,o,H),dt||(dt=mt.add(pe)),ot=X(K,pe,lt,w,E,dt,o,Ut),Ct.push(dt),zt=ot.sub(dt)}St=zt.mag()}let te=zt._mult((Mt-gt)/St)._add(dt||mt),ze=G+Math.atan2(lt.y-mt.y,lt.x-mt.x);return Ct.push(te),{point:te,angle:F?ze:0,path:Ct}}let O=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function j(f,e){for(let o=0;o<f;o++){let c=e.length;e.resize(c+4),e.float32.set(O,3*c)}}function Y(f,e,o){let c=e[0],p=e[1];return f[0]=o[0]*c+o[4]*p+o[12],f[1]=o[1]*c+o[5]*p+o[13],f[3]=o[3]*c+o[7]*p+o[15],f}let J=100;class ht{constructor(e,o=new Do(e.width+200,e.height+200,25),c=new Do(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=c,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+J,this.screenBottomBoundary=e.height+J,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,c,p,m,x){let w=this.projectAndGetPerspectiveRatio(p,e.anchorPointX,e.anchorPointY,x),E=c*w.perspectiveRatio,I=e.x1*E+w.point.x,A=e.y1*E+w.point.y,L=e.x2*E+w.point.x,F=e.y2*E+w.point.y;return!this.isInsideGrid(I,A,L,F)||o!=="always"&&this.grid.hitTest(I,A,L,F,o,m)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[I,A,L,F],offscreen:this.isOffscreen(I,A,L,F)}}placeCollisionCircles(e,o,c,p,m,x,w,E,I,A,L,F,$,Z){let H=[],G=new l.P(o.anchorX,o.anchorY),ot=Cr(G,x,Z),dt=cs(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),K=(A?m/dt:m*dt)/l.ap,lt=Cr(G,w,Z).point,mt=Se(K,p,o.lineOffsetX*K,o.lineOffsetY*K,!1,lt,G,o,c,w,{projections:{},offsets:{}},!1,Z),gt=!1,St=!1,Mt=!0;if(mt){let Ct=.5*F*dt+$,zt=new l.P(-100,-100),te=new l.P(this.screenRightBoundary,this.screenBottomBoundary),ze=new us,Ut=mt.first,pe=mt.last,re=[];for(let Te=Ut.path.length-1;Te>=1;Te--)re.push(Ut.path[Te]);for(let Te=1;Te<pe.path.length;Te++)re.push(pe.path[Te]);let or=2.5*Ct;if(E){let Te=re.map(Re=>Cr(Re,E,Z));re=Te.some(Re=>Re.signedDistanceFromCamera<=0)?[]:Te.map(Re=>Re.point)}let De=[];if(re.length>0){let Te=re[0].clone(),Re=re[0].clone();for(let Rr=1;Rr<re.length;Rr++)Te.x=Math.min(Te.x,re[Rr].x),Te.y=Math.min(Te.y,re[Rr].y),Re.x=Math.max(Re.x,re[Rr].x),Re.y=Math.max(Re.y,re[Rr].y);De=Te.x>=zt.x&&Re.x<=te.x&&Te.y>=zt.y&&Re.y<=te.y?[re]:Re.x<zt.x||Te.x>te.x||Re.y<zt.y||Te.y>te.y?[]:l.am([re],zt.x,zt.y,te.x,te.y)}for(let Te of De){ze.reset(Te,.25*Ct);let Re=0;Re=ze.length<=.5*Ct?1:Math.ceil(ze.paddedLength/or)+1;for(let Rr=0;Rr<Re;Rr++){let pr=Rr/Math.max(Re-1,1),yn=ze.lerp(pr),Qr=yn.x+J,jr=yn.y+J;H.push(Qr,jr,Ct,0);let vi=Qr-Ct,_r=jr-Ct,vo=Qr+Ct,xo=jr+Ct;if(Mt=Mt&&this.isOffscreen(vi,_r,vo,xo),St=St||this.isInsideGrid(vi,_r,vo,xo),e!=="always"&&this.grid.hitTestCircle(Qr,jr,Ct,e,L)&&(gt=!0,!I))return{circles:[],offscreen:!1,collisionDetected:gt}}}}return{circles:!I&&gt||!St||dt<this.perspectiveRatioCutoff?[]:H,offscreen:Mt,collisionDetected:gt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],c=1/0,p=1/0,m=-1/0,x=-1/0;for(let A of e){let L=new l.P(A.x+J,A.y+J);c=Math.min(c,L.x),p=Math.min(p,L.y),m=Math.max(m,L.x),x=Math.max(x,L.y),o.push(L)}let w=this.grid.query(c,p,m,x).concat(this.ignoredGrid.query(c,p,m,x)),E={},I={};for(let A of w){let L=A.key;if(E[L.bucketInstanceId]===void 0&&(E[L.bucketInstanceId]={}),E[L.bucketInstanceId][L.featureIndex])continue;let F=[new l.P(A.x1,A.y1),new l.P(A.x2,A.y1),new l.P(A.x2,A.y2),new l.P(A.x1,A.y2)];l.an(o,F)&&(E[L.bucketInstanceId][L.featureIndex]=!0,I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]=[]),I[L.bucketInstanceId].push(L.featureIndex))}return I}insertCollisionBox(e,o,c,p,m,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:m,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,c,p,m,x){let w=c?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:m,collisionGroupID:x,overlapMode:o};for(let I=0;I<e.length;I+=4)w.insertCircle(E,e[I],e[I+1],e[I+2])}projectAndGetPerspectiveRatio(e,o,c,p){let m;return p?(m=[o,c,p(o,c),1],l.ag(m,m,e)):(m=[o,c,0,1],Y(m,m,e)),{point:new l.P((m[0]/m[3]+1)/2*this.transform.width+J,(-m[1]/m[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}}isOffscreen(e,o,c,p){return c<J||e>=this.screenRightBoundary||p<J||o>this.screenBottomBoundary}isInsideGrid(e,o,c,p){return c>=0&&e<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let e=l.ao([]);return l.$(e,e,[-100,-100,0]),e}}function nt(f,e,o){return e*(l.N/(f.tileSize*Math.pow(2,o-f.tileID.overscaledZ)))}class tt{constructor(e,o,c,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class it{constructor(e,o,c,p,m){this.text=new tt(e?e.text:null,o,c,m),this.icon=new tt(e?e.icon:null,o,p,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class bt{constructor(e,o,c){this.text=e,this.icon=o,this.skipFade=c}}class wt{constructor(){this.invProjMatrix=l.Z(),this.viewportMatrix=l.Z(),this.circles=[]}}class Tt{constructor(e,o,c,p,m){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=m}}class oe{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:c=>c.collisionGroupID===o}}return this.collisionGroups[e]}}function me(f,e,o,c,p){let{horizontalAlign:m,verticalAlign:x}=l.au(f);return new l.P(-(m-.5)*e+c[0]*p,-(x-.5)*o+c[1]*p)}function Kt(f,e,o,c,p,m){let{x1:x,x2:w,y1:E,y2:I,anchorPointX:A,anchorPointY:L}=f,F=new l.P(e,o);return c&&F._rotate(p?m:-m),{x1:x+F.x,y1:E+F.y,x2:w+F.x,y2:I+F.y,anchorPointX:A,anchorPointY:L}}class ae{constructor(e,o,c,p,m){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new oe(p),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,o,c,p){let m=c.getBucket(o),x=c.latestFeatureIndex;if(!m||!x||o.id!==m.layerIds[0])return;let w=c.collisionBoxArray,E=m.layers[0].layout,I=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),A=c.tileSize/l.N,L=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),F=E.get("text-pitch-alignment")==="map",$=E.get("text-rotation-alignment")==="map",Z=nt(c,1,this.transform.zoom),H=Ot(L,F,$,this.transform,Z),G=null;if(F){let dt=Pi(L,F,$,this.transform,Z);G=l.a1([],this.transform.labelPlaneMatrix,dt)}this.retainedQueryData[m.bucketInstanceId]=new Tt(m.bucketInstanceId,x,m.sourceLayerIndex,m.index,c.tileID);let ot={bucket:m,layout:E,posMatrix:L,textLabelPlaneMatrix:H,labelToScreenMatrix:G,scale:I,textPixelRatio:A,holdingForFade:c.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:l.ah(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(p)for(let dt of m.sortKeyRanges){let{sortKey:K,symbolInstanceStart:lt,symbolInstanceEnd:mt}=dt;e.push({sortKey:K,symbolInstanceStart:lt,symbolInstanceEnd:mt,parameters:ot})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ot})}attemptAnchorPlacement(e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H,G){let ot=l.aq[e.textAnchor],dt=[e.textOffset0,e.textOffset1],K=me(ot,c,p,dt,m),lt=this.collisionIndex.placeCollisionBox(Kt(o,K.x,K.y,x,w,this.transform.angle),L,E,I,A.predicate,G);if((!H||this.collisionIndex.placeCollisionBox(Kt(H,K.x,K.y,x,w,this.transform.angle),L,E,I,A.predicate,G).box.length!==0)&&lt.box.length>0){let mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(mt=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:dt,width:c,height:p,anchor:ot,textBoxScale:m,prevAnchor:mt},this.markUsedJustification($,ot,F,Z),$.allowVerticalPlacement&&(this.markUsedOrientation($,Z,F),this.placedOrientations[F.crossTileID]=Z),{shift:K,placedGlyphBoxes:lt}}}placeLayerBucketPart(e,o,c){let{bucket:p,layout:m,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:E,textPixelRatio:I,holdingForFade:A,collisionBoxArray:L,partiallyEvaluatedTextSize:F,collisionGroup:$}=e.parameters,Z=m.get("text-optional"),H=m.get("icon-optional"),G=l.ar(m,"text-overlap","text-allow-overlap"),ot=G==="always",dt=l.ar(m,"icon-overlap","icon-allow-overlap"),K=dt==="always",lt=m.get("text-rotation-alignment")==="map",mt=m.get("text-pitch-alignment")==="map",gt=m.get("icon-text-fit")!=="none",St=m.get("symbol-z-order")==="viewport-y",Mt=ot&&(K||!p.hasIconData()||H),Ct=K&&(ot||!p.hasTextData()||Z);!p.collisionArrays&&L&&p.deserializeCollisionBoxes(L);let zt=this.retainedQueryData[p.bucketInstanceId].tileID,te=this.terrain?(Ut,pe)=>this.terrain.getElevation(zt,Ut,pe):null,ze=(Ut,pe)=>{var re,or;if(o[Ut.crossTileID])return;if(A)return void(this.placements[Ut.crossTileID]=new bt(!1,!1,!1));let De=!1,Te=!1,Re=!0,Rr=null,pr={box:null,offscreen:null},yn={box:null,offscreen:null},Qr=null,jr=null,vi=null,_r=0,vo=0,xo=0;pe.textFeatureIndex?_r=pe.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(_r=Ut.featureIndex),pe.verticalTextFeatureIndex&&(vo=pe.verticalTextFeatureIndex);let gs=pe.textBox;if(gs){let In=Or=>{let tn=l.ai.horizontal;if(p.allowVerticalPlacement&&!Or&&this.prevPlacement){let oi=this.prevPlacement.placedOrientations[Ut.crossTileID];oi&&(this.placedOrientations[Ut.crossTileID]=oi,tn=oi,this.markUsedOrientation(p,tn,Ut))}return tn},_n=(Or,tn)=>{if(p.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&pe.verticalTextBox){for(let oi of p.writingModes)if(oi===l.ai.vertical?(pr=tn(),yn=pr):pr=Or(),pr&&pr.box&&pr.box.length)break}else pr=Or()},Zn=Ut.textAnchorOffsetStartIndex,Zs=Ut.textAnchorOffsetEndIndex;if(Zs===Zn){let Or=(tn,oi)=>{let Fr=this.collisionIndex.placeCollisionBox(tn,G,I,x,$.predicate,te);return Fr&&Fr.box&&Fr.box.length&&(this.markUsedOrientation(p,oi,Ut),this.placedOrientations[Ut.crossTileID]=oi),Fr};_n(()=>Or(gs,l.ai.horizontal),()=>{let tn=pe.verticalTextBox;return p.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&tn?Or(tn,l.ai.vertical):{box:null,offscreen:null}}),In(pr&&pr.box&&pr.box.length)}else{let Or=l.aq[(or=(re=this.prevPlacement)===null||re===void 0?void 0:re.variableOffsets[Ut.crossTileID])===null||or===void 0?void 0:or.anchor],tn=(Fr,Xs,Pu)=>{let cp=Fr.x2-Fr.x1,hp=Fr.y2-Fr.y1,yd=Ut.textBoxScale,qc=gt&&dt==="never"?Xs:null,bo={box:[],offscreen:!1},Hs=G==="never"?1:2,wo="never";Or&&Hs++;for(let Bi=0;Bi<Hs;Bi++){for(let So=Zn;So<Zs;So++){let $c=p.textAnchorOffsets.get(So);if(Or&&$c.textAnchor!==Or)continue;let jo=this.attemptAnchorPlacement($c,Fr,cp,hp,yd,lt,mt,I,x,$,wo,Ut,p,Pu,qc,te);if(jo&&(bo=jo.placedGlyphBoxes,bo&&bo.box&&bo.box.length))return De=!0,Rr=jo.shift,bo}Or?Or=null:wo=G}return bo};_n(()=>tn(gs,pe.iconBox,l.ai.horizontal),()=>{let Fr=pe.verticalTextBox;return p.allowVerticalPlacement&&!(pr&&pr.box&&pr.box.length)&&Ut.numVerticalGlyphVertices>0&&Fr?tn(Fr,pe.verticalIconBox,l.ai.vertical):{box:null,offscreen:null}}),pr&&(De=pr.box,Re=pr.offscreen);let oi=In(pr&&pr.box);if(!De&&this.prevPlacement){let Fr=this.prevPlacement.variableOffsets[Ut.crossTileID];Fr&&(this.variableOffsets[Ut.crossTileID]=Fr,this.markUsedJustification(p,Fr.anchor,Ut,oi))}}}if(Qr=pr,De=Qr&&Qr.box&&Qr.box.length>0,Re=Qr&&Qr.offscreen,Ut.useRuntimeCollisionCircles){let In=p.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),_n=l.aj(p.textSizeData,F,In),Zn=m.get("text-padding");jr=this.collisionIndex.placeCollisionCircles(G,In,p.lineVertexArray,p.glyphOffsetArray,_n,x,w,E,c,mt,$.predicate,Ut.collisionCircleDiameter,Zn,te),jr.circles.length&&jr.collisionDetected&&!c&&l.w("Collisions detected, but collision boxes are not shown"),De=ot||jr.circles.length>0&&!jr.collisionDetected,Re=Re&&jr.offscreen}if(pe.iconFeatureIndex&&(xo=pe.iconFeatureIndex),pe.iconBox){let In=_n=>{let Zn=gt&&Rr?Kt(_n,Rr.x,Rr.y,lt,mt,this.transform.angle):_n;return this.collisionIndex.placeCollisionBox(Zn,dt,I,x,$.predicate,te)};yn&&yn.box&&yn.box.length&&pe.verticalIconBox?(vi=In(pe.verticalIconBox),Te=vi.box.length>0):(vi=In(pe.iconBox),Te=vi.box.length>0),Re=Re&&vi.offscreen}let $s=Z||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Pa=H||Ut.numIconVertices===0;if($s||Pa?Pa?$s||(Te=Te&&De):De=Te&&De:Te=De=Te&&De,De&&Qr&&Qr.box&&this.collisionIndex.insertCollisionBox(Qr.box,G,m.get("text-ignore-placement"),p.bucketInstanceId,yn&&yn.box&&vo?vo:_r,$.ID),Te&&vi&&this.collisionIndex.insertCollisionBox(vi.box,dt,m.get("icon-ignore-placement"),p.bucketInstanceId,xo,$.ID),jr&&(De&&this.collisionIndex.insertCollisionCircles(jr.circles,G,m.get("text-ignore-placement"),p.bucketInstanceId,_r,$.ID),c)){let In=p.bucketInstanceId,_n=this.collisionCircleArrays[In];_n===void 0&&(_n=this.collisionCircleArrays[In]=new wt);for(let Zn=0;Zn<jr.circles.length;Zn+=4)_n.circles.push(jr.circles[Zn+0]),_n.circles.push(jr.circles[Zn+1]),_n.circles.push(jr.circles[Zn+2]),_n.circles.push(jr.collisionDetected?1:0)}if(Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new bt(De||Mt,Te||Ct,Re||p.justReloaded),o[Ut.crossTileID]=!0};if(St){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=p.getSortedSymbolIndexes(this.transform.angle);for(let pe=Ut.length-1;pe>=0;--pe){let re=Ut[pe];ze(p.symbolInstances.get(re),p.collisionArrays[re])}}else for(let Ut=e.symbolInstanceStart;Ut<e.symbolInstanceEnd;Ut++)ze(p.symbolInstances.get(Ut),p.collisionArrays[Ut]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){let Ut=this.collisionCircleArrays[p.bucketInstanceId];l.as(Ut.invProjMatrix,x),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(e,o,c,p){let m;m=p===l.ai.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.at(o)];let x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(let w of x)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=m>=0&&w!==m?0:c.crossTileID)}markUsedOrientation(e,o,c){let p=o===l.ai.horizontal||o===l.ai.horizontalOnly?o:0,m=o===l.ai.vertical?o:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(let w of x)e.text.placedSymbolArray.get(w).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,c=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let p=o?o.symbolFadeChange(e):1,m=o?o.opacities:{},x=o?o.variableOffsets:{},w=o?o.placedOrientations:{};for(let E in this.placements){let I=this.placements[E],A=m[E];A?(this.opacities[E]=new it(A,p,I.text,I.icon),c=c||I.text!==A.text.placed||I.icon!==A.icon.placed):(this.opacities[E]=new it(null,p,I.text,I.icon,I.skipFade),c=c||I.text||I.icon)}for(let E in m){let I=m[E];if(!this.opacities[E]){let A=new it(I,p,!1,!1);A.isHidden()||(this.opacities[E]=A,c=c||I.text.placed||I.icon.placed)}}for(let E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(let E in w)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=w[E]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){let c={};for(let p of o){let m=p.getBucket(e);m&&p.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,c,p.collisionBoxArray)}}updateBucketOpacities(e,o,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let p=e.layers[0],m=p.layout,x=new it(null,0,!1,!1,!0),w=m.get("text-allow-overlap"),E=m.get("icon-allow-overlap"),I=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=m.get("text-rotation-alignment")==="map",L=m.get("text-pitch-alignment")==="map",F=m.get("icon-text-fit")!=="none",$=new it(null,0,w&&(E||!e.hasIconData()||m.get("icon-optional")),E&&(w||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);let Z=(H,G,ot)=>{for(let dt=0;dt<G/4;dt++)H.opacityVertexArray.emplaceBack(ot);H.hasVisibleVertices=H.hasVisibleVertices||ot!==mi};for(let H=0;H<e.symbolInstances.length;H++){let G=e.symbolInstances.get(H),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:dt,crossTileID:K}=G,lt=this.opacities[K];o[K]?lt=x:lt||(lt=$,this.opacities[K]=lt),o[K]=!0;let mt=G.numIconVertices>0,gt=this.placedOrientations[G.crossTileID],St=gt===l.ai.vertical,Mt=gt===l.ai.horizontal||gt===l.ai.horizontalOnly;if(ot>0||dt>0){let Ct=Kr(lt.text);Z(e.text,ot,St?mi:Ct),Z(e.text,dt,Mt?mi:Ct);let zt=lt.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach(Ut=>{Ut>=0&&(e.text.placedSymbolArray.get(Ut).hidden=zt||St?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=zt||Mt?1:0);let te=this.variableOffsets[G.crossTileID];te&&this.markUsedJustification(e,te.anchor,G,gt);let ze=this.placedOrientations[G.crossTileID];ze&&(this.markUsedJustification(e,"left",G,ze),this.markUsedOrientation(e,ze,G))}if(mt){let Ct=Kr(lt.icon),zt=!(F&&G.verticalPlacedIconSymbolIndex&&St);G.placedIconSymbolIndex>=0&&(Z(e.icon,G.numIconVertices,zt?Ct:mi),e.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=lt.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(Z(e.icon,G.numVerticalIconVertices,zt?mi:Ct),e.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=lt.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Ct=e.collisionArrays[H];if(Ct){let zt=new l.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let ze=!0;if(I){let Ut=this.variableOffsets[K];Ut?(zt=me(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),A&&zt._rotate(L?this.transform.angle:-this.transform.angle)):ze=!1}Ct.textBox&&xe(e.textCollisionBox.collisionVertexArray,lt.text.placed,!ze||St,zt.x,zt.y),Ct.verticalTextBox&&xe(e.textCollisionBox.collisionVertexArray,lt.text.placed,!ze||Mt,zt.x,zt.y)}let te=!!(!Mt&&Ct.verticalIconBox);Ct.iconBox&&xe(e.iconCollisionBox.collisionVertexArray,lt.icon.placed,te,F?zt.x:0,F?zt.y:0),Ct.verticalIconBox&&xe(e.iconCollisionBox.collisionVertexArray,lt.icon.placed,!te,F?zt.x:0,F?zt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){let H=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=H.invProjMatrix,e.placementViewportMatrix=H.viewportMatrix,e.collisionCircleArray=H.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){let c=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function xe(f,e,o,c,p){f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0),f.emplaceBack(e?1:0,o?1:0,c||0,p||0)}let We=Math.pow(2,25),qe=Math.pow(2,24),$e=Math.pow(2,17),Ge=Math.pow(2,16),mn=Math.pow(2,9),hr=Math.pow(2,8),Vr=Math.pow(2,1);function Kr(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let e=f.placed?1:0,o=Math.floor(127*f.opacity);return o*We+e*qe+o*$e+e*Ge+o*mn+e*hr+o*Vr+e}let mi=0;class Ul{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,c,p,m){let x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,m())return!0;return!1}}class hs{constructor(e,o,c,p,m,x,w,E){this.placement=new ae(e,o,x,w,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,o,c){let p=l.h.now(),m=()=>!this._forceFullPlacement&&l.h.now()-p>2;for(;this._currentPlacementIndex>=0;){let x=o[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Ul(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let ps=512/l.N/2;class Hi{constructor(e,o,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};let p=new Map;for(let m=0;m<o.length;m++){let x=o.get(m),w=x.key,E=p.get(w);E?E.push(x):p.set(w,[x])}for(let[m,x]of p){let w={positions:x.map(E=>({x:Math.floor(E.anchorX*ps),y:Math.floor(E.anchorY*ps)})),crossTileIDs:x.map(E=>E.crossTileID)};if(w.positions.length>128){let E=new l.av(w.positions.length,16,Uint16Array);for(let{x:I,y:A}of w.positions)E.add(I,A);E.finish(),delete w.positions,w.index=E}this._symbolsByKey[m]=w}}getScaledCoordinates(e,o){let{x:c,y:p,z:m}=this.tileID.canonical,{x,y:w,z:E}=o.canonical,I=ps/Math.pow(2,E-m),A=(w*l.N+e.anchorY)*I,L=p*l.N*ps;return{x:Math.floor((x*l.N+e.anchorX)*I-c*l.N*ps),y:Math.floor(A-L)}}findMatches(e,o,c){let p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let m=0;m<e.length;m++){let x=e.get(m);if(x.crossTileID)continue;let w=this._symbolsByKey[x.key];if(!w)continue;let E=this.getScaledCoordinates(x,o);if(w.index){let I=w.index.range(E.x-p,E.y-p,E.x+p,E.y+p).sort();for(let A of I){let L=w.crossTileIDs[A];if(!c[L]){c[L]=!0,x.crossTileID=L;break}}}else if(w.positions)for(let I=0;I<w.positions.length;I++){let A=w.positions[I],L=w.crossTileIDs[I];if(Math.abs(A.x-E.x)<=p&&Math.abs(A.y-E.y)<=p&&!c[L]){c[L]=!0,x.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class tr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let o=Math.round((e-this.lng)/360);if(o!==0)for(let c in this.indexes){let p=this.indexes[c],m={};for(let x in p){let w=p[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+o),m[w.tileID.key]=w}this.indexes[c]=m}this.lng=e}addBucket(e,o,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<o.symbolInstances.length;m++)o.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let p=this.usedCrossTileIDs[e.overscaledZ];for(let m in this.indexes){let x=this.indexes[m];if(Number(m)>e.overscaledZ)for(let w in x){let E=x[w];E.tileID.isChildOf(e)&&E.findMatches(o.symbolInstances,e,p)}else{let w=x[e.scaledTo(Number(m)).key];w&&w.findMatches(o.symbolInstances,e,p)}}for(let m=0;m<o.symbolInstances.length;m++){let x=o.symbolInstances.get(m);x.crossTileID||(x.crossTileID=c.generate(),p[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Hi(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(let c of o.getCrossTileIDsLists())for(let p of c)delete this.usedCrossTileIDs[e][p]}removeStaleBuckets(e){let o=!1;for(let c in this.indexes){let p=this.indexes[c];for(let m in p)e[p[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[m]),delete p[m],o=!0)}return o}}class ts{constructor(){this.layerIndexes={},this.crossTileIDs=new tr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,c){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new jl);let m=!1,x={};p.handleWrapJump(c);for(let w of o){let E=w.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(w.tileID,E,this.crossTileIDs)&&(m=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(m=!0),m}pruneUnusedLayers(e){let o={};e.forEach(c=>{o[c]=!0});for(let c in this.layerIndexes)o[c]||delete this.layerIndexes[c]}}let Br=(f,e)=>l.x(f,e&&e.filter(o=>o.identifier!=="source.canvas")),Rn=l.F(l.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ul=l.F(l.ax,["setCenter","setZoom","setBearing","setPitch"]),En=l.aw();class un extends l.E{constructor(e,o={}){super(),this.map=e,this.dispatcher=new Ri(ia(),this,e._getMapId()),this.imageManager=new nr,this.imageManager.setEventedParent(this),this.glyphManager=new Er(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Qo(256,512),this.crossTileSymbolIndex=new ts,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.az());let c=this;this._rtlTextPluginCallback=un.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(m,x)=>{if(l.aA(m),x&&x.every(w=>w))for(let w in c.sourceCaches){let E=c.sourceCaches[w].getSource().type;E!=="vector"&&E!=="geojson"||c.sourceCaches[w].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;let m=this.sourceCaches[p.sourceId];if(!m)return;let x=m.getSource();if(x&&x.vectorLayerIds)for(let w in this._layers){let E=this._layers[w];E.source===x.id&&this._validateLayer(E)}})}loadURL(e,o={},c){this.fire(new l.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;let p=this.map._requestManager.transformRequest(e,qt.Style);this._request=l.f(p,(m,x)=>{this._request=null,m?this.fire(new l.j(m)):x&&this._load(x,o,c)})}loadJSON(e,o={},c){this.fire(new l.k("dataloading",{dataType:"style"})),this._request=l.h.frame(()=>{this._request=null,o.validate=o.validate!==!1,this._load(e,o,c)})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(En,{validate:!1})}_load(e,o,c){var p;let m=o.transformStyle?o.transformStyle(c,e):e;if(!o.validate||!Br(this,l.y(m))){this._loaded=!0,this.stylesheet=m;for(let x in m.sources)this.addSource(x,m.sources[x],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new pi(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){let e=l.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(let o of e){let c=l.aC(o);c.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=c}}_loadSprite(e,o=!1,c=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,m,x,w){let E=Le(p),I=E.length,A=x>1?"@2x":"",L={},F={},$={};for(let{id:Z,url:H}of E){let G=m.transformRequest(m.normalizeSpriteURL(H,A,".json"),qt.SpriteJSON),ot=`${Z}_${G.url}`;L[ot]=l.f(G,(lt,mt)=>{delete L[ot],F[Z]=mt,lr(w,F,$,lt,I)});let dt=m.transformRequest(m.normalizeSpriteURL(H,A,".png"),qt.SpriteImage),K=`${Z}_${dt.url}`;L[K]=Pt.getImage(dt,(lt,mt)=>{delete L[K],$[Z]=mt,lr(w,F,$,lt,I)})}return{cancel(){for(let Z of Object.values(L))Z.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),(p,m)=>{if(this._spriteRequest=null,p)this.fire(new l.j(p));else if(m)for(let x in m){this._spritesImagesIds[x]=[];let w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(E=>!(E in m)):[];for(let E of w)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(let E in m[x]){let I=x==="default"?E:`${x}:${E}`;this._spritesImagesIds[x].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,m[x][E],!1):this.imageManager.addImage(I,m[x][E]),o&&(this._changedImages[I]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),c&&c(p)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(e){let o=this.sourceCaches[e.source];if(!o)return;let c=e.sourceLayer;if(!c)return;let p=o.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.j(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){let o=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o);let c=[];for(let p of e)o[p]&&c.push(o[p]);return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let o=Object.keys(this._layers);for(let c of o){let p=this._layers[c];p.type!=="custom"&&(e[c]=p.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(let e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let o=this._changed;if(this._changed){let p=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(p.length||m.length)&&this._updateWorkerLayers(p,m);for(let x in this._updatedSources){let w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}let c={};for(let p in this.sourceCaches){let m=this.sourceCaches[p];c[p]=m.used,m.used=!1}for(let p of this._order){let m=this._layers[p];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(let p in c){let m=this.sourceCaches[p];c[p]!==m.used&&m.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.z=e.zoom,o&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(e),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){this._checkLoaded();let c=this.serialize();if(e=o.transformStyle?o.transformStyle(c,e):e,Br(this,l.y(e)))return!1;(e=l.aD(e)).layers=l.aB(e.layers);let p=l.aE(c,e).filter(x=>!(x.command in ul));if(p.length===0)return!1;let m=p.filter(x=>!(x.command in Rn));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);for(let x of p)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=e,this._serializedLayers=null,!0}addImage(e,o){if(this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.y.source,`sources.${e}`,o,null,c))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let p=this.sourceCaches[e]=new Vn(e,o,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let c in this._layers)if(this._layers[c].source===e)return this.fire(new l.j(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));let o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,c={}){this._checkLoaded();let p=e.id;if(this.getLayer(p))return void this.fire(new l.j(new Error(`Layer "${p}" already exists on this map.`)));let m;if(e.type==="custom"){if(Br(this,l.aF(e)))return;m=l.aC(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(p,e.source),e=l.aD(e),e=l.e(e,{source:p})),this._validate(l.y.layer,`layers.${p}`,e,{arrayIndex:-1},c))return;m=l.aC(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:p}})}let x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new l.j(new Error(`Cannot add layer "${p}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=m,this._removedLayers[p]&&m.source&&m.type!=="custom"){let w=this._removedLayers[p];delete this._removedLayers[p],w.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;let c=this._order.indexOf(e);this._order.splice(c,1);let p=o?this._order.indexOf(o):this._order.length;o&&p===-1?this.fire(new l.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let o=this._layers[e];if(!o)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);let c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,c){this._checkLoaded();let p=this.getLayer(e);p?p.minzoom===o&&p.maxzoom===c||(o!=null&&(p.minzoom=o),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,c={}){this._checkLoaded();let p=this.getLayer(e);if(p){if(!l.aG(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(l.y.filter,`layers.${p.id}.filter`,o,null,c)||(p.filter=l.aD(o),this._updateLayer(p)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.aD(this.getLayer(e).filter)}setLayoutProperty(e,o,c,p={}){this._checkLoaded();let m=this.getLayer(e);m?l.aG(m.getLayoutProperty(o),c)||(m.setLayoutProperty(o,c,p),this._updateLayer(m)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){let c=this.getLayer(e);if(c)return c.getLayoutProperty(o);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,c,p={}){this._checkLoaded();let m=this.getLayer(e);m?l.aG(m.getPaintProperty(o),c)||(m.setPaintProperty(o,c,p)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();let c=e.source,p=e.sourceLayer,m=this.sourceCaches[c];if(m===void 0)return void this.fire(new l.j(new Error(`The source '${c}' does not exist in the map's style.`)));let x=m.getSource().type;x==="geojson"&&p?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(p,e.id,o)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();let c=e.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new l.j(new Error(`The source '${c}' does not exist in the map's style.`)));let m=p.getSource().type,x=m==="vector"?e.sourceLayer:void 0;m!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,e.id,o):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let o=e.source,c=e.sourceLayer,p=this.sourceCaches[o];if(p!==void 0)return p.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,e.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=l.aH(this.sourceCaches,m=>m.serialize()),o=this._serializeByIds(this._order),c=this.map.getTerrain()||void 0,p=this.stylesheet;return l.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:e,layers:o,terrain:c},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let o=x=>this._layers[x].type==="fill-extrusion",c={},p=[];for(let x=this._order.length-1;x>=0;x--){let w=this._order[x];if(o(w)){c[w]=x;for(let E of e){let I=E[w];if(I)for(let A of I)p.push(A)}}}p.sort((x,w)=>w.intersectionZ-x.intersectionZ);let m=[];for(let x=this._order.length-1;x>=0;x--){let w=this._order[x];if(o(w))for(let E=p.length-1;E>=0;E--){let I=p[E].feature;if(c[I.layer.id]<x)break;m.push(I),p.pop()}else for(let E of e){let I=E[w];if(I)for(let A of I)m.push(A.feature)}}return m}queryRenderedFeatures(e,o,c){o&&o.filter&&this._validate(l.y.filter,"queryRenderedFeatures.filter",o.filter,null,o);let p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(let w of o.layers){let E=this._layers[w];if(!E)return this.fire(new l.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];p[E.source]=!0}}let m=[];o.availableImages=this._availableImages;let x=this._serializedAllLayers();for(let w in this.sourceCaches)o.layers&&!p[w]||m.push(Zr(this.sourceCaches[w],this._layers,x,e,o,c));return this.placement&&m.push(function(w,E,I,A,L,F,$){let Z={},H=F.queryRenderedSymbols(A),G=[];for(let ot of Object.keys(H).map(Number))G.push($[ot]);G.sort(Mo);for(let ot of G){let dt=ot.featureIndex.lookupSymbolFeatures(H[ot.bucketInstanceId],E,ot.bucketIndex,ot.sourceLayerIndex,L.filter,L.layers,L.availableImages,w);for(let K in dt){let lt=Z[K]=Z[K]||[],mt=dt[K];mt.sort((gt,St)=>{let Mt=ot.featureSortOrder;if(Mt){let Ct=Mt.indexOf(gt.featureIndex);return Mt.indexOf(St.featureIndex)-Ct}return St.featureIndex-gt.featureIndex});for(let gt of mt)lt.push(gt)}}for(let ot in Z)Z[ot].forEach(dt=>{let K=dt.feature,lt=I[w[ot].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=lt});return Z}(this._layers,x,this.sourceCaches,e,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,o){o&&o.filter&&this._validate(l.y.filter,"querySourceFeatures.filter",o.filter,null,o);let c=this.sourceCaches[e];return c?function(p,m){let x=p.getRenderableIds().map(I=>p.getTileByID(I)),w=[],E={};for(let I=0;I<x.length;I++){let A=x[I],L=A.tileID.canonical.key;E[L]||(E[L]=!0,A.querySourceFeatures(w,m))}return w}(c,o):[]}addSourceType(e,o,c){return Oi(e)?c(new Error(`A source type called "${e}" already exists.`)):(((p,m)=>{ba[p]=m})(e,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:o.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();let c=this.light.getLight(),p=!1;for(let x in e)if(!l.aG(e[x],c[x])){p=!0;break}if(!p)return;let m={now:l.h.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(m)}_validate(e,o,c,p,m={}){return(!m||m.validate!==!1)&&Br(this,e.call(l.y,l.e({key:o,style:this.serialize(),value:c,styleSpec:l.v},p)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._layers)this._layers[o].setEventedParent(null);for(let o in this.sourceCaches){let c=this.sourceCaches[o];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,c,p,m=!1){let x=!1,w=!1,E={};for(let I of this._order){let A=this._layers[I];if(A.type!=="symbol")continue;if(!E[A.source]){let F=this.sourceCaches[A.source];E[A.source]=F.getRenderableIds(!0).map($=>F.getTileByID($)).sort(($,Z)=>Z.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Z.tileID)?-1:1))}let L=this.crossTileSymbolIndex.addLayer(A,E[A.source],e.center.lng);x=x||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.h.now(),e.zoom))&&(this.pauseablePlacement=new hs(e,this.map.terrain,this._order,m,o,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(let I of this._order){let A=this._layers[I];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.h.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o,c){this.imageManager.getImages(o.icons,c),this._updateTilesForChangedImages();let p=this.sourceCaches[o.source];p&&p.setDependencies(o.tileID.key,o.type,o.icons)}getGlyphs(e,o,c){this.glyphManager.getGlyphs(o.stacks,c);let p=this.sourceCaches[o.source];p&&p.setDependencies(o.tileID.key,o.type,[""])}getResource(e,o,c){return l.m(o,c)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(l.y.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,c={},p){this._checkLoaded();let m=[{id:e,url:o}],x=[...Le(this.stylesheet.sprite),...m];this._validate(l.y.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(m,!0,p))}removeSprite(e){this._checkLoaded();let o=Le(this.stylesheet.sprite);if(o.find(c=>c.id===e)){if(this._spritesImagesIds[e])for(let c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;o.splice(o.findIndex(c=>c.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Le(this.stylesheet.sprite)}setSprite(e,o={},c){this._checkLoaded(),e&&this._validate(l.y.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}un.registerForPluginStateChange=l.aK;var cl=l.Q([{name:"a_pos",type:"Int16",components:2}]),Ns="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";let br={prelude:He(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:He(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:He(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:He(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:He("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:He(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:He(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:He("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:He("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:He("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:He(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:He(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:He(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:He(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:He(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:He(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:He(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:He(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:He(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:He(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:He(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:He(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:He(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:He(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:He("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ns),terrainDepth:He("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ns),terrainCoords:He("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ns)};function He(f,e){let o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/attribute ([\w]+) ([\w]+)/g),p=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=m?m.concat(p):p,w={};return{fragmentSource:f=f.replace(o,(E,I,A,L,F)=>(w[F]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${A} ${L} ${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(o,(E,I,A,L,F)=>{let $=L==="float"?"vec2":"vec4",Z=F.match(/color/)?"color":$;return w[F]?I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${$} a_${F};
varying ${A} ${L} ${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${A} ${$} a_${F};
#else
uniform ${A} ${L} u_${F};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = a_${F};
#else
    ${A} ${L} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${A} ${L} ${F} = unpack_mix_${Z}(a_${F}, u_${F}_t);
#else
    ${A} ${L} ${F} = u_${F};
#endif
`}),staticAttributes:c,staticUniforms:x}}class Bo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,c,p,m,x,w,E,I){this.context=e;let A=this.boundPaintVertexBuffers.length!==p.length;for(let L=0;!A&&L<p.length;L++)this.boundPaintVertexBuffers[L]!==p[L]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==c||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==I?this.freshBind(o,c,p,m,x,w,E,I):(e.bindVertexArray.set(this.vao),w&&w.bind(),m&&m.dynamicDraw&&m.bind(),E&&E.bind(),I&&I.bind())}freshBind(e,o,c,p,m,x,w,E){let I=e.numAttributes,A=this.context,L=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=E,o.enableAttributes(L,e);for(let F of c)F.enableAttributes(L,e);x&&x.enableAttributes(L,e),w&&w.enableAttributes(L,e),E&&E.enableAttributes(L,e),o.bind(),o.setVertexAttribPointers(L,e,m);for(let F of c)F.bind(),F.setVertexAttribPointers(L,e,m);x&&(x.bind(),x.setVertexAttribPointers(L,e,m)),p&&p.bind(),w&&(w.bind(),w.setVertexAttribPointers(L,e,m)),E&&(E.bind(),E.setVertexAttribPointers(L,e,m)),A.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Tr(f){let e=[];for(let o=0;o<f.length;o++){if(f[o]===null)continue;let c=f[o].split(" ");e.push(c.pop())}return e}class Va{constructor(e,o,c,p,m,x){let w=e.gl;this.program=w.createProgram();let E=Tr(o.staticAttributes),I=c?c.getBinderAttributes():[],A=E.concat(I),L=br.prelude.staticUniforms?Tr(br.prelude.staticUniforms):[],F=o.staticUniforms?Tr(o.staticUniforms):[],$=c?c.getBinderUniforms():[],Z=L.concat(F).concat($),H=[];for(let gt of Z)H.indexOf(gt)<0&&H.push(gt);let G=c?c.defines():[];m&&G.push("#define OVERDRAW_INSPECTOR;"),x&&G.push("#define TERRAIN3D;");let ot=G.concat(br.prelude.fragmentSource,o.fragmentSource).join(`
`),dt=G.concat(br.prelude.vertexSource,o.vertexSource).join(`
`),K=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(K,ot),w.compileShader(K),!w.getShaderParameter(K,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(K)}`);w.attachShader(this.program,K);let lt=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(lt,dt),w.compileShader(lt),!w.getShaderParameter(lt,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(lt)}`);w.attachShader(this.program,lt),this.attributes={};let mt={};this.numAttributes=A.length;for(let gt=0;gt<this.numAttributes;gt++)A[gt]&&(w.bindAttribLocation(this.program,gt,A[gt]),this.attributes[A[gt]]=gt);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(lt),w.deleteShader(K);for(let gt=0;gt<H.length;gt++){let St=H[gt];if(St&&!mt[St]){let Mt=w.getUniformLocation(this.program,St);Mt&&(mt[St]=Mt)}}this.fixedUniforms=p(e,mt),this.terrainUniforms=((gt,St)=>({u_depth:new l.aL(gt,St.u_depth),u_terrain:new l.aL(gt,St.u_terrain),u_terrain_dim:new l.aM(gt,St.u_terrain_dim),u_terrain_matrix:new l.aN(gt,St.u_terrain_matrix),u_terrain_unpack:new l.aO(gt,St.u_terrain_unpack),u_terrain_exaggeration:new l.aM(gt,St.u_terrain_exaggeration)}))(e,mt),this.binderUniforms=c?c.getUniforms(e,mt):[]}draw(e,o,c,p,m,x,w,E,I,A,L,F,$,Z,H,G,ot,dt){let K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(p),e.setColorMode(m),e.setCullFace(x),E){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,E.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,E.texture);for(let mt in this.terrainUniforms)this.terrainUniforms[mt].set(E[mt])}for(let mt in this.fixedUniforms)this.fixedUniforms[mt].set(w[mt]);H&&H.setUniforms(e,this.binderUniforms,$,{zoom:Z});let lt=0;switch(o){case K.LINES:lt=2;break;case K.TRIANGLES:lt=3;break;case K.LINE_STRIP:lt=1}for(let mt of F.get()){let gt=mt.vaos||(mt.vaos={});(gt[I]||(gt[I]=new Bo)).bind(e,this,A,H?H.getPaintVertexBuffers():[],L,mt.vertexOffset,G,ot,dt),K.drawElements(o,mt.primitiveLength*lt,K.UNSIGNED_SHORT,mt.primitiveOffset*lt*2)}}}function gi(f,e,o){let c=1/nt(o,1,e.transform.tileZoom),p=Math.pow(2,o.tileID.overscaledZ),m=o.tileSize*Math.pow(2,e.transform.tileZoom)/p,x=m*(o.tileID.canonical.x+o.tileID.wrap*p),w=m*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[c,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}let _u=(f,e,o,c)=>{let p=e.style.light,m=p.properties.get("position"),x=[m.x,m.y,m.z],w=function(){var I=new l.A(9);return l.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();p.properties.get("anchor")==="viewport"&&function(I,A){var L=Math.sin(A),F=Math.cos(A);I[0]=F,I[1]=L,I[2]=0,I[3]=-L,I[4]=F,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(w,-e.transform.angle),function(I,A,L){var F=A[0],$=A[1],Z=A[2];I[0]=F*L[0]+$*L[3]+Z*L[6],I[1]=F*L[1]+$*L[4]+Z*L[7],I[2]=F*L[2]+$*L[5]+Z*L[8]}(x,x,w);let E=p.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+o,u_opacity:c}},Vo=(f,e,o,c,p,m,x)=>l.e(_u(f,e,o,c),gi(m,e,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),Gl=f=>({u_matrix:f}),D=(f,e,o,c)=>l.e(Gl(f),gi(o,e,c)),U=(f,e)=>({u_matrix:f,u_world:e}),ct=(f,e,o,c,p)=>l.e(D(f,e,o,c),{u_world:p}),vt=(f,e,o,c)=>{let p=f.transform,m,x;if(c.paint.get("circle-pitch-alignment")==="map"){let w=nt(o,1,p.zoom);m=!0,x=[w,w]}else m=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,o,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},At=(f,e,o)=>{let c=nt(o,1,e.zoom),p=Math.pow(2,e.zoom-o.tileID.overscaledZ),m=o.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[e.pixelsToGLUnits[0]/(c*p),e.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:m}},Lt=(f,e,o=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:o}),Rt=f=>({u_matrix:f}),fe=(f,e,o,c)=>({u_matrix:f,u_extrude_scale:nt(e,1,o),u_intensity:c});function ve(f,e){let o=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new l.U(0,c/o).toLngLat().lat,new l.U(0,(c+1)/o).toLngLat().lat]}let Ce=(f,e,o,c)=>{let p=f.transform;return{u_matrix:fr(f,e,o,c),u_ratio:1/nt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Ae=(f,e,o,c,p)=>l.e(Ce(f,e,o,p),{u_image:0,u_image_height:c}),Ie=(f,e,o,c,p)=>{let m=f.transform,x=ri(e,m);return{u_matrix:fr(f,e,o,p),u_texsize:e.imageAtlasTexture.size,u_ratio:1/nt(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},dr=(f,e,o,c,p,m)=>{let x=f.lineAtlas,w=ri(e,f.transform),E=o.layout.get("line-cap")==="round",I=x.getDash(c.from,E),A=x.getDash(c.to,E),L=I.width*p.fromScale,F=A.width*p.toScale;return l.e(Ce(f,e,o,m),{u_patternscale_a:[w/L,-I.height/2],u_patternscale_b:[w/F,-A.height/2],u_sdfgamma:x.width/(256*Math.min(L,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:A.y,u_mix:p.t})};function ri(f,e){return 1/nt(f,1,e.tileZoom)}function fr(f,e,o,c){return f.translatePosMatrix(c?c.posMatrix:e.tileID.posMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}let Mi=(f,e,o,c,p)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:o,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(m=p.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:ce(p.paint.get("raster-hue-rotate"))};var m,x};function ce(f){f*=Math.PI/180;let e=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}let Xe=(f,e,o,c,p,m,x,w,E,I)=>{let A=p.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:A.width/A.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+E,u_pitch_with_map:+c,u_texsize:I,u_texture:0}},cn=(f,e,o,c,p,m,x,w,E,I,A)=>{let L=p.transform;return l.e(Xe(f,e,o,c,p,m,x,w,E,I),{u_gamma_scale:c?Math.cos(L._pitch)*L.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+A})},wn=(f,e,o,c,p,m,x,w,E,I)=>l.e(cn(f,e,o,c,p,m,x,w,!0,E,!0),{u_texsize_icon:I,u_texture_icon:1}),Qn=(f,e,o)=>({u_matrix:f,u_opacity:e,u_color:o}),ni=(f,e,o,c,p,m)=>l.e(function(x,w,E,I){let A=E.imageManager.getPattern(x.from.toString()),L=E.imageManager.getPattern(x.to.toString()),{width:F,height:$}=E.imageManager.getPixelSize(),Z=Math.pow(2,I.tileID.overscaledZ),H=I.tileSize*Math.pow(2,E.transform.tileZoom)/Z,G=H*(I.tileID.canonical.x+I.tileID.wrap*Z),ot=H*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[F,$],u_mix:w.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/nt(I,1,E.transform.tileZoom),u_pixel_coord_upper:[G>>16,ot>>16],u_pixel_coord_lower:[65535&G,65535&ot]}}(c,m,o,p),{u_matrix:f,u_opacity:e}),hl={fillExtrusion:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_lightpos:new l.aP(f,e.u_lightpos),u_lightintensity:new l.aM(f,e.u_lightintensity),u_lightcolor:new l.aP(f,e.u_lightcolor),u_vertical_gradient:new l.aM(f,e.u_vertical_gradient),u_opacity:new l.aM(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_lightpos:new l.aP(f,e.u_lightpos),u_lightintensity:new l.aM(f,e.u_lightintensity),u_lightcolor:new l.aP(f,e.u_lightcolor),u_vertical_gradient:new l.aM(f,e.u_vertical_gradient),u_height_factor:new l.aM(f,e.u_height_factor),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade),u_opacity:new l.aM(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world),u_image:new l.aL(f,e.u_image),u_texsize:new l.aQ(f,e.u_texsize),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_scale_with_map:new l.aL(f,e.u_scale_with_map),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_extrude_scale:new l.aQ(f,e.u_extrude_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_matrix:new l.aN(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aM(f,e.u_pixels_to_tile_units),u_extrude_scale:new l.aQ(f,e.u_extrude_scale),u_overscale_factor:new l.aM(f,e.u_overscale_factor)}),collisionCircle:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_inv_matrix:new l.aN(f,e.u_inv_matrix),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_viewport_size:new l.aQ(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new l.aR(f,e.u_color),u_matrix:new l.aN(f,e.u_matrix),u_overlay:new l.aL(f,e.u_overlay),u_overlay_scale:new l.aM(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new l.aM(f,e.u_extrude_scale),u_intensity:new l.aM(f,e.u_intensity),u_matrix:new l.aN(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_world:new l.aQ(f,e.u_world),u_image:new l.aL(f,e.u_image),u_color_ramp:new l.aL(f,e.u_color_ramp),u_opacity:new l.aM(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_latrange:new l.aQ(f,e.u_latrange),u_light:new l.aQ(f,e.u_light),u_shadow:new l.aR(f,e.u_shadow),u_highlight:new l.aR(f,e.u_highlight),u_accent:new l.aR(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_image:new l.aL(f,e.u_image),u_dimension:new l.aQ(f,e.u_dimension),u_zoom:new l.aM(f,e.u_zoom),u_unpack:new l.aO(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_image:new l.aL(f,e.u_image),u_image_height:new l.aM(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texsize:new l.aQ(f,e.u_texsize),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_image:new l.aL(f,e.u_image),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_scale:new l.aP(f,e.u_scale),u_fade:new l.aM(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ratio:new l.aM(f,e.u_ratio),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_units_to_pixels:new l.aQ(f,e.u_units_to_pixels),u_patternscale_a:new l.aQ(f,e.u_patternscale_a),u_patternscale_b:new l.aQ(f,e.u_patternscale_b),u_sdfgamma:new l.aM(f,e.u_sdfgamma),u_image:new l.aL(f,e.u_image),u_tex_y_a:new l.aM(f,e.u_tex_y_a),u_tex_y_b:new l.aM(f,e.u_tex_y_b),u_mix:new l.aM(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_tl_parent:new l.aQ(f,e.u_tl_parent),u_scale_parent:new l.aM(f,e.u_scale_parent),u_buffer_scale:new l.aM(f,e.u_buffer_scale),u_fade_t:new l.aM(f,e.u_fade_t),u_opacity:new l.aM(f,e.u_opacity),u_image0:new l.aL(f,e.u_image0),u_image1:new l.aL(f,e.u_image1),u_brightness_low:new l.aM(f,e.u_brightness_low),u_brightness_high:new l.aM(f,e.u_brightness_high),u_saturation_factor:new l.aM(f,e.u_saturation_factor),u_contrast_factor:new l.aM(f,e.u_contrast_factor),u_spin_weights:new l.aP(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texture:new l.aL(f,e.u_texture)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texture:new l.aL(f,e.u_texture),u_gamma_scale:new l.aM(f,e.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_is_halo:new l.aL(f,e.u_is_halo)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new l.aL(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aL(f,e.u_is_size_feature_constant),u_size_t:new l.aM(f,e.u_size_t),u_size:new l.aM(f,e.u_size),u_camera_to_center_distance:new l.aM(f,e.u_camera_to_center_distance),u_pitch:new l.aM(f,e.u_pitch),u_rotate_symbol:new l.aL(f,e.u_rotate_symbol),u_aspect_ratio:new l.aM(f,e.u_aspect_ratio),u_fade_change:new l.aM(f,e.u_fade_change),u_matrix:new l.aN(f,e.u_matrix),u_label_plane_matrix:new l.aN(f,e.u_label_plane_matrix),u_coord_matrix:new l.aN(f,e.u_coord_matrix),u_is_text:new l.aL(f,e.u_is_text),u_pitch_with_map:new l.aL(f,e.u_pitch_with_map),u_texsize:new l.aQ(f,e.u_texsize),u_texsize_icon:new l.aQ(f,e.u_texsize_icon),u_texture:new l.aL(f,e.u_texture),u_texture_icon:new l.aL(f,e.u_texture_icon),u_gamma_scale:new l.aM(f,e.u_gamma_scale),u_device_pixel_ratio:new l.aM(f,e.u_device_pixel_ratio),u_is_halo:new l.aL(f,e.u_is_halo)}),background:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_opacity:new l.aM(f,e.u_opacity),u_color:new l.aR(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_opacity:new l.aM(f,e.u_opacity),u_image:new l.aL(f,e.u_image),u_pattern_tl_a:new l.aQ(f,e.u_pattern_tl_a),u_pattern_br_a:new l.aQ(f,e.u_pattern_br_a),u_pattern_tl_b:new l.aQ(f,e.u_pattern_tl_b),u_pattern_br_b:new l.aQ(f,e.u_pattern_br_b),u_texsize:new l.aQ(f,e.u_texsize),u_mix:new l.aM(f,e.u_mix),u_pattern_size_a:new l.aQ(f,e.u_pattern_size_a),u_pattern_size_b:new l.aQ(f,e.u_pattern_size_b),u_scale_a:new l.aM(f,e.u_scale_a),u_scale_b:new l.aM(f,e.u_scale_b),u_pixel_coord_upper:new l.aQ(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aQ(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aM(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texture:new l.aL(f,e.u_texture),u_ele_delta:new l.aM(f,e.u_ele_delta)}),terrainDepth:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_ele_delta:new l.aM(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new l.aN(f,e.u_matrix),u_texture:new l.aL(f,e.u_texture),u_terrain_coords_id:new l.aM(f,e.u_terrain_coords_id),u_ele_delta:new l.aM(f,e.u_ele_delta)})};class gn{constructor(e,o,c){this.context=e;let p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let oa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pl{constructor(e,o,c,p){this.length=o.length,this.attributes=c,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.context=e;let m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let c=0;c<this.attributes.length;c++){let p=o.attributes[this.attributes[c].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,o,c){for(let p=0;p<this.attributes.length;p++){let m=this.attributes[p],x=o.attributes[m.name];x!==void 0&&e.vertexAttribPointer(x,m.components,e[oa[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Yi=new WeakMap;function ko(f){var e;if(Yi.has(f))return Yi.get(f);{let o=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Yi.set(f,o),o}}class Oe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ua extends Oe{getDefault(){return l.aT.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Un extends Oe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ti extends Oe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ql extends Oe{getDefault(){return[!0,!0,!0,!0]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class dl extends Oe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class fl extends Oe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class vu extends Oe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class $l extends Oe{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ja extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Zl extends Oe{getDefault(){return[0,1]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class xu extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class ml extends Oe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Xl extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class bu extends Oe{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ss extends Oe{getDefault(){return l.aT.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class sa extends Oe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Mh extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class Dh extends Oe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class np extends Oe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class kh extends Oe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ec extends Oe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Hl extends Oe{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ga extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class wu extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Bs extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Es extends Oe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ic extends Oe{getDefault(){return null}set(e){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cc extends Oe{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;let c=this.gl;ko(c)?c.bindVertexArray(e):(o=c.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class gl extends Oe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class po extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Su extends Oe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class fo extends Oe{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class ds extends fo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class yl extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Eu extends fo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ye{constructor(e,o,c,p,m){this.context=e,this.width=o,this.height=c;let x=e.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new ds(e,w),p)this.depthAttachment=m?new Eu(e,w):new yl(e,w);else if(m)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){let e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){let c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class wr{constructor(e,o,c){this.blendFunction=e,this.blendColor=o,this.mask=c}}wr.Replace=[1,0],wr.disabled=new wr(wr.Replace,l.aT.transparent,[!1,!1,!1,!1]),wr.unblended=new wr(wr.Replace,l.aT.transparent,[!0,!0,!0,!0]),wr.alphaBlended=new wr([1,771],l.aT.transparent,[!0,!0,!0,!0]);class ip{constructor(e){var o,c;if(this.gl=e,this.clearColor=new Ua(this),this.clearDepth=new Un(this),this.clearStencil=new ti(this),this.colorMask=new ql(this),this.depthMask=new dl(this),this.stencilMask=new fl(this),this.stencilFunc=new vu(this),this.stencilOp=new $l(this),this.stencilTest=new ja(this),this.depthRange=new Zl(this),this.depthTest=new xu(this),this.depthFunc=new ml(this),this.blend=new Xl(this),this.blendFunc=new bu(this),this.blendColor=new Ss(this),this.blendEquation=new sa(this),this.cullFace=new Mh(this),this.cullFaceSide=new Dh(this),this.frontFace=new np(this),this.program=new kh(this),this.activeTexture=new ec(this),this.viewport=new Hl(this),this.bindFramebuffer=new Ga(this),this.bindRenderbuffer=new wu(this),this.bindTexture=new Bs(this),this.bindVertexBuffer=new Es(this),this.bindElementBuffer=new Ic(this),this.bindVertexArray=new Cc(this),this.pixelStoreUnpack=new gl(this),this.pixelStoreUnpackPremultiplyAlpha=new po(this),this.pixelStoreUnpackFlipY=new Su(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ko(e)){this.HALF_FLOAT=e.HALF_FLOAT;let p=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:p?.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:p?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let p=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new gn(this,e,o)}createVertexBuffer(e,o,c){return new pl(this,e,o,c)}createRenderbuffer(e,o,c){let p=this.gl,m=p.createRenderbuffer();return this.bindRenderbuffer.set(m),p.renderbufferStorage(p.RENDERBUFFER,e,o,c),this.bindRenderbuffer.set(null),m}createFramebuffer(e,o,c,p){return new Ye(this,e,o,c,p)}clear({color:e,depth:o,stencil:c}){let p=this.gl,m=0;e&&(m|=p.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(m|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),c!==void 0&&(m|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.aG(e.blendFunction,wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ko(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return ko(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Be{constructor(e,o,c){this.func=e,this.mask=o,this.range=c}}Be.ReadOnly=!1,Be.ReadWrite=!0,Be.disabled=new Be(519,Be.ReadOnly,[0,1]);let es=7680;class gr{constructor(e,o,c,p,m,x){this.test=e,this.ref=o,this.mask=c,this.fail=p,this.depthFail=m,this.pass=x}}gr.disabled=new gr({func:519,mask:0},0,0,es,es,es);class ur{constructor(e,o,c){this.enable=e,this.mode=o,this.frontFace=c}}let mo;function wa(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I=f.useProgram("collisionBox"),A=[],L=0,F=0;for(let K=0;K<c.length;K++){let lt=c[K],mt=e.getTile(lt),gt=mt.getBucket(o);if(!gt)continue;let St=lt.posMatrix;p[0]===0&&p[1]===0||(St=f.translatePosMatrix(lt.posMatrix,mt,p,m));let Mt=x?gt.textCollisionBox:gt.iconCollisionBox,Ct=gt.collisionCircleArray;if(Ct.length>0){let zt=l.Z(),te=St;l.aU(zt,gt.placementInvProjMatrix,f.transform.glCoordMatrix),l.aU(zt,zt,gt.placementViewportMatrix),A.push({circleArray:Ct,circleOffset:F,transform:te,invTransform:zt,coord:lt}),L+=Ct.length/4,F=L}Mt&&I.draw(w,E.LINES,Be.disabled,gr.disabled,f.colorModeForRenderPass(),ur.disabled,At(St,f.transform,mt),f.style.map.terrain&&f.style.map.terrain.getTerrainData(lt),o.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,f.transform.zoom,null,null,Mt.collisionVertexBuffer)}if(!x||!A.length)return;let $=f.useProgram("collisionCircle"),Z=new l.aV;Z.resize(4*L),Z._trim();let H=0;for(let K of A)for(let lt=0;lt<K.circleArray.length/4;lt++){let mt=4*lt,gt=K.circleArray[mt+0],St=K.circleArray[mt+1],Mt=K.circleArray[mt+2],Ct=K.circleArray[mt+3];Z.emplace(H++,gt,St,Mt,Ct,0),Z.emplace(H++,gt,St,Mt,Ct,1),Z.emplace(H++,gt,St,Mt,Ct,2),Z.emplace(H++,gt,St,Mt,Ct,3)}(!mo||mo.length<2*L)&&(mo=function(K){let lt=2*K,mt=new l.aX;mt.resize(lt),mt._trim();for(let gt=0;gt<lt;gt++){let St=6*gt;mt.uint16[St+0]=4*gt+0,mt.uint16[St+1]=4*gt+1,mt.uint16[St+2]=4*gt+2,mt.uint16[St+3]=4*gt+2,mt.uint16[St+4]=4*gt+3,mt.uint16[St+5]=4*gt+0}return mt}(L));let G=w.createIndexBuffer(mo,!0),ot=w.createVertexBuffer(Z,l.aW.members,!0);for(let K of A){let lt={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(dt=f.transform).cameraToCenterDistance,u_viewport_size:[dt.width,dt.height]};$.draw(w,E.TRIANGLES,Be.disabled,gr.disabled,f.colorModeForRenderPass(),ur.disabled,lt,f.style.map.terrain&&f.style.map.terrain.getTerrainData(K.coord),o.id,ot,G,l.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,f.transform.zoom,null,null,null)}var dt;ot.destroy(),G.destroy()}ur.disabled=new ur(!1,1029,2305),ur.backCCW=new ur(!0,1029,2305);let qa=l.ao(new Float32Array(16));function rs(f,e,o,c,p,m){let{horizontalAlign:x,verticalAlign:w}=l.au(f);return new l.P((-(x-.5)*e/p+c[0])*m,(-(w-.5)*o/p+c[1])*m)}function _l(f,e,o,c,p,m,x,w,E,I,A){let L=f.text.placedSymbolArray,F=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,Z={};F.clear();for(let H=0;H<L.length;H++){let G=L.get(H),ot=G.hidden||!G.crossTileID||f.allowVerticalPlacement&&!G.placedOrientation?null:c[G.crossTileID];if(ot){let dt=new l.P(G.anchorX,G.anchorY),K=Cr(dt,o?x:m,A),lt=cs(p.cameraToCenterDistance,K.signedDistanceFromCamera),mt=l.aj(f.textSizeData,E,G)*lt/l.ap;o&&(mt*=f.tilePixelRatio/w);let{width:gt,height:St,anchor:Mt,textOffset:Ct,textBoxScale:zt}=ot,te=rs(Mt,gt,St,Ct,zt,mt),ze=o?Cr(dt.add(te),m,A).point:K.point.add(e?te.rotate(-p.angle):te),Ut=f.allowVerticalPlacement&&G.placedOrientation===l.ai.vertical?Math.PI/2:0;for(let pe=0;pe<G.numGlyphs;pe++)l.ak(F,ze,Ut);I&&G.associatedIconIndex>=0&&(Z[G.associatedIconIndex]={shiftedAnchor:ze,angle:Ut})}else j(G.numGlyphs,F)}if(I){$.clear();let H=f.icon.placedSymbolArray;for(let G=0;G<H.length;G++){let ot=H.get(G);if(ot.hidden)j(ot.numGlyphs,$);else{let dt=Z[G];if(dt)for(let K=0;K<ot.numGlyphs;K++)l.ak($,dt.shiftedAnchor,dt.angle);else j(ot.numGlyphs,$)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(F)}function $a(f,e,o){return o.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Vs(f,e,o,c,p,m,x,w,E,I,A,L){let F=f.context,$=F.gl,Z=f.transform,H=w==="map",G=E==="map",ot=w!=="viewport"&&o.layout.get("symbol-placement")!=="point",dt=H&&!G&&!ot,K=!o.layout.get("symbol-sort-key").isConstant(),lt=!1,mt=f.depthModeForSublayer(0,Be.ReadOnly),gt=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),St=[];for(let Mt of c){let Ct=e.getTile(Mt),zt=Ct.getBucket(o);if(!zt)continue;let te=p?zt.text:zt.icon;if(!te||!te.segments.get().length||!te.hasVisibleVertices)continue;let ze=te.programConfigurations.get(o.id),Ut=p||zt.sdfIcons,pe=p?zt.textSizeData:zt.iconSizeData,re=G||Z.pitch!==0,or=f.useProgram($a(Ut,p,zt),ze),De=l.ah(pe,Z.zoom),Te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Mt),Re,Rr,pr,yn,Qr=[0,0],jr=null;if(p)Rr=Ct.glyphAtlasTexture,pr=$.LINEAR,Re=Ct.glyphAtlasTexture.size,zt.iconsInText&&(Qr=Ct.imageAtlasTexture.size,jr=Ct.imageAtlasTexture,yn=re||f.options.rotating||f.options.zooming||pe.kind==="composite"||pe.kind==="camera"?$.LINEAR:$.NEAREST);else{let Or=o.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear;Rr=Ct.imageAtlasTexture,pr=Ut||f.options.rotating||f.options.zooming||Or||re?$.LINEAR:$.NEAREST,Re=Ct.imageAtlasTexture.size}let vi=nt(Ct,1,f.transform.zoom),_r=Ot(Mt.posMatrix,G,H,f.transform,vi),vo=Pi(Mt.posMatrix,G,H,f.transform,vi),xo=gt&&zt.hasTextData(),gs=o.layout.get("icon-text-fit")!=="none"&&xo&&zt.hasIconData();if(ot){let Or=f.style.map.terrain?(oi,Fr)=>f.style.map.terrain.getElevation(Mt,oi,Fr):null,tn=o.layout.get("text-rotation-alignment")==="map";Nt(zt,Mt.posMatrix,f,p,_r,vo,G,I,tn,Or)}let $s=f.translatePosMatrix(Mt.posMatrix,Ct,m,x),Pa=ot||p&&gt||gs?qa:_r,In=f.translatePosMatrix(vo,Ct,m,x,!0),_n=Ut&&o.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Zn;Zn=Ut?zt.iconsInText?wn(pe.kind,De,dt,G,f,$s,Pa,In,Re,Qr):cn(pe.kind,De,dt,G,f,$s,Pa,In,p,Re,!0):Xe(pe.kind,De,dt,G,f,$s,Pa,In,p,Re);let Zs={program:or,buffers:te,uniformValues:Zn,atlasTexture:Rr,atlasTextureIcon:jr,atlasInterpolation:pr,atlasInterpolationIcon:yn,isSDF:Ut,hasHalo:_n};if(K&&zt.canOverlap){lt=!0;let Or=te.segments.get();for(let tn of Or)St.push({segments:new l.S([tn]),sortKey:tn.sortKey,state:Zs,terrainData:Te})}else St.push({segments:te.segments,sortKey:0,state:Zs,terrainData:Te})}lt&&St.sort((Mt,Ct)=>Mt.sortKey-Ct.sortKey);for(let Mt of St){let Ct=Mt.state;if(F.activeTexture.set($.TEXTURE0),Ct.atlasTexture.bind(Ct.atlasInterpolation,$.CLAMP_TO_EDGE),Ct.atlasTextureIcon&&(F.activeTexture.set($.TEXTURE1),Ct.atlasTextureIcon&&Ct.atlasTextureIcon.bind(Ct.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ct.isSDF){let zt=Ct.uniformValues;Ct.hasHalo&&(zt.u_is_halo=1,Yl(Ct.buffers,Mt.segments,o,f,Ct.program,mt,A,L,zt,Mt.terrainData)),zt.u_is_halo=0}Yl(Ct.buffers,Mt.segments,o,f,Ct.program,mt,A,L,Ct.uniformValues,Mt.terrainData)}}function Yl(f,e,o,c,p,m,x,w,E,I){let A=c.context;p.draw(A,A.gl.TRIANGLES,m,x,w,ur.disabled,E,I,o.id,f.layoutVertexBuffer,f.indexBuffer,e,o.paint,c.transform.zoom,f.programConfigurations.get(o.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function aa(f,e,o,c,p){if(!o||!c||!c.imageAtlas)return;let m=c.imageAtlas.patternPositions,x=m[o.to.toString()],w=m[o.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){let E=p.getPaintProperty(e);x=m[E],w=m[E]}x&&w&&f.setConstantPatternPositions(x,w)}function Sa(f,e,o,c,p,m,x){let w=f.context.gl,E="fill-pattern",I=o.paint.get(E),A=I&&I.constantOr(1),L=o.getCrossfadeParameters(),F,$,Z,H,G;x?($=A&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):($=A?"fillPattern":"fill",F=w.TRIANGLES);let ot=I.constantOr(null);for(let dt of c){let K=e.getTile(dt);if(A&&!K.patternsLoaded())continue;let lt=K.getBucket(o);if(!lt)continue;let mt=lt.programConfigurations.get(o.id),gt=f.useProgram($,mt),St=f.style.map.terrain&&f.style.map.terrain.getTerrainData(dt);A&&(f.context.activeTexture.set(w.TEXTURE0),K.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),mt.updatePaintBuffers(L)),aa(mt,E,ot,K,o);let Mt=St?dt:null,Ct=f.translatePosMatrix(Mt?Mt.posMatrix:dt.posMatrix,K,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(x){H=lt.indexBuffer2,G=lt.segments2;let zt=[w.drawingBufferWidth,w.drawingBufferHeight];Z=$==="fillOutlinePattern"&&A?ct(Ct,f,L,K,zt):U(Ct,zt)}else H=lt.indexBuffer,G=lt.segments,Z=A?D(Ct,f,L,K):Gl(Ct);gt.draw(f.context,F,p,f.stencilModeForClipping(dt),m,ur.disabled,Z,St,o.id,lt.layoutVertexBuffer,H,G,o.paint,f.transform.zoom,mt)}}function Ea(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I="fill-extrusion-pattern",A=o.paint.get(I),L=A.constantOr(1),F=o.getCrossfadeParameters(),$=o.paint.get("fill-extrusion-opacity"),Z=A.constantOr(null);for(let H of c){let G=e.getTile(H),ot=G.getBucket(o);if(!ot)continue;let dt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(H),K=ot.programConfigurations.get(o.id),lt=f.useProgram(L?"fillExtrusionPattern":"fillExtrusion",K);L&&(f.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),K.updatePaintBuffers(F)),aa(K,I,Z,G,o);let mt=f.translatePosMatrix(H.posMatrix,G,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),gt=o.paint.get("fill-extrusion-vertical-gradient"),St=L?Vo(mt,f,gt,$,H,F,G):_u(mt,f,gt,$);lt.draw(w,w.gl.TRIANGLES,p,m,x,ur.backCCW,St,dt,o.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,o.paint,f.transform.zoom,K,f.style.map.terrain&&ot.centroidVertexBuffer)}}function zh(f,e,o,c,p,m,x){let w=f.context,E=w.gl,I=o.fbo;if(!I)return;let A=f.useProgram("hillshade"),L=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get()),A.draw(w,E.TRIANGLES,p,m,x,ur.disabled,((F,$,Z,H)=>{let G=Z.paint.get("hillshade-shadow-color"),ot=Z.paint.get("hillshade-highlight-color"),dt=Z.paint.get("hillshade-accent-color"),K=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=F.transform.angle);let lt=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix($.tileID.toUnwrapped(),lt),u_image:0,u_latrange:ve(0,$.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),K],u_shadow:G,u_highlight:ot,u_accent:dt}})(f,o,c,L?e:null),L,c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Wl(f,e,o,c,p,m){let x=f.context,w=x.gl,E=e.dem;if(E&&E.data){let I=E.dim,A=E.stride,L=E.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(A),e.demTexture){let $=e.demTexture;$.update(L,{premultiply:!1}),$.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new je(x,L,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){let $=new je(x,{width:I,height:I,data:null},w.RGBA);$.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=x.createFramebuffer(I,I,!0,!1),F.colorAttachment.set($.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,I,I]),f.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,c,p,m,ur.disabled,(($,Z)=>{let H=Z.stride,G=l.Z();return l.aS(G,0,l.N,-l.N,0,0,1),l.$(G,G,[0,-l.N,0]),{u_matrix:G,u_image:1,u_dimension:[H,H],u_zoom:$.overscaledZ,u_unpack:Z.getUnpackVector()}})(e.tileID,E),null,o.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function rc(f,e,o,c,p,m){let x=c.paint.get("raster-fade-duration");if(!m&&x>0){let w=l.h.now(),E=(w-f.timeAdded)/x,I=e?(w-e.timeAdded)/x:-1,A=o.getSource(),L=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),$=F&&f.refreshedUponExpiration?1:l.ad(F?E:1-I,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}let Za=new l.aT(1,0,0,1),vl=new l.aT(0,1,0,1),Ts=new l.aT(0,0,1,1),Pc=new l.aT(1,0,1,1),Ta=new l.aT(0,1,1,1);function la(f,e,o,c){ua(f,0,e+o/2,f.transform.width,o,c)}function xl(f,e,o,c){ua(f,e-o/2,0,o,f.transform.height,c)}function ua(f,e,o,c,p,m){let x=f.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,o*f.pixelRatio,c*f.pixelRatio,p*f.pixelRatio),x.clear({color:m}),w.disable(w.SCISSOR_TEST)}function Tu(f,e,o){let c=f.context,p=c.gl,m=o.posMatrix,x=f.useProgram("debug"),w=Be.disabled,E=gr.disabled,I=f.colorModeForRenderPass(),A="$debug",L=f.style.map.terrain&&f.style.map.terrain.getTerrainData(o);c.activeTexture.set(p.TEXTURE0);let F=e.getTileByID(o.key).latestRawTileData,$=Math.floor((F&&F.byteLength||0)/1024),Z=e.getTile(o).tileSize,H=512/Math.min(Z,512)*(o.overscaledZ/f.transform.zoom)*.5,G=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(G+=` => ${o.overscaledZ}`),function(ot,dt){ot.initDebugOverlayCanvas();let K=ot.debugOverlayCanvas,lt=ot.context.gl,mt=ot.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,K.width,K.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(dt,5,5),mt.strokeText(dt,5,5),ot.debugOverlayTexture.update(K),ot.debugOverlayTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE)}(f,`${G} ${$}kB`),x.draw(c,p.TRIANGLES,w,E,wr.alphaBlended,ur.disabled,Lt(m,l.aT.transparent,H),null,A,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(c,p.LINE_STRIP,w,E,I,ur.disabled,Lt(m,l.aT.red),L,A,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Ir(f,e,o){let c=f.context,p=c.gl,m=f.colorModeForRenderPass(),x=new Be(p.LEQUAL,Be.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),E=e.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,f.width,f.height]);for(let I of o){let A=f.renderToTexture.getTexture(I),L=e.getTerrainData(I.tileID);c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A.texture);let F={u_matrix:f.transform.calculatePosMatrix(I.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(f.transform.zoom)};w.draw(c,p.TRIANGLES,x,gr.disabled,m,ur.backCCW,F,L,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class ns{constructor(e,o){this.context=new ip(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.Z(),renderTime:0},this.setup(),this.numSublayers=Vn.maxUnderzooming+Vn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ts}resize(e,o,c){if(this.width=Math.floor(e*c),this.height=Math.floor(o*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style._order)this.style._layers[p].resize()}setup(){let e=this.context,o=new l.a_;o.emplaceBack(0,0),o.emplaceBack(l.N,0),o.emplaceBack(0,l.N),o.emplaceBack(l.N,l.N),this.tileExtentBuffer=e.createVertexBuffer(o,cl.members),this.tileExtentSegments=l.S.simpleSegment(0,0,4,2);let c=new l.a_;c.emplaceBack(0,0),c.emplaceBack(l.N,0),c.emplaceBack(0,l.N),c.emplaceBack(l.N,l.N),this.debugBuffer=e.createVertexBuffer(c,cl.members),this.debugSegments=l.S.simpleSegment(0,0,4,5);let p=new l.V;p.emplaceBack(0,0,0,0),p.emplaceBack(l.N,0,l.N,0),p.emplaceBack(0,l.N,0,l.N),p.emplaceBack(l.N,l.N,l.N,l.N),this.rasterBoundsBuffer=e.createVertexBuffer(p,ln.members),this.rasterBoundsSegments=l.S.simpleSegment(0,0,4,2);let m=new l.a_;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,cl.members),this.viewportSegments=l.S.simpleSegment(0,0,4,2);let x=new l.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);let w=new l.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);let E=this.context.gl;this.stencilClearMode=new gr({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){let e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let c=l.Z();l.aS(c,0,this.width,this.height,0,0,1),l.a0(c,c,[o.drawingBufferWidth,o.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,o.TRIANGLES,Be.disabled,this.stencilClearMode,wr.disabled,ur.disabled,Rt(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source;let c=this.context,p=c.gl;this.nextStencilID+o.length>256&&this.clearStencil(),c.setColorMode(wr.disabled),c.setDepthMode(Be.disabled);let m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let x of o){let w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);m.draw(c,p.TRIANGLES,Be.disabled,new gr({func:p.ALWAYS,mask:0},w,255,p.KEEP,p.KEEP,p.REPLACE),wr.disabled,ur.disabled,Rt(x.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,o=this.context.gl;return new gr({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){let o=this.context.gl;return new gr({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(e){let o=this.context.gl,c=e.sort((x,w)=>w.overscaledZ-x.overscaledZ),p=c[c.length-1].overscaledZ,m=c[0].overscaledZ-p+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();let x={};for(let w=0;w<m;w++)x[w+p]=new gr({func:o.GEQUAL,mask:255},w+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=m,[x,c]}return[{[p]:gr.disabled},c]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new wr([e.CONSTANT_COLOR,e.ONE],new l.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?wr.unblended:wr.alphaBlended}depthModeForSublayer(e,o,c){if(!this.opaquePassEnabledForLayer())return Be.disabled;let p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Be(c||this.context.gl.LEQUAL,o,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(l.h.now()),this.imageManager.beginFrame();let c=this.style._order,p=this.style.sourceCaches,m={},x={},w={};for(let E in p){let I=p[E];I.used&&I.prepare(this.context),m[E]=I.getVisibleCoordinates(),x[E]=m[E].slice().reverse(),w[E]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<c.length;E++)if(this.style._layers[c[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;let E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(l.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(I,A){let L=I.context,F=L.gl,$=wr.unblended,Z=new Be(F.LEQUAL,Be.ReadWrite,[0,1]),H=A.getTerrainMesh(),G=A.sourceCache.getRenderableTiles(),ot=I.useProgram("terrainDepth");L.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),L.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),L.clear({color:l.aT.transparent,depth:1});for(let dt of G){let K=A.getTerrainData(dt.tileID),lt={u_matrix:I.transform.calculatePosMatrix(dt.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(I.transform.zoom)};ot.draw(L,F.TRIANGLES,Z,gr.disabled,$,ur.backCCW,lt,K,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}L.bindFramebuffer.set(null),L.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain),function(I,A){let L=I.context,F=L.gl,$=wr.unblended,Z=new Be(F.LEQUAL,Be.ReadWrite,[0,1]),H=A.getTerrainMesh(),G=A.getCoordsTexture(),ot=A.sourceCache.getRenderableTiles(),dt=I.useProgram("terrainCoords");L.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),L.viewport.set([0,0,I.width/devicePixelRatio,I.height/devicePixelRatio]),L.clear({color:l.aT.transparent,depth:1}),A.coordsIndex=[];for(let K of ot){let lt=A.getTerrainData(K.tileID);L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,G.texture);let mt={u_matrix:I.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(I.transform.zoom)};dt.draw(L,F.TRIANGLES,Z,gr.disabled,$,ur.backCCW,mt,lt,"terrain",H.vertexBuffer,H.indexBuffer,H.segments),A.coordsIndex.push(K.tileID.key)}L.bindFramebuffer.set(null),L.viewport.set([0,0,I.width,I.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(let E of c){let I=this.style._layers[E];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;let A=x[I.source];(I.type==="custom"||A.length)&&this.renderLayer(this,p[I.source],I,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.aT.black:l.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){let E=this.style._layers[c[this.currentLayer]],I=p[E.source],A=m[E.source];this._renderTileClippingMasks(E,A),this.renderLayer(this,I,E,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){let E=this.style._layers[c[this.currentLayer]],I=p[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;let A=(E.type==="symbol"?w:x)[E.source];this._renderTileClippingMasks(E,m[E.source]),this.renderLayer(this,I,E,A)}if(this.options.showTileBoundaries){let E=function(I,A){let L=null,F=Object.values(I._layers).flatMap(G=>G.source&&!G.isHidden(A)?[I.sourceCaches[G.source]]:[]),$=F.filter(G=>G.getSource().type==="vector"),Z=F.filter(G=>G.getSource().type!=="vector"),H=G=>{(!L||L.getSource().maxzoom<G.getSource().maxzoom)&&(L=G)};return $.forEach(G=>H(G)),L||Z.forEach(G=>H(G)),L}(this.style,this.transform.zoom);E&&function(I,A,L){for(let F=0;F<L.length;F++)Tu(I,A,L[F])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){let I=E.transform.padding;la(E,E.transform.height-(I.top||0),3,Za),la(E,I.bottom||0,3,vl),xl(E,I.left||0,3,Ts),xl(E,E.transform.width-(I.right||0),3,Pc);let A=E.transform.centerPoint;(function(L,F,$,Z){ua(L,F-1,$-10,2,20,Z),ua(L,F-10,$-1,20,2,Z)})(E,A.x,E.transform.height-A.y,Ta)}(this),this.context.setDefault()}renderLayer(e,o,c,p){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(p||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(m,x,w,E,I){if(m.renderPass!=="translucent")return;let A=gr.disabled,L=m.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,$,Z,H,G,ot,dt){let K=$.transform,lt=G==="map",mt=ot==="map";for(let gt of F){let St=H.getTile(gt),Mt=St.getBucket(Z);if(!Mt||!Mt.text||!Mt.text.segments.get().length)continue;let Ct=l.ah(Mt.textSizeData,K.zoom),zt=nt(St,1,$.transform.zoom),te=Ot(gt.posMatrix,mt,lt,$.transform,zt),ze=Z.layout.get("icon-text-fit")!=="none"&&Mt.hasIconData();if(Ct){let Ut=Math.pow(2,K.zoom-St.tileID.overscaledZ);_l(Mt,lt,mt,dt,K,te,gt.posMatrix,Ut,Ct,ze,$.style.map.terrain?(pe,re)=>$.style.map.terrain.getElevation(gt,pe,re):null)}}}(E,m,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),I),w.paint.get("icon-opacity").constantOr(1)!==0&&Vs(m,x,w,E,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),A,L),w.paint.get("text-opacity").constantOr(1)!==0&&Vs(m,x,w,E,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),A,L),x.map.showCollisionBoxes&&(wa(m,x,w,E,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),wa(m,x,w,E,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(e,o,c,p,this.style.placement.variableOffsets);break;case"circle":(function(m,x,w,E){if(m.renderPass!=="translucent")return;let I=w.paint.get("circle-opacity"),A=w.paint.get("circle-stroke-width"),L=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(A.constantOr(1)===0||L.constantOr(1)===0))return;let $=m.context,Z=$.gl,H=m.depthModeForSublayer(0,Be.ReadOnly),G=gr.disabled,ot=m.colorModeForRenderPass(),dt=[];for(let K=0;K<E.length;K++){let lt=E[K],mt=x.getTile(lt),gt=mt.getBucket(w);if(!gt)continue;let St=gt.programConfigurations.get(w.id),Mt=m.useProgram("circle",St),Ct=gt.layoutVertexBuffer,zt=gt.indexBuffer,te=m.style.map.terrain&&m.style.map.terrain.getTerrainData(lt),ze={programConfiguration:St,program:Mt,layoutVertexBuffer:Ct,indexBuffer:zt,uniformValues:vt(m,lt,mt,w),terrainData:te};if(F){let Ut=gt.segments.get();for(let pe of Ut)dt.push({segments:new l.S([pe]),sortKey:pe.sortKey,state:ze})}else dt.push({segments:gt.segments,sortKey:0,state:ze})}F&&dt.sort((K,lt)=>K.sortKey-lt.sortKey);for(let K of dt){let{programConfiguration:lt,program:mt,layoutVertexBuffer:gt,indexBuffer:St,uniformValues:Mt,terrainData:Ct}=K.state;mt.draw($,Z.TRIANGLES,H,G,ot,ur.disabled,Mt,Ct,w.id,gt,St,K.segments,w.paint,m.transform.zoom,lt)}})(e,o,c,p);break;case"heatmap":(function(m,x,w,E){if(w.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){let I=m.context,A=I.gl,L=gr.disabled,F=new wr([A.ONE,A.ONE],l.aT.transparent,[!0,!0,!0,!0]);(function($,Z,H){let G=$.gl;$.activeTexture.set(G.TEXTURE1),$.viewport.set([0,0,Z.width/4,Z.height/4]);let ot=H.heatmapFbo;if(ot)G.bindTexture(G.TEXTURE_2D,ot.colorAttachment.get()),$.bindFramebuffer.set(ot.framebuffer);else{let dt=G.createTexture();G.bindTexture(G.TEXTURE_2D,dt),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ot=H.heatmapFbo=$.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(K,lt,mt,gt){var St,Mt;let Ct=K.gl,zt=(St=K.HALF_FLOAT)!==null&&St!==void 0?St:Ct.UNSIGNED_BYTE,te=(Mt=K.RGBA16F)!==null&&Mt!==void 0?Mt:Ct.RGBA;Ct.texImage2D(Ct.TEXTURE_2D,0,te,lt.width/4,lt.height/4,0,Ct.RGBA,zt,null),gt.colorAttachment.set(mt)}($,Z,dt,ot)}})(I,m,w),I.clear({color:l.aT.transparent});for(let $=0;$<E.length;$++){let Z=E[$];if(x.hasRenderableParent(Z))continue;let H=x.getTile(Z),G=H.getBucket(w);if(!G)continue;let ot=G.programConfigurations.get(w.id),dt=m.useProgram("heatmap",ot),{zoom:K}=m.transform;dt.draw(I,A.TRIANGLES,Be.disabled,L,F,ur.disabled,fe(Z.posMatrix,H,K,w.paint.get("heatmap-intensity")),null,w.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,w.paint,m.transform.zoom,ot)}I.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(I,A){let L=I.context,F=L.gl,$=A.heatmapFbo;if(!$)return;L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,$.colorAttachment.get()),L.activeTexture.set(F.TEXTURE1);let Z=A.colorRampTexture;Z||(Z=A.colorRampTexture=new je(L,A.colorRamp,F.RGBA)),Z.bind(F.LINEAR,F.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(L,F.TRIANGLES,Be.disabled,gr.disabled,I.colorModeForRenderPass(),ur.disabled,((H,G,ot,dt)=>{let K=l.Z();l.aS(K,0,H.width,H.height,0,0,1);let lt=H.context.gl;return{u_matrix:K,u_world:[lt.drawingBufferWidth,lt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}})(I,A),null,A.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,A.paint,I.transform.zoom)}(m,w))})(e,o,c,p);break;case"line":(function(m,x,w,E){if(m.renderPass!=="translucent")return;let I=w.paint.get("line-opacity"),A=w.paint.get("line-width");if(I.constantOr(1)===0||A.constantOr(1)===0)return;let L=m.depthModeForSublayer(0,Be.ReadOnly),F=m.colorModeForRenderPass(),$=w.paint.get("line-dasharray"),Z=w.paint.get("line-pattern"),H=Z.constantOr(1),G=w.paint.get("line-gradient"),ot=w.getCrossfadeParameters(),dt=H?"linePattern":$?"lineSDF":G?"lineGradient":"line",K=m.context,lt=K.gl,mt=!0;for(let gt of E){let St=x.getTile(gt);if(H&&!St.patternsLoaded())continue;let Mt=St.getBucket(w);if(!Mt)continue;let Ct=Mt.programConfigurations.get(w.id),zt=m.context.program.get(),te=m.useProgram(dt,Ct),ze=mt||te.program!==zt,Ut=m.style.map.terrain&&m.style.map.terrain.getTerrainData(gt),pe=Z.constantOr(null);if(pe&&St.imageAtlas){let De=St.imageAtlas,Te=De.patternPositions[pe.to.toString()],Re=De.patternPositions[pe.from.toString()];Te&&Re&&Ct.setConstantPatternPositions(Te,Re)}let re=Ut?gt:null,or=H?Ie(m,St,w,ot,re):$?dr(m,St,w,$,ot,re):G?Ae(m,St,w,Mt.lineClipsArray.length,re):Ce(m,St,w,re);if(H)K.activeTexture.set(lt.TEXTURE0),St.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),Ct.updatePaintBuffers(ot);else if($&&(ze||m.lineAtlas.dirty))K.activeTexture.set(lt.TEXTURE0),m.lineAtlas.bind(K);else if(G){let De=Mt.gradients[w.id],Te=De.texture;if(w.gradientVersion!==De.version){let Re=256;if(w.stepInterpolant){let Rr=x.getSource().maxzoom,pr=gt.canonical.z===Rr?Math.ceil(1<<m.transform.maxZoom-gt.canonical.z):1;Re=l.ad(l.aY(Mt.maxLineLength/l.N*1024*pr),256,K.maxTextureSize)}De.gradient=l.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:De.gradient||void 0,clips:Mt.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new je(K,De.gradient,lt.RGBA),De.version=w.gradientVersion,Te=De.texture}K.activeTexture.set(lt.TEXTURE0),Te.bind(w.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}te.draw(K,lt.TRIANGLES,L,m.stencilModeForClipping(gt),F,ur.disabled,or,Ut,w.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,w.paint,m.transform.zoom,Ct,Mt.layoutVertexBuffer2),mt=!1}})(e,o,c,p);break;case"fill":(function(m,x,w,E){let I=w.paint.get("fill-color"),A=w.paint.get("fill-opacity");if(A.constantOr(1)===0)return;let L=m.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),$=m.opaquePassEnabledForLayer()&&!F.constantOr(1)&&I.constantOr(l.aT.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===$){let Z=m.depthModeForSublayer(1,m.renderPass==="opaque"?Be.ReadWrite:Be.ReadOnly);Sa(m,x,w,E,Z,L,!1)}if(m.renderPass==="translucent"&&w.paint.get("fill-antialias")){let Z=m.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Be.ReadOnly);Sa(m,x,w,E,Z,L,!0)}})(e,o,c,p);break;case"fill-extrusion":(function(m,x,w,E){let I=w.paint.get("fill-extrusion-opacity");if(I!==0&&m.renderPass==="translucent"){let A=new Be(m.context.gl.LEQUAL,Be.ReadWrite,m.depthRangeFor3D);if(I!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ea(m,x,w,E,A,gr.disabled,wr.disabled),Ea(m,x,w,E,A,m.stencilModeFor3D(),m.colorModeForRenderPass());else{let L=m.colorModeForRenderPass();Ea(m,x,w,E,A,gr.disabled,L)}}})(e,o,c,p);break;case"hillshade":(function(m,x,w,E){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;let I=m.context,A=m.depthModeForSublayer(0,Be.ReadOnly),L=m.colorModeForRenderPass(),[F,$]=m.renderPass==="translucent"?m.stencilConfigForOverlap(E):[{},E];for(let Z of $){let H=x.getTile(Z);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&m.renderPass==="offscreen"?Wl(m,H,w,A,gr.disabled,L):m.renderPass==="translucent"&&zh(m,Z,H,w,A,F[Z.overscaledZ],L)}I.viewport.set([0,0,m.width,m.height])})(e,o,c,p);break;case"raster":(function(m,x,w,E){if(m.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!E.length)return;let I=m.context,A=I.gl,L=x.getSource(),F=m.useProgram("raster"),$=m.colorModeForRenderPass(),[Z,H]=L instanceof Qe?[{},E]:m.stencilConfigForOverlap(E),G=H[H.length-1].overscaledZ,ot=!m.options.moving;for(let dt of H){let K=m.depthModeForSublayer(dt.overscaledZ-G,w.paint.get("raster-opacity")===1?Be.ReadWrite:Be.ReadOnly,A.LESS),lt=x.getTile(dt);lt.registerFadeDuration(w.paint.get("raster-fade-duration"));let mt=x.findLoadedParent(dt,0),gt=rc(lt,mt,x,w,m.transform,m.style.map.terrain),St,Mt,Ct=w.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;I.activeTexture.set(A.TEXTURE0),lt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(A.TEXTURE1),mt?(mt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),St=Math.pow(2,mt.tileID.overscaledZ-lt.tileID.overscaledZ),Mt=[lt.tileID.canonical.x*St%1,lt.tileID.canonical.y*St%1]):lt.texture.bind(Ct,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);let zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(dt),te=zt?dt:null,ze=te?te.posMatrix:m.transform.calculatePosMatrix(dt.toUnwrapped(),ot),Ut=Mi(ze,Mt||[0,0],St||1,gt,w);L instanceof Qe?F.draw(I,A.TRIANGLES,K,gr.disabled,$,ur.disabled,Ut,zt,w.id,L.boundsBuffer,m.quadTriangleIndexBuffer,L.boundsSegments):F.draw(I,A.TRIANGLES,K,Z[dt.overscaledZ],$,ur.disabled,Ut,zt,w.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(e,o,c,p);break;case"background":(function(m,x,w,E){let I=w.paint.get("background-color"),A=w.paint.get("background-opacity");if(A===0)return;let L=m.context,F=L.gl,$=m.transform,Z=$.tileSize,H=w.paint.get("background-pattern");if(m.isPatternMissing(H))return;let G=!H&&I.a===1&&A===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==G)return;let ot=gr.disabled,dt=m.depthModeForSublayer(0,G==="opaque"?Be.ReadWrite:Be.ReadOnly),K=m.colorModeForRenderPass(),lt=m.useProgram(H?"backgroundPattern":"background"),mt=E||$.coveringTiles({tileSize:Z,terrain:m.style.map.terrain});H&&(L.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context));let gt=w.getCrossfadeParameters();for(let St of mt){let Mt=E?St.posMatrix:m.transform.calculatePosMatrix(St.toUnwrapped()),Ct=H?ni(Mt,A,m,H,{tileID:St,tileSize:Z},gt):Qn(Mt,A,I),zt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(St);lt.draw(L,F.TRIANGLES,dt,ot,K,ur.disabled,Ct,zt,w.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(e,0,c,p);break;case"custom":(function(m,x,w){let E=m.context,I=w.implementation;if(m.renderPass==="offscreen"){let A=I.prerender;A&&(m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),A.call(I,E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),E.setColorMode(m.colorModeForRenderPass()),E.setStencilMode(gr.disabled);let A=I.renderingMode==="3d"?new Be(m.context.gl.LEQUAL,Be.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Be.ReadOnly);E.setDepthMode(A),I.render(E.gl,m.transform.customLayerMatrix()),E.setDirty(),m.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,c)}}translatePosMatrix(e,o,c,p,m){if(!c[0]&&!c[1])return e;let x=m?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){let I=Math.sin(x),A=Math.cos(x);c=[c[0]*A-c[1]*I,c[0]*I+c[1]*A]}let w=[m?c[0]:nt(o,c[0],this.transform.zoom),m?c[1]:nt(o,c[1],this.transform.zoom),0],E=new Float32Array(16);return l.$(E,e,w),E}saveTileTexture(e){let o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let o=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!o||!c}useProgram(e,o){this.cache=this.cache||{};let c=e+(o?o.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new Va(this.context,br[e],o,hl[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}class On{constructor(e,o){this.points=e,this.planes=o}static fromInvProjectionMatrix(e,o,c){let p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let E=1/(w=l.ag([],w,e))[3]/o*p;return l.b3(w,w,[E,E,1/w[3],E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let E=function(F,$){var Z=$[0],H=$[1],G=$[2],ot=Z*Z+H*H+G*G;return ot>0&&(ot=1/Math.sqrt(ot)),F[0]=$[0]*ot,F[1]=$[1]*ot,F[2]=$[2]*ot,F}([],function(F,$,Z){var H=$[0],G=$[1],ot=$[2],dt=Z[0],K=Z[1],lt=Z[2];return F[0]=G*lt-ot*K,F[1]=ot*dt-H*lt,F[2]=H*K-G*dt,F}([],ke([],m[w[0]],m[w[1]]),ke([],m[w[2]],m[w[1]]))),I=-((A=E)[0]*(L=m[w[1]])[0]+A[1]*L[1]+A[2]*L[2]);var A,L;return E.concat(I)});return new On(m,x)}}class Uo{constructor(e,o){this.min=e,this.max=o,this.center=function(c,p,m){return c[0]=.5*p[0],c[1]=.5*p[1],c[2]=.5*p[2],c}([],function(c,p,m){return c[0]=p[0]+m[0],c[1]=p[1]+m[1],c[2]=p[2]+m[2],c}([],this.min,this.max))}quadrant(e){let o=[e%2==0,e<2],c=le(this.min),p=le(this.max);for(let m=0;m<o.length;m++)c[m]=o[m]?this.min[m]:this.center[m],p[m]=o[m]?this.center[m]:this.max[m];return p[2]=this.max[2],new Uo(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){let o=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],c=!0;for(let p=0;p<e.planes.length;p++){let m=e.planes[p],x=0;for(let w=0;w<o.length;w++)l.b4(m,o[w])>=0&&x++;if(x===0)return 0;x!==o.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let m=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){let E=e.points[w][p]-this.min[p];m=Math.min(m,E),x=Math.max(x,E)}if(x<0||m>this.max[p]-this.min[p])return 0}return 1}}class ca{constructor(e=0,o=0,c=0,p=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=c,this.right=p}interpolate(e,o,c){return o.top!=null&&e.top!=null&&(this.top=l.B.number(e.top,o.top,c)),o.bottom!=null&&e.bottom!=null&&(this.bottom=l.B.number(e.bottom,o.bottom,c)),o.left!=null&&e.left!=null&&(this.left=l.B.number(e.left,o.left,c)),o.right!=null&&e.right!=null&&(this.right=l.B.number(e.right,o.right,c)),this}getCenter(e,o){let c=l.ad((this.left+e-this.right)/2,0,e),p=l.ad((this.top+o-this.bottom)/2,0,o);return new l.P(c,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class bl{constructor(e,o,c,p,m){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=o||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){let e=new bl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this._minEleveationForCurrentTile=e._minEleveationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){let o=-l.b5(e,-180,180)*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=function(){var c=new l.A(4);return l.A!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,p,m){var x=p[0],w=p[1],E=p[2],I=p[3],A=Math.sin(m),L=Math.cos(m);c[0]=x*L+E*A,c[1]=w*L+I*A,c[2]=x*-A+E*L,c[3]=w*-A+I*L}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let o=l.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){let o=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this.tileZoom=Math.max(0,Math.floor(o)),this.scale=this.zoomScale(o),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,c){this._unmodified=!1,this._edgeInsets.interpolate(e,o,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let o=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(e){let o=[new l.b6(0,e)];if(this._renderWorldCopies){let c=this.pointCoordinate(new l.P(0,0)),p=this.pointCoordinate(new l.P(this.width,0)),m=this.pointCoordinate(new l.P(this.width,this.height)),x=this.pointCoordinate(new l.P(0,this.height)),w=Math.floor(Math.min(c.x,p.x,m.x,x.x)),E=Math.floor(Math.max(c.x,p.x,m.x,x.x)),I=1;for(let A=w-I;A<=E+I;A++)A!==0&&o.push(new l.b6(A,e))}return o}coveringTiles(e){var o,c;let p=this.coveringZoomLevel(e),m=p;if(e.minzoom!==void 0&&p<e.minzoom)return[];e.maxzoom!==void 0&&p>e.maxzoom&&(p=e.maxzoom);let x=this.pointCoordinate(this.getCameraPoint()),w=l.U.fromLngLat(this.center),E=Math.pow(2,p),I=[E*x.x,E*x.y,0],A=[E*w.x,E*w.y,0],L=On.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p),F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=p);let $=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,Z=K=>({aabb:new Uo([K*E,0,0],[(K+1)*E,E,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),H=[],G=[],ot=p,dt=e.reparseOverscaled?m:p;if(this._renderWorldCopies)for(let K=1;K<=3;K++)H.push(Z(-K)),H.push(Z(K));for(H.push(Z(0));H.length>0;){let K=H.pop(),lt=K.x,mt=K.y,gt=K.fullyVisible;if(!gt){let te=K.aabb.intersects(L);if(te===0)continue;gt=te===2}let St=e.terrain?I:A,Mt=K.aabb.distanceX(St),Ct=K.aabb.distanceY(St),zt=Math.max(Math.abs(Mt),Math.abs(Ct));if(K.zoom===ot||zt>$+(1<<ot-K.zoom)-2&&K.zoom>=F){let te=ot-K.zoom,ze=I[0]-.5-(lt<<te),Ut=I[1]-.5-(mt<<te);G.push({tileID:new l.O(K.zoom===ot?dt:K.zoom,K.wrap,K.zoom,lt,mt),distanceSq:er([A[0]-.5-lt,A[1]-.5-mt]),tileDistanceToCamera:Math.sqrt(ze*ze+Ut*Ut)})}else for(let te=0;te<4;te++){let ze=(lt<<1)+te%2,Ut=(mt<<1)+(te>>1),pe=K.zoom+1,re=K.aabb.quadrant(te);if(e.terrain){let or=new l.O(pe,K.wrap,pe,ze,Ut),De=e.terrain.getMinMaxElevation(or),Te=(o=De.minElevation)!==null&&o!==void 0?o:this.elevation,Re=(c=De.maxElevation)!==null&&c!==void 0?c:this.elevation;re=new Uo([re.min[0],re.min[1],Te],[re.max[0],re.max[1],Re])}H.push({aabb:re,zoom:pe,x:ze,y:Ut,wrap:K.wrap,fullyVisible:gt})}}return G.sort((K,lt)=>K.distanceSq-lt.distanceSq).map(K=>K.tileID)}resize(e,o){this.width=e,this.height=o,this.pixelsToGLUnits=[2/e,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let o=l.ad(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.P(l.G(e.lng)*this.worldSize,l.H(o)*this.worldSize)}unproject(e){return new l.U(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){let o=this.pointLocation(this.centerPoint,e),c=e.getElevationForLngLatZoom(o,this.tileZoom);if(!(this.elevation-c))return;let p=this.getCameraPosition(),m=l.U.fromLngLat(p.lngLat,p.altitude),x=l.U.fromLngLat(o,c),w=m.x-x.x,E=m.y-x.y,I=m.z-x.z,A=Math.sqrt(w*w+E*E+I*I),L=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=c,this._center=o,this.zoom=L}setLocationAtPoint(e,o){let c=this.pointCoordinate(o),p=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),x=new l.U(m.x-(c.x-p.x),m.y-(c.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,o){return o?this.coordinatePoint(this.locationCoordinate(e),o.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,o){return this.coordinateLocation(this.pointCoordinate(e,o))}locationCoordinate(e){return l.U.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,o){if(o){let F=o.pointCoordinate(e);if(F!=null)return F}let c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];l.ag(c,c,this.pixelMatrixInverse),l.ag(p,p,this.pixelMatrixInverse);let m=c[3],x=p[3],w=c[1]/m,E=p[1]/x,I=c[2]/m,A=p[2]/x,L=I===A?0:(0-I)/(A-I);return new l.U(l.B.number(c[0]/m,p[0]/x,L)/this.worldSize,l.B.number(w,E,L)/this.worldSize)}coordinatePoint(e,o=0,c=this.pixelMatrix){let p=[e.x*this.worldSize,e.y*this.worldSize,o,1];return l.ag(p,p,c),new l.P(p[0]/p[3],p[1]/p[3])}getBounds(){let e=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new l.P(0,e))).extend(this.pointLocation(new l.P(this.width,e))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,o=!1){let c=e.key,p=o?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];let m=e.canonical,x=this.worldSize/this.zoomScale(m.z),w=m.x+Math.pow(2,m.z)*e.wrap,E=l.ao(new Float64Array(16));return l.$(E,E,[w*x,m.y*x,0]),l.a0(E,E,[x/l.N,x/l.N,1]),l.a1(E,o?this.alignedProjMatrix:this.projMatrix,E),p[c]=new Float32Array(E),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,o,c,p,m=-90,x=90,w=-180,E=180,I=this.size,A=this._unmodified;if(this.latRange){let $=this.latRange;m=l.H($[1])*this.worldSize,x=l.H($[0])*this.worldSize,e=x-m<I.y?I.y/(x-m):0}if(this.lngRange){let $=this.lngRange;w=l.b5(l.G($[0])*this.worldSize,0,this.worldSize),E=l.b5(l.G($[1])*this.worldSize,0,this.worldSize),E<w&&(E+=this.worldSize),o=E-w<I.x?I.x/(E-w):0}let L=this.point,F=Math.max(o||0,e||0);if(F)return this.center=this.unproject(new l.P(o?(E+w)/2:L.x,e?(x+m)/2:L.y)),this.zoom+=this.scaleZoom(F),this._unmodified=A,void(this._constraining=!1);if(this.latRange){let $=L.y,Z=I.y/2;$-Z<m&&(p=m+Z),$+Z>x&&(p=x-Z)}if(this.lngRange){let $=(w+E)/2,Z=l.b5(L.x,$-this.worldSize/2,$+this.worldSize/2),H=I.x/2;Z-H<w&&(c=w+H),Z+H>E&&(c=E-H)}c===void 0&&p===void 0||(this.center=this.unproject(new l.P(c!==void 0?c:L.x,p!==void 0?p:L.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,o=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b7(1,this.center.lat)*this.worldSize;let p=l.ao(new Float64Array(16));l.a0(p,p,[this.width/2,-this.height/2,1]),l.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=l.ao(new Float64Array(16)),l.a0(p,p,[1,-1,1]),l.$(p,p,[-1,-1,0]),l.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;let m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=m-x*this._pixelPerMeter/Math.cos(this._pitch),E=x<0?w:m,I=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),L=Math.sin(A)*E/Math.sin(l.ad(Math.PI-I-A,.01,Math.PI-.01)),F=this.getHorizon(),$=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),Z=Math.sin($)*E/Math.sin(l.ad(Math.PI-I-$,.01,Math.PI-.01)),H=Math.min(L,Z),G=1.01*(Math.cos(Math.PI/2-this._pitch)*H+E),ot=this.height/50;p=new Float64Array(16),l.b8(p,this._fov,this.width/this.height,ot,G),p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,l.a0(p,p,[1,-1,1]),l.$(p,p,[0,0,-this.cameraToCenterDistance]),l.b9(p,p,this._pitch),l.ae(p,p,this.angle),l.$(p,p,[-o,-c,0]),this.mercatorMatrix=l.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),l.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.a1(new Float64Array(16),this.labelPlaneMatrix,p),l.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=l.as([],p),this.pixelMatrix3D=l.a1(new Float64Array(16),this.labelPlaneMatrix,p);let dt=this.width%2/2,K=this.height%2/2,lt=Math.cos(this.angle),mt=Math.sin(this.angle),gt=o-Math.round(o)+lt*dt+mt*K,St=c-Math.round(c)+lt*K+mt*dt,Mt=new Float64Array(p);if(l.$(Mt,Mt,[gt>.5?gt-1:gt,St>.5?St-1:St,0]),this.alignedProjMatrix=Mt,p=l.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;let e=this.pointCoordinate(new l.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.ag(o,o,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,e))}getCameraQueryGeometry(e){let o=this.getCameraPoint();if(e.length===1)return[e[0],o];{let c=o.x,p=o.y,m=o.x,x=o.y;for(let w of e)c=Math.min(c,w.x),p=Math.min(p,w.y),m=Math.max(m,w.x),x=Math.max(x,w.y);return[new l.P(c,p),new l.P(m,p),new l.P(m,x),new l.P(c,x),new l.P(c,p)]}}}function kt(f,e){let o,c=!1,p=null,m=null,x=()=>{p=null,c&&(f.apply(m,o),p=setTimeout(x,e),c=!1)};return(...w)=>(c=!0,m=this,o=w,p||x(),p)}class Wt{constructor(e){this._getCurrentHash=()=>{let o=window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{let o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){let c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{let o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}},this._updateHash=kt(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){let o=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,p),x=Math.round(o.lng*m)/m,w=Math.round(o.lat*m)/m,E=this._map.getBearing(),I=this._map.getPitch(),A="";if(A+=e?`/${x}/${w}/${c}`:`${c}/${w}/${x}`,(E||I)&&(A+="/"+Math.round(10*E)/10),I&&(A+=`/${Math.round(I)}`),this._hashName){let L=this._hashName,F=!1,$=window.location.hash.slice(1).split("&").map(Z=>{let H=Z.split("=")[0];return H===L?(F=!0,`${H}=${A}`):Z}).filter(Z=>Z);return F||$.push(`${L}=${A}`),`#${$.join("&")}`}return`#${A}`}}let we={linearity:.3,easing:l.ba(0,0,.3,1)},rr=l.e({deceleration:2500,maxSpeed:1400},we),jn=l.e({deceleration:20,maxSpeed:1400},we),$r=l.e({deceleration:1e3,maxSpeed:360},we),yi=l.e({deceleration:1e3,maxSpeed:90},we);class Di{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.h.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,o=l.h.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let o={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:m}of this._inertiaBuffer)o.zoom+=m.zoomDelta||0,o.bearing+=m.bearingDelta||0,o.pitch+=m.pitchDelta||0,m.panDelta&&o.pan._add(m.panDelta),m.around&&(o.around=m.around),m.pinchAround&&(o.pinchAround=m.pinchAround);let c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){let m=Gn(o.pan.mag(),c,l.e({},rr,e||{}));p.offset=o.pan.mult(m.amount/o.pan.mag()),p.center=this._map.transform.center,Tn(p,m)}if(o.zoom){let m=Gn(o.zoom,c,jn);p.zoom=this._map.transform.zoom+m.amount,Tn(p,m)}if(o.bearing){let m=Gn(o.bearing,c,$r);p.bearing=this._map.transform.bearing+l.ad(m.amount,-179,179),Tn(p,m)}if(o.pitch){let m=Gn(o.pitch,c,yi);p.pitch=this._map.transform.pitch+m.amount,Tn(p,m)}if(p.zoom||p.bearing){let m=o.pinchAround===void 0?o.around:o.pinchAround;p.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),l.e(p,{noMoveStart:!0})}}function Tn(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Gn(f,e,o){let{maxSpeed:c,linearity:p,deceleration:m}=o,x=l.ad(f*p/(e/1e3),-c,c),w=Math.abs(x)/(m*p);return{easing:o.easing,duration:1e3*w,amount:x*(w/2)}}class Mr extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c,p={}){let m=R.mousePos(o.getCanvasContainer(),c),x=o.unproject(m);super(e,l.e({point:m,lngLat:x,originalEvent:c},p)),this._defaultPrevented=!1,this.target=o}}class so extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c){let p=e==="touchend"?c.changedTouches:c.touches,m=R.touchPos(o.getCanvasContainer(),p),x=m.map(E=>o.unproject(E)),w=m.reduce((E,I,A,L)=>E.add(I.div(L.length)),new l.P(0,0));super(e,{points:m,point:w,lngLats:x,lngLat:o.unproject(w),originalEvent:c}),this._defaultPrevented=!1}}class Us extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class go{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Us(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Mr(e.type,this._map,e))}mouseup(e){this._map.fire(new Mr(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Mr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mr(e.type,this._map,e))}mouseover(e){this._map.fire(new Mr(e.type,this._map,e))}mouseout(e){this._map.fire(new Mr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new so(e.type,this._map,e))}touchmove(e){this._map.fire(new so(e.type,this._map,e))}touchend(e){this._map.fire(new so(e.type,this._map,e))}touchcancel(e){this._map.fire(new so(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class js{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ki{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(l.P.convert(e),this._map.terrain)}}class Jl{constructor(e,o){this._map=e,this._tr=new ki(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(R.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;let c=o;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;let p=this._startPos;this._lastPos=c,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let m=Math.min(p.x,c.x),x=Math.max(p.x,c.x),w=Math.min(p.y,c.y),E=Math.max(p.y,c.y);R.setTransform(this._box,`translate(${m}px,${w}px)`),this._box.style.width=x-m+"px",this._box.style.height=E-w+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;let c=this._startPos,p=o;if(this.reset(),R.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(c,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new l.k(e,{originalEvent:o}))}}function Fn(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);let o={};for(let c=0;c<f.length;c++)o[f[c].identifier]=e[c];return o}class Fi{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){let m=new l.P(0,0);for(let x of p)m._add(x);return m.div(p.length)}(o),this.touches=Fn(c,o)))}touchmove(e,o,c){if(this.aborted||!this.centroid)return;let p=Fn(c,o);for(let m in this.touches){let x=p[m];(!x||x.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,o,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){let p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Xa{constructor(e){this.singleTap=new Fi(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,c){this.singleTap.touchstart(e,o,c)}touchmove(e,o,c){this.singleTap.touchmove(e,o,c)}touchend(e,o,c){let p=this.singleTap.touchend(e,o,c);if(p){let m=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(m&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class yo{constructor(e){this._tr=new ki(e),this._zoomIn=new Xa({numTouches:1,numTaps:2}),this._zoomOut=new Xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,c){this._zoomIn.touchstart(e,o,c),this._zoomOut.touchstart(e,o,c)}touchmove(e,o,c){this._zoomIn.touchmove(e,o,c),this._zoomOut.touchmove(e,o,c)}touchend(e,o,c){let p=this._zoomIn.touchend(e,o,c),m=this._zoomOut.touchend(e,o,c),x=this._tr;return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _o{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=o.length?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;let c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let p=o.length?o[0]:o;return!this._moved&&p.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(c,p))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&R.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let qn={0:1,2:2};class hn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let o=R.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,c){let p=qn[c];return o.buttons===void 0||(o.buttons&p)!==p}(e,this._eventButton)}isValidEndEvent(e){return R.mouseButton(e)===this._eventButton}}class Kl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}let is=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=function(e){e.preventDefault()}},fs=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:o=.8})=>{let c=new hn({checkCorrectEvent:p=>R.mouseButton(p)===0&&p.ctrlKey||R.mouseButton(p)===2});return new _o({clickTolerance:e,move:(p,m)=>({bearingDelta:(m.x-p.x)*o}),moveStateManager:c,enable:f,assignEvents:is})},Nn=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:o=-.5})=>{let c=new hn({checkCorrectEvent:p=>R.mouseButton(p)===0&&p.ctrlKey||R.mouseButton(p)===2});return new _o({clickTolerance:e,move:(p,m)=>({pitchDelta:(m.y-p.y)*o}),moveStateManager:c,enable:f,assignEvents:is})};class Ht{constructor(e,o){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,o,c){return this._calculateTransform(e,o,c)}touchmove(e,o,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,o,c)}touchend(e,o,c){this._calculateTransform(e,o,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,c){c.length>0&&(this._active=!0);let p=Fn(c,o),m=new l.P(0,0),x=new l.P(0,0),w=0;for(let I in p){let A=p[I],L=this._touches[I];L&&(m._add(A),x._add(A.sub(L)),w++,p[I]=A)}if(this._touches=p,w<this._minTouches||!x.mag())return;let E=x.div(w);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(w),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class os{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,c){if(!this._firstTwoTouches)return;e.preventDefault();let[p,m]=this._firstTwoTouches,x=Wi(c,o,p),w=Wi(c,o,m);if(!x||!w)return;let E=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],E,e)}touchend(e,o,c){if(!this._firstTwoTouches)return;let[p,m]=this._firstTwoTouches,x=Wi(c,o,p),w=Wi(c,o,m);x&&w||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Wi(f,e,o){for(let c=0;c<f.length;c++)if(f[c].identifier===o)return e[c]}function ss(f,e){return Math.log(f/e)/Math.LN2}class Ha extends os{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){let c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ss(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ss(this._distance,c),pinchAround:o}}}function Gt(f,e){return 180*f.angleWith(e)/Math.PI}class Ql extends os{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o){let c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gt(this._vector,c),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let o=25/(Math.PI*this._minDiameter)*360,c=Gt(e,this._startVector);return Math.abs(c)<o}}function Ya(f){return Math.abs(f.y)>Math.abs(f.x)}class Ac extends os{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,c){super.touchstart(e,o,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,Ya(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;let p=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,m,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,c){if(this._valid!==void 0)return this._valid;let p=e.mag()>=2,m=o.mag()>=2;if(!p&&!m)return;if(!p||!m)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;let x=e.y>0==o.y>0;return Ya(e)&&Ya(o)&&x}}let Wa={panStep:100,bearingStep:15,pitchStep:10};class tu{constructor(e){this._tr=new ki(e);let o=Wa;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,c=0,p=0,m=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:w=>{let E=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:nc,zoom:o?Math.round(E.zoom)+o*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+c*this._bearingStep,pitch:E.pitch+p*this._pitchStep,offset:[-m*this._panStep,-x*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function nc(f){return f*(2-f)}let eu=4.000244140625;class ic{constructor(e,o){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new ki(e),this._el=e.getCanvasContainer(),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,c=l.h.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,o!==0&&o%eu==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=R.mousePos(this._el,e),c=this._tr;this._around=l.L.convert(this._aroundCenter?c.center:c.unproject(o)),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(this._delta!==0){let w=this._type==="wheel"&&Math.abs(this._delta)>eu?this._wheelZoomRate:this._defaultZoomRate,E=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&E!==0&&(E=1/E);let I=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(I*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let o=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,c=this._startZoom,p=this._easing,m,x=!1;if(this._type==="wheel"&&c&&p){let w=Math.min((l.h.now()-this._lastWheelEventTime)/200,1),E=p(w);m=l.B.number(c,o,E),w<1?this._frameId||(this._frameId=!0):x=!0}else m=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=l.bb;if(this._prevEase){let c=this._prevEase,p=(l.h.now()-c.start)/c.duration,m=c.easing(p+.01)-c.easing(p),x=.27/Math.sqrt(m*m+1e-4)*.01,w=Math.sqrt(.0729-x*x);o=l.ba(x,w,.25,1)}return this._prevEase={start:l.h.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Lc{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mc{constructor(e){this._tr=new ki(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dc{constructor(){this._tap=new Xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,c){if(!this._swipePoint)if(this._tapTime){let p=o[0],m=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;m&&x?c.length>0&&(this._swipePoint=p,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,o,c)}touchmove(e,o,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;let p=o[0],m=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,o,c)}touchend(e,o,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{let p=this._tap.touchend(e,o,c);p&&(this._tapTime=e.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kc{constructor(e,o,c){this._el=e,this._mousePan=o,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ii{constructor(e,o,c){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=o,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ms{constructor(e,o,c,p){this._el=e,this._touchZoom=o,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let wl=f=>f.zoom||f.drag||f.pitch||f.rotate;class zc extends l.k{}function Sl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Rc{constructor(e,o){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,m)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let x=p.type==="renderFrame"?void 0:p,w={needsRenderFrame:!1},E={},I={},A=p.touches,L=A?this._getMapTouches(A):void 0,F=L?R.touchPos(this._el,L):R.mousePos(this._el,p);for(let{handlerName:H,handler:G,allowed:ot}of this._handlers){if(!G.isEnabled())continue;let dt;this._blockedByActive(I,ot,H)?G.reset():G[m||p.type]&&(dt=G[m||p.type](p,F,L),this.mergeHandlerResult(w,E,dt,H,x),dt&&dt.needsRenderFrame&&this._triggerRenderFrame()),(dt||G.isActive())&&(I[H]=G)}let $={};for(let H in this._previousActiveHandlers)I[H]||($[H]=x);this._previousActiveHandlers=I,(Object.keys($).length||Sl(w))&&(this._changes.push([w,E,$]),this._triggerRenderFrame()),(Object.keys(I).length||Sl(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Di(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);let c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(let[p,m,x]of this._listeners)R.addEventListener(p,m,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(let[e,o,c]of this._listeners)R.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){let o=this._map,c=o.getCanvasContainer();this._add("mapEvent",new go(o,e));let p=o.boxZoom=new Jl(o,e);this._add("boxZoom",p),e.interactive&&e.boxZoom&&p.enable();let m=new yo(o),x=new Mc(o);o.doubleClickZoom=new Lc(x,m),this._add("tapZoom",m),this._add("clickZoom",x),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();let w=new Dc;this._add("tapDragZoom",w);let E=o.touchPitch=new Ac(o);this._add("touchPitch",E),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);let I=fs(e),A=Nn(e);o.dragRotate=new ii(e,I,A),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();let L=(({enable:ot,clickTolerance:dt})=>{let K=new hn({checkCorrectEvent:lt=>R.mouseButton(lt)===0&&!lt.ctrlKey});return new _o({clickTolerance:dt,move:(lt,mt)=>({around:mt,panDelta:mt.sub(lt)}),activateOnStart:!0,moveStateManager:K,enable:ot,assignEvents:is})})(e),F=new Ht(e,o);o.dragPan=new kc(c,L,F),this._add("mousePan",L),this._add("touchPan",F,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);let $=new Ql,Z=new Ha;o.touchZoomRotate=new ms(c,Z,$,w),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);let H=o.scrollZoom=new ic(o,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);let G=o.keyboard=new tu(o);this._add("keyboard",G),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new js(o))}_add(e,o,c){this._handlers.push({handlerName:e,handler:o,allowed:c}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wl(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,c){for(let p in e)if(p!==c&&(!o||o.indexOf(p)<0))return!0;return!1}_getMapTouches(e){let o=[];for(let c of e)this._el.contains(c.target)&&o.push(c);return o}mergeHandlerResult(e,o,c,p,m){if(!c)return;l.e(e,c);let x={handlerName:p,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(o.zoom=x),c.panDelta!==void 0&&(o.drag=x),c.pitchDelta!==void 0&&(o.pitch=x),c.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){let e={},o={},c={};for(let[p,m,x]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),l.e(o,m),l.e(c,x);this._updateMapTransform(e,o,c),this._changes=[]}_updateMapTransform(e,o,c){let p=this._map,m=p._getTransformForUpdate(),x=p.terrain;if(!(Sl(e)||x&&this._terrainMovement))return this._fireEvents(o,c,!0);let{panDelta:w,zoomDelta:E,bearingDelta:I,pitchDelta:A,around:L,pinchAround:F}=e;F!==void 0&&(L=F),p._stop(!0),L=L||p.transform.centerPoint;let $=m.pointLocation(w?L.sub(w):L);I&&(m.bearing+=I),A&&(m.pitch+=A),E&&(m.zoom+=E),x?this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(w)):m.setLocationAtPoint($,L):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint($,L),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,m.recalculateZoom(p.terrain)})):m.setLocationAtPoint($,L),p._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,c,!0)}_fireEvents(e,o,c){let p=wl(this._eventsInProgress),m=wl(e),x={};for(let A in e){let{originalEvent:L}=e[A];this._eventsInProgress[A]||(x[`${A}start`]=L),this._eventsInProgress[A]=e[A]}!p&&m&&this._fireEvent("movestart",m.originalEvent);for(let A in x)this._fireEvent(A,x[A]);m&&this._fireEvent("move",m.originalEvent);for(let A in e){let{originalEvent:L}=e[A];this._fireEvent(A,L)}let w={},E;for(let A in this._eventsInProgress){let{handlerName:L,originalEvent:F}=this._eventsInProgress[A];this._handlersById[L].isActive()||(delete this._eventsInProgress[A],E=o[L]||F,w[`${A}end`]=E)}for(let A in w)this._fireEvent(A,w[A]);let I=wl(this._eventsInProgress);if(c&&(p||m)&&!I){this._updatingCamera=!0;let A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!A||!A.essential&&l.h.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:E})),L(this._map.getBearing())&&this._map.resetNorth()):(L(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new l.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new zc("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class op extends l.E{constructor(e,o){super(),this._renderFrameCallback=()=>{let c=Math.min((l.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=o.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.L(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}panBy(e,o,c){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},o),c)}panTo(e,o,c){return this.easeTo(l.e({center:e},o),c)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,c){return this.easeTo(l.e({zoom:e},o),c)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,c){return this.easeTo(l.e({bearing:e},o),c)}resetNorth(e,o){return this.rotateTo(0,l.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}cameraForBounds(e,o){e=Ne.convert(e);let c=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,o)}_cameraForBoxAndBearing(e,o,c,p){let m={top:0,bottom:0,right:0,left:0};if(typeof(p=l.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){let mt=p.padding;p.padding={top:mt,bottom:mt,right:mt,left:mt}}p.padding=l.e(m,p.padding);let x=this.transform,w=x.padding,E=x.project(l.L.convert(e)),I=x.project(l.L.convert(o)),A=E.rotate(-c*Math.PI/180),L=I.rotate(-c*Math.PI/180),F=new l.P(Math.max(A.x,L.x),Math.max(A.y,L.y)),$=new l.P(Math.min(A.x,L.x),Math.min(A.y,L.y)),Z=F.sub($),H=(x.width-(w.left+w.right+p.padding.left+p.padding.right))/Z.x,G=(x.height-(w.top+w.bottom+p.padding.top+p.padding.bottom))/Z.y;if(G<0||H<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let ot=Math.min(x.scaleZoom(x.scale*Math.min(H,G)),p.maxZoom),dt=l.P.convert(p.offset),K=new l.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),lt=dt.add(K).mult(x.scale/x.zoomScale(ot));return{center:x.unproject(E.add(I).div(2).sub(lt)),zoom:ot,bearing:c}}fitBounds(e,o,c){return this._fitInternal(this.cameraForBounds(e,o),o,c)}fitScreenCoordinates(e,o,c,p,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(e)),this.transform.pointLocation(l.P.convert(o)),c,p),p,m)}_fitInternal(e,o,c){return e?(delete(o=l.e(e,o)).padding,o.linear?this.easeTo(o,c):this.flyTo(o,c)):this}jumpTo(e,o){this.stop();let c=this._getTransformForUpdate(),p=!1,m=!1,x=!1;return"zoom"in e&&c.zoom!==+e.zoom&&(p=!0,c.zoom=+e.zoom),e.center!==void 0&&(c.center=l.L.convert(e.center)),"bearing"in e&&c.bearing!==+e.bearing&&(m=!0,c.bearing=+e.bearing),"pitch"in e&&c.pitch!==+e.pitch&&(x=!0,c.pitch=+e.pitch),e.padding==null||c.isPaddingEqual(e.padding)||(c.padding=e.padding),this._applyUpdatedTransform(c),this.fire(new l.k("movestart",o)).fire(new l.k("move",o)),p&&this.fire(new l.k("zoomstart",o)).fire(new l.k("zoom",o)).fire(new l.k("zoomend",o)),m&&this.fire(new l.k("rotatestart",o)).fire(new l.k("rotate",o)).fire(new l.k("rotateend",o)),x&&this.fire(new l.k("pitchstart",o)).fire(new l.k("pitch",o)).fire(new l.k("pitchend",o)),this.fire(new l.k("moveend",o))}calculateCameraOptionsFromTo(e,o,c,p=0){let m=l.U.fromLngLat(e,o),x=l.U.fromLngLat(c,p),w=x.x-m.x,E=x.y-m.y,I=x.z-m.z,A=Math.hypot(w,E,I);if(A===0)throw new Error("Can't calculate camera options with same From and To");let L=Math.hypot(w,E),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),$=180*Math.atan2(w,-E)/Math.PI,Z=180*Math.acos(L/A)/Math.PI;return Z=I<0?90-Z:90+Z,{center:x.toLngLat(),zoom:F,pitch:Z,bearing:$}}easeTo(e,o){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.bb},e)).animate===!1||!e.essential&&l.h.prefersReducedMotion)&&(e.duration=0);let c=this._getTransformForUpdate(),p=this.getZoom(),m=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in e?+e.zoom:p,I="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:x,L="padding"in e?e.padding:c.padding,F=l.P.convert(e.offset),$=c.centerPoint.add(F),Z=c.pointLocation($),H=l.L.convert(e.center||Z);this._normalizeCenter(H);let G=c.project(Z),ot=c.project(H).sub(G),dt=c.zoomScale(E-p),K,lt;e.around&&(K=l.L.convert(e.around),lt=c.locationPoint(K));let mt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==p,this._rotating=this._rotating||m!==I,this._pitching=this._pitching||A!==x,this._padding=!c.isPaddingEqual(L),this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,mt),this.terrain&&this._prepareElevation(H),this._ease(gt=>{if(this._zooming&&(c.zoom=l.B.number(p,E,gt)),this._rotating&&(c.bearing=l.B.number(m,I,gt)),this._pitching&&(c.pitch=l.B.number(x,A,gt)),this._padding&&(c.interpolatePadding(w,L,gt),$=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(gt),K)c.setLocationAtPoint(K,lt);else{let St=c.zoomScale(c.zoom-p),Mt=E>p?Math.min(2,dt):Math.max(.5,dt),Ct=Math.pow(Mt,1-gt),zt=c.unproject(G.add(ot.mult(gt*Ct)).mult(St));c.setLocationAtPoint(c.renderWorldCopies?zt.wrap():zt,$)}this._applyUpdatedTransform(c),this._fireMoveEvents(o)},gt=>{this.terrain&&this._finalizeElevation(),this._afterEase(o,gt)},e),this}_prepareEase(e,o,c={}){this._moving=!0,o||c.moving||this.fire(new l.k("movestart",e)),this._zooming&&!c.zooming&&this.fire(new l.k("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new l.k("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new l.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);let o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){let c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(o-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.elevation=l.B.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;let o=e.clone(),{center:c,zoom:p,pitch:m,bearing:x,elevation:w}=this.transformCameraUpdate(o);c&&(o.center=c),p!==void 0&&(o.zoom=p),m!==void 0&&(o.pitch=m),x!==void 0&&(o.bearing=x),w!==void 0&&(o.elevation=w),this.transform.apply(o)}_fireMoveEvents(e){this.fire(new l.k("move",e)),this._zooming&&this.fire(new l.k("zoom",e)),this._rotating&&this.fire(new l.k("rotate",e)),this._pitching&&this.fire(new l.k("pitch",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;let c=this._zooming,p=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new l.k("zoomend",e)),p&&this.fire(new l.k("rotateend",e)),m&&this.fire(new l.k("pitchend",e)),this.fire(new l.k("moveend",e))}flyTo(e,o){if(!e.essential&&l.h.prefersReducedMotion){let re=l.F(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(re,o)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.bb},e);let c=this._getTransformForUpdate(),p=this.getZoom(),m=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in e?l.ad(+e.zoom,c.minZoom,c.maxZoom):p,I="bearing"in e?this._normalizeBearing(e.bearing,m):m,A="pitch"in e?+e.pitch:x,L="padding"in e?e.padding:c.padding,F=c.zoomScale(E-p),$=l.P.convert(e.offset),Z=c.centerPoint.add($),H=c.pointLocation(Z),G=l.L.convert(e.center||H);this._normalizeCenter(G);let ot=c.project(H),dt=c.project(G).sub(ot),K=e.curve,lt=Math.max(c.width,c.height),mt=lt/F,gt=dt.mag();if("minZoom"in e){let re=l.ad(Math.min(e.minZoom,p,E),c.minZoom,c.maxZoom),or=lt/c.zoomScale(re-p);K=Math.sqrt(or/gt*2)}let St=K*K;function Mt(re){let or=(mt*mt-lt*lt+(re?-1:1)*St*St*gt*gt)/(2*(re?mt:lt)*St*gt);return Math.log(Math.sqrt(or*or+1)-or)}function Ct(re){return(Math.exp(re)-Math.exp(-re))/2}function zt(re){return(Math.exp(re)+Math.exp(-re))/2}let te=Mt(!1),ze=function(re){return zt(te)/zt(te+K*re)},Ut=function(re){return lt*((zt(te)*(Ct(or=te+K*re)/zt(or))-Ct(te))/St)/gt;var or},pe=(Mt(!0)-te)/K;if(Math.abs(gt)<1e-6||!isFinite(pe)){if(Math.abs(lt-mt)<1e-6)return this.easeTo(e,o);let re=mt<lt?-1:1;pe=Math.abs(Math.log(mt/lt))/K,Ut=function(){return 0},ze=function(or){return Math.exp(re*K*or)}}return e.duration="duration"in e?+e.duration:1e3*pe/("screenSpeed"in e?+e.screenSpeed/K:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==I,this._pitching=A!==x,this._padding=!c.isPaddingEqual(L),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(G),this._ease(re=>{let or=re*pe,De=1/ze(or);c.zoom=re===1?E:p+c.scaleZoom(De),this._rotating&&(c.bearing=l.B.number(m,I,re)),this._pitching&&(c.pitch=l.B.number(x,A,re)),this._padding&&(c.interpolatePadding(w,L,re),Z=c.centerPoint.add($)),this.terrain&&!e.freezeElevation&&this._updateElevation(re);let Te=re===1?G:c.unproject(ot.add(dt.mult(Ut(or))).mult(De));c.setLocationAtPoint(c.renderWorldCopies?Te.wrap():Te,Z),this._applyUpdatedTransform(c),this._fireMoveEvents(o)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,o)}if(!e){let c=this.handlers;c&&c.stop(!1)}return this}_ease(e,o,c){c.animate===!1||c.duration===0?(e(1),o()):(this._easeStart=l.h.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=l.b5(e,-180,180);let c=Math.abs(e-o);return Math.abs(e-360-o)<c&&(e-=360),Math.abs(e+360-o)<c&&(e+=360),e}_normalizeCenter(e){let o=this.transform;if(!o.renderWorldCopies||o.lngRange)return;let c=e.lng-o.center.lng;e.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.L.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class _i{constructor(e={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){let c=this._map._getUIString(`AttributionControl.${o}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}let o=this._map.style.sourceCaches;for(let p in o){let m=o[p];if(m.used||m.usedForTerrain){let x=m.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,m)=>p.length-m.length),e=e.filter((p,m)=>{for(let x=m+1;x<e.length;x++)if(e[x].indexOf(p)>=0)return!1;return!0});let c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yr{constructor(e={}){this._updateCompact=()=>{let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");let o=R.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Iu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){let o=this._currentlyRunning,c=o?this._queue.concat(o):this._queue;for(let p of c)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let o=this._currentlyRunning=this._queue;this._queue=[];for(let c of o)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}let Oc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var sp=l.Q([{name:"a_pos3d",type:"Int16",components:3}]);class ap extends l.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];let c={};for(let p of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o}))c[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.aS(p.posMatrix,0,l.N,0,l.N,0,1),this._tiles[p.key]=new No(p,this.tileSize));for(let p in this._tiles)c[p]||delete this._tiles[p]}freeRtt(e){for(let o in this._tiles){let c=this._tiles[o];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let o={};for(let c of this._renderableTilesKeys){let p=this._tiles[c].tileID;if(p.canonical.equals(e.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16),l.aS(m.posMatrix,0,l.N,0,l.N,0,1),o[c]=m}else if(p.canonical.isChildOf(e.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16);let x=p.canonical.z-e.canonical.z,w=p.canonical.x-(p.canonical.x>>x<<x),E=p.canonical.y-(p.canonical.y>>x<<x),I=l.N>>x;l.aS(m.posMatrix,0,I,0,I,0,1),l.$(m.posMatrix,m.posMatrix,[-w*I,-E*I,0]),o[c]=m}else if(e.canonical.isChildOf(p.canonical)){let m=e.clone();m.posMatrix=new Float64Array(16);let x=e.canonical.z-p.canonical.z,w=e.canonical.x-(e.canonical.x>>x<<x),E=e.canonical.y-(e.canonical.y>>x<<x),I=l.N>>x;l.aS(m.posMatrix,0,l.N,0,l.N,0,1),l.$(m.posMatrix,m.posMatrix,[w*I,E*I,0]),l.a0(m.posMatrix,m.posMatrix,[1/2**x,1/2**x,0]),o[c]=m}}return o}getSourceTile(e,o){let c=this.sourceCache._source,p=e.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&o)for(;p>=c.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(p--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(o=>o.timeAdded>=e)}}class lp{constructor(e,o,c){this.painter=e,this.sourceCache=new ap(o),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,c,p=l.N){var m;if(!(o>=0&&o<p&&c>=0&&c<p))return 0;let x=this.getTerrainData(e),w=(m=x.tile)===null||m===void 0?void 0:m.dem;if(!w)return 0;let E=function(Z,H,G){var ot=H[0],dt=H[1];return Z[0]=G[0]*ot+G[4]*dt+G[12],Z[1]=G[1]*ot+G[5]*dt+G[13],Z}([],[o/p*l.N,c/p*l.N],x.u_terrain_matrix),I=[E[0]*w.dim,E[1]*w.dim],A=Math.floor(I[0]),L=Math.floor(I[1]),F=I[0]-A,$=I[1]-L;return w.get(A,L)*(1-F)*(1-$)+w.get(A+1,L)*F*(1-$)+w.get(A,L+1)*(1-F)*$+w.get(A+1,L+1)*F*$}getElevationForLngLatZoom(e,o){let{tileID:c,mercatorX:p,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(c,p%l.N,m%l.N,l.N)}getElevation(e,o,c,p=l.N){return this.getDEMElevation(e,o,c,p)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let p=this.painter.context,m=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new je(p,m,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new je(p,new l.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ao([])}let o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){let p=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new je(p,o.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),o.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}let c=o&&o+o.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){let p=this.sourceCache.sourceCache._source.maxzoom,m=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?m=e.canonical.z-p:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let x=e.canonical.x-(e.canonical.x>>m<<m),w=e.canonical.y-(e.canonical.y>>m<<m),E=l.bc(new Float64Array(16),[1/(l.N<<m),1/(l.N<<m),0]);l.$(E,E,[x*l.N,w*l.N,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){let o=this.painter,c=o.width/devicePixelRatio,p=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new je(o.context,{width:c,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new je(o.context,{width:c,height:p,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(c,p,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,x=0;m<this._coordsTextureSize;m++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)o[x+0]=255&w,o[x+1]=255&m,o[x+2]=w>>8<<4|m>>8,o[x+3]=0;let c=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),p=new je(e,c,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){let o=new Uint8Array(4),c=this.painter.context,p=c.gl;c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,o),c.bindFramebuffer.set(null);let m=o[0]+(o[2]>>4<<8),x=o[1]+((15&o[2])<<8),w=this.coordsIndex[255-o[3]],E=w&&this.sourceCache.getTileByID(w);if(!E)return null;let I=this._coordsTextureSize,A=(1<<E.tileID.canonical.z)*I;return new l.U(this._allowMercatorOverflow(e,(E.tileID.canonical.x*I+m)/A),(E.tileID.canonical.y*I+x)/A,this.getElevation(E.tileID,m,x,I))}getTerrainMesh(){if(this._mesh)return this._mesh;let e=this.painter.context,o=new l.bd,c=new l.b0,p=this.meshSize,m=l.N/p,x=p*p;for(let L=0;L<=p;L++)for(let F=0;F<=p;F++)o.emplaceBack(F*m,L*m,0);for(let L=0;L<x;L+=p+1)for(let F=0;F<p;F++)c.emplaceBack(F+L,p+F+L+1,p+F+L+2),c.emplaceBack(F+L,p+F+L+2,F+L+1);let w=o.length,E=w+2*(p+1);for(let L of[0,1])for(let F=0;F<=p;F++)for(let $ of[0,1])o.emplaceBack(F*m,L*l.N,$);for(let L=0;L<2*p;L+=2)c.emplaceBack(E+L,E+L+1,E+L+3),c.emplaceBack(E+L,E+L+3,E+L+2),c.emplaceBack(w+L,w+L+3,w+L+1),c.emplaceBack(w+L,w+L+2,w+L+3);let I=o.length,A=I+2*(p+1);for(let L of[0,1])for(let F=0;F<=p;F++)for(let $ of[0,1])o.emplaceBack(L*l.N,F*m,$);for(let L=0;L<2*p;L+=2)c.emplaceBack(I+L,I+L+1,I+L+3),c.emplaceBack(I+L,I+L+3,I+L+2),c.emplaceBack(A+L,A+L+3,A+L+1),c.emplaceBack(A+L,A+L+2,A+L+3);return this._mesh={indexBuffer:e.createIndexBuffer(c),vertexBuffer:e.createVertexBuffer(o,sp.members),segments:l.S.simpleSegment(0,0,o.length,c.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*l.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,o){var c;let{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(c=this.getMinMaxElevation(p).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){let o=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return o&&o.dem&&(c.minElevation=o.dem.min*this.exaggeration,c.maxElevation=o.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,o){let c=l.U.fromLngLat(e.wrap()),p=(1<<o)*l.N,m=c.x*p,x=c.y*p,w=Math.floor(m/l.N),E=Math.floor(x/l.N);return{tileID:new l.O(o,0,o,w,E),mercatorX:m,mercatorY:x}}_allowMercatorOverflow(e,o){let c=e.x<this.painter.width/2,p=l.bf(o),m=this.painter.transform.center.lng;return c&&Math.sign(p)>0&&Math.sign(m)<0||!c&&Math.sign(p)<0&&Math.sign(m)>0?(p=360*Math.sign(m)+p,l.G(p)):o}}class gd{constructor(e,o,c){this._context=e,this._size=o,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(c.texture),{id:e,fbo:o,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let $n={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cu{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new gd(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(c=>!e._layers[c].isHidden(o)),this._coordsDescendingInv={};for(let c in e.sourceCaches){this._coordsDescendingInv[c]={};let p=e.sourceCaches[c].getVisibleCoordinates();for(let m of p){let x=this.terrain.sourceCache.getTerrainCoords(m);for(let w in x)this._coordsDescendingInv[c][w]||(this._coordsDescendingInv[c][w]=[]),this._coordsDescendingInv[c][w].push(x[w])}}this._coordsDescendingInvStr={};for(let c of e._order){let p=e._layers[c],m=p.source;if($n[p.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(let x in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][x]=this._coordsDescendingInv[m][x].map(w=>w.key).sort().join()}}for(let c of this._renderableTiles)for(let p in this._coordsDescendingInvStr){let m=this._coordsDescendingInvStr[p][c.tileID.key];m&&m!==c.rttCoords[p]&&(c.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;let o=e.type,c=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if($n[o]&&(this._prevType&&$n[this._prevType]||this._stacks.push([]),this._prevType=o,this._stacks[this._stacks.length-1].push(e.id),!p))return!0;if($n[this._prevType]||$n[o]&&p){this._prevType=o;let m=this._stacks.length-1,x=this._stacks[m]||[];for(let w of this._renderableTiles){if(this.pool.isFull()&&(Ir(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[m]){let I=this.pool.getObjectForId(w.rtt[m].id);if(I.stamp===w.rtt[m].stamp){this.pool.useObject(I);continue}}let E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),w.rtt[m]={id:E.id,stamp:E.stamp},c.context.bindFramebuffer.set(E.fbo.framebuffer),c.context.clear({color:l.aT.transparent,stencil:0}),c.currentStencilSource=void 0;for(let I=0;I<x.length;I++){let A=c.style._layers[x[I]],L=A.source?this._coordsDescendingInv[A.source][w.tileID.key]:[w.tileID];c.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),c._renderTileClippingMasks(A,L),c.renderLayer(c,c.style.sourceCaches[A.source],A,L),A.source&&(w.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][w.tileID.key])}}return Ir(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),$n[o]}return!1}}let ie=V,he={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},El=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Fc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nc{constructor(e,o,c=!1){this.mousedown=x=>{this.startMouse(l.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),R.mousePos(this.element,x)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,R.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;let p=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=o,this.mouseRotate=fs({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:E=.8})=>{let I=new Kl;return new _o({clickTolerance:w,move:(A,L)=>({bearingDelta:(L.x-A.x)*E}),moveStateManager:I,enable:x,assignEvents:El})})({clickTolerance:p,enable:!0}),this.map=e,c&&(this.mousePitch=Nn({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:E=-.5})=>{let I=new Kl;return new _o({clickTolerance:w,move:(A,L)=>({pitchDelta:(L.y-A.y)*E}),moveStateManager:I,enable:x,assignEvents:El})})({clickTolerance:m,enable:!0})),R.addEventListener(o,"mousedown",this.mousedown),R.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(o,"touchcancel",this.reset)}startMouse(e,o){this.mouseRotate.dragStart(e,o),this.mousePitch&&this.mousePitch.dragStart(e,o),R.disableDrag()}startTouch(e,o){this.touchRotate.dragStart(e,o),this.touchPitch&&this.touchPitch.dragStart(e,o),R.disableDrag()}moveMouse(e,o){let c=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(e,o)||{};if(p&&c.setBearing(c.getBearing()+p),this.mousePitch){let{pitchDelta:m}=this.mousePitch.dragMove(e,o)||{};m&&c.setPitch(c.getPitch()+m)}}moveTouch(e,o){let c=this.map,{bearingDelta:p}=this.touchRotate.dragMove(e,o)||{};if(p&&c.setBearing(c.getBearing()+p),this.touchPitch){let{pitchDelta:m}=this.touchPitch.dragMove(e,o)||{};m&&c.setPitch(c.getPitch()+m)}}off(){let e=this.element;R.removeEventListener(e,"mousedown",this.mousedown),R.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Ur;function Bc(f,e,o){if(f=new l.L(f.lng,f.lat),e){let c=new l.L(f.lng-360,f.lat),p=new l.L(f.lng+360,f.lat),m=o.locationPoint(f).distSqr(e);o.locationPoint(c).distSqr(e)<m?f=c:o.locationPoint(p).distSqr(e)<m&&(f=p)}for(;Math.abs(f.lng-o.center.lng)>180;){let c=o.locationPoint(f);if(c.x>=0&&c.y>=0&&c.x<=o.width&&c.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}let Ni={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function up(f,e,o){let c=f.classList;for(let p in Ni)c.remove(`maplibregl-${o}-anchor-${p}`);c.add(`maplibregl-${o}-anchor-${e}`)}class Gs extends l.E{constructor(e){if(super(),this._onKeyPress=o=>{let c=o.code,p=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=o=>{let c=o.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()},this._update=o=>{if(!this._map)return;let c=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!c)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Bc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${Ni[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{let x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=o=>{if(!this._isDragging){let c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");let o=R.createNS("http://www.w3.org/2000/svg","svg"),c=41,p=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${c}px`),o.setAttributeNS(null,"width",`${p}px`),o.setAttributeNS(null,"viewBox",`0 0 ${p} ${c}`);let m=R.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");let x=R.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");let w=R.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");let E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let ot of E){let dt=R.createNS("http://www.w3.org/2000/svg","ellipse");dt.setAttributeNS(null,"opacity","0.04"),dt.setAttributeNS(null,"cx","10.5"),dt.setAttributeNS(null,"cy","5.80029008"),dt.setAttributeNS(null,"rx",ot.rx),dt.setAttributeNS(null,"ry",ot.ry),w.appendChild(dt)}let I=R.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);let A=R.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(A);let L=R.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");let F=R.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(F);let $=R.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");let Z=R.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");let H=R.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");let G=R.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),Z.appendChild(H),Z.appendChild(G),x.appendChild(w),x.appendChild(I),x.appendChild(L),x.appendChild($),x.appendChild(Z),o.appendChild(x),o.setAttributeNS(null,"height",c*this._scale+"px"),o.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),up(this._element,this._anchor,"marker"),e&&e.className)for(let o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.L.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let o=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[o,-1*(38.1-13.5+o)],"bottom-right":[-o,-1*(38.1-13.5+o)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}let Dr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Pr=0,Ia=!1,Tl={maxWidth:100,unit:"metric"};function Il(f,e,o){let c=o&&o.maxWidth||100,p=f._container.clientHeight/2,m=f.unproject([0,p]),x=f.unproject([c,p]),w=m.distanceTo(x);if(o&&o.unit==="imperial"){let E=3.2808*w;E>5280?qs(e,c,E/5280,f._getUIString("ScaleControl.Miles")):qs(e,c,E,f._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?qs(e,c,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?qs(e,c,w/1e3,f._getUIString("ScaleControl.Kilometers")):qs(e,c,w,f._getUIString("ScaleControl.Meters"))}function qs(f,e,o,c){let p=function(m){let x=Math.pow(10,`${Math.floor(m)}`.length-1),w=m/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){let I=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*I)/I}(w),x*w}(o);f.style.width=e*(p/o)+"px",f.innerHTML=`${p}&nbsp;${c}`}let Vc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ca(f){if(f){if(typeof f=="number"){let e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,f),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-f),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(f,0),right:new l.P(-f,0)}}if(f instanceof l.P||Array.isArray(f)){let e=l.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(f.center||[0,0]),top:l.P.convert(f.top||[0,0]),"top-left":l.P.convert(f["top-left"]||[0,0]),"top-right":l.P.convert(f["top-right"]||[0,0]),bottom:l.P.convert(f.bottom||[0,0]),"bottom-left":l.P.convert(f["bottom-left"]||[0,0]),"bottom-right":l.P.convert(f["bottom-right"]||[0,0]),left:l.P.convert(f.left||[0,0]),right:l.P.convert(f.right||[0,0])}}return Ca(new l.P(0,0))}let jc={extend:(f,...e)=>l.e(f,...e),run(f){f()},logToElement(f,e=!1,o="log"){let c=window.document.getElementById(o);c&&(e&&(c.innerHTML=""),c.innerHTML+=`<br>${f}`)}},Gc=V;class Je{static get version(){return Gc}static get workerCount(){return ji.workerCount}static set workerCount(e){ji.workerCount=e}static get maxParallelImageRequests(){return l.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){l.c.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return l.c.WORKER_URL}static set workerUrl(e){l.c.WORKER_URL=e}static addProtocol(e,o){l.c.REGISTERED_PROTOCOLS[e]=o}static removeProtocol(e){delete l.c.REGISTERED_PROTOCOLS[e]}}return Je.Map=class extends op{constructor(f){if(l.bg.mark(l.bh.create),(f=l.e({},he,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bl(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._cooperativeGesturesOnWheel=e=>{this._onCooperativeGesture(e,e[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new Iu,this._controls=[],this._mapId=l.a2(),this._locale=l.e({},Oc,f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this._imageQueueHandle=Pt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qt(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let e=!1,o=kt(c=>{this._trackResize&&!this._removed&&this.resize(c)._update()},50);this._resizeObserver=new ResizeObserver(c=>{e?o(c):e=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Rc(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new Wt(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,l.e({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new _i({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new yr,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update(e.dataType==="style"),this.fire(new l.k(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new l.k(`${e.dataType}dataloading`,e))}),this.on("dataabort",e=>{this.fire(new l.k("sourcedataabort",e))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=f.onAdd(this);this._controls.push(f);let c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(o,c.firstChild):c.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,o,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,o,c)}resize(f){var e;let o=this._containerDimensions(),c=o[0],p=o[1],m=this._getClampedPixelRatio(c,p);if(this._resizeCanvas(c,p,m),this.painter.resize(c,p,m),this.painter.overLimit()){let w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];let E=this._getClampedPixelRatio(c,p);this._resizeCanvas(c,p,E),this.painter.resize(c,p,E)}this.transform.resize(c,p),(e=this._requestedCameraState)===null||e===void 0||e.resize(c,p);let x=!this._moving;return x&&(this.stop(),this.fire(new l.k("movestart",f)).fire(new l.k("move",f))),this.fire(new l.k("resize",f)),x&&this.fire(new l.k("moveend",f)),this}_getClampedPixelRatio(f,e){let{0:o,1:c}=this._maxCanvasSize,p=this.getPixelRatio(),m=f*p,x=e*p;return Math.min(m>o?o/m:1,x>c?c/x:1)*p}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Ne.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(f){return this.transform.locationPoint(l.L.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(l.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,o){if(f==="mouseenter"||f==="mouseover"){let c=!1;return{layer:e,listener:o,delegates:{mousemove:p=>{let m=this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[];m.length?c||(c=!0,o.call(this,new Mr(f,this,p.originalEvent,{features:m}))):c=!1},mouseout:()=>{c=!1}}}}if(f==="mouseleave"||f==="mouseout"){let c=!1;return{layer:e,listener:o,delegates:{mousemove:p=>{(this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[]).length?c=!0:c&&(c=!1,o.call(this,new Mr(f,this,p.originalEvent)))},mouseout:p=>{c&&(c=!1,o.call(this,new Mr(f,this,p.originalEvent)))}}}}{let c=p=>{let m=this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[];m.length&&(p.features=m,o.call(this,p),delete p.features)};return{layer:e,listener:o,delegates:{[f]:c}}}}on(f,e,o){if(o===void 0)return super.on(f,e);let c=this._createDelegatedListener(f,e,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(c);for(let p in c.delegates)this.on(p,c.delegates[p]);return this}once(f,e,o){if(o===void 0)return super.once(f,e);let c=this._createDelegatedListener(f,e,o);for(let p in c.delegates)this.once(p,c.delegates[p]);return this}off(f,e,o){return o===void 0?super.off(f,e):(this._delegatedListeners&&this._delegatedListeners[f]&&(c=>{let p=this._delegatedListeners[f];for(let m=0;m<p.length;m++){let x=p[m];if(x.layer===e&&x.listener===o){for(let w in x.delegates)this.off(w,x.delegates[w]);return p.splice(m,1),this}}})(),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let o,c=f instanceof l.P||Array.isArray(f),p=c?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:f)||{},p instanceof l.P||typeof p[0]=="number")o=[l.P.convert(p)];else{let m=l.P.convert(p[0]),x=l.P.convert(p[1]);o=[m,new l.P(x.x,m.y),x,new l.P(m.x,x.y),m]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){let e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));let o=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new un(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,o):this.style.loadJSON(f,e,o),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new un(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){let o=this._requestManager.transformRequest(f,qt.Style);l.f(o,(c,p)=>{c?this.fire(new l.j(c)):p&&this._updateDiff(p,e)})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){let e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new l.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){let e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);for(let o in this.style._layers){let c=this.style._layers[o];c.type==="hillshade"&&c.source===f.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new lp(this.painter,e,f),this.painter.renderToTexture=new Cu(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==f.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let f=this.style&&this.style.sourceCaches;for(let e in f){let o=f[e]._tiles;for(let c in o){let p=o[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(f,e,o){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,e,o)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,o={}){let{pixelRatio:c=1,sdf:p=!1,stretchX:m,stretchY:x,content:w}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.a(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:E,height:I,data:A}=e,L=e;return this.style.addImage(f,{data:new l.R({width:E,height:I},new Uint8Array(A)),pixelRatio:c,stretchX:m,stretchY:x,content:w,sdf:p,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f),this}}{let{width:E,height:I,data:A}=l.h.getImageData(e);this.style.addImage(f,{data:new l.R({width:E,height:I},A),pixelRatio:c,stretchX:m,stretchY:x,content:w,sdf:p,version:0})}}updateImage(f,e){let o=this.style.getImage(f);if(!o)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let c=e instanceof HTMLImageElement||l.a(e)?l.h.getImageData(e):e,{width:p,height:m,data:x}=c;if(p===void 0||m===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||m!==o.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let w=!(e instanceof HTMLImageElement||l.a(e));return o.data.replace(x,w),this.style.updateImage(f,o),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,e){Pt.getImage(this._requestManager.transformRequest(f,qt.Image),e)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,o){return this.style.setLayerZoomRange(f,e,o),this._update(!0)}setFilter(f,e,o={}){return this.style.setFilter(f,e,o),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,o,c={}){return this.style.setPaintProperty(f,e,o,c),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,o,c={}){return this.style.setLayoutProperty(f,e,o,c),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,o,c=>{c||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,o=>{o||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){let f=this._container;f.classList.add("maplibregl-map");let e=this._canvasContainer=R.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");let o=this._containerDimensions(),c=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],c);let p=this._controlContainer=R.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=R.create("div",`maplibregl-ctrl-${x} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=R.create("div","maplibregl-cooperative-gesture-screen",this._container);let f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${f}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){R.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(f,e,o){this._canvas.width=Math.floor(o*f),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1},e=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{e={requestedAttributes:f},c&&(e.statusMessage=c.statusMessage,e.type=c.type)},{once:!0});let o=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!o){let c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new ns(o,this.transform),et.testSupport(o)}_onCooperativeGesture(f,e,o){return!e&&o<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){let e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let p=this.transform.zoom,m=l.h.now();this.style.zoomHistory.update(p,m);let x=new l.a8(p,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(o=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bg.mark(l.bh.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,l.bg.mark(l.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Pt.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.bg.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.h.frame(f=>{l.bg.frame(f),this._frame=null,this._render(f)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return ie}getCameraTargetElevation(){return this.transform.elevation}},Je.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{let e=this._map.getZoom(),o=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,o)=>{let c=this._map._getUIString(`NavigationControl.${o}`);e.title=c,e.setAttribute("aria-label",c)},this.options=l.e({},Fc,f),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){let o=R.create("button",f,this._container);return o.type="button",o.addEventListener("click",e),o}},Je.GeolocateControl=class extends l.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let o=new l.L(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,p=this._map.getBearing(),m=l.e({bearing:p},this.options.fitBoundsOptions),x=Ne.fromLngLat(o,c);this._map.fitBounds(x,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let o=new l.L(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ia)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gs({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Dr,f)}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(e,o=!1){Ur===void 0||o?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(c=>{Ur=c.state!=="denied",e(Ur)}).catch(()=>{Ur=!!window.navigator.geolocation,e(Ur)}):(Ur=!!window.navigator.geolocation,e(Ur)):e(Ur)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Pr=0,Ia=!1}_isOutOfMapMaxBounds(f){let e=this._map.getMaxBounds(),o=f.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let f=this._map.getBounds(),e=f.getSouthEast(),o=f.getNorthEast(),c=e.distanceTo(o),p=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Pr--,Ia=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Pr++,Pr>1?(f={maximumAge:6e5,timeout:0},Ia=!0):(f=this.options.positionOptions,Ia=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Je.AttributionControl=_i,Je.LogoControl=yr,Je.ScaleControl=class{constructor(f){this._onMove=()=>{Il(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Il(this._map,this._container,this.options)},this.options=l.e({},Tl,f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Je.FullscreenControl=class extends l.E{constructor(f={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let f=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Je.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=f}onAdd(f){return this._map=f,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Je.Popup=class extends l.E{constructor(f){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.k("close")),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bc(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!e)return;let o=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),c=this.options.anchor,p=Ca(this.options.offset);if(!c){let x=this._container.offsetWidth,w=this._container.offsetHeight,E;E=o.y+p.bottom.y<w?["top"]:o.y>this._map.transform.height-w?["bottom"]:[],o.x<x/2?E.push("left"):o.x>this._map.transform.width-x/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}let m=o.add(p[c]).round();R.setTransform(this._container,`${Ni[c]} translate(${m.x}px,${m.y}px)`),up(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Vc),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=l.L.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let e=document.createDocumentFragment(),o=document.createElement("body"),c;for(o.innerHTML=f;c=o.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(Uc);f&&f.focus()}},Je.Marker=Gs,Je.Style=un,Je.LngLat=l.L,Je.LngLatBounds=Ne,Je.Point=l.P,Je.MercatorCoordinate=l.U,Je.Evented=l.E,Je.AJAXError=l.bi,Je.config=l.c,Je.CanvasSource=Fo,Je.GeoJSONSource=oo,Je.ImageSource=Qe,Je.RasterDEMTileSource=Os,Je.RasterTileSource=Ci,Je.VectorTileSource=zn,Je.VideoSource=na,Je.setRTLTextPlugin=l.bj,Je.getRTLTextPluginStatus=l.bk,Je.prewarm=function(){ia().acquire(Ze)},Je.clearPrewarmedResources=function(){let f=Zi;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Ze),Zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},jc.extend(Je,{isSafari:l.ac,getPerformanceMetrics:l.bg.getPerformanceMetrics}),Je});var C=_;return C})})(pb);var DP=pb.exports;var dE=_e(Ee(),1);var Uu=()=>{let{map:i}=(0,dE.useContext)(A0);return i};var rd=_e(Ee(),1),mE=_e(Wp(),1);var fE=10,db=i=>{let s=Uu(),u=new Set(Array.isArray(i.layerId)?i.layerId:[i.layerId]),d=(0,rd.useRef)(null),[_,b]=(0,rd.useState)(),C=l=>{let V=l.target,R=V.queryRenderedFeatures(l.point).filter(({layer:et})=>u.has(et.id));if(R.length>0){let{id:et,type:at,source:st,properties:yt,geometry:xt}=R[0];yt.cluster?V.getSource(st).getClusterLeaves(yt.cluster_id,1/0,0,(It,Pt)=>{if(!It){let qt=Pt.map(Qt=>({type:Qt.type,properties:Qt.properties,geometry:Qt.geometry}));b({target:{clusterId:et,features:qt},event:l.originalEvent})}}):b({target:{type:at,properties:yt,geometry:xt},event:l.originalEvent})}else b(void 0)};return(0,rd.useLayoutEffect)(()=>{if(d.current){let{clientX:l,clientY:V}=_.event,R=d.current.style;R.left=`${l+fE}px`,R.top=`${V+fE}px`}},[_]),(0,rd.useEffect)(()=>(s.on("mousemove",C),()=>{s.off("mousemove",C)}),[s]),_&&(0,mE.createPortal)(td.jsx("div",{ref:d,className:"p6o-tooltip-container",children:i.content(_.target,_.event)}),document.body)};var fb=i=>{let{id:s,data:u}=i,d=Uu();return(0,gE.useEffect)(()=>(d.addSource(`source-${s}`,{type:"geojson",data:u}),d.addLayer({id:`layer-${s}-fill`,...i.fillStyle,source:`source-${s}`,filter:["!=","$type","Point"],metadata:{interactive:i.interactive}}),d.addLayer({id:`layer-${s}-line`,...i.strokeStyle,source:`source-${s}`,filter:["!=","$type","Point"]}),d.addLayer({id:`layer-${s}-point`,...i.pointStyle,filter:["==","$type","Point"],source:`source-${s}`,metadata:{interactive:i.interactive}}),setTimeout(()=>d.moveLayer(`layer-${s}-point`),10),()=>{d.removeLayer(`layer-${s}-point`),d.removeLayer(`layer-${s}-line`),d.removeLayer(`layer-${s}-fill`),d.removeSource(`source-${s}`)}),[u]),i.tooltip?td.jsx(db,{layerId:[`layer-${s}-point`,`layer-${s}-fill`],content:i.tooltip}):null};var yE=_e(Ee(),1);var mb=(i,s,u,d)=>({width:i,height:i,data:new Uint8Array(i*i*4),onAdd:function(){let _=document.createElement("canvas");_.width=this.width,_.height=this.height,this.context=_.getContext("2d",{willReadFrequently:!0})},render:function(){let _=performance.now()%u/u,b=i/2*.2,C=i/2*.7*_+b,l=this.context;return l.clearRect(0,0,this.width,this.height),l.beginPath(),l.arc(this.width/2,this.height/2,C,0,Math.PI*2),l.fillStyle=`rgba(${s[0]}, ${s[1]}, ${s[2]}, ${1.5*(1-_)})`,l.fill(),this.data=l.getImageData(0,0,this.width,this.height).data,d.triggerRepaint(),!0}});var vE=_e(Ee(),1);var M0=_e(Ee(),1);var _E=(i=21)=>crypto.getRandomValues(new Uint8Array(i)).reduce((s,u)=>(u&=63,u<36?s+=u.toString(36):u<62?s+=(u-26).toString(36).toUpperCase():u>62?s+="-":s+="_",s),"");var gb=i=>{let s=Uu(),u=(0,M0.useMemo)(()=>`pulse-${_E()}`,[]),d=typeof i=="number"?i:i.size,_=typeof i=="number"?[246,112,86]:i.rgb||[246,112,86],b=typeof i=="number"?1e3:i.duration||1e3;return(0,M0.useEffect)(()=>(s.addImage(u,mb(d*2,_,b,s),{pixelRatio:2}),()=>{s.removeImage(u)}),[]),{type:"symbol",layout:{"icon-image":u}}};var yb=i=>{let{id:s,data:u}=i,d=Uu(),_=gb(i.size||100);return(0,vE.useEffect)(()=>(d.addSource(`source-${s}-pulse`,{type:"geojson",data:u}),d.addLayer({id:`layer-${s}-pulse`,..._,filter:["==","$type","Point"],source:`source-${s}-pulse`}),()=>{d.removeLayer(`layer-${s}-pulse`),d.removeSource(`source-${s}-pulse`)}),[u]),null};var RP=_e(Ee(),1);var D0=_e(Ee(),1);var Ps=_e(Ee(),1),xE=new Map([["bold",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128Z"}))],["duotone",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M216,48V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H208A8,8,0,0,1,216,48Z",opacity:"0.2"}),Ps.default.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"}))],["fill",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM184,136H72a8,8,0,0,1,0-16H184a8,8,0,0,1,0,16Z"}))],["light",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M222,128a6,6,0,0,1-6,6H40a6,6,0,0,1,0-12H216A6,6,0,0,1,222,128Z"}))],["regular",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,128Z"}))],["thin",Ps.default.createElement(Ps.default.Fragment,null,Ps.default.createElement("path",{d:"M220,128a4,4,0,0,1-4,4H40a4,4,0,0,1,0-8H216A4,4,0,0,1,220,128Z"}))]]);var OP=Object.defineProperty,FP=Object.defineProperties,NP=Object.getOwnPropertyDescriptors,bE=Object.getOwnPropertySymbols,BP=Object.prototype.hasOwnProperty,VP=Object.prototype.propertyIsEnumerable,wE=(i,s,u)=>s in i?OP(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,UP=(i,s)=>{for(var u in s||(s={}))BP.call(s,u)&&wE(i,u,s[u]);if(bE)for(var u of bE(s))VP.call(s,u)&&wE(i,u,s[u]);return i},jP=(i,s)=>FP(i,NP(s)),SE=(0,D0.forwardRef)((i,s)=>D0.default.createElement(fh,jP(UP({ref:s},i),{weights:xE})));SE.displayName="Minus";var k0=_e(Ee(),1);var As=_e(Ee(),1),EE=new Map([["bold",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"}))],["duotone",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M216,48V208a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H208A8,8,0,0,1,216,48Z",opacity:"0.2"}),As.default.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"}))],["fill",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM184,136H136v48a8,8,0,0,1-16,0V136H72a8,8,0,0,1,0-16h48V72a8,8,0,0,1,16,0v48h48a8,8,0,0,1,0,16Z"}))],["light",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M222,128a6,6,0,0,1-6,6H134v82a6,6,0,0,1-12,0V134H40a6,6,0,0,1,0-12h82V40a6,6,0,0,1,12,0v82h82A6,6,0,0,1,222,128Z"}))],["regular",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"}))],["thin",As.default.createElement(As.default.Fragment,null,As.default.createElement("path",{d:"M220,128a4,4,0,0,1-4,4H132v84a4,4,0,0,1-8,0V132H40a4,4,0,0,1,0-8h84V40a4,4,0,0,1,8,0v84h84A4,4,0,0,1,220,128Z"}))]]);var GP=Object.defineProperty,qP=Object.defineProperties,$P=Object.getOwnPropertyDescriptors,TE=Object.getOwnPropertySymbols,ZP=Object.prototype.hasOwnProperty,XP=Object.prototype.propertyIsEnumerable,IE=(i,s,u)=>s in i?GP(i,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[s]=u,HP=(i,s)=>{for(var u in s||(s={}))ZP.call(s,u)&&IE(i,u,s[u]);if(TE)for(var u of TE(s))XP.call(s,u)&&IE(i,u,s[u]);return i},YP=(i,s)=>qP(i,$P(s)),CE=(0,k0.forwardRef)((i,s)=>k0.default.createElement(fh,YP(HP({ref:s},i),{weights:EE})));CE.displayName="Plus";var pZ=_e(Ee(),1);var z0=_e(Ee(),1);var JP=_e(Ee(),1);var GT=_e(Ee(),1);var PE={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},AE={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},LE={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}};function _b(i,s,u){if(i!==null)for(var d,_,b,C,l,V,R,et=0,at=0,st,yt=i.type,xt=yt==="FeatureCollection",It=yt==="Feature",Pt=xt?i.features.length:1,qt=0;qt<Pt;qt++){R=xt?i.features[qt].geometry:It?i.geometry:i,st=R?R.type==="GeometryCollection":!1,l=st?R.geometries.length:1;for(var Qt=0;Qt<l;Qt++){var se=0,le=0;if(C=st?R.geometries[Qt]:R,C!==null){V=C.coordinates;var Ue=C.type;switch(et=u&&(Ue==="Polygon"||Ue==="MultiPolygon")?1:0,Ue){case null:break;case"Point":if(s(V,at,qt,se,le)===!1)return!1;at++,se++;break;case"LineString":case"MultiPoint":for(d=0;d<V.length;d++){if(s(V[d],at,qt,se,le)===!1)return!1;at++,Ue==="MultiPoint"&&se++}Ue==="LineString"&&se++;break;case"Polygon":case"MultiLineString":for(d=0;d<V.length;d++){for(_=0;_<V[d].length-et;_++){if(s(V[d][_],at,qt,se,le)===!1)return!1;at++}Ue==="MultiLineString"&&se++,Ue==="Polygon"&&le++}Ue==="Polygon"&&se++;break;case"MultiPolygon":for(d=0;d<V.length;d++){for(le=0,_=0;_<V[d].length;_++){for(b=0;b<V[d][_].length-et;b++){if(s(V[d][_][b],at,qt,se,le)===!1)return!1;at++}le++}se++}break;case"GeometryCollection":for(d=0;d<C.geometries.length;d++)if(_b(C.geometries[d],s,u)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function vb(i,s){if(i.type==="Feature")s(i,0);else if(i.type==="FeatureCollection")for(var u=0;u<i.features.length&&s(i.features[u],u)!==!1;u++);}function xb(i,s){var u,d,_,b,C,l,V,R,et,at,st=0,yt=i.type==="FeatureCollection",xt=i.type==="Feature",It=yt?i.features.length:1;for(u=0;u<It;u++){for(l=yt?i.features[u].geometry:xt?i.geometry:i,R=yt?i.features[u].properties:xt?i.properties:{},et=yt?i.features[u].bbox:xt?i.bbox:void 0,at=yt?i.features[u].id:xt?i.id:void 0,V=l?l.type==="GeometryCollection":!1,C=V?l.geometries.length:1,_=0;_<C;_++){if(b=V?l.geometries[_]:l,b===null){if(s(null,st,R,et,at)===!1)return!1;continue}switch(b.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(b,st,R,et,at)===!1)return!1;break}case"GeometryCollection":{for(d=0;d<b.geometries.length;d++)if(s(b.geometries[d],st,R,et,at)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}st++}}function yf(i){var s=[1/0,1/0,-1/0,-1/0];return _b(i,function(u){s[0]>u[0]&&(s[0]=u[0]),s[1]>u[1]&&(s[1]=u[1]),s[2]<u[0]&&(s[2]=u[0]),s[3]<u[1]&&(s[3]=u[1])}),s}yf.default=yf;var nl=63710088e-1,DE={centimeters:nl*100,centimetres:nl*100,degrees:nl/111325,feet:nl*3.28084,inches:nl*39.37,kilometers:nl/1e3,kilometres:nl/1e3,meters:nl,metres:nl,miles:nl/1609.344,millimeters:nl*1e3,millimetres:nl*1e3,nauticalmiles:nl/1852,radians:1,yards:nl*1.0936};function pm(i,s,u){u===void 0&&(u={});var d={type:"Feature"};return(u.id===0||u.id)&&(d.id=u.id),u.bbox&&(d.bbox=u.bbox),d.properties=s||{},d.geometry=i,d}function kE(i,s,u){if(u===void 0&&(u={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ME(i[0])||!ME(i[1]))throw new Error("coordinates must contain numbers");var d={type:"Point",coordinates:i};return pm(d,s,u)}function zE(i,s,u){u===void 0&&(u={});for(var d=0,_=i;d<_.length;d++){var b=_[d];if(b.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var C=0;C<b[b.length-1].length;C++)if(b[b.length-1][C]!==b[0][C])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:i};return pm(l,s,u)}function R0(i,s){s===void 0&&(s={});var u={type:"FeatureCollection"};return s.id&&(u.id=s.id),s.bbox&&(u.bbox=s.bbox),u.features=i,u}function RE(i,s){s===void 0&&(s="kilometers");var u=DE[s];if(!u)throw new Error(s+" units is invalid");return i*u}function OE(i,s){s===void 0&&(s="kilometers");var u=DE[s];if(!u)throw new Error(s+" units is invalid");return i/u}function ME(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function FE(i,s){s===void 0&&(s={});var u=Number(i[0]),d=Number(i[1]),_=Number(i[2]),b=Number(i[3]);if(i.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var C=[u,d],l=[u,b],V=[_,b],R=[_,d];return zE([[C,R,V,l,C]],s.properties,{bbox:i,id:s.id})}function NE(i,s){s===void 0&&(s={});var u=yf(i),d=(u[0]+u[2])/2,_=(u[1]+u[3])/2;return kE([d,_],s.properties,s)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(i){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var s=Object(this),u=Math.max(Math.min(s.length,9007199254740991),0)||0,d=1 in arguments&&parseInt(Number(arguments[1]),10)||0;d=d<0?Math.max(u+d,0):Math.min(d,u);var _=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:u;for(_=_<0?Math.max(u+arguments[2],0):Math.min(_,u);d<_;)s[d]=i,++d;return s},writable:!0});Number.isFinite=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)};Number.isInteger=Number.isInteger||function(i){return typeof i=="number"&&isFinite(i)&&Math.floor(i)===i};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(i){return i!==i};Math.trunc=Math.trunc||function(i){return i<0?Math.ceil(i):Math.floor(i)};var _f=function(){};_f.prototype.interfaces_=function(){return[]};_f.prototype.getClass=function(){return _f};_f.prototype.equalsWithTolerance=function(i,s,u){return Math.abs(i-s)<=u};var $i=function(i){function s(u){i.call(this,u),this.name="IllegalArgumentException",this.message=u,this.stack=new i().stack}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s}(Error),Lr=function(){},GE={MAX_VALUE:{configurable:!0}};Lr.isNaN=function(i){return Number.isNaN(i)};Lr.doubleToLongBits=function(i){return i};Lr.longBitsToDouble=function(i){return i};Lr.isInfinite=function(i){return!Number.isFinite(i)};GE.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Lr,GE);var fu=function(){},U0=function(){},fm=function(){};function mu(){}var Vt=function i(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=i.NULL_ORDINATE;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.z=s.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=i.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Lf={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Vt.prototype.setOrdinate=function(i,s){switch(i){case Vt.X:this.x=s;break;case Vt.Y:this.y=s;break;case Vt.Z:this.z=s;break;default:throw new $i("Invalid ordinate index: "+i)}};Vt.prototype.equals2D=function(){if(arguments.length===1){var i=arguments[0];return!(this.x!==i.x||this.y!==i.y)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];return!(!_f.equalsWithTolerance(this.x,s.x,u)||!_f.equalsWithTolerance(this.y,s.y,u))}};Vt.prototype.getOrdinate=function(i){switch(i){case Vt.X:return this.x;case Vt.Y:return this.y;case Vt.Z:return this.z}throw new $i("Invalid ordinate index: "+i)};Vt.prototype.equals3D=function(i){return this.x===i.x&&this.y===i.y&&(this.z===i.z||Lr.isNaN(this.z))&&Lr.isNaN(i.z)};Vt.prototype.equals=function(i){return i instanceof Vt?this.equals2D(i):!1};Vt.prototype.equalInZ=function(i,s){return _f.equalsWithTolerance(this.z,i.z,s)};Vt.prototype.compareTo=function(i){var s=i;return this.x<s.x?-1:this.x>s.x?1:this.y<s.y?-1:this.y>s.y?1:0};Vt.prototype.clone=function(){};Vt.prototype.copy=function(){return new Vt(this)};Vt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Vt.prototype.distance3D=function(i){var s=this.x-i.x,u=this.y-i.y,d=this.z-i.z;return Math.sqrt(s*s+u*u+d*d)};Vt.prototype.distance=function(i){var s=this.x-i.x,u=this.y-i.y;return Math.sqrt(s*s+u*u)};Vt.prototype.hashCode=function(){var i=17;return i=37*i+Vt.hashCode(this.x),i=37*i+Vt.hashCode(this.y),i};Vt.prototype.setCoordinate=function(i){this.x=i.x,this.y=i.y,this.z=i.z};Vt.prototype.interfaces_=function(){return[fu,U0,mu]};Vt.prototype.getClass=function(){return Vt};Vt.hashCode=function(){if(arguments.length===1){var i=arguments[0],s=Lr.doubleToLongBits(i);return Math.trunc((s^s)>>>32)}};Lf.DimensionalComparator.get=function(){return Op};Lf.serialVersionUID.get=function(){return 6683108902428367e3};Lf.NULL_ORDINATE.get=function(){return Lr.NaN};Lf.X.get=function(){return 0};Lf.Y.get=function(){return 1};Lf.Z.get=function(){return 2};Object.defineProperties(Vt,Lf);var Op=function(i){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var s=arguments[0];if(s!==2&&s!==3)throw new $i("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}};Op.prototype.compare=function(i,s){var u=i,d=s,_=Op.compare(u.x,d.x);if(_!==0)return _;var b=Op.compare(u.y,d.y);if(b!==0)return b;if(this._dimensionsToTest<=2)return 0;var C=Op.compare(u.z,d.z);return C};Op.prototype.interfaces_=function(){return[fm]};Op.prototype.getClass=function(){return Op};Op.compare=function(i,s){return i<s?-1:i>s?1:Lr.isNaN(i)?Lr.isNaN(s)?0:-1:Lr.isNaN(s)?1:0};var mm=function(){};mm.prototype.create=function(){};mm.prototype.interfaces_=function(){return[]};mm.prototype.getClass=function(){return mm};var Xt=function(){},Xy={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Xt.prototype.interfaces_=function(){return[]};Xt.prototype.getClass=function(){return Xt};Xt.toLocationSymbol=function(i){switch(i){case Xt.EXTERIOR:return"e";case Xt.BOUNDARY:return"b";case Xt.INTERIOR:return"i";case Xt.NONE:return"-"}throw new $i("Unknown location value: "+i)};Xy.INTERIOR.get=function(){return 0};Xy.BOUNDARY.get=function(){return 1};Xy.EXTERIOR.get=function(){return 2};Xy.NONE.get=function(){return-1};Object.defineProperties(Xt,Xy);var xr=function(i,s){return i.interfaces_&&i.interfaces_().indexOf(s)>-1},Ol=function(){},qE={LOG_10:{configurable:!0}};Ol.prototype.interfaces_=function(){return[]};Ol.prototype.getClass=function(){return Ol};Ol.log10=function(i){var s=Math.log(i);return Lr.isInfinite(s)||Lr.isNaN(s)?s:s/Ol.LOG_10};Ol.min=function(i,s,u,d){var _=i;return s<_&&(_=s),u<_&&(_=u),d<_&&(_=d),_};Ol.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],u=arguments[2];return i<s?s:i>u?u:i}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var d=arguments[0],_=arguments[1],b=arguments[2];return d<_?_:d>b?b:d}};Ol.wrap=function(i,s){return i<0?s- -i%s:i%s};Ol.max=function(){if(arguments.length===3){var i=arguments[0],s=arguments[1],u=arguments[2],d=i;return s>d&&(d=s),u>d&&(d=u),d}else if(arguments.length===4){var _=arguments[0],b=arguments[1],C=arguments[2],l=arguments[3],V=_;return b>V&&(V=b),C>V&&(V=C),l>V&&(V=l),V}};Ol.average=function(i,s){return(i+s)/2};qE.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Ol,qE);var wc=function(i){this.str=i};wc.prototype.append=function(i){this.str+=i};wc.prototype.setCharAt=function(i,s){this.str=this.str.substr(0,i)+s+this.str.substr(i+1)};wc.prototype.toString=function(i){return this.str};var pc=function(i){this.value=i};pc.prototype.intValue=function(){return this.value};pc.prototype.compareTo=function(i){return this.value<i?-1:this.value>i?1:0};pc.isNaN=function(i){return Number.isNaN(i)};var zy=function(){};zy.isWhitespace=function(i){return i<=32&&i>=0||i===127};zy.toUpperCase=function(i){return i.toUpperCase()};var Jt=function i(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var s=arguments[0];this.init(s)}else if(arguments[0]instanceof i){var u=arguments[0];this.init(u)}else if(typeof arguments[0]=="string"){var d=arguments[0];i.call(this,i.parse(d))}}else if(arguments.length===2){var _=arguments[0],b=arguments[1];this.init(_,b)}},Ju={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Jt.prototype.le=function(i){return(this._hi<i._hi||this._hi===i._hi)&&this._lo<=i._lo};Jt.prototype.extractSignificantDigits=function(i,s){var u=this.abs(),d=Jt.magnitude(u._hi),_=Jt.TEN.pow(d);u=u.divide(_),u.gt(Jt.TEN)?(u=u.divide(Jt.TEN),d+=1):u.lt(Jt.ONE)&&(u=u.multiply(Jt.TEN),d-=1);for(var b=d+1,C=new wc,l=Jt.MAX_PRINT_DIGITS-1,V=0;V<=l;V++){i&&V===b&&C.append(".");var R=Math.trunc(u._hi);if(R<0)break;var et=!1,at=0;R>9?(et=!0,at="9"):at="0"+R,C.append(at),u=u.subtract(Jt.valueOf(R)).multiply(Jt.TEN),et&&u.selfAdd(Jt.TEN);var st=!0,yt=Jt.magnitude(u._hi);if(yt<0&&Math.abs(yt)>=l-V&&(st=!1),!st)break}return s[0]=d,C.toString()};Jt.prototype.sqr=function(){return this.multiply(this)};Jt.prototype.doubleValue=function(){return this._hi+this._lo};Jt.prototype.subtract=function(){if(arguments[0]instanceof Jt){var i=arguments[0];return this.add(i.negate())}else if(typeof arguments[0]=="number"){var s=arguments[0];return this.add(-s)}};Jt.prototype.equals=function(){if(arguments.length===1){var i=arguments[0];return this._hi===i._hi&&this._lo===i._lo}};Jt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Jt.prototype.selfSubtract=function(){if(arguments[0]instanceof Jt){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i._hi,-i._lo)}else if(typeof arguments[0]=="number"){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s,0)}};Jt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Jt.prototype.min=function(i){return this.le(i)?this:i};Jt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Jt){var i=arguments[0];return this.selfDivide(i._hi,i._lo)}else if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfDivide(s,0)}}else if(arguments.length===2){var u=arguments[0],d=arguments[1],_=null,b=null,C=null,l=null,V=null,R=null,et=null,at=null;return V=this._hi/u,R=Jt.SPLIT*V,_=R-V,at=Jt.SPLIT*u,_=R-_,b=V-_,C=at-u,et=V*u,C=at-C,l=u-C,at=_*C-et+_*l+b*C+b*l,R=(this._hi-et-at+this._lo-V*d)/u,at=V+R,this._hi=at,this._lo=V-at+R,this}};Jt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Jt.prototype.divide=function(){if(arguments[0]instanceof Jt){var i=arguments[0],s=null,u=null,d=null,_=null,b=null,C=null,l=null,V=null;b=this._hi/i._hi,C=Jt.SPLIT*b,s=C-b,V=Jt.SPLIT*i._hi,s=C-s,u=b-s,d=V-i._hi,l=b*i._hi,d=V-d,_=i._hi-d,V=s*d-l+s*_+u*d+u*_,C=(this._hi-l-V+this._lo-b*i._lo)/i._hi,V=b+C;var R=V,et=b-V+C;return new Jt(R,et)}else if(typeof arguments[0]=="number"){var at=arguments[0];return Lr.isNaN(at)?Jt.createNaN():Jt.copy(this).selfDivide(at,0)}};Jt.prototype.ge=function(i){return(this._hi>i._hi||this._hi===i._hi)&&this._lo>=i._lo};Jt.prototype.pow=function(i){if(i===0)return Jt.valueOf(1);var s=new Jt(this),u=Jt.valueOf(1),d=Math.abs(i);if(d>1)for(;d>0;)d%2===1&&u.selfMultiply(s),d/=2,d>0&&(s=s.sqr());else u=s;return i<0?u.reciprocal():u};Jt.prototype.ceil=function(){if(this.isNaN())return Jt.NaN;var i=Math.ceil(this._hi),s=0;return i===this._hi&&(s=Math.ceil(this._lo)),new Jt(i,s)};Jt.prototype.compareTo=function(i){var s=i;return this._hi<s._hi?-1:this._hi>s._hi?1:this._lo<s._lo?-1:this._lo>s._lo?1:0};Jt.prototype.rint=function(){if(this.isNaN())return this;var i=this.add(.5);return i.floor()};Jt.prototype.setValue=function(){if(arguments[0]instanceof Jt){var i=arguments[0];return this.init(i),this}else if(typeof arguments[0]=="number"){var s=arguments[0];return this.init(s),this}};Jt.prototype.max=function(i){return this.ge(i)?this:i};Jt.prototype.sqrt=function(){if(this.isZero())return Jt.valueOf(0);if(this.isNegative())return Jt.NaN;var i=1/Math.sqrt(this._hi),s=this._hi*i,u=Jt.valueOf(s),d=this.subtract(u.sqr()),_=d._hi*(i*.5);return u.add(_)};Jt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Jt){var i=arguments[0];return this.selfAdd(i._hi,i._lo)}else if(typeof arguments[0]=="number"){var s=arguments[0],u=null,d=null,_=null,b=null,C=null,l=null;return _=this._hi+s,C=_-this._hi,b=_-C,b=s-C+(this._hi-b),l=b+this._lo,u=_+l,d=l+(_-u),this._hi=u+d,this._lo=d+(u-this._hi),this}}else if(arguments.length===2){var V=arguments[0],R=arguments[1],et=null,at=null,st=null,yt=null,xt=null,It=null,Pt=null,qt=null;xt=this._hi+V,st=this._lo+R,Pt=xt-this._hi,qt=st-this._lo,It=xt-Pt,yt=st-qt,It=V-Pt+(this._hi-It),yt=R-qt+(this._lo-yt),Pt=It+st,et=xt+Pt,at=Pt+(xt-et),Pt=yt+at;var Qt=et+Pt,se=Pt+(et-Qt);return this._hi=Qt,this._lo=se,this}};Jt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Jt){var i=arguments[0];return this.selfMultiply(i._hi,i._lo)}else if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfMultiply(s,0)}}else if(arguments.length===2){var u=arguments[0],d=arguments[1],_=null,b=null,C=null,l=null,V=null,R=null;V=Jt.SPLIT*this._hi,_=V-this._hi,R=Jt.SPLIT*u,_=V-_,b=this._hi-_,C=R-u,V=this._hi*u,C=R-C,l=u-C,R=_*C-V+_*l+b*C+b*l+(this._hi*d+this._lo*u);var et=V+R;_=V-et;var at=R+_;return this._hi=et,this._lo=at,this}};Jt.prototype.selfSqr=function(){return this.selfMultiply(this)};Jt.prototype.floor=function(){if(this.isNaN())return Jt.NaN;var i=Math.floor(this._hi),s=0;return i===this._hi&&(s=Math.floor(this._lo)),new Jt(i,s)};Jt.prototype.negate=function(){return this.isNaN()?this:new Jt(-this._hi,-this._lo)};Jt.prototype.clone=function(){};Jt.prototype.multiply=function(){if(arguments[0]instanceof Jt){var i=arguments[0];return i.isNaN()?Jt.createNaN():Jt.copy(this).selfMultiply(i)}else if(typeof arguments[0]=="number"){var s=arguments[0];return Lr.isNaN(s)?Jt.createNaN():Jt.copy(this).selfMultiply(s,0)}};Jt.prototype.isNaN=function(){return Lr.isNaN(this._hi)};Jt.prototype.intValue=function(){return Math.trunc(this._hi)};Jt.prototype.toString=function(){var i=Jt.magnitude(this._hi);return i>=-3&&i<=20?this.toStandardNotation():this.toSciNotation()};Jt.prototype.toStandardNotation=function(){var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),u=this.extractSignificantDigits(!0,s),d=s[0]+1,_=u;if(u.charAt(0)===".")_="0"+u;else if(d<0)_="0."+Jt.stringOfChar("0",-d)+u;else if(u.indexOf(".")===-1){var b=d-u.length,C=Jt.stringOfChar("0",b);_=u+C+".0"}return this.isNegative()?"-"+_:_};Jt.prototype.reciprocal=function(){var i=null,s=null,u=null,d=null,_=null,b=null,C=null,l=null;_=1/this._hi,b=Jt.SPLIT*_,i=b-_,l=Jt.SPLIT*this._hi,i=b-i,s=_-i,u=l-this._hi,C=_*this._hi,u=l-u,d=this._hi-u,l=i*u-C+i*d+s*u+s*d,b=(1-C-l-_*this._lo)/this._hi;var V=_+b,R=_-V+b;return new Jt(V,R)};Jt.prototype.toSciNotation=function(){if(this.isZero())return Jt.SCI_NOT_ZERO;var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),u=this.extractSignificantDigits(!1,s),d=Jt.SCI_NOT_EXPONENT_CHAR+s[0];if(u.charAt(0)==="0")throw new Error("Found leading zero: "+u);var _="";u.length>1&&(_=u.substring(1));var b=u.charAt(0)+"."+_;return this.isNegative()?"-"+b+d:b+d};Jt.prototype.abs=function(){return this.isNaN()?Jt.NaN:this.isNegative()?this.negate():new Jt(this)};Jt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Jt.prototype.lt=function(i){return(this._hi<i._hi||this._hi===i._hi)&&this._lo<i._lo};Jt.prototype.add=function(){if(arguments[0]instanceof Jt){var i=arguments[0];return Jt.copy(this).selfAdd(i)}else if(typeof arguments[0]=="number"){var s=arguments[0];return Jt.copy(this).selfAdd(s)}};Jt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this._hi=i,this._lo=0}else if(arguments[0]instanceof Jt){var s=arguments[0];this._hi=s._hi,this._lo=s._lo}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];this._hi=u,this._lo=d}};Jt.prototype.gt=function(i){return(this._hi>i._hi||this._hi===i._hi)&&this._lo>i._lo};Jt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Jt.prototype.trunc=function(){return this.isNaN()?Jt.NaN:this.isPositive()?this.floor():this.ceil()};Jt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Jt.prototype.interfaces_=function(){return[mu,fu,U0]};Jt.prototype.getClass=function(){return Jt};Jt.sqr=function(i){return Jt.valueOf(i).selfMultiply(i)};Jt.valueOf=function(){if(typeof arguments[0]=="string"){var i=arguments[0];return Jt.parse(i)}else if(typeof arguments[0]=="number"){var s=arguments[0];return new Jt(s)}};Jt.sqrt=function(i){return Jt.valueOf(i).sqrt()};Jt.parse=function(i){for(var s=0,u=i.length;zy.isWhitespace(i.charAt(s));)s++;var d=!1;if(s<u){var _=i.charAt(s);(_==="-"||_==="+")&&(s++,_==="-"&&(d=!0))}for(var b=new Jt,C=0,l=0,V=0;!(s>=u);){var R=i.charAt(s);if(s++,zy.isDigit(R)){var et=R-"0";b.selfMultiply(Jt.TEN),b.selfAdd(et),C++;continue}if(R==="."){l=C;continue}if(R==="e"||R==="E"){var at=i.substring(s);try{V=pc.parseInt(at)}catch(Pt){throw Pt instanceof Error?new Error("Invalid exponent "+at+" in string "+i):Pt}finally{}break}throw new Error("Unexpected character '"+R+"' at position "+s+" in string "+i)}var st=b,yt=C-l-V;if(yt===0)st=b;else if(yt>0){var xt=Jt.TEN.pow(yt);st=b.divide(xt)}else if(yt<0){var It=Jt.TEN.pow(-yt);st=b.multiply(It)}return d?st.negate():st};Jt.createNaN=function(){return new Jt(Lr.NaN,Lr.NaN)};Jt.copy=function(i){return new Jt(i)};Jt.magnitude=function(i){var s=Math.abs(i),u=Math.log(s)/Math.log(10),d=Math.trunc(Math.floor(u)),_=Math.pow(10,d);return _*10<=s&&(d+=1),d};Jt.stringOfChar=function(i,s){for(var u=new wc,d=0;d<s;d++)u.append(i);return u.toString()};Ju.PI.get=function(){return new Jt(3.141592653589793,12246467991473532e-32)};Ju.TWO_PI.get=function(){return new Jt(6.283185307179586,24492935982947064e-32)};Ju.PI_2.get=function(){return new Jt(1.5707963267948966,6123233995736766e-32)};Ju.E.get=function(){return new Jt(2.718281828459045,14456468917292502e-32)};Ju.NaN.get=function(){return new Jt(Lr.NaN,Lr.NaN)};Ju.EPS.get=function(){return 123259516440783e-46};Ju.SPLIT.get=function(){return 134217729};Ju.MAX_PRINT_DIGITS.get=function(){return 32};Ju.TEN.get=function(){return Jt.valueOf(10)};Ju.ONE.get=function(){return Jt.valueOf(1)};Ju.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Ju.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Jt,Ju);var Oa=function(){},$E={DP_SAFE_EPSILON:{configurable:!0}};Oa.prototype.interfaces_=function(){return[]};Oa.prototype.getClass=function(){return Oa};Oa.orientationIndex=function(i,s,u){var d=Oa.orientationIndexFilter(i,s,u);if(d<=1)return d;var _=Jt.valueOf(s.x).selfAdd(-i.x),b=Jt.valueOf(s.y).selfAdd(-i.y),C=Jt.valueOf(u.x).selfAdd(-s.x),l=Jt.valueOf(u.y).selfAdd(-s.y);return _.selfMultiply(l).selfSubtract(b.selfMultiply(C)).signum()};Oa.signOfDet2x2=function(i,s,u,d){var _=i.multiply(d).selfSubtract(s.multiply(u));return _.signum()};Oa.intersection=function(i,s,u,d){var _=Jt.valueOf(d.y).selfSubtract(u.y).selfMultiply(Jt.valueOf(s.x).selfSubtract(i.x)),b=Jt.valueOf(d.x).selfSubtract(u.x).selfMultiply(Jt.valueOf(s.y).selfSubtract(i.y)),C=_.subtract(b),l=Jt.valueOf(d.x).selfSubtract(u.x).selfMultiply(Jt.valueOf(i.y).selfSubtract(u.y)),V=Jt.valueOf(d.y).selfSubtract(u.y).selfMultiply(Jt.valueOf(i.x).selfSubtract(u.x)),R=l.subtract(V),et=R.selfDivide(C).doubleValue(),at=Jt.valueOf(i.x).selfAdd(Jt.valueOf(s.x).selfSubtract(i.x).selfMultiply(et)).doubleValue(),st=Jt.valueOf(s.x).selfSubtract(i.x).selfMultiply(Jt.valueOf(i.y).selfSubtract(u.y)),yt=Jt.valueOf(s.y).selfSubtract(i.y).selfMultiply(Jt.valueOf(i.x).selfSubtract(u.x)),xt=st.subtract(yt),It=xt.selfDivide(C).doubleValue(),Pt=Jt.valueOf(u.y).selfAdd(Jt.valueOf(d.y).selfSubtract(u.y).selfMultiply(It)).doubleValue();return new Vt(at,Pt)};Oa.orientationIndexFilter=function(i,s,u){var d=null,_=(i.x-u.x)*(s.y-u.y),b=(i.y-u.y)*(s.x-u.x),C=_-b;if(_>0){if(b<=0)return Oa.signum(C);d=_+b}else if(_<0){if(b>=0)return Oa.signum(C);d=-_-b}else return Oa.signum(C);var l=Oa.DP_SAFE_EPSILON*d;return C>=l||-C>=l?Oa.signum(C):2};Oa.signum=function(i){return i>0?1:i<0?-1:0};$E.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Oa,$E);var dn=function(){},Hy={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Hy.X.get=function(){return 0};Hy.Y.get=function(){return 1};Hy.Z.get=function(){return 2};Hy.M.get=function(){return 3};dn.prototype.setOrdinate=function(i,s,u){};dn.prototype.size=function(){};dn.prototype.getOrdinate=function(i,s){};dn.prototype.getCoordinate=function(){};dn.prototype.getCoordinateCopy=function(i){};dn.prototype.getDimension=function(){};dn.prototype.getX=function(i){};dn.prototype.clone=function(){};dn.prototype.expandEnvelope=function(i){};dn.prototype.copy=function(){};dn.prototype.getY=function(i){};dn.prototype.toCoordinateArray=function(){};dn.prototype.interfaces_=function(){return[U0]};dn.prototype.getClass=function(){return dn};Object.defineProperties(dn,Hy);var ZE=function(){},Dm=function(i){function s(){i.call(this,"Projective point not representable on the Cartesian plane.")}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(ZE),Ds=function(){};Ds.arraycopy=function(i,s,u,d,_){for(var b=0,C=s;C<s+_;C++)u[d+b]=i[C],b++};Ds.getProperty=function(i){return{"line.separator":`
`}[i]};var ju=function i(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var u=arguments[0],d=arguments[1];this.x=u,this.y=d,this.w=1}else if(arguments[0]instanceof i&&arguments[1]instanceof i){var _=arguments[0],b=arguments[1];this.x=_.y*b.w-b.y*_.w,this.y=b.x*_.w-_.x*b.w,this.w=_.x*b.y-b.x*_.y}else if(arguments[0]instanceof Vt&&arguments[1]instanceof Vt){var C=arguments[0],l=arguments[1];this.x=C.y-l.y,this.y=l.x-C.x,this.w=C.x*l.y-l.x*C.y}}else if(arguments.length===3){var V=arguments[0],R=arguments[1],et=arguments[2];this.x=V,this.y=R,this.w=et}else if(arguments.length===4){var at=arguments[0],st=arguments[1],yt=arguments[2],xt=arguments[3],It=at.y-st.y,Pt=st.x-at.x,qt=at.x*st.y-st.x*at.y,Qt=yt.y-xt.y,se=xt.x-yt.x,le=yt.x*xt.y-xt.x*yt.y;this.x=Pt*le-se*qt,this.y=Qt*qt-It*le,this.w=It*se-Qt*Pt}};ju.prototype.getY=function(){var i=this.y/this.w;if(Lr.isNaN(i)||Lr.isInfinite(i))throw new Dm;return i};ju.prototype.getX=function(){var i=this.x/this.w;if(Lr.isNaN(i)||Lr.isInfinite(i))throw new Dm;return i};ju.prototype.getCoordinate=function(){var i=new Vt;return i.x=this.getX(),i.y=this.getY(),i};ju.prototype.interfaces_=function(){return[]};ju.prototype.getClass=function(){return ju};ju.intersection=function(i,s,u,d){var _=i.y-s.y,b=s.x-i.x,C=i.x*s.y-s.x*i.y,l=u.y-d.y,V=d.x-u.x,R=u.x*d.y-d.x*u.y,et=b*R-V*C,at=l*C-_*R,st=_*V-l*b,yt=et/st,xt=at/st;if(Lr.isNaN(yt)||Lr.isInfinite(yt)||Lr.isNaN(xt)||Lr.isInfinite(xt))throw new Dm;return new Vt(yt,xt)};var ir=function i(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Vt){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else if(arguments[0]instanceof i){var u=arguments[0];this.init(u)}}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.init(d.x,_.x,d.y,_.y)}else if(arguments.length===4){var b=arguments[0],C=arguments[1],l=arguments[2],V=arguments[3];this.init(b,C,l,V)}},XE={serialVersionUID:{configurable:!0}};ir.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ir.prototype.equals=function(i){if(!(i instanceof ir))return!1;var s=i;return this.isNull()?s.isNull():this._maxx===s.getMaxX()&&this._maxy===s.getMaxY()&&this._minx===s.getMinX()&&this._miny===s.getMinY()};ir.prototype.intersection=function(i){if(this.isNull()||i.isNull()||!this.intersects(i))return new ir;var s=this._minx>i._minx?this._minx:i._minx,u=this._miny>i._miny?this._miny:i._miny,d=this._maxx<i._maxx?this._maxx:i._maxx,_=this._maxy<i._maxy?this._maxy:i._maxy;return new ir(s,d,u,_)};ir.prototype.isNull=function(){return this._maxx<this._minx};ir.prototype.getMaxX=function(){return this._maxx};ir.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Vt){var i=arguments[0];return this.covers(i.x,i.y)}else if(arguments[0]instanceof ir){var s=arguments[0];return this.isNull()||s.isNull()?!1:s.getMinX()>=this._minx&&s.getMaxX()<=this._maxx&&s.getMinY()>=this._miny&&s.getMaxY()<=this._maxy}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];return this.isNull()?!1:u>=this._minx&&u<=this._maxx&&d>=this._miny&&d<=this._maxy}};ir.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof ir){var i=arguments[0];return this.isNull()||i.isNull()?!1:!(i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny)}else if(arguments[0]instanceof Vt){var s=arguments[0];return this.intersects(s.x,s.y)}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];return this.isNull()?!1:!(u>this._maxx||u<this._minx||d>this._maxy||d<this._miny)}};ir.prototype.getMinY=function(){return this._miny};ir.prototype.getMinX=function(){return this._minx};ir.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Vt){var i=arguments[0];this.expandToInclude(i.x,i.y)}else if(arguments[0]instanceof ir){var s=arguments[0];if(s.isNull())return null;this.isNull()?(this._minx=s.getMinX(),this._maxx=s.getMaxX(),this._miny=s.getMinY(),this._maxy=s.getMaxY()):(s._minx<this._minx&&(this._minx=s._minx),s._maxx>this._maxx&&(this._maxx=s._maxx),s._miny<this._miny&&(this._miny=s._miny),s._maxy>this._maxy&&(this._maxy=s._maxy))}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];this.isNull()?(this._minx=u,this._maxx=u,this._miny=d,this._maxy=d):(u<this._minx&&(this._minx=u),u>this._maxx&&(this._maxx=u),d<this._miny&&(this._miny=d),d>this._maxy&&(this._maxy=d))}};ir.prototype.minExtent=function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i<s?i:s};ir.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};ir.prototype.compareTo=function(i){var s=i;return this.isNull()?s.isNull()?0:-1:s.isNull()?1:this._minx<s._minx?-1:this._minx>s._minx?1:this._miny<s._miny?-1:this._miny>s._miny?1:this._maxx<s._maxx?-1:this._maxx>s._maxx?1:this._maxy<s._maxy?-1:this._maxy>s._maxy?1:0};ir.prototype.translate=function(i,s){if(this.isNull())return null;this.init(this.getMinX()+i,this.getMaxX()+i,this.getMinY()+s,this.getMaxY()+s)};ir.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};ir.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};ir.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};ir.prototype.maxExtent=function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i>s?i:s};ir.prototype.expandBy=function(){if(arguments.length===1){var i=arguments[0];this.expandBy(i,i)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];if(this.isNull())return null;this._minx-=s,this._maxx+=s,this._miny-=u,this._maxy+=u,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};ir.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof ir){var i=arguments[0];return this.covers(i)}else if(arguments[0]instanceof Vt){var s=arguments[0];return this.covers(s)}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];return this.covers(u,d)}};ir.prototype.centre=function(){return this.isNull()?null:new Vt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};ir.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Vt){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof ir){var s=arguments[0];this._minx=s._minx,this._maxx=s._maxx,this._miny=s._miny,this._maxy=s._maxy}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];this.init(u.x,d.x,u.y,d.y)}else if(arguments.length===4){var _=arguments[0],b=arguments[1],C=arguments[2],l=arguments[3];_<b?(this._minx=_,this._maxx=b):(this._minx=b,this._maxx=_),C<l?(this._miny=C,this._maxy=l):(this._miny=l,this._maxy=C)}};ir.prototype.getMaxY=function(){return this._maxy};ir.prototype.distance=function(i){if(this.intersects(i))return 0;var s=0;this._maxx<i._minx?s=i._minx-this._maxx:this._minx>i._maxx&&(s=this._minx-i._maxx);var u=0;return this._maxy<i._miny?u=i._miny-this._maxy:this._miny>i._maxy&&(u=this._miny-i._maxy),s===0?u:u===0?s:Math.sqrt(s*s+u*u)};ir.prototype.hashCode=function(){var i=17;return i=37*i+Vt.hashCode(this._minx),i=37*i+Vt.hashCode(this._maxx),i=37*i+Vt.hashCode(this._miny),i=37*i+Vt.hashCode(this._maxy),i};ir.prototype.interfaces_=function(){return[fu,mu]};ir.prototype.getClass=function(){return ir};ir.intersects=function(){if(arguments.length===3){var i=arguments[0],s=arguments[1],u=arguments[2];return u.x>=(i.x<s.x?i.x:s.x)&&u.x<=(i.x>s.x?i.x:s.x)&&u.y>=(i.y<s.y?i.y:s.y)&&u.y<=(i.y>s.y?i.y:s.y)}else if(arguments.length===4){var d=arguments[0],_=arguments[1],b=arguments[2],C=arguments[3],l=Math.min(b.x,C.x),V=Math.max(b.x,C.x),R=Math.min(d.x,_.x),et=Math.max(d.x,_.x);return!(R>V||et<l||(l=Math.min(b.y,C.y),V=Math.max(b.y,C.y),R=Math.min(d.y,_.y),et=Math.max(d.y,_.y),R>V)||et<l)}};XE.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(ir,XE);var ac={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},j0=function(i){this.geometryFactory=i||new Wr};j0.prototype.read=function(i){var s,u,d;i=i.replace(/[\n\r]/g," ");var _=ac.typeStr.exec(i);if(i.search("EMPTY")!==-1&&(_=ac.emptyTypeStr.exec(i),_[2]=void 0),_&&(u=_[1].toLowerCase(),d=_[2],dm[u]&&(s=dm[u].apply(this,[d]))),s===void 0)throw new Error("Could not parse WKT "+i);return s};j0.prototype.write=function(i){return this.extractGeometry(i)};j0.prototype.extractGeometry=function(i){var s=i.getGeometryType().toLowerCase();if(!$h[s])return null;var u=s.toUpperCase(),d;return i.isEmpty()?d=u+" EMPTY":d=u+"("+$h[s].apply(this,[i])+")",d};var $h={coordinate:function(i){return i.x+" "+i.y},point:function(i){return $h.coordinate.call(this,i._coordinates._coordinates[0])},multipoint:function(i){for(var s=this,u=[],d=0,_=i._geometries.length;d<_;++d)u.push("("+$h.point.apply(s,[i._geometries[d]])+")");return u.join(",")},linestring:function(i){for(var s=this,u=[],d=0,_=i._points._coordinates.length;d<_;++d)u.push($h.coordinate.apply(s,[i._points._coordinates[d]]));return u.join(",")},linearring:function(i){for(var s=this,u=[],d=0,_=i._points._coordinates.length;d<_;++d)u.push($h.coordinate.apply(s,[i._points._coordinates[d]]));return u.join(",")},multilinestring:function(i){for(var s=this,u=[],d=0,_=i._geometries.length;d<_;++d)u.push("("+$h.linestring.apply(s,[i._geometries[d]])+")");return u.join(",")},polygon:function(i){var s=this,u=[];u.push("("+$h.linestring.apply(this,[i._shell])+")");for(var d=0,_=i._holes.length;d<_;++d)u.push("("+$h.linestring.apply(s,[i._holes[d]])+")");return u.join(",")},multipolygon:function(i){for(var s=this,u=[],d=0,_=i._geometries.length;d<_;++d)u.push("("+$h.polygon.apply(s,[i._geometries[d]])+")");return u.join(",")},geometrycollection:function(i){for(var s=this,u=[],d=0,_=i._geometries.length;d<_;++d)u.push(s.extractGeometry(i._geometries[d]));return u.join(",")}},dm={point:function(i){if(i===void 0)return this.geometryFactory.createPoint();var s=i.trim().split(ac.spaces);return this.geometryFactory.createPoint(new Vt(Number.parseFloat(s[0]),Number.parseFloat(s[1])))},multipoint:function(i){var s=this;if(i===void 0)return this.geometryFactory.createMultiPoint();for(var u,d=i.trim().split(","),_=[],b=0,C=d.length;b<C;++b)u=d[b].replace(ac.trimParens,"$1"),_.push(dm.point.apply(s,[u]));return this.geometryFactory.createMultiPoint(_)},linestring:function(i){if(i===void 0)return this.geometryFactory.createLineString();for(var s=i.trim().split(","),u=[],d,_=0,b=s.length;_<b;++_)d=s[_].trim().split(ac.spaces),u.push(new Vt(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLineString(u)},linearring:function(i){if(i===void 0)return this.geometryFactory.createLinearRing();for(var s=i.trim().split(","),u=[],d,_=0,b=s.length;_<b;++_)d=s[_].trim().split(ac.spaces),u.push(new Vt(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLinearRing(u)},multilinestring:function(i){var s=this;if(i===void 0)return this.geometryFactory.createMultiLineString();for(var u,d=i.trim().split(ac.parenComma),_=[],b=0,C=d.length;b<C;++b)u=d[b].replace(ac.trimParens,"$1"),_.push(dm.linestring.apply(s,[u]));return this.geometryFactory.createMultiLineString(_)},polygon:function(i){var s=this;if(i===void 0)return this.geometryFactory.createPolygon();for(var u,d,_,b=i.trim().split(ac.parenComma),C,l=[],V=0,R=b.length;V<R;++V)u=b[V].replace(ac.trimParens,"$1"),d=dm.linestring.apply(s,[u]),_=s.geometryFactory.createLinearRing(d._points),V===0?C=_:l.push(_);return this.geometryFactory.createPolygon(C,l)},multipolygon:function(i){var s=this;if(i===void 0)return this.geometryFactory.createMultiPolygon();for(var u,d=i.trim().split(ac.doubleParenComma),_=[],b=0,C=d.length;b<C;++b)u=d[b].replace(ac.trimParens,"$1"),_.push(dm.polygon.apply(s,[u]));return this.geometryFactory.createMultiPolygon(_)},geometrycollection:function(i){var s=this;if(i===void 0)return this.geometryFactory.createGeometryCollection();i=i.replace(/,\s*([A-Za-z])/g,"|$1");for(var u=i.trim().split("|"),d=[],_=0,b=u.length;_<b;++_)d.push(s.read(u[_]));return this.geometryFactory.createGeometryCollection(d)}},qu=function(i){this.parser=new j0(i)};qu.prototype.write=function(i){return this.parser.write(i)};qu.toLineString=function(i,s){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+i.x+" "+i.y+", "+s.x+" "+s.y+" )"};var Yh=function(i){function s(u){i.call(this,u),this.name="RuntimeException",this.message=u,this.stack=new i().stack}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s}(Error),O0=function(i){function s(){if(i.call(this),arguments.length===0)i.call(this);else if(arguments.length===1){var u=arguments[0];i.call(this,u)}}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Yh),Nr=function(){};Nr.prototype.interfaces_=function(){return[]};Nr.prototype.getClass=function(){return Nr};Nr.shouldNeverReachHere=function(){if(arguments.length===0)Nr.shouldNeverReachHere(null);else if(arguments.length===1){var i=arguments[0];throw new O0("Should never reach here"+(i!==null?": "+i:""))}};Nr.isTrue=function(){var i,s;if(arguments.length===1)i=arguments[0],Nr.isTrue(i,null);else if(arguments.length===2&&(i=arguments[0],s=arguments[1],!i))throw s===null?new O0:new O0(s)};Nr.equals=function(){var i,s,u;if(arguments.length===2)i=arguments[0],s=arguments[1],Nr.equals(i,s,null);else if(arguments.length===3&&(i=arguments[0],s=arguments[1],u=arguments[2],!s.equals(i)))throw new O0("Expected "+i+" but encountered "+s+(u!==null?": "+u:""))};var no=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Vt,this._intPt[1]=new Vt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Mf={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};no.prototype.getIndexAlongSegment=function(i,s){return this.computeIntLineIndex(),this._intLineIndex[i][s]};no.prototype.getTopologySummary=function(){var i=new wc;return this.isEndPoint()&&i.append(" endpoint"),this._isProper&&i.append(" proper"),this.isCollinear()&&i.append(" collinear"),i.toString()};no.prototype.computeIntersection=function(i,s,u,d){this._inputLines[0][0]=i,this._inputLines[0][1]=s,this._inputLines[1][0]=u,this._inputLines[1][1]=d,this._result=this.computeIntersect(i,s,u,d)};no.prototype.getIntersectionNum=function(){return this._result};no.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var i=arguments[0],s=this.getEdgeDistance(i,0),u=this.getEdgeDistance(i,1);s>u?(this._intLineIndex[i][0]=0,this._intLineIndex[i][1]=1):(this._intLineIndex[i][0]=1,this._intLineIndex[i][1]=0)}};no.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};no.prototype.setPrecisionModel=function(i){this._precisionModel=i};no.prototype.isInteriorIntersection=function(){var i=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var s=arguments[0],u=0;u<this._result;u++)if(!(i._intPt[u].equals2D(i._inputLines[s][0])||i._intPt[u].equals2D(i._inputLines[s][1])))return!0;return!1}};no.prototype.getIntersection=function(i){return this._intPt[i]};no.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};no.prototype.hasIntersection=function(){return this._result!==no.NO_INTERSECTION};no.prototype.getEdgeDistance=function(i,s){var u=no.computeEdgeDistance(this._intPt[s],this._inputLines[i][0],this._inputLines[i][1]);return u};no.prototype.isCollinear=function(){return this._result===no.COLLINEAR_INTERSECTION};no.prototype.toString=function(){return qu.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qu.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};no.prototype.getEndpoint=function(i,s){return this._inputLines[i][s]};no.prototype.isIntersection=function(i){for(var s=this,u=0;u<this._result;u++)if(s._intPt[u].equals2D(i))return!0;return!1};no.prototype.getIntersectionAlongSegment=function(i,s){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[i][s]]};no.prototype.interfaces_=function(){return[]};no.prototype.getClass=function(){return no};no.computeEdgeDistance=function(i,s,u){var d=Math.abs(u.x-s.x),_=Math.abs(u.y-s.y),b=-1;if(i.equals(s))b=0;else if(i.equals(u))d>_?b=d:b=_;else{var C=Math.abs(i.x-s.x),l=Math.abs(i.y-s.y);d>_?b=C:b=l,b===0&&!i.equals(s)&&(b=Math.max(C,l))}return Nr.isTrue(!(b===0&&!i.equals(s)),"Bad distance calculation"),b};no.nonRobustComputeEdgeDistance=function(i,s,u){var d=i.x-s.x,_=i.y-s.y,b=Math.sqrt(d*d+_*_);return Nr.isTrue(!(b===0&&!i.equals(s)),"Invalid distance calculation"),b};Mf.DONT_INTERSECT.get=function(){return 0};Mf.DO_INTERSECT.get=function(){return 1};Mf.COLLINEAR.get=function(){return 2};Mf.NO_INTERSECTION.get=function(){return 0};Mf.POINT_INTERSECTION.get=function(){return 1};Mf.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(no,Mf);var md=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.isInSegmentEnvelopes=function(u){var d=new ir(this._inputLines[0][0],this._inputLines[0][1]),_=new ir(this._inputLines[1][0],this._inputLines[1][1]);return d.contains(u)&&_.contains(u)},s.prototype.computeIntersection=function(){if(arguments.length===3){var u=arguments[0],d=arguments[1],_=arguments[2];if(this._isProper=!1,ir.intersects(d,_,u)&&Fe.orientationIndex(d,_,u)===0&&Fe.orientationIndex(_,d,u)===0)return this._isProper=!0,(u.equals(d)||u.equals(_))&&(this._isProper=!1),this._result=i.POINT_INTERSECTION,null;this._result=i.NO_INTERSECTION}else return i.prototype.computeIntersection.apply(this,arguments)},s.prototype.normalizeToMinimum=function(u,d,_,b,C){C.x=this.smallestInAbsValue(u.x,d.x,_.x,b.x),C.y=this.smallestInAbsValue(u.y,d.y,_.y,b.y),u.x-=C.x,u.y-=C.y,d.x-=C.x,d.y-=C.y,_.x-=C.x,_.y-=C.y,b.x-=C.x,b.y-=C.y},s.prototype.safeHCoordinateIntersection=function(u,d,_,b){var C=null;try{C=ju.intersection(u,d,_,b)}catch(l){if(l instanceof Dm)C=s.nearestEndpoint(u,d,_,b);else throw l}finally{}return C},s.prototype.intersection=function(u,d,_,b){var C=this.intersectionWithNormalization(u,d,_,b);return this.isInSegmentEnvelopes(C)||(C=new Vt(s.nearestEndpoint(u,d,_,b))),this._precisionModel!==null&&this._precisionModel.makePrecise(C),C},s.prototype.smallestInAbsValue=function(u,d,_,b){var C=u,l=Math.abs(C);return Math.abs(d)<l&&(C=d,l=Math.abs(d)),Math.abs(_)<l&&(C=_,l=Math.abs(_)),Math.abs(b)<l&&(C=b),C},s.prototype.checkDD=function(u,d,_,b,C){var l=Oa.intersection(u,d,_,b),V=this.isInSegmentEnvelopes(l);Ds.out.println("DD in env = "+V+"  --------------------- "+l),C.distance(l)>1e-4&&Ds.out.println("Distance = "+C.distance(l))},s.prototype.intersectionWithNormalization=function(u,d,_,b){var C=new Vt(u),l=new Vt(d),V=new Vt(_),R=new Vt(b),et=new Vt;this.normalizeToEnvCentre(C,l,V,R,et);var at=this.safeHCoordinateIntersection(C,l,V,R);return at.x+=et.x,at.y+=et.y,at},s.prototype.computeCollinearIntersection=function(u,d,_,b){var C=ir.intersects(u,d,_),l=ir.intersects(u,d,b),V=ir.intersects(_,b,u),R=ir.intersects(_,b,d);return C&&l?(this._intPt[0]=_,this._intPt[1]=b,i.COLLINEAR_INTERSECTION):V&&R?(this._intPt[0]=u,this._intPt[1]=d,i.COLLINEAR_INTERSECTION):C&&V?(this._intPt[0]=_,this._intPt[1]=u,_.equals(u)&&!l&&!R?i.POINT_INTERSECTION:i.COLLINEAR_INTERSECTION):C&&R?(this._intPt[0]=_,this._intPt[1]=d,_.equals(d)&&!l&&!V?i.POINT_INTERSECTION:i.COLLINEAR_INTERSECTION):l&&V?(this._intPt[0]=b,this._intPt[1]=u,b.equals(u)&&!C&&!R?i.POINT_INTERSECTION:i.COLLINEAR_INTERSECTION):l&&R?(this._intPt[0]=b,this._intPt[1]=d,b.equals(d)&&!C&&!V?i.POINT_INTERSECTION:i.COLLINEAR_INTERSECTION):i.NO_INTERSECTION},s.prototype.normalizeToEnvCentre=function(u,d,_,b,C){var l=u.x<d.x?u.x:d.x,V=u.y<d.y?u.y:d.y,R=u.x>d.x?u.x:d.x,et=u.y>d.y?u.y:d.y,at=_.x<b.x?_.x:b.x,st=_.y<b.y?_.y:b.y,yt=_.x>b.x?_.x:b.x,xt=_.y>b.y?_.y:b.y,It=l>at?l:at,Pt=R<yt?R:yt,qt=V>st?V:st,Qt=et<xt?et:xt,se=(It+Pt)/2,le=(qt+Qt)/2;C.x=se,C.y=le,u.x-=C.x,u.y-=C.y,d.x-=C.x,d.y-=C.y,_.x-=C.x,_.y-=C.y,b.x-=C.x,b.y-=C.y},s.prototype.computeIntersect=function(u,d,_,b){if(this._isProper=!1,!ir.intersects(u,d,_,b))return i.NO_INTERSECTION;var C=Fe.orientationIndex(u,d,_),l=Fe.orientationIndex(u,d,b);if(C>0&&l>0||C<0&&l<0)return i.NO_INTERSECTION;var V=Fe.orientationIndex(_,b,u),R=Fe.orientationIndex(_,b,d);if(V>0&&R>0||V<0&&R<0)return i.NO_INTERSECTION;var et=C===0&&l===0&&V===0&&R===0;return et?this.computeCollinearIntersection(u,d,_,b):(C===0||l===0||V===0||R===0?(this._isProper=!1,u.equals2D(_)||u.equals2D(b)?this._intPt[0]=u:d.equals2D(_)||d.equals2D(b)?this._intPt[0]=d:C===0?this._intPt[0]=new Vt(_):l===0?this._intPt[0]=new Vt(b):V===0?this._intPt[0]=new Vt(u):R===0&&(this._intPt[0]=new Vt(d))):(this._isProper=!0,this._intPt[0]=this.intersection(u,d,_,b)),i.POINT_INTERSECTION)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.nearestEndpoint=function(u,d,_,b){var C=u,l=Fe.distancePointLine(u,_,b),V=Fe.distancePointLine(d,_,b);return V<l&&(l=V,C=d),V=Fe.distancePointLine(_,u,d),V<l&&(l=V,C=_),V=Fe.distancePointLine(b,u,d),V<l&&(l=V,C=b),C},s}(no),vf=function(){};vf.prototype.interfaces_=function(){return[]};vf.prototype.getClass=function(){return vf};vf.orientationIndex=function(i,s,u){var d=s.x-i.x,_=s.y-i.y,b=u.x-s.x,C=u.y-s.y;return vf.signOfDet2x2(d,_,b,C)};vf.signOfDet2x2=function(i,s,u,d){var _=null,b=null,C=null;if(_=1,i===0||d===0)return s===0||u===0?0:s>0?u>0?-_:_:u>0?_:-_;if(s===0||u===0)return d>0?i>0?_:-_:i>0?-_:_;if(s>0?d>0?s<=d||(_=-_,b=i,i=u,u=b,b=s,s=d,d=b):s<=-d?(_=-_,u=-u,d=-d):(b=i,i=-u,u=b,b=s,s=-d,d=b):d>0?-s<=d?(_=-_,i=-i,s=-s):(b=-i,i=u,u=b,b=-s,s=d,d=b):s>=d?(i=-i,s=-s,u=-u,d=-d):(_=-_,b=-i,i=-u,u=b,b=-s,s=-d,d=b),i>0)if(u>0){if(!(i<=u))return _}else return _;else{if(u>0)return-_;if(i>=u)_=-_,i=-i,u=-u;else return-_}for(;;){if(C=Math.floor(u/i),u=u-C*i,d=d-C*s,d<0)return-_;if(d>s)return _;if(i>u+u){if(s<d+d)return _}else{if(s>d+d)return-_;u=i-u,d=s-d,_=-_}if(d===0)return u===0?0:-_;if(u===0||(C=Math.floor(i/u),i=i-C*u,s=s-C*d,s<0))return _;if(s>d)return-_;if(u>i+i){if(d<s+s)return-_}else{if(d>s+s)return _;i=u-i,s=d-s,_=-_}if(s===0)return i===0?0:_;if(i===0)return-_}};var cc=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var i=arguments[0];this._p=i};cc.prototype.countSegment=function(i,s){if(i.x<this._p.x&&s.x<this._p.x)return null;if(this._p.x===s.x&&this._p.y===s.y)return this._isPointOnSegment=!0,null;if(i.y===this._p.y&&s.y===this._p.y){var u=i.x,d=s.x;return u>d&&(u=s.x,d=i.x),this._p.x>=u&&this._p.x<=d&&(this._isPointOnSegment=!0),null}if(i.y>this._p.y&&s.y<=this._p.y||s.y>this._p.y&&i.y<=this._p.y){var _=i.x-this._p.x,b=i.y-this._p.y,C=s.x-this._p.x,l=s.y-this._p.y,V=vf.signOfDet2x2(_,b,C,l);if(V===0)return this._isPointOnSegment=!0,null;l<b&&(V=-V),V>0&&this._crossingCount++}};cc.prototype.isPointInPolygon=function(){return this.getLocation()!==Xt.EXTERIOR};cc.prototype.getLocation=function(){return this._isPointOnSegment?Xt.BOUNDARY:this._crossingCount%2===1?Xt.INTERIOR:Xt.EXTERIOR};cc.prototype.isOnSegment=function(){return this._isPointOnSegment};cc.prototype.interfaces_=function(){return[]};cc.prototype.getClass=function(){return cc};cc.locatePointInRing=function(){if(arguments[0]instanceof Vt&&xr(arguments[1],dn)){for(var i=arguments[0],s=arguments[1],u=new cc(i),d=new Vt,_=new Vt,b=1;b<s.size();b++)if(s.getCoordinate(b,d),s.getCoordinate(b-1,_),u.countSegment(d,_),u.isOnSegment())return u.getLocation();return u.getLocation()}else if(arguments[0]instanceof Vt&&arguments[1]instanceof Array){for(var C=arguments[0],l=arguments[1],V=new cc(C),R=1;R<l.length;R++){var et=l[R],at=l[R-1];if(V.countSegment(et,at),V.isOnSegment())return V.getLocation()}return V.getLocation()}};var Fe=function(){},Df={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};Fe.orientationIndex=function(i,s,u){return Oa.orientationIndex(i,s,u)};Fe.signedArea=function(){if(arguments[0]instanceof Array){var i=arguments[0];if(i.length<3)return 0;for(var s=0,u=i[0].x,d=1;d<i.length-1;d++){var _=i[d].x-u,b=i[d+1].y,C=i[d-1].y;s+=_*(C-b)}return s/2}else if(xr(arguments[0],dn)){var l=arguments[0],V=l.size();if(V<3)return 0;var R=new Vt,et=new Vt,at=new Vt;l.getCoordinate(0,et),l.getCoordinate(1,at);var st=et.x;at.x-=st;for(var yt=0,xt=1;xt<V-1;xt++)R.y=et.y,et.x=at.x,et.y=at.y,l.getCoordinate(xt+1,at),at.x-=st,yt+=et.x*(R.y-at.y);return yt/2}};Fe.distanceLineLine=function(i,s,u,d){if(i.equals(s))return Fe.distancePointLine(i,u,d);if(u.equals(d))return Fe.distancePointLine(d,i,s);var _=!1;if(!ir.intersects(i,s,u,d))_=!0;else{var b=(s.x-i.x)*(d.y-u.y)-(s.y-i.y)*(d.x-u.x);if(b===0)_=!0;else{var C=(i.y-u.y)*(d.x-u.x)-(i.x-u.x)*(d.y-u.y),l=(i.y-u.y)*(s.x-i.x)-(i.x-u.x)*(s.y-i.y),V=l/b,R=C/b;(R<0||R>1||V<0||V>1)&&(_=!0)}}return _?Ol.min(Fe.distancePointLine(i,u,d),Fe.distancePointLine(s,u,d),Fe.distancePointLine(u,i,s),Fe.distancePointLine(d,i,s)):0};Fe.isPointInRing=function(i,s){return Fe.locatePointInRing(i,s)!==Xt.EXTERIOR};Fe.computeLength=function(i){var s=i.size();if(s<=1)return 0;var u=0,d=new Vt;i.getCoordinate(0,d);for(var _=d.x,b=d.y,C=1;C<s;C++){i.getCoordinate(C,d);var l=d.x,V=d.y,R=l-_,et=V-b;u+=Math.sqrt(R*R+et*et),_=l,b=V}return u};Fe.isCCW=function(i){var s=i.length-1;if(s<3)throw new $i("Ring has fewer than 4 points, so orientation cannot be determined");for(var u=i[0],d=0,_=1;_<=s;_++){var b=i[_];b.y>u.y&&(u=b,d=_)}var C=d;do C=C-1,C<0&&(C=s);while(i[C].equals2D(u)&&C!==d);var l=d;do l=(l+1)%s;while(i[l].equals2D(u)&&l!==d);var V=i[C],R=i[l];if(V.equals2D(u)||R.equals2D(u)||V.equals2D(R))return!1;var et=Fe.computeOrientation(V,u,R),at=!1;return et===0?at=V.x>R.x:at=et>0,at};Fe.locatePointInRing=function(i,s){return cc.locatePointInRing(i,s)};Fe.distancePointLinePerpendicular=function(i,s,u){var d=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),_=((s.y-i.y)*(u.x-s.x)-(s.x-i.x)*(u.y-s.y))/d;return Math.abs(_)*Math.sqrt(d)};Fe.computeOrientation=function(i,s,u){return Fe.orientationIndex(i,s,u)};Fe.distancePointLine=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(s.length===0)throw new $i("Line array must contain at least one vertex");for(var u=i.distance(s[0]),d=0;d<s.length-1;d++){var _=Fe.distancePointLine(i,s[d],s[d+1]);_<u&&(u=_)}return u}else if(arguments.length===3){var b=arguments[0],C=arguments[1],l=arguments[2];if(C.x===l.x&&C.y===l.y)return b.distance(C);var V=(l.x-C.x)*(l.x-C.x)+(l.y-C.y)*(l.y-C.y),R=((b.x-C.x)*(l.x-C.x)+(b.y-C.y)*(l.y-C.y))/V;if(R<=0)return b.distance(C);if(R>=1)return b.distance(l);var et=((C.y-b.y)*(l.x-C.x)-(C.x-b.x)*(l.y-C.y))/V;return Math.abs(et)*Math.sqrt(V)}};Fe.isOnLine=function(i,s){for(var u=new md,d=1;d<s.length;d++){var _=s[d-1],b=s[d];if(u.computeIntersection(i,_,b),u.hasIntersection())return!0}return!1};Df.CLOCKWISE.get=function(){return-1};Df.RIGHT.get=function(){return Fe.CLOCKWISE};Df.COUNTERCLOCKWISE.get=function(){return 1};Df.LEFT.get=function(){return Fe.COUNTERCLOCKWISE};Df.COLLINEAR.get=function(){return 0};Df.STRAIGHT.get=function(){return Fe.COLLINEAR};Object.defineProperties(Fe,Df);var Wh=function(){};Wh.prototype.filter=function(i){};Wh.prototype.interfaces_=function(){return[]};Wh.prototype.getClass=function(){return Wh};var mr=function(){var i=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=i,this._SRID=i.getSRID()},Ph={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};mr.prototype.isGeometryCollection=function(){return this.getSortIndex()===mr.SORTINDEX_GEOMETRYCOLLECTION};mr.prototype.getFactory=function(){return this._factory};mr.prototype.getGeometryN=function(i){return this};mr.prototype.getArea=function(){return 0};mr.prototype.isRectangle=function(){return!1};mr.prototype.equals=function(){if(arguments[0]instanceof mr){var i=arguments[0];return i===null?!1:this.equalsTopo(i)}else if(arguments[0]instanceof Object){var s=arguments[0];if(!(s instanceof mr))return!1;var u=s;return this.equalsExact(u)}};mr.prototype.equalsExact=function(i){return this===i||this.equalsExact(i,0)};mr.prototype.geometryChanged=function(){this.apply(mr.geometryChangedFilter)};mr.prototype.geometryChangedAction=function(){this._envelope=null};mr.prototype.equalsNorm=function(i){return i===null?!1:this.norm().equalsExact(i.norm())};mr.prototype.getLength=function(){return 0};mr.prototype.getNumGeometries=function(){return 1};mr.prototype.compareTo=function(){if(arguments.length===1){var i=arguments[0],s=i;return this.getSortIndex()!==s.getSortIndex()?this.getSortIndex()-s.getSortIndex():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(i)}else if(arguments.length===2){var u=arguments[0],d=arguments[1];return this.getSortIndex()!==u.getSortIndex()?this.getSortIndex()-u.getSortIndex():this.isEmpty()&&u.isEmpty()?0:this.isEmpty()?-1:u.isEmpty()?1:this.compareToSameClass(u,d)}};mr.prototype.getUserData=function(){return this._userData};mr.prototype.getSRID=function(){return this._SRID};mr.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};mr.prototype.checkNotGeometryCollection=function(i){if(i.getSortIndex()===mr.SORTINDEX_GEOMETRYCOLLECTION)throw new $i("This method does not support GeometryCollection arguments")};mr.prototype.equal=function(i,s,u){return u===0?i.equals(s):i.distance(s)<=u};mr.prototype.norm=function(){var i=this.copy();return i.normalize(),i};mr.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};mr.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ir(this._envelope)};mr.prototype.setSRID=function(i){this._SRID=i};mr.prototype.setUserData=function(i){this._userData=i};mr.prototype.compare=function(i,s){for(var u=i.iterator(),d=s.iterator();u.hasNext()&&d.hasNext();){var _=u.next(),b=d.next(),C=_.compareTo(b);if(C!==0)return C}return u.hasNext()?1:d.hasNext()?-1:0};mr.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};mr.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===mr.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===mr.SORTINDEX_MULTIPOINT||this.getSortIndex()===mr.SORTINDEX_MULTILINESTRING||this.getSortIndex()===mr.SORTINDEX_MULTIPOLYGON};mr.prototype.interfaces_=function(){return[U0,fu,mu]};mr.prototype.getClass=function(){return mr};mr.hasNonEmptyElements=function(i){for(var s=0;s<i.length;s++)if(!i[s].isEmpty())return!0;return!1};mr.hasNullElements=function(i){for(var s=0;s<i.length;s++)if(i[s]===null)return!0;return!1};Ph.serialVersionUID.get=function(){return 8763622679187377e3};Ph.SORTINDEX_POINT.get=function(){return 0};Ph.SORTINDEX_MULTIPOINT.get=function(){return 1};Ph.SORTINDEX_LINESTRING.get=function(){return 2};Ph.SORTINDEX_LINEARRING.get=function(){return 3};Ph.SORTINDEX_MULTILINESTRING.get=function(){return 4};Ph.SORTINDEX_POLYGON.get=function(){return 5};Ph.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Ph.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Ph.geometryChangedFilter.get=function(){return Sb};Object.defineProperties(mr,Ph);var Sb=function(){};Sb.interfaces_=function(){return[Wh]};Sb.filter=function(i){i.geometryChangedAction()};var vh=function(){};vh.prototype.filter=function(i){};vh.prototype.interfaces_=function(){return[]};vh.prototype.getClass=function(){return vh};var hu=function(){},tp={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};hu.prototype.isInBoundary=function(i){};hu.prototype.interfaces_=function(){return[]};hu.prototype.getClass=function(){return hu};tp.Mod2BoundaryNodeRule.get=function(){return gm};tp.EndPointBoundaryNodeRule.get=function(){return ym};tp.MultiValentEndPointBoundaryNodeRule.get=function(){return _m};tp.MonoValentEndPointBoundaryNodeRule.get=function(){return vm};tp.MOD2_BOUNDARY_RULE.get=function(){return new gm};tp.ENDPOINT_BOUNDARY_RULE.get=function(){return new ym};tp.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _m};tp.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vm};tp.OGC_SFS_BOUNDARY_RULE.get=function(){return hu.MOD2_BOUNDARY_RULE};Object.defineProperties(hu,tp);var gm=function(){};gm.prototype.isInBoundary=function(i){return i%2===1};gm.prototype.interfaces_=function(){return[hu]};gm.prototype.getClass=function(){return gm};var ym=function(){};ym.prototype.isInBoundary=function(i){return i>0};ym.prototype.interfaces_=function(){return[hu]};ym.prototype.getClass=function(){return ym};var _m=function(){};_m.prototype.isInBoundary=function(i){return i>1};_m.prototype.interfaces_=function(){return[hu]};_m.prototype.getClass=function(){return _m};var vm=function(){};vm.prototype.isInBoundary=function(i){return i===1};vm.prototype.interfaces_=function(){return[hu]};vm.prototype.getClass=function(){return vm};var Yo=function(){};Yo.prototype.add=function(){};Yo.prototype.addAll=function(){};Yo.prototype.isEmpty=function(){};Yo.prototype.iterator=function(){};Yo.prototype.size=function(){};Yo.prototype.toArray=function(){};Yo.prototype.remove=function(){};function Eb(i){this.message=i||""}Eb.prototype=new Error;Eb.prototype.name="IndexOutOfBoundsException";var km=function(){};km.prototype.hasNext=function(){};km.prototype.next=function(){};km.prototype.remove=function(){};var Gu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.get=function(){},s.prototype.set=function(){},s.prototype.isEmpty=function(){},s}(Yo);function zm(i){this.message=i||""}zm.prototype=new Error;zm.prototype.name="NoSuchElementException";var Pe=function(i){function s(){i.call(this),this.array_=[],arguments[0]instanceof Yo&&this.addAll(arguments[0])}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.ensureCapacity=function(){},s.prototype.interfaces_=function(){return[i,Yo]},s.prototype.add=function(u){return arguments.length===1?this.array_.push(u):this.array_.splice(arguments[0],arguments[1]),!0},s.prototype.clear=function(){this.array_=[]},s.prototype.addAll=function(u){for(var d=this,_=u.iterator();_.hasNext();)d.add(_.next());return!0},s.prototype.set=function(u,d){var _=this.array_[u];return this.array_[u]=d,_},s.prototype.iterator=function(){return new eA(this)},s.prototype.get=function(u){if(u<0||u>=this.size())throw new Eb;return this.array_[u]},s.prototype.isEmpty=function(){return this.array_.length===0},s.prototype.size=function(){return this.array_.length},s.prototype.toArray=function(){for(var u=this,d=[],_=0,b=this.array_.length;_<b;_++)d.push(u.array_[_]);return d},s.prototype.remove=function(u){for(var d=this,_=!1,b=0,C=this.array_.length;b<C;b++)if(d.array_[b]===u){d.array_.splice(b,1),_=!0;break}return _},s}(Gu),eA=function(i){function s(u){i.call(this),this.arrayList_=u,this.position_=0}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new zm;return this.arrayList_.get(this.position_++)},s.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},s.prototype.set=function(u){return this.arrayList_.set(this.position_-1,u)},s.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},s}(km),Yy=function(i){function s(){if(i.call(this),arguments.length!==0){if(arguments.length===1){var d=arguments[0];this.ensureCapacity(d.length),this.add(d,!0)}else if(arguments.length===2){var _=arguments[0],b=arguments[1];this.ensureCapacity(_.length),this.add(_,b)}}}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={coordArrayType:{configurable:!0}};return u.coordArrayType.get=function(){return new Array(0).fill(null)},s.prototype.getCoordinate=function(d){return this.get(d)},s.prototype.addAll=function(){var d=this;if(arguments.length===2){for(var _=arguments[0],b=arguments[1],C=!1,l=_.iterator();l.hasNext();)d.add(l.next(),b),C=!0;return C}else return i.prototype.addAll.apply(this,arguments)},s.prototype.clone=function(){for(var d=this,_=i.prototype.clone.call(this),b=0;b<this.size();b++)_.add(b,d.get(b).copy());return _},s.prototype.toCoordinateArray=function(){return this.toArray(s.coordArrayType)},s.prototype.add=function(){var d=this;if(arguments.length===1){var _=arguments[0];i.prototype.add.call(this,_)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],C=arguments[1];return this.add(b,C,!0),!0}else if(arguments[0]instanceof Vt&&typeof arguments[1]=="boolean"){var l=arguments[0],V=arguments[1];if(!V&&this.size()>=1){var R=this.get(this.size()-1);if(R.equals2D(l))return null}i.prototype.add.call(this,l)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var et=arguments[0],at=arguments[1];return this.add(et,at),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var st=arguments[0],yt=arguments[1],xt=arguments[2];if(xt)for(var It=0;It<st.length;It++)d.add(st[It],yt);else for(var Pt=st.length-1;Pt>=0;Pt--)d.add(st[Pt],yt);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Vt){var qt=arguments[0],Qt=arguments[1],se=arguments[2];if(!se){var le=this.size();if(le>0){if(qt>0){var Ue=this.get(qt-1);if(Ue.equals2D(Qt))return null}if(qt<le){var ke=this.get(qt);if(ke.equals2D(Qt))return null}}}i.prototype.add.call(this,qt,Qt)}}else if(arguments.length===4){var er=arguments[0],Le=arguments[1],lr=arguments[2],je=arguments[3],zr=1;lr>je&&(zr=-1);for(var nr=lr;nr!==je;nr+=zr)d.add(er[nr],Le);return!0}},s.prototype.closeRing=function(){this.size()>0&&this.add(new Vt(this.get(0)),!1)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},Object.defineProperties(s,u),s}(Pe),Jr=function(){},G0={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};G0.ForwardComparator.get=function(){return Ry};G0.BidirectionalComparator.get=function(){return xm};G0.coordArrayType.get=function(){return new Array(0).fill(null)};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.isRing=function(i){return!(i.length<4||!i[0].equals2D(i[i.length-1]))};Jr.ptNotInList=function(i,s){for(var u=0;u<i.length;u++){var d=i[u];if(Jr.indexOf(d,s)<0)return d}return null};Jr.scroll=function(i,s){var u=Jr.indexOf(s,i);if(u<0)return null;var d=new Array(i.length).fill(null);Ds.arraycopy(i,u,d,0,i.length-u),Ds.arraycopy(i,0,d,i.length-u,u),Ds.arraycopy(d,0,i,0,i.length)};Jr.equals=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var u=0;u<i.length;u++)if(!i[u].equals(s[u]))return!1;return!0}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2];if(d===_)return!0;if(d===null||_===null||d.length!==_.length)return!1;for(var C=0;C<d.length;C++)if(b.compare(d[C],_[C])!==0)return!1;return!0}};Jr.intersection=function(i,s){for(var u=new Yy,d=0;d<i.length;d++)s.intersects(i[d])&&u.add(i[d],!0);return u.toCoordinateArray()};Jr.hasRepeatedPoints=function(i){for(var s=1;s<i.length;s++)if(i[s-1].equals(i[s]))return!0;return!1};Jr.removeRepeatedPoints=function(i){if(!Jr.hasRepeatedPoints(i))return i;var s=new Yy(i,!1);return s.toCoordinateArray()};Jr.reverse=function(i){for(var s=i.length-1,u=Math.trunc(s/2),d=0;d<=u;d++){var _=i[d];i[d]=i[s-d],i[s-d]=_}};Jr.removeNull=function(i){for(var s=0,u=0;u<i.length;u++)i[u]!==null&&s++;var d=new Array(s).fill(null);if(s===0)return d;for(var _=0,b=0;b<i.length;b++)i[b]!==null&&(d[_++]=i[b]);return d};Jr.copyDeep=function(){if(arguments.length===1){for(var i=arguments[0],s=new Array(i.length).fill(null),u=0;u<i.length;u++)s[u]=new Vt(i[u]);return s}else if(arguments.length===5)for(var d=arguments[0],_=arguments[1],b=arguments[2],C=arguments[3],l=arguments[4],V=0;V<l;V++)b[C+V]=new Vt(d[_+V])};Jr.isEqualReversed=function(i,s){for(var u=0;u<i.length;u++){var d=i[u],_=s[i.length-u-1];if(d.compareTo(_)!==0)return!1}return!0};Jr.envelope=function(i){for(var s=new ir,u=0;u<i.length;u++)s.expandToInclude(i[u]);return s};Jr.toCoordinateArray=function(i){return i.toArray(Jr.coordArrayType)};Jr.atLeastNCoordinatesOrNothing=function(i,s){return s.length>=i?s:[]};Jr.indexOf=function(i,s){for(var u=0;u<s.length;u++)if(i.equals(s[u]))return u;return-1};Jr.increasingDirection=function(i){for(var s=0;s<Math.trunc(i.length/2);s++){var u=i.length-1-s,d=i[s].compareTo(i[u]);if(d!==0)return d}return 1};Jr.compare=function(i,s){for(var u=0;u<i.length&&u<s.length;){var d=i[u].compareTo(s[u]);if(d!==0)return d;u++}return u<s.length?-1:u<i.length?1:0};Jr.minCoordinate=function(i){for(var s=null,u=0;u<i.length;u++)(s===null||s.compareTo(i[u])>0)&&(s=i[u]);return s};Jr.extract=function(i,s,u){s=Ol.clamp(s,0,i.length),u=Ol.clamp(u,-1,i.length);var d=u-s+1;u<0&&(d=0),s>=i.length&&(d=0),u<s&&(d=0);var _=new Array(d).fill(null);if(d===0)return _;for(var b=0,C=s;C<=u;C++)_[b++]=i[C];return _};Object.defineProperties(Jr,G0);var Ry=function(){};Ry.prototype.compare=function(i,s){var u=i,d=s;return Jr.compare(u,d)};Ry.prototype.interfaces_=function(){return[fm]};Ry.prototype.getClass=function(){return Ry};var xm=function(){};xm.prototype.compare=function(i,s){var u=i,d=s;if(u.length<d.length)return-1;if(u.length>d.length)return 1;if(u.length===0)return 0;var _=Jr.compare(u,d),b=Jr.isEqualReversed(u,d);return b?0:_};xm.prototype.OLDcompare=function(i,s){var u=i,d=s;if(u.length<d.length)return-1;if(u.length>d.length)return 1;if(u.length===0)return 0;for(var _=Jr.increasingDirection(u),b=Jr.increasingDirection(d),C=_>0?0:u.length-1,l=b>0?0:u.length-1,V=0;V<u.length;V++){var R=u[C].compareTo(d[l]);if(R!==0)return R;C+=_,l+=b}return 0};xm.prototype.interfaces_=function(){return[fm]};xm.prototype.getClass=function(){return xm};var kf=function(){};kf.prototype.get=function(){};kf.prototype.put=function(){};kf.prototype.size=function(){};kf.prototype.values=function(){};kf.prototype.entrySet=function(){};var rA=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s}(kf);function Wy(i){this.message=i||""}Wy.prototype=new Error;Wy.prototype.name="OperationNotSupported";function q0(){}q0.prototype=new Yo;q0.prototype.contains=function(){};var Tb=function(i){function s(){i.call(this),this.array_=[],arguments[0]instanceof Yo&&this.addAll(arguments[0])}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.contains=function(u){for(var d=this,_=0,b=this.array_.length;_<b;_++){var C=d.array_[_];if(C===u)return!0}return!1},s.prototype.add=function(u){return this.contains(u)?!1:(this.array_.push(u),!0)},s.prototype.addAll=function(u){for(var d=this,_=u.iterator();_.hasNext();)d.add(_.next());return!0},s.prototype.remove=function(u){throw new Error},s.prototype.size=function(){return this.array_.length},s.prototype.isEmpty=function(){return this.array_.length===0},s.prototype.toArray=function(){for(var u=this,d=[],_=0,b=this.array_.length;_<b;_++)d.push(u.array_[_]);return d},s.prototype.iterator=function(){return new nA(this)},s}(q0),nA=function(i){function s(u){i.call(this),this.hashSet_=u,this.position_=0}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new zm;return this.hashSet_.array_[this.position_++]},s.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},s.prototype.remove=function(){throw new Wy},s}(km),Xh=0,nd=1;function BE(i){return i===null?Xh:i.color}function Ei(i){return i===null?null:i.parent}function qh(i,s){i!==null&&(i.color=s)}function bb(i){return i===null?null:i.left}function VE(i){return i===null?null:i.right}function ta(){this.root_=null,this.size_=0}ta.prototype=new rA;ta.prototype.get=function(i){for(var s=this.root_;s!==null;){var u=i.compareTo(s.key);if(u<0)s=s.left;else if(u>0)s=s.right;else return s.value}return null};ta.prototype.put=function(i,s){if(this.root_===null)return this.root_={key:i,value:s,left:null,right:null,parent:null,color:Xh,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var u=this.root_,d,_;do if(d=u,_=i.compareTo(u.key),_<0)u=u.left;else if(_>0)u=u.right;else{var b=u.value;return u.value=s,b}while(u!==null);var C={key:i,left:null,right:null,value:s,parent:d,color:Xh,getValue:function(){return this.value},getKey:function(){return this.key}};return _<0?d.left=C:d.right=C,this.fixAfterInsertion(C),this.size_++,null};ta.prototype.fixAfterInsertion=function(i){var s=this;for(i.color=nd;i!=null&&i!==this.root_&&i.parent.color===nd;)if(Ei(i)===bb(Ei(Ei(i)))){var u=VE(Ei(Ei(i)));BE(u)===nd?(qh(Ei(i),Xh),qh(u,Xh),qh(Ei(Ei(i)),nd),i=Ei(Ei(i))):(i===VE(Ei(i))&&(i=Ei(i),s.rotateLeft(i)),qh(Ei(i),Xh),qh(Ei(Ei(i)),nd),s.rotateRight(Ei(Ei(i))))}else{var d=bb(Ei(Ei(i)));BE(d)===nd?(qh(Ei(i),Xh),qh(d,Xh),qh(Ei(Ei(i)),nd),i=Ei(Ei(i))):(i===bb(Ei(i))&&(i=Ei(i),s.rotateRight(i)),qh(Ei(i),Xh),qh(Ei(Ei(i)),nd),s.rotateLeft(Ei(Ei(i))))}this.root_.color=Xh};ta.prototype.values=function(){var i=new Pe,s=this.getFirstEntry();if(s!==null)for(i.add(s.value);(s=ta.successor(s))!==null;)i.add(s.value);return i};ta.prototype.entrySet=function(){var i=new Tb,s=this.getFirstEntry();if(s!==null)for(i.add(s);(s=ta.successor(s))!==null;)i.add(s);return i};ta.prototype.rotateLeft=function(i){if(i!=null){var s=i.right;i.right=s.left,s.left!=null&&(s.left.parent=i),s.parent=i.parent,i.parent===null?this.root_=s:i.parent.left===i?i.parent.left=s:i.parent.right=s,s.left=i,i.parent=s}};ta.prototype.rotateRight=function(i){if(i!=null){var s=i.left;i.left=s.right,s.right!=null&&(s.right.parent=i),s.parent=i.parent,i.parent===null?this.root_=s:i.parent.right===i?i.parent.right=s:i.parent.left=s,s.right=i,i.parent=s}};ta.prototype.getFirstEntry=function(){var i=this.root_;if(i!=null)for(;i.left!=null;)i=i.left;return i};ta.successor=function(i){if(i===null)return null;if(i.right!==null){for(var s=i.right;s.left!==null;)s=s.left;return s}else{for(var u=i.parent,d=i;u!==null&&d===u.right;)d=u,u=u.parent;return u}};ta.prototype.size=function(){return this.size_};var Oy=function(){};Oy.prototype.interfaces_=function(){return[]};Oy.prototype.getClass=function(){return Oy};function HE(){}HE.prototype=new q0;function dc(){this.array_=[],arguments[0]instanceof Yo&&this.addAll(arguments[0])}dc.prototype=new HE;dc.prototype.contains=function(i){for(var s=this,u=0,d=this.array_.length;u<d;u++){var _=s.array_[u];if(_.compareTo(i)===0)return!0}return!1};dc.prototype.add=function(i){var s=this;if(this.contains(i))return!1;for(var u=0,d=this.array_.length;u<d;u++){var _=s.array_[u];if(_.compareTo(i)===1)return s.array_.splice(u,0,i),!0}return this.array_.push(i),!0};dc.prototype.addAll=function(i){for(var s=this,u=i.iterator();u.hasNext();)s.add(u.next());return!0};dc.prototype.remove=function(i){throw new Wy};dc.prototype.size=function(){return this.array_.length};dc.prototype.isEmpty=function(){return this.array_.length===0};dc.prototype.toArray=function(){for(var i=this,s=[],u=0,d=this.array_.length;u<d;u++)s.push(i.array_[u]);return s};dc.prototype.iterator=function(){return new $0(this)};var $0=function(i){this.treeSet_=i,this.position_=0};$0.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new zm;return this.treeSet_.array_[this.position_++]};$0.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};$0.prototype.remove=function(){throw new Wy};var id=function(){};id.sort=function(){var i=arguments[0],s,u,d,_;if(arguments.length===1)_=function(C,l){return C.compareTo(l)},i.sort(_);else if(arguments.length===2)d=arguments[1],_=function(C,l){return d.compare(C,l)},i.sort(_);else if(arguments.length===3){u=i.slice(arguments[1],arguments[2]),u.sort();var b=i.slice(0,arguments[1]).concat(u,i.slice(arguments[2],i.length));for(i.splice(0,i.length),s=0;s<b.length;s++)i.push(b[s])}else if(arguments.length===4)for(u=i.slice(arguments[1],arguments[2]),d=arguments[3],_=function(C,l){return d.compare(C,l)},u.sort(_),b=i.slice(0,arguments[1]).concat(u,i.slice(arguments[2],i.length)),i.splice(0,i.length),s=0;s<b.length;s++)i.push(b[s])};id.asList=function(i){for(var s=new Pe,u=0,d=i.length;u<d;u++)s.add(i[u]);return s};var Ln=function(){},Ku={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ku.P.get=function(){return 0};Ku.L.get=function(){return 1};Ku.A.get=function(){return 2};Ku.FALSE.get=function(){return-1};Ku.TRUE.get=function(){return-2};Ku.DONTCARE.get=function(){return-3};Ku.SYM_FALSE.get=function(){return"F"};Ku.SYM_TRUE.get=function(){return"T"};Ku.SYM_DONTCARE.get=function(){return"*"};Ku.SYM_P.get=function(){return"0"};Ku.SYM_L.get=function(){return"1"};Ku.SYM_A.get=function(){return"2"};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};Ln.toDimensionSymbol=function(i){switch(i){case Ln.FALSE:return Ln.SYM_FALSE;case Ln.TRUE:return Ln.SYM_TRUE;case Ln.DONTCARE:return Ln.SYM_DONTCARE;case Ln.P:return Ln.SYM_P;case Ln.L:return Ln.SYM_L;case Ln.A:return Ln.SYM_A}throw new $i("Unknown dimension value: "+i)};Ln.toDimensionValue=function(i){switch(zy.toUpperCase(i)){case Ln.SYM_FALSE:return Ln.FALSE;case Ln.SYM_TRUE:return Ln.TRUE;case Ln.SYM_DONTCARE:return Ln.DONTCARE;case Ln.SYM_P:return Ln.P;case Ln.SYM_L:return Ln.L;case Ln.SYM_A:return Ln.A}throw new $i("Unknown dimension symbol: "+i)};Object.defineProperties(Ln,Ku);var fc=function(){};fc.prototype.filter=function(i){};fc.prototype.interfaces_=function(){return[]};fc.prototype.getClass=function(){return fc};var $u=function(){};$u.prototype.filter=function(i,s){};$u.prototype.isDone=function(){};$u.prototype.isGeometryChanged=function(){};$u.prototype.interfaces_=function(){return[]};$u.prototype.getClass=function(){return $u};var ya=function(i){function s(d,_){if(i.call(this,_),this._geometries=d||[],i.hasNullElements(this._geometries))throw new $i("geometries must not contain null elements")}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){for(var d=this,_=new ir,b=0;b<this._geometries.length;b++)_.expandToInclude(d._geometries[b].getEnvelopeInternal());return _},s.prototype.getGeometryN=function(d){return this._geometries[d]},s.prototype.getSortIndex=function(){return i.SORTINDEX_GEOMETRYCOLLECTION},s.prototype.getCoordinates=function(){for(var d=this,_=new Array(this.getNumPoints()).fill(null),b=-1,C=0;C<this._geometries.length;C++)for(var l=d._geometries[C].getCoordinates(),V=0;V<l.length;V++)b++,_[b]=l[V];return _},s.prototype.getArea=function(){for(var d=this,_=0,b=0;b<this._geometries.length;b++)_+=d._geometries[b].getArea();return _},s.prototype.equalsExact=function(){var d=this;if(arguments.length===2){var _=arguments[0],b=arguments[1];if(!this.isEquivalentClass(_))return!1;var C=_;if(this._geometries.length!==C._geometries.length)return!1;for(var l=0;l<this._geometries.length;l++)if(!d._geometries[l].equalsExact(C._geometries[l],b))return!1;return!0}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){for(var d=this,_=0;_<this._geometries.length;_++)d._geometries[_].normalize();id.sort(this._geometries)},s.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},s.prototype.getBoundaryDimension=function(){for(var d=this,_=Ln.FALSE,b=0;b<this._geometries.length;b++)_=Math.max(_,d._geometries[b].getBoundaryDimension());return _},s.prototype.getDimension=function(){for(var d=this,_=Ln.FALSE,b=0;b<this._geometries.length;b++)_=Math.max(_,d._geometries[b].getDimension());return _},s.prototype.getLength=function(){for(var d=this,_=0,b=0;b<this._geometries.length;b++)_+=d._geometries[b].getLength();return _},s.prototype.getNumPoints=function(){for(var d=this,_=0,b=0;b<this._geometries.length;b++)_+=d._geometries[b].getNumPoints();return _},s.prototype.getNumGeometries=function(){return this._geometries.length},s.prototype.reverse=function(){for(var d=this,_=this._geometries.length,b=new Array(_).fill(null),C=0;C<this._geometries.length;C++)b[C]=d._geometries[C].reverse();return this.getFactory().createGeometryCollection(b)},s.prototype.compareToSameClass=function(){var d=this;if(arguments.length===1){var _=arguments[0],b=new dc(id.asList(this._geometries)),C=new dc(id.asList(_._geometries));return this.compare(b,C)}else if(arguments.length===2){for(var l=arguments[0],V=arguments[1],R=l,et=this.getNumGeometries(),at=R.getNumGeometries(),st=0;st<et&&st<at;){var yt=d.getGeometryN(st),xt=R.getGeometryN(st),It=yt.compareToSameClass(xt,V);if(It!==0)return It;st++}return st<et?1:st<at?-1:0}},s.prototype.apply=function(){var d=this;if(xr(arguments[0],vh))for(var _=arguments[0],b=0;b<this._geometries.length;b++)d._geometries[b].apply(_);else if(xr(arguments[0],$u)){var C=arguments[0];if(this._geometries.length===0)return null;for(var l=0;l<this._geometries.length&&(d._geometries[l].apply(C),!C.isDone());l++);C.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],fc)){var V=arguments[0];V.filter(this);for(var R=0;R<this._geometries.length;R++)d._geometries[R].apply(V)}else if(xr(arguments[0],Wh)){var et=arguments[0];et.filter(this);for(var at=0;at<this._geometries.length;at++)d._geometries[at].apply(et)}},s.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Nr.shouldNeverReachHere(),null},s.prototype.clone=function(){var d=this,_=i.prototype.clone.call(this);_._geometries=new Array(this._geometries.length).fill(null);for(var b=0;b<this._geometries.length;b++)_._geometries[b]=d._geometries[b].clone();return _},s.prototype.getGeometryType=function(){return"GeometryCollection"},s.prototype.copy=function(){for(var d=this,_=new Array(this._geometries.length).fill(null),b=0;b<_.length;b++)_[b]=d._geometries[b].copy();return new s(_,this._factory)},s.prototype.isEmpty=function(){for(var d=this,_=0;_<this._geometries.length;_++)if(!d._geometries[_].isEmpty())return!1;return!0},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(s,u),s}(mr),sd=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return mr.SORTINDEX_MULTILINESTRING},s.prototype.equalsExact=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.isEquivalentClass(d)?i.prototype.equalsExact.call(this,d,_):!1}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return this.isClosed()?Ln.FALSE:0},s.prototype.isClosed=function(){var d=this;if(this.isEmpty())return!1;for(var _=0;_<this._geometries.length;_++)if(!d._geometries[_].isClosed())return!1;return!0},s.prototype.getDimension=function(){return 1},s.prototype.reverse=function(){for(var d=this,_=this._geometries.length,b=new Array(_).fill(null),C=0;C<this._geometries.length;C++)b[_-1-C]=d._geometries[C].reverse();return this.getFactory().createMultiLineString(b)},s.prototype.getBoundary=function(){return new lu(this).getBoundary()},s.prototype.getGeometryType=function(){return"MultiLineString"},s.prototype.copy=function(){for(var d=this,_=new Array(this._geometries.length).fill(null),b=0;b<_.length;b++)_[b]=d._geometries[b].copy();return new s(_,this._factory)},s.prototype.interfaces_=function(){return[Oy]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(s,u),s}(ya),lu=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var i=arguments[0],s=hu.MOD2_BOUNDARY_RULE;this._geom=i,this._geomFact=i.getFactory(),this._bnRule=s}else if(arguments.length===2){var u=arguments[0],d=arguments[1];this._geom=u,this._geomFact=u.getFactory(),this._bnRule=d}};lu.prototype.boundaryMultiLineString=function(i){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var s=this.computeBoundaryCoordinates(i);return s.length===1?this._geomFact.createPoint(s[0]):this._geomFact.createMultiPointFromCoords(s)};lu.prototype.getBoundary=function(){return this._geom instanceof uo?this.boundaryLineString(this._geom):this._geom instanceof sd?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};lu.prototype.boundaryLineString=function(i){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(i.isClosed()){var s=this._bnRule.isInBoundary(2);return s?i.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([i.getStartPoint(),i.getEndPoint()])};lu.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};lu.prototype.computeBoundaryCoordinates=function(i){var s=this,u=new Pe;this._endpointMap=new ta;for(var d=0;d<i.getNumGeometries();d++){var _=i.getGeometryN(d);_.getNumPoints()!==0&&(s.addEndpoint(_.getCoordinateN(0)),s.addEndpoint(_.getCoordinateN(_.getNumPoints()-1)))}for(var b=this._endpointMap.entrySet().iterator();b.hasNext();){var C=b.next(),l=C.getValue(),V=l.count;s._bnRule.isInBoundary(V)&&u.add(C.getKey())}return Jr.toCoordinateArray(u)};lu.prototype.addEndpoint=function(i){var s=this._endpointMap.get(i);s===null&&(s=new F0,this._endpointMap.put(i,s)),s.count++};lu.prototype.interfaces_=function(){return[]};lu.prototype.getClass=function(){return lu};lu.getBoundary=function(){if(arguments.length===1){var i=arguments[0],s=new lu(i);return s.getBoundary()}else if(arguments.length===2){var u=arguments[0],d=arguments[1],_=new lu(u,d);return _.getBoundary()}};var F0=function(){this.count=null};F0.prototype.interfaces_=function(){return[]};F0.prototype.getClass=function(){return F0};function iA(){}function oA(){}var sA=function(){};function aA(){}function lA(){}function uA(){}var uu=function(){},Ib={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};uu.prototype.interfaces_=function(){return[]};uu.prototype.getClass=function(){return uu};uu.chars=function(i,s){for(var u=new Array(s).fill(null),d=0;d<s;d++)u[d]=i;return String(u)};uu.getStackTrace=function(){if(arguments.length===1){var i=arguments[0],s=new aA,u=new iA;return i.printStackTrace(u),s.toString()}else if(arguments.length===2){var d=arguments[0],_=arguments[1],b="";new oA(uu.getStackTrace(d));for(var C=new uA,l=0;l<_;l++)try{b+=C.readLine()+uu.NEWLINE}catch(V){if(V instanceof lA)Nr.shouldNeverReachHere();else throw V}finally{}return b}};uu.split=function(i,s){for(var u=s.length,d=new Pe,_=""+i,b=_.indexOf(s);b>=0;){var C=_.substring(0,b);d.add(C),_=_.substring(b+u),b=_.indexOf(s)}_.length>0&&d.add(_);for(var l=new Array(d.size()).fill(null),V=0;V<l.length;V++)l[V]=d.get(V);return l};uu.toString=function(){if(arguments.length===1){var i=arguments[0];return uu.SIMPLE_ORDINATE_FORMAT.format(i)}};uu.spaces=function(i){return uu.chars(" ",i)};Ib.NEWLINE.get=function(){return Ds.getProperty("line.separator")};Ib.SIMPLE_ORDINATE_FORMAT.get=function(){return new sA};Object.defineProperties(uu,Ib);var Ao=function(){};Ao.prototype.interfaces_=function(){return[]};Ao.prototype.getClass=function(){return Ao};Ao.copyCoord=function(i,s,u,d){for(var _=Math.min(i.getDimension(),u.getDimension()),b=0;b<_;b++)u.setOrdinate(d,b,i.getOrdinate(s,b))};Ao.isRing=function(i){var s=i.size();return s===0?!0:s<=3?!1:i.getOrdinate(0,dn.X)===i.getOrdinate(s-1,dn.X)&&i.getOrdinate(0,dn.Y)===i.getOrdinate(s-1,dn.Y)};Ao.isEqual=function(i,s){var u=i.size(),d=s.size();if(u!==d)return!1;for(var _=Math.min(i.getDimension(),s.getDimension()),b=0;b<u;b++)for(var C=0;C<_;C++){var l=i.getOrdinate(b,C),V=s.getOrdinate(b,C);if(i.getOrdinate(b,C)!==s.getOrdinate(b,C)&&!(Lr.isNaN(l)&&Lr.isNaN(V)))return!1}return!0};Ao.extend=function(i,s,u){var d=i.create(u,s.getDimension()),_=s.size();if(Ao.copy(s,0,d,0,_),_>0)for(var b=_;b<u;b++)Ao.copy(s,_-1,d,b,1);return d};Ao.reverse=function(i){for(var s=i.size()-1,u=Math.trunc(s/2),d=0;d<=u;d++)Ao.swap(i,d,s-d)};Ao.swap=function(i,s,u){if(s===u)return null;for(var d=0;d<i.getDimension();d++){var _=i.getOrdinate(s,d);i.setOrdinate(s,d,i.getOrdinate(u,d)),i.setOrdinate(u,d,_)}};Ao.copy=function(i,s,u,d,_){for(var b=0;b<_;b++)Ao.copyCoord(i,s+b,u,d+b)};Ao.toString=function(){if(arguments.length===1){var i=arguments[0],s=i.size();if(s===0)return"()";var u=i.getDimension(),d=new wc;d.append("(");for(var _=0;_<s;_++){_>0&&d.append(" ");for(var b=0;b<u;b++)b>0&&d.append(","),d.append(uu.toString(i.getOrdinate(_,b)))}return d.append(")"),d.toString()}};Ao.ensureValidRing=function(i,s){var u=s.size();if(u===0)return s;if(u<=3)return Ao.createClosedRing(i,s,4);var d=s.getOrdinate(0,dn.X)===s.getOrdinate(u-1,dn.X)&&s.getOrdinate(0,dn.Y)===s.getOrdinate(u-1,dn.Y);return d?s:Ao.createClosedRing(i,s,u+1)};Ao.createClosedRing=function(i,s,u){var d=i.create(u,s.getDimension()),_=s.size();Ao.copy(s,0,d,0,_);for(var b=_;b<u;b++)Ao.copy(s,0,d,b,1);return d};var uo=function(i){function s(d,_){i.call(this,_),this._points=null,this.init(d)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ir:this._points.expandEnvelope(new ir)},s.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},s.prototype.getSortIndex=function(){return i.SORTINDEX_LINESTRING},s.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},s.prototype.equalsExact=function(){var d=this;if(arguments.length===2){var _=arguments[0],b=arguments[1];if(!this.isEquivalentClass(_))return!1;var C=_;if(this._points.size()!==C._points.size())return!1;for(var l=0;l<this._points.size();l++)if(!d.equal(d._points.getCoordinate(l),C._points.getCoordinate(l),b))return!1;return!0}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){for(var d=this,_=0;_<Math.trunc(this._points.size()/2);_++){var b=d._points.size()-1-_;if(!d._points.getCoordinate(_).equals(d._points.getCoordinate(b)))return d._points.getCoordinate(_).compareTo(d._points.getCoordinate(b))>0&&Ao.reverse(d._points),null}},s.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},s.prototype.getBoundaryDimension=function(){return this.isClosed()?Ln.FALSE:0},s.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},s.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},s.prototype.getDimension=function(){return 1},s.prototype.getLength=function(){return Fe.computeLength(this._points)},s.prototype.getNumPoints=function(){return this._points.size()},s.prototype.reverse=function(){var d=this._points.copy();Ao.reverse(d);var _=this.getFactory().createLineString(d);return _},s.prototype.compareToSameClass=function(){var d=this;if(arguments.length===1){for(var _=arguments[0],b=_,C=0,l=0;C<this._points.size()&&l<b._points.size();){var V=d._points.getCoordinate(C).compareTo(b._points.getCoordinate(l));if(V!==0)return V;C++,l++}return C<this._points.size()?1:l<b._points.size()?-1:0}else if(arguments.length===2){var R=arguments[0],et=arguments[1],at=R;return et.compare(this._points,at._points)}},s.prototype.apply=function(){var d=this;if(xr(arguments[0],vh))for(var _=arguments[0],b=0;b<this._points.size();b++)_.filter(d._points.getCoordinate(b));else if(xr(arguments[0],$u)){var C=arguments[0];if(this._points.size()===0)return null;for(var l=0;l<this._points.size()&&(C.filter(d._points,l),!C.isDone());l++);C.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],fc)){var V=arguments[0];V.filter(this)}else if(xr(arguments[0],Wh)){var R=arguments[0];R.filter(this)}},s.prototype.getBoundary=function(){return new lu(this).getBoundary()},s.prototype.isEquivalentClass=function(d){return d instanceof s},s.prototype.clone=function(){var d=i.prototype.clone.call(this);return d._points=this._points.clone(),d},s.prototype.getCoordinateN=function(d){return this._points.getCoordinate(d)},s.prototype.getGeometryType=function(){return"LineString"},s.prototype.copy=function(){return new s(this._points.copy(),this._factory)},s.prototype.getCoordinateSequence=function(){return this._points},s.prototype.isEmpty=function(){return this._points.size()===0},s.prototype.init=function(d){if(d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),d.size()===1)throw new $i("Invalid number of points in LineString (found "+d.size()+" - must be 0 or >= 2)");this._points=d},s.prototype.isCoordinate=function(d){for(var _=this,b=0;b<this._points.size();b++)if(_._points.getCoordinate(b).equals(d))return!0;return!1},s.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},s.prototype.getPointN=function(d){return this.getFactory().createPoint(this._points.getCoordinate(d))},s.prototype.interfaces_=function(){return[Oy]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(s,u),s}(mr),Fy=function(){};Fy.prototype.interfaces_=function(){return[]};Fy.prototype.getClass=function(){return Fy};var ol=function(i){function s(d,_){i.call(this,_),this._coordinates=d||null,this.init(this._coordinates)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ir;var d=new ir;return d.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),d},s.prototype.getSortIndex=function(){return i.SORTINDEX_POINT},s.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},s.prototype.equalsExact=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.isEquivalentClass(d)?this.isEmpty()&&d.isEmpty()?!0:this.isEmpty()!==d.isEmpty()?!1:this.equal(d.getCoordinate(),this.getCoordinate(),_):!1}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){},s.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},s.prototype.getBoundaryDimension=function(){return Ln.FALSE},s.prototype.getDimension=function(){return 0},s.prototype.getNumPoints=function(){return this.isEmpty()?0:1},s.prototype.reverse=function(){return this.copy()},s.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},s.prototype.compareToSameClass=function(){if(arguments.length===1){var d=arguments[0],_=d;return this.getCoordinate().compareTo(_.getCoordinate())}else if(arguments.length===2){var b=arguments[0],C=arguments[1],l=b;return C.compare(this._coordinates,l._coordinates)}},s.prototype.apply=function(){if(xr(arguments[0],vh)){var d=arguments[0];if(this.isEmpty())return null;d.filter(this.getCoordinate())}else if(xr(arguments[0],$u)){var _=arguments[0];if(this.isEmpty())return null;_.filter(this._coordinates,0),_.isGeometryChanged()&&this.geometryChanged()}else if(xr(arguments[0],fc)){var b=arguments[0];b.filter(this)}else if(xr(arguments[0],Wh)){var C=arguments[0];C.filter(this)}},s.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},s.prototype.clone=function(){var d=i.prototype.clone.call(this);return d._coordinates=this._coordinates.clone(),d},s.prototype.getGeometryType=function(){return"Point"},s.prototype.copy=function(){return new s(this._coordinates.copy(),this._factory)},s.prototype.getCoordinateSequence=function(){return this._coordinates},s.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},s.prototype.isEmpty=function(){return this._coordinates.size()===0},s.prototype.init=function(d){d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),Nr.isTrue(d.size()<=1),this._coordinates=d},s.prototype.isSimple=function(){return!0},s.prototype.interfaces_=function(){return[Fy]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(s,u),s}(mr),Bp=function(){};Bp.prototype.interfaces_=function(){return[]};Bp.prototype.getClass=function(){return Bp};var Jo=function(i){function s(d,_,b){if(i.call(this,b),this._shell=null,this._holes=null,d===null&&(d=this.getFactory().createLinearRing()),_===null&&(_=[]),i.hasNullElements(_))throw new $i("holes must not contain null elements");if(d.isEmpty()&&i.hasNonEmptyElements(_))throw new $i("shell is empty but holes are not");this._shell=d,this._holes=_}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},s.prototype.getSortIndex=function(){return i.SORTINDEX_POLYGON},s.prototype.getCoordinates=function(){var d=this;if(this.isEmpty())return[];for(var _=new Array(this.getNumPoints()).fill(null),b=-1,C=this._shell.getCoordinates(),l=0;l<C.length;l++)b++,_[b]=C[l];for(var V=0;V<this._holes.length;V++)for(var R=d._holes[V].getCoordinates(),et=0;et<R.length;et++)b++,_[b]=R[et];return _},s.prototype.getArea=function(){var d=this,_=0;_+=Math.abs(Fe.signedArea(this._shell.getCoordinateSequence()));for(var b=0;b<this._holes.length;b++)_-=Math.abs(Fe.signedArea(d._holes[b].getCoordinateSequence()));return _},s.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var d=this._shell.getCoordinateSequence(),_=this.getEnvelopeInternal(),b=0;b<5;b++){var C=d.getX(b);if(!(C===_.getMinX()||C===_.getMaxX()))return!1;var l=d.getY(b);if(!(l===_.getMinY()||l===_.getMaxY()))return!1}for(var V=d.getX(0),R=d.getY(0),et=1;et<=4;et++){var at=d.getX(et),st=d.getY(et),yt=at!==V,xt=st!==R;if(yt===xt)return!1;V=at,R=st}return!0},s.prototype.equalsExact=function(){var d=this;if(arguments.length===2){var _=arguments[0],b=arguments[1];if(!this.isEquivalentClass(_))return!1;var C=_,l=this._shell,V=C._shell;if(!l.equalsExact(V,b)||this._holes.length!==C._holes.length)return!1;for(var R=0;R<this._holes.length;R++)if(!d._holes[R].equalsExact(C._holes[R],b))return!1;return!0}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){var d=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var _=0;_<this._holes.length;_++)d.normalize(d._holes[_],!1);id.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],C=arguments[1];if(b.isEmpty())return null;var l=new Array(b.getCoordinates().length-1).fill(null);Ds.arraycopy(b.getCoordinates(),0,l,0,l.length);var V=Jr.minCoordinate(b.getCoordinates());Jr.scroll(l,V),Ds.arraycopy(l,0,b.getCoordinates(),0,l.length),b.getCoordinates()[l.length]=l[0],Fe.isCCW(b.getCoordinates())===C&&Jr.reverse(b.getCoordinates())}},s.prototype.getCoordinate=function(){return this._shell.getCoordinate()},s.prototype.getNumInteriorRing=function(){return this._holes.length},s.prototype.getBoundaryDimension=function(){return 1},s.prototype.getDimension=function(){return 2},s.prototype.getLength=function(){var d=this,_=0;_+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)_+=d._holes[b].getLength();return _},s.prototype.getNumPoints=function(){for(var d=this,_=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)_+=d._holes[b].getNumPoints();return _},s.prototype.reverse=function(){var d=this,_=this.copy();_._shell=this._shell.copy().reverse(),_._holes=new Array(this._holes.length).fill(null);for(var b=0;b<this._holes.length;b++)_._holes[b]=d._holes[b].copy().reverse();return _},s.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},s.prototype.compareToSameClass=function(){var d=this;if(arguments.length===1){var _=arguments[0],b=this._shell,C=_._shell;return b.compareToSameClass(C)}else if(arguments.length===2){var l=arguments[0],V=arguments[1],R=l,et=this._shell,at=R._shell,st=et.compareToSameClass(at,V);if(st!==0)return st;for(var yt=this.getNumInteriorRing(),xt=R.getNumInteriorRing(),It=0;It<yt&&It<xt;){var Pt=d.getInteriorRingN(It),qt=R.getInteriorRingN(It),Qt=Pt.compareToSameClass(qt,V);if(Qt!==0)return Qt;It++}return It<yt?1:It<xt?-1:0}},s.prototype.apply=function(d){var _=this;if(xr(d,vh)){this._shell.apply(d);for(var b=0;b<this._holes.length;b++)_._holes[b].apply(d)}else if(xr(d,$u)){if(this._shell.apply(d),!d.isDone())for(var C=0;C<this._holes.length&&(_._holes[C].apply(d),!d.isDone());C++);d.isGeometryChanged()&&this.geometryChanged()}else if(xr(d,fc))d.filter(this);else if(xr(d,Wh)){d.filter(this),this._shell.apply(d);for(var l=0;l<this._holes.length;l++)_._holes[l].apply(d)}},s.prototype.getBoundary=function(){var d=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var _=new Array(this._holes.length+1).fill(null);_[0]=this._shell;for(var b=0;b<this._holes.length;b++)_[b+1]=d._holes[b];return _.length<=1?this.getFactory().createLinearRing(_[0].getCoordinateSequence()):this.getFactory().createMultiLineString(_)},s.prototype.clone=function(){var d=this,_=i.prototype.clone.call(this);_._shell=this._shell.clone(),_._holes=new Array(this._holes.length).fill(null);for(var b=0;b<this._holes.length;b++)_._holes[b]=d._holes[b].clone();return _},s.prototype.getGeometryType=function(){return"Polygon"},s.prototype.copy=function(){for(var d=this,_=this._shell.copy(),b=new Array(this._holes.length).fill(null),C=0;C<b.length;C++)b[C]=d._holes[C].copy();return new s(_,b,this._factory)},s.prototype.getExteriorRing=function(){return this._shell},s.prototype.isEmpty=function(){return this._shell.isEmpty()},s.prototype.getInteriorRingN=function(d){return this._holes[d]},s.prototype.interfaces_=function(){return[Bp]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(s,u),s}(mr),bm=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return mr.SORTINDEX_MULTIPOINT},s.prototype.isValid=function(){return!0},s.prototype.equalsExact=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.isEquivalentClass(d)?i.prototype.equalsExact.call(this,d,_):!1}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.getCoordinate=function(){if(arguments.length===1){var d=arguments[0];return this._geometries[d].getCoordinate()}else return i.prototype.getCoordinate.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return Ln.FALSE},s.prototype.getDimension=function(){return 0},s.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},s.prototype.getGeometryType=function(){return"MultiPoint"},s.prototype.copy=function(){for(var d=this,_=new Array(this._geometries.length).fill(null),b=0;b<_.length;b++)_[b]=d._geometries[b].copy();return new s(_,this._factory)},s.prototype.interfaces_=function(){return[Fy]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(s,u),s}(ya),xh=function(i){function s(d,_){d instanceof Vt&&_ instanceof Wr&&(d=_.getCoordinateSequenceFactory().create(d)),i.call(this,d,_),this.validateConstruction()}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return mr.SORTINDEX_LINEARRING},s.prototype.getBoundaryDimension=function(){return Ln.FALSE},s.prototype.isClosed=function(){return this.isEmpty()?!0:i.prototype.isClosed.call(this)},s.prototype.reverse=function(){var d=this._points.copy();Ao.reverse(d);var _=this.getFactory().createLinearRing(d);return _},s.prototype.validateConstruction=function(){if(!this.isEmpty()&&!i.prototype.isClosed.call(this))throw new $i("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new $i("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},s.prototype.getGeometryType=function(){return"LinearRing"},s.prototype.copy=function(){return new s(this._points.copy(),this._factory)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},u.MINIMUM_VALID_SIZE.get=function(){return 4},u.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(s,u),s}(uo),yh=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return mr.SORTINDEX_MULTIPOLYGON},s.prototype.equalsExact=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.isEquivalentClass(d)?i.prototype.equalsExact.call(this,d,_):!1}else return i.prototype.equalsExact.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return 1},s.prototype.getDimension=function(){return 2},s.prototype.reverse=function(){for(var d=this,_=this._geometries.length,b=new Array(_).fill(null),C=0;C<this._geometries.length;C++)b[C]=d._geometries[C].reverse();return this.getFactory().createMultiPolygon(b)},s.prototype.getBoundary=function(){var d=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var _=new Pe,b=0;b<this._geometries.length;b++)for(var C=d._geometries[b],l=C.getBoundary(),V=0;V<l.getNumGeometries();V++)_.add(l.getGeometryN(V));var R=new Array(_.size()).fill(null);return this.getFactory().createMultiLineString(_.toArray(R))},s.prototype.getGeometryType=function(){return"MultiPolygon"},s.prototype.copy=function(){for(var d=this,_=new Array(this._geometries.length).fill(null),b=0;b<_.length;b++)_[b]=d._geometries[b].copy();return new s(_,this._factory)},s.prototype.interfaces_=function(){return[Bp]},s.prototype.getClass=function(){return s},u.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(s,u),s}(ya),pu=function(i){this._factory=i||null,this._isUserDataCopied=!1},Z0={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};pu.prototype.setCopyUserData=function(i){this._isUserDataCopied=i};pu.prototype.edit=function(i,s){if(i===null)return null;var u=this.editInternal(i,s);return this._isUserDataCopied&&u.setUserData(i.getUserData()),u};pu.prototype.editInternal=function(i,s){return this._factory===null&&(this._factory=i.getFactory()),i instanceof ya?this.editGeometryCollection(i,s):i instanceof Jo?this.editPolygon(i,s):i instanceof ol?s.edit(i,this._factory):i instanceof uo?s.edit(i,this._factory):(Nr.shouldNeverReachHere("Unsupported Geometry class: "+i.getClass().getName()),null)};pu.prototype.editGeometryCollection=function(i,s){for(var u=this,d=s.edit(i,this._factory),_=new Pe,b=0;b<d.getNumGeometries();b++){var C=u.edit(d.getGeometryN(b),s);C===null||C.isEmpty()||_.add(C)}return d.getClass()===bm?this._factory.createMultiPoint(_.toArray([])):d.getClass()===sd?this._factory.createMultiLineString(_.toArray([])):d.getClass()===yh?this._factory.createMultiPolygon(_.toArray([])):this._factory.createGeometryCollection(_.toArray([]))};pu.prototype.editPolygon=function(i,s){var u=this,d=s.edit(i,this._factory);if(d===null&&(d=this._factory.createPolygon(null)),d.isEmpty())return d;var _=this.edit(d.getExteriorRing(),s);if(_===null||_.isEmpty())return this._factory.createPolygon();for(var b=new Pe,C=0;C<d.getNumInteriorRing();C++){var l=u.edit(d.getInteriorRingN(C),s);l===null||l.isEmpty()||b.add(l)}return this._factory.createPolygon(_,b.toArray([]))};pu.prototype.interfaces_=function(){return[]};pu.prototype.getClass=function(){return pu};pu.GeometryEditorOperation=function(){};Z0.NoOpGeometryOperation.get=function(){return Ny};Z0.CoordinateOperation.get=function(){return By};Z0.CoordinateSequenceOperation.get=function(){return Vy};Object.defineProperties(pu,Z0);var Ny=function(){};Ny.prototype.edit=function(i,s){return i};Ny.prototype.interfaces_=function(){return[pu.GeometryEditorOperation]};Ny.prototype.getClass=function(){return Ny};var By=function(){};By.prototype.edit=function(i,s){var u=this.editCoordinates(i.getCoordinates(),i);return u===null?i:i instanceof xh?s.createLinearRing(u):i instanceof uo?s.createLineString(u):i instanceof ol?u.length>0?s.createPoint(u[0]):s.createPoint():i};By.prototype.interfaces_=function(){return[pu.GeometryEditorOperation]};By.prototype.getClass=function(){return By};var Vy=function(){};Vy.prototype.edit=function(i,s){return i instanceof xh?s.createLinearRing(this.edit(i.getCoordinateSequence(),i)):i instanceof uo?s.createLineString(this.edit(i.getCoordinateSequence(),i)):i instanceof ol?s.createPoint(this.edit(i.getCoordinateSequence(),i)):i};Vy.prototype.interfaces_=function(){return[pu.GeometryEditorOperation]};Vy.prototype.getClass=function(){return Vy};var Co=function(){var i=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var s=arguments[0];this._coordinates=new Array(s).fill(null);for(var u=0;u<s;u++)i._coordinates[u]=new Vt}else if(xr(arguments[0],dn)){var d=arguments[0];if(d===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=d.getDimension(),this._coordinates=new Array(d.size()).fill(null);for(var _=0;_<this._coordinates.length;_++)i._coordinates[_]=d.getCoordinateCopy(_)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var b=arguments[0],C=arguments[1];this._coordinates=b,this._dimension=C,b===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],V=arguments[1];this._coordinates=new Array(l).fill(null),this._dimension=V;for(var R=0;R<l;R++)i._coordinates[R]=new Vt}}},YE={serialVersionUID:{configurable:!0}};Co.prototype.setOrdinate=function(i,s,u){switch(s){case dn.X:this._coordinates[i].x=u;break;case dn.Y:this._coordinates[i].y=u;break;case dn.Z:this._coordinates[i].z=u;break;default:throw new $i("invalid ordinateIndex")}};Co.prototype.size=function(){return this._coordinates.length};Co.prototype.getOrdinate=function(i,s){switch(s){case dn.X:return this._coordinates[i].x;case dn.Y:return this._coordinates[i].y;case dn.Z:return this._coordinates[i].z}return Lr.NaN};Co.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._coordinates[i]}else if(arguments.length===2){var s=arguments[0],u=arguments[1];u.x=this._coordinates[s].x,u.y=this._coordinates[s].y,u.z=this._coordinates[s].z}};Co.prototype.getCoordinateCopy=function(i){return new Vt(this._coordinates[i])};Co.prototype.getDimension=function(){return this._dimension};Co.prototype.getX=function(i){return this._coordinates[i].x};Co.prototype.clone=function(){for(var i=this,s=new Array(this.size()).fill(null),u=0;u<this._coordinates.length;u++)s[u]=i._coordinates[u].clone();return new Co(s,this._dimension)};Co.prototype.expandEnvelope=function(i){for(var s=this,u=0;u<this._coordinates.length;u++)i.expandToInclude(s._coordinates[u]);return i};Co.prototype.copy=function(){for(var i=this,s=new Array(this.size()).fill(null),u=0;u<this._coordinates.length;u++)s[u]=i._coordinates[u].copy();return new Co(s,this._dimension)};Co.prototype.toString=function(){var i=this;if(this._coordinates.length>0){var s=new wc(17*this._coordinates.length);s.append("("),s.append(this._coordinates[0]);for(var u=1;u<this._coordinates.length;u++)s.append(", "),s.append(i._coordinates[u]);return s.append(")"),s.toString()}else return"()"};Co.prototype.getY=function(i){return this._coordinates[i].y};Co.prototype.toCoordinateArray=function(){return this._coordinates};Co.prototype.interfaces_=function(){return[dn,mu]};Co.prototype.getClass=function(){return Co};YE.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Co,YE);var bh=function(){},Cb={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};bh.prototype.readResolve=function(){return bh.instance()};bh.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return new Co(i)}else if(xr(arguments[0],dn)){var s=arguments[0];return new Co(s)}}else if(arguments.length===2){var u=arguments[0],d=arguments[1];return d>3&&(d=3),d<2?new Co(u):new Co(u,d)}};bh.prototype.interfaces_=function(){return[mm,mu]};bh.prototype.getClass=function(){return bh};bh.instance=function(){return bh.instanceObject};Cb.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Cb.instanceObject.get=function(){return new bh};Object.defineProperties(bh,Cb);var WE=function(i){function s(){i.call(this),this.map_=new Map}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.get=function(u){return this.map_.get(u)||null},s.prototype.put=function(u,d){return this.map_.set(u,d),d},s.prototype.values=function(){for(var u=new Pe,d=this.map_.values(),_=d.next();!_.done;)u.add(_.value),_=d.next();return u},s.prototype.entrySet=function(){var u=new Tb;return this.map_.entries().forEach(function(d){return u.add(d)}),u},s.prototype.size=function(){return this.map_.size()},s}(kf),Dn=function i(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=i.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof mc){var s=arguments[0];this._modelType=s,s===i.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var u=arguments[0];this._modelType=i.FIXED,this.setScale(u)}else if(arguments[0]instanceof i){var d=arguments[0];this._modelType=d._modelType,this._scale=d._scale}}},Pb={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Dn.prototype.equals=function(i){if(!(i instanceof Dn))return!1;var s=i;return this._modelType===s._modelType&&this._scale===s._scale};Dn.prototype.compareTo=function(i){var s=i,u=this.getMaximumSignificantDigits(),d=s.getMaximumSignificantDigits();return new pc(u).compareTo(new pc(d))};Dn.prototype.getScale=function(){return this._scale};Dn.prototype.isFloating=function(){return this._modelType===Dn.FLOATING||this._modelType===Dn.FLOATING_SINGLE};Dn.prototype.getType=function(){return this._modelType};Dn.prototype.toString=function(){var i="UNKNOWN";return this._modelType===Dn.FLOATING?i="Floating":this._modelType===Dn.FLOATING_SINGLE?i="Floating-Single":this._modelType===Dn.FIXED&&(i="Fixed (Scale="+this.getScale()+")"),i};Dn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var i=arguments[0];if(Lr.isNaN(i))return i;if(this._modelType===Dn.FLOATING_SINGLE){var s=i;return s}return this._modelType===Dn.FIXED?Math.round(i*this._scale)/this._scale:i}else if(arguments[0]instanceof Vt){var u=arguments[0];if(this._modelType===Dn.FLOATING)return null;u.x=this.makePrecise(u.x),u.y=this.makePrecise(u.y)}};Dn.prototype.getMaximumSignificantDigits=function(){var i=16;return this._modelType===Dn.FLOATING?i=16:this._modelType===Dn.FLOATING_SINGLE?i=6:this._modelType===Dn.FIXED&&(i=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),i};Dn.prototype.setScale=function(i){this._scale=Math.abs(i)};Dn.prototype.interfaces_=function(){return[mu,fu]};Dn.prototype.getClass=function(){return Dn};Dn.mostPrecise=function(i,s){return i.compareTo(s)>=0?i:s};Pb.serialVersionUID.get=function(){return 7777263578777804e3};Pb.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Dn,Pb);var mc=function i(s){this._name=s||null,i.nameToTypeMap.put(s,this)},Ab={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};mc.prototype.readResolve=function(){return mc.nameToTypeMap.get(this._name)};mc.prototype.toString=function(){return this._name};mc.prototype.interfaces_=function(){return[mu]};mc.prototype.getClass=function(){return mc};Ab.serialVersionUID.get=function(){return-552860263173159e4};Ab.nameToTypeMap.get=function(){return new WE};Object.defineProperties(mc,Ab);Dn.Type=mc;Dn.FIXED=new mc("FIXED");Dn.FLOATING=new mc("FLOATING");Dn.FLOATING_SINGLE=new mc("FLOATING SINGLE");var Wr=function i(){this._precisionModel=new Dn,this._SRID=0,this._coordinateSequenceFactory=i.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?xr(arguments[0],mm)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Dn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},JE={serialVersionUID:{configurable:!0}};Wr.prototype.toGeometry=function(i){return i.isNull()?this.createPoint(null):i.getMinX()===i.getMaxX()&&i.getMinY()===i.getMaxY()?this.createPoint(new Vt(i.getMinX(),i.getMinY())):i.getMinX()===i.getMaxX()||i.getMinY()===i.getMaxY()?this.createLineString([new Vt(i.getMinX(),i.getMinY()),new Vt(i.getMaxX(),i.getMaxY())]):this.createPolygon(this.createLinearRing([new Vt(i.getMinX(),i.getMinY()),new Vt(i.getMinX(),i.getMaxY()),new Vt(i.getMaxX(),i.getMaxY()),new Vt(i.getMaxX(),i.getMinY()),new Vt(i.getMinX(),i.getMinY())]),null)};Wr.prototype.createLineString=function(i){if(i){if(i instanceof Array)return new uo(this.getCoordinateSequenceFactory().create(i),this);if(xr(i,dn))return new uo(i,this)}else return new uo(this.getCoordinateSequenceFactory().create([]),this)};Wr.prototype.createMultiLineString=function(){if(arguments.length===0)return new sd(null,this);if(arguments.length===1){var i=arguments[0];return new sd(i,this)}};Wr.prototype.buildGeometry=function(i){for(var s=null,u=!1,d=!1,_=i.iterator();_.hasNext();){var b=_.next(),C=b.getClass();s===null&&(s=C),C!==s&&(u=!0),b.isGeometryCollectionOrDerived()&&(d=!0)}if(s===null)return this.createGeometryCollection();if(u||d)return this.createGeometryCollection(Wr.toGeometryArray(i));var l=i.iterator().next(),V=i.size()>1;if(V){if(l instanceof Jo)return this.createMultiPolygon(Wr.toPolygonArray(i));if(l instanceof uo)return this.createMultiLineString(Wr.toLineStringArray(i));if(l instanceof ol)return this.createMultiPoint(Wr.toPointArray(i));Nr.shouldNeverReachHere("Unhandled class: "+l.getClass().getName())}return l};Wr.prototype.createMultiPointFromCoords=function(i){return this.createMultiPoint(i!==null?this.getCoordinateSequenceFactory().create(i):null)};Wr.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Vt){var i=arguments[0];return this.createPoint(i!==null?this.getCoordinateSequenceFactory().create([i]):null)}else if(xr(arguments[0],dn)){var s=arguments[0];return new ol(s,this)}}};Wr.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};Wr.prototype.createPolygon=function(){if(arguments.length===0)return new Jo(null,null,this);if(arguments.length===1){if(xr(arguments[0],dn)){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}else if(arguments[0]instanceof Array){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}else if(arguments[0]instanceof xh){var u=arguments[0];return this.createPolygon(u,null)}}else if(arguments.length===2){var d=arguments[0],_=arguments[1];return new Jo(d,_,this)}};Wr.prototype.getSRID=function(){return this._SRID};Wr.prototype.createGeometryCollection=function(){if(arguments.length===0)return new ya(null,this);if(arguments.length===1){var i=arguments[0];return new ya(i,this)}};Wr.prototype.createGeometry=function(i){var s=new pu(this);return s.edit(i,{edit:function(){if(arguments.length===2){var u=arguments[0];return this._coordinateSequenceFactory.create(u)}}})};Wr.prototype.getPrecisionModel=function(){return this._precisionModel};Wr.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLinearRing(i!==null?this.getCoordinateSequenceFactory().create(i):null)}else if(xr(arguments[0],dn)){var s=arguments[0];return new xh(s,this)}}};Wr.prototype.createMultiPolygon=function(){if(arguments.length===0)return new yh(null,this);if(arguments.length===1){var i=arguments[0];return new yh(i,this)}};Wr.prototype.createMultiPoint=function(){var i=this;if(arguments.length===0)return new bm(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var s=arguments[0];return new bm(s,this)}else if(arguments[0]instanceof Array){var u=arguments[0];return this.createMultiPoint(u!==null?this.getCoordinateSequenceFactory().create(u):null)}else if(xr(arguments[0],dn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var _=new Array(d.size()).fill(null),b=0;b<d.size();b++){var C=i.getCoordinateSequenceFactory().create(1,d.getDimension());Ao.copy(d,b,C,0,1),_[b]=i.createPoint(C)}return this.createMultiPoint(_)}}};Wr.prototype.interfaces_=function(){return[mu]};Wr.prototype.getClass=function(){return Wr};Wr.toMultiPolygonArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toGeometryArray=function(i){if(i===null)return null;var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.getDefaultCoordinateSequenceFactory=function(){return bh.instance()};Wr.toMultiLineStringArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toLineStringArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toMultiPointArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toLinearRingArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toPointArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.toPolygonArray=function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)};Wr.createPointFromInternalCoord=function(i,s){return s.getPrecisionModel().makePrecise(i),s.getFactory().createPoint(i)};JE.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(Wr,JE);var cA=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],X0=function(i){this.geometryFactory=i||new Wr};X0.prototype.read=function(i){var s;typeof i=="string"?s=JSON.parse(i):s=i;var u=s.type;if(!lc[u])throw new Error("Unknown GeoJSON type: "+s.type);return cA.indexOf(u)!==-1?lc[u].apply(this,[s.coordinates]):u==="GeometryCollection"?lc[u].apply(this,[s.geometries]):lc[u].apply(this,[s])};X0.prototype.write=function(i){var s=i.getGeometryType();if(!Zh[s])throw new Error("Geometry is not supported");return Zh[s].apply(this,[i])};var lc={Feature:function(i){var s={};for(var u in i)s[u]=i[u];if(i.geometry){var d=i.geometry.type;if(!lc[d])throw new Error("Unknown GeoJSON type: "+i.type);s.geometry=this.read(i.geometry)}return i.bbox&&(s.bbox=lc.bbox.apply(this,[i.bbox])),s},FeatureCollection:function(i){var s=this,u={};if(i.features){u.features=[];for(var d=0;d<i.features.length;++d)u.features.push(s.read(i.features[d]))}return i.bbox&&(u.bbox=this.parse.bbox.apply(this,[i.bbox])),u},coordinates:function(i){for(var s=[],u=0;u<i.length;++u){var d=i[u];s.push(new Vt(d[0],d[1]))}return s},bbox:function(i){return this.geometryFactory.createLinearRing([new Vt(i[0],i[1]),new Vt(i[2],i[1]),new Vt(i[2],i[3]),new Vt(i[0],i[3]),new Vt(i[0],i[1])])},Point:function(i){var s=new Vt(i[0],i[1]);return this.geometryFactory.createPoint(s)},MultiPoint:function(i){for(var s=this,u=[],d=0;d<i.length;++d)u.push(lc.Point.apply(s,[i[d]]));return this.geometryFactory.createMultiPoint(u)},LineString:function(i){var s=lc.coordinates.apply(this,[i]);return this.geometryFactory.createLineString(s)},MultiLineString:function(i){for(var s=this,u=[],d=0;d<i.length;++d)u.push(lc.LineString.apply(s,[i[d]]));return this.geometryFactory.createMultiLineString(u)},Polygon:function(i){for(var s=this,u=lc.coordinates.apply(this,[i[0]]),d=this.geometryFactory.createLinearRing(u),_=[],b=1;b<i.length;++b){var C=i[b],l=lc.coordinates.apply(s,[C]),V=s.geometryFactory.createLinearRing(l);_.push(V)}return this.geometryFactory.createPolygon(d,_)},MultiPolygon:function(i){for(var s=this,u=[],d=0;d<i.length;++d){var _=i[d];u.push(lc.Polygon.apply(s,[_]))}return this.geometryFactory.createMultiPolygon(u)},GeometryCollection:function(i){for(var s=this,u=[],d=0;d<i.length;++d){var _=i[d];u.push(s.read(_))}return this.geometryFactory.createGeometryCollection(u)}},Zh={coordinate:function(i){return[i.x,i.y]},Point:function(i){var s=Zh.coordinate.apply(this,[i.getCoordinate()]);return{type:"Point",coordinates:s}},MultiPoint:function(i){for(var s=this,u=[],d=0;d<i._geometries.length;++d){var _=i._geometries[d],b=Zh.Point.apply(s,[_]);u.push(b.coordinates)}return{type:"MultiPoint",coordinates:u}},LineString:function(i){for(var s=this,u=[],d=i.getCoordinates(),_=0;_<d.length;++_){var b=d[_];u.push(Zh.coordinate.apply(s,[b]))}return{type:"LineString",coordinates:u}},MultiLineString:function(i){for(var s=this,u=[],d=0;d<i._geometries.length;++d){var _=i._geometries[d],b=Zh.LineString.apply(s,[_]);u.push(b.coordinates)}return{type:"MultiLineString",coordinates:u}},Polygon:function(i){var s=this,u=[],d=Zh.LineString.apply(this,[i._shell]);u.push(d.coordinates);for(var _=0;_<i._holes.length;++_){var b=i._holes[_],C=Zh.LineString.apply(s,[b]);u.push(C.coordinates)}return{type:"Polygon",coordinates:u}},MultiPolygon:function(i){for(var s=this,u=[],d=0;d<i._geometries.length;++d){var _=i._geometries[d],b=Zh.Polygon.apply(s,[_]);u.push(b.coordinates)}return{type:"MultiPolygon",coordinates:u}},GeometryCollection:function(i){for(var s=this,u=[],d=0;d<i._geometries.length;++d){var _=i._geometries[d],b=_.getGeometryType();u.push(Zh[b].apply(s,[_]))}return{type:"GeometryCollection",geometries:u}}},H0=function(i){this.geometryFactory=i||new Wr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new X0(this.geometryFactory)};H0.prototype.read=function(i){var s=this.parser.read(i);return this.precisionModel.getType()===Dn.FIXED&&this.reducePrecision(s),s};H0.prototype.reducePrecision=function(i){var s=this,u,d;if(i.coordinate)this.precisionModel.makePrecise(i.coordinate);else if(i.points)for(u=0,d=i.points.length;u<d;u++)s.precisionModel.makePrecise(i.points[u]);else if(i.geometries)for(u=0,d=i.geometries.length;u<d;u++)s.reducePrecision(i.geometries[u])};var Lb=function(){this.parser=new X0(this.geometryFactory)};Lb.prototype.write=function(i){return this.parser.write(i)};var be=function(){},Y0={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.opposite=function(i){return i===be.LEFT?be.RIGHT:i===be.RIGHT?be.LEFT:i};Y0.ON.get=function(){return 0};Y0.LEFT.get=function(){return 1};Y0.RIGHT.get=function(){return 2};Object.defineProperties(be,Y0);function W0(i){this.message=i||""}W0.prototype=new Error;W0.prototype.name="EmptyStackException";function Sc(){this.array_=[]}Sc.prototype=new Gu;Sc.prototype.add=function(i){return this.array_.push(i),!0};Sc.prototype.get=function(i){if(i<0||i>=this.size())throw new Error;return this.array_[i]};Sc.prototype.push=function(i){return this.array_.push(i),i};Sc.prototype.pop=function(i){if(this.array_.length===0)throw new W0;return this.array_.pop()};Sc.prototype.peek=function(){if(this.array_.length===0)throw new W0;return this.array_[this.array_.length-1]};Sc.prototype.empty=function(){return this.array_.length===0};Sc.prototype.isEmpty=function(){return this.empty()};Sc.prototype.search=function(i){return this.array_.indexOf(i)};Sc.prototype.size=function(){return this.array_.length};Sc.prototype.toArray=function(){for(var i=this,s=[],u=0,d=this.array_.length;u<d;u++)s.push(i.array_[u]);return s};var gc=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};gc.prototype.getCoordinate=function(){return this._minCoord};gc.prototype.getRightmostSide=function(i,s){var u=this.getRightmostSideOfSegment(i,s);return u<0&&(u=this.getRightmostSideOfSegment(i,s-1)),u<0&&(this._minCoord=null,this.checkForRightmostCoordinate(i)),u};gc.prototype.findRightmostEdgeAtVertex=function(){var i=this._minDe.getEdge().getCoordinates();Nr.isTrue(this._minIndex>0&&this._minIndex<i.length,"rightmost point expected to be interior vertex of edge");var s=i[this._minIndex-1],u=i[this._minIndex+1],d=Fe.computeOrientation(this._minCoord,u,s),_=!1;(s.y<this._minCoord.y&&u.y<this._minCoord.y&&d===Fe.COUNTERCLOCKWISE||s.y>this._minCoord.y&&u.y>this._minCoord.y&&d===Fe.CLOCKWISE)&&(_=!0),_&&(this._minIndex=this._minIndex-1)};gc.prototype.getRightmostSideOfSegment=function(i,s){var u=i.getEdge(),d=u.getCoordinates();if(s<0||s+1>=d.length||d[s].y===d[s+1].y)return-1;var _=be.LEFT;return d[s].y<d[s+1].y&&(_=be.RIGHT),_};gc.prototype.getEdge=function(){return this._orientedDe};gc.prototype.checkForRightmostCoordinate=function(i){for(var s=this,u=i.getEdge().getCoordinates(),d=0;d<u.length-1;d++)(s._minCoord===null||u[d].x>s._minCoord.x)&&(s._minDe=i,s._minIndex=d,s._minCoord=u[d])};gc.prototype.findRightmostEdgeAtNode=function(){var i=this._minDe.getNode(),s=i.getEdges();this._minDe=s.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};gc.prototype.findEdge=function(i){for(var s=this,u=i.iterator();u.hasNext();){var d=u.next();d.isForward()&&s.checkForRightmostCoordinate(d)}Nr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var _=this.getRightmostSide(this._minDe,this._minIndex);_===be.LEFT&&(this._orientedDe=this._minDe.getSym())};gc.prototype.interfaces_=function(){return[]};gc.prototype.getClass=function(){return gc};var Jh=function(i){function s(u,d){i.call(this,s.msgWithCoord(u,d)),this.pt=d?new Vt(d):null,this.name="TopologyException"}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.getCoordinate=function(){return this.pt},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.msgWithCoord=function(u,d){return d?u:u+" [ "+d+" ]"},s}(Yh),J0=function(){this.array_=[]};J0.prototype.addLast=function(i){this.array_.push(i)};J0.prototype.removeFirst=function(){return this.array_.shift()};J0.prototype.isEmpty=function(){return this.array_.length===0};var _a=function(){this._finder=null,this._dirEdgeList=new Pe,this._nodes=new Pe,this._rightMostCoord=null,this._env=null,this._finder=new gc};_a.prototype.clearVisitedEdges=function(){for(var i=this._dirEdgeList.iterator();i.hasNext();){var s=i.next();s.setVisited(!1)}};_a.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};_a.prototype.computeNodeDepth=function(i){for(var s=this,u=null,d=i.getEdges().iterator();d.hasNext();){var _=d.next();if(_.isVisited()||_.getSym().isVisited()){u=_;break}}if(u===null)throw new Jh("unable to find edge to compute depths at "+i.getCoordinate());i.getEdges().computeDepths(u);for(var b=i.getEdges().iterator();b.hasNext();){var C=b.next();C.setVisited(!0),s.copySymDepths(C)}};_a.prototype.computeDepth=function(i){this.clearVisitedEdges();var s=this._finder.getEdge();s.setEdgeDepths(be.RIGHT,i),this.copySymDepths(s),this.computeDepths(s)};_a.prototype.create=function(i){this.addReachable(i),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};_a.prototype.findResultEdges=function(){for(var i=this._dirEdgeList.iterator();i.hasNext();){var s=i.next();s.getDepth(be.RIGHT)>=1&&s.getDepth(be.LEFT)<=0&&!s.isInteriorAreaEdge()&&s.setInResult(!0)}};_a.prototype.computeDepths=function(i){var s=this,u=new Tb,d=new J0,_=i.getNode();for(d.addLast(_),u.add(_),i.setVisited(!0);!d.isEmpty();){var b=d.removeFirst();u.add(b),s.computeNodeDepth(b);for(var C=b.getEdges().iterator();C.hasNext();){var l=C.next(),V=l.getSym();if(!V.isVisited()){var R=V.getNode();u.contains(R)||(d.addLast(R),u.add(R))}}}};_a.prototype.compareTo=function(i){var s=i;return this._rightMostCoord.x<s._rightMostCoord.x?-1:this._rightMostCoord.x>s._rightMostCoord.x?1:0};_a.prototype.getEnvelope=function(){if(this._env===null){for(var i=new ir,s=this._dirEdgeList.iterator();s.hasNext();)for(var u=s.next(),d=u.getEdge().getCoordinates(),_=0;_<d.length-1;_++)i.expandToInclude(d[_]);this._env=i}return this._env};_a.prototype.addReachable=function(i){var s=this,u=new Sc;for(u.add(i);!u.empty();){var d=u.pop();s.add(d,u)}};_a.prototype.copySymDepths=function(i){var s=i.getSym();s.setDepth(be.LEFT,i.getDepth(be.RIGHT)),s.setDepth(be.RIGHT,i.getDepth(be.LEFT))};_a.prototype.add=function(i,s){var u=this;i.setVisited(!0),this._nodes.add(i);for(var d=i.getEdges().iterator();d.hasNext();){var _=d.next();u._dirEdgeList.add(_);var b=_.getSym(),C=b.getNode();C.isVisited()||s.push(C)}};_a.prototype.getNodes=function(){return this._nodes};_a.prototype.getDirectedEdges=function(){return this._dirEdgeList};_a.prototype.interfaces_=function(){return[fu]};_a.prototype.getClass=function(){return _a};var Ti=function i(){var s=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var u=arguments[0];this.init(u.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[be.ON]=d}else if(arguments[0]instanceof i){var _=arguments[0];if(this.init(_.location.length),_!==null)for(var b=0;b<this.location.length;b++)s.location[b]=_.location[b]}}else if(arguments.length===3){var C=arguments[0],l=arguments[1],V=arguments[2];this.init(3),this.location[be.ON]=C,this.location[be.LEFT]=l,this.location[be.RIGHT]=V}};Ti.prototype.setAllLocations=function(i){for(var s=this,u=0;u<this.location.length;u++)s.location[u]=i};Ti.prototype.isNull=function(){for(var i=this,s=0;s<this.location.length;s++)if(i.location[s]!==Xt.NONE)return!1;return!0};Ti.prototype.setAllLocationsIfNull=function(i){for(var s=this,u=0;u<this.location.length;u++)s.location[u]===Xt.NONE&&(s.location[u]=i)};Ti.prototype.isLine=function(){return this.location.length===1};Ti.prototype.merge=function(i){var s=this;if(i.location.length>this.location.length){var u=new Array(3).fill(null);u[be.ON]=this.location[be.ON],u[be.LEFT]=Xt.NONE,u[be.RIGHT]=Xt.NONE,this.location=u}for(var d=0;d<this.location.length;d++)s.location[d]===Xt.NONE&&d<i.location.length&&(s.location[d]=i.location[d])};Ti.prototype.getLocations=function(){return this.location};Ti.prototype.flip=function(){if(this.location.length<=1)return null;var i=this.location[be.LEFT];this.location[be.LEFT]=this.location[be.RIGHT],this.location[be.RIGHT]=i};Ti.prototype.toString=function(){var i=new wc;return this.location.length>1&&i.append(Xt.toLocationSymbol(this.location[be.LEFT])),i.append(Xt.toLocationSymbol(this.location[be.ON])),this.location.length>1&&i.append(Xt.toLocationSymbol(this.location[be.RIGHT])),i.toString()};Ti.prototype.setLocations=function(i,s,u){this.location[be.ON]=i,this.location[be.LEFT]=s,this.location[be.RIGHT]=u};Ti.prototype.get=function(i){return i<this.location.length?this.location[i]:Xt.NONE};Ti.prototype.isArea=function(){return this.location.length>1};Ti.prototype.isAnyNull=function(){for(var i=this,s=0;s<this.location.length;s++)if(i.location[s]===Xt.NONE)return!0;return!1};Ti.prototype.setLocation=function(){if(arguments.length===1){var i=arguments[0];this.setLocation(be.ON,i)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];this.location[s]=u}};Ti.prototype.init=function(i){this.location=new Array(i).fill(null),this.setAllLocations(Xt.NONE)};Ti.prototype.isEqualOnSide=function(i,s){return this.location[s]===i.location[s]};Ti.prototype.allPositionsEqual=function(i){for(var s=this,u=0;u<this.location.length;u++)if(s.location[u]!==i)return!1;return!0};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};var Kn=function i(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new Ti(s),this.elt[1]=new Ti(s)}else if(arguments[0]instanceof i){var u=arguments[0];this.elt[0]=new Ti(u.elt[0]),this.elt[1]=new Ti(u.elt[1])}}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.elt[0]=new Ti(Xt.NONE),this.elt[1]=new Ti(Xt.NONE),this.elt[d].setLocation(_)}else if(arguments.length===3){var b=arguments[0],C=arguments[1],l=arguments[2];this.elt[0]=new Ti(b,C,l),this.elt[1]=new Ti(b,C,l)}else if(arguments.length===4){var V=arguments[0],R=arguments[1],et=arguments[2],at=arguments[3];this.elt[0]=new Ti(Xt.NONE,Xt.NONE,Xt.NONE),this.elt[1]=new Ti(Xt.NONE,Xt.NONE,Xt.NONE),this.elt[V].setLocations(R,et,at)}};Kn.prototype.getGeometryCount=function(){var i=0;return this.elt[0].isNull()||i++,this.elt[1].isNull()||i++,i};Kn.prototype.setAllLocations=function(i,s){this.elt[i].setAllLocations(s)};Kn.prototype.isNull=function(i){return this.elt[i].isNull()};Kn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var i=arguments[0];this.setAllLocationsIfNull(0,i),this.setAllLocationsIfNull(1,i)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];this.elt[s].setAllLocationsIfNull(u)}};Kn.prototype.isLine=function(i){return this.elt[i].isLine()};Kn.prototype.merge=function(i){for(var s=this,u=0;u<2;u++)s.elt[u]===null&&i.elt[u]!==null?s.elt[u]=new Ti(i.elt[u]):s.elt[u].merge(i.elt[u])};Kn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Kn.prototype.getLocation=function(){if(arguments.length===1){var i=arguments[0];return this.elt[i].get(be.ON)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];return this.elt[s].get(u)}};Kn.prototype.toString=function(){var i=new wc;return this.elt[0]!==null&&(i.append("A:"),i.append(this.elt[0].toString())),this.elt[1]!==null&&(i.append(" B:"),i.append(this.elt[1].toString())),i.toString()};Kn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var i=arguments[0];return this.elt[i].isArea()}};Kn.prototype.isAnyNull=function(i){return this.elt[i].isAnyNull()};Kn.prototype.setLocation=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.elt[i].setLocation(be.ON,s)}else if(arguments.length===3){var u=arguments[0],d=arguments[1],_=arguments[2];this.elt[u].setLocation(d,_)}};Kn.prototype.isEqualOnSide=function(i,s){return this.elt[0].isEqualOnSide(i.elt[0],s)&&this.elt[1].isEqualOnSide(i.elt[1],s)};Kn.prototype.allPositionsEqual=function(i,s){return this.elt[i].allPositionsEqual(s)};Kn.prototype.toLine=function(i){this.elt[i].isArea()&&(this.elt[i]=new Ti(this.elt[i].location[0]))};Kn.prototype.interfaces_=function(){return[]};Kn.prototype.getClass=function(){return Kn};Kn.toLineLabel=function(i){for(var s=new Kn(Xt.NONE),u=0;u<2;u++)s.setLocation(u,i.getLocation(u));return s};var Oo=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Pe,this._pts=new Pe,this._label=new Kn(Xt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Pe,this._geometryFactory=null;var i=arguments[0],s=arguments[1];this._geometryFactory=s,this.computePoints(i),this.computeRing()};Oo.prototype.computeRing=function(){var i=this;if(this._ring!==null)return null;for(var s=new Array(this._pts.size()).fill(null),u=0;u<this._pts.size();u++)s[u]=i._pts.get(u);this._ring=this._geometryFactory.createLinearRing(s),this._isHole=Fe.isCCW(this._ring.getCoordinates())};Oo.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Oo.prototype.computePoints=function(i){var s=this;this._startDe=i;var u=i,d=!0;do{if(u===null)throw new Jh("Found null DirectedEdge");if(u.getEdgeRing()===s)throw new Jh("Directed Edge visited twice during ring-building at "+u.getCoordinate());s._edges.add(u);var _=u.getLabel();Nr.isTrue(_.isArea()),s.mergeLabel(_),s.addPoints(u.getEdge(),u.isForward(),d),d=!1,s.setEdgeRing(u,s),u=s.getNext(u)}while(u!==this._startDe)};Oo.prototype.getLinearRing=function(){return this._ring};Oo.prototype.getCoordinate=function(i){return this._pts.get(i)};Oo.prototype.computeMaxNodeDegree=function(){var i=this;this._maxNodeDegree=0;var s=this._startDe;do{var u=s.getNode(),d=u.getEdges().getOutgoingDegree(i);d>i._maxNodeDegree&&(i._maxNodeDegree=d),s=i.getNext(s)}while(s!==this._startDe);this._maxNodeDegree*=2};Oo.prototype.addPoints=function(i,s,u){var d=this,_=i.getCoordinates();if(s){var b=1;u&&(b=0);for(var C=b;C<_.length;C++)d._pts.add(_[C])}else{var l=_.length-2;u&&(l=_.length-1);for(var V=l;V>=0;V--)d._pts.add(_[V])}};Oo.prototype.isHole=function(){return this._isHole};Oo.prototype.setInResult=function(){var i=this._startDe;do i.getEdge().setInResult(!0),i=i.getNext();while(i!==this._startDe)};Oo.prototype.containsPoint=function(i){var s=this.getLinearRing(),u=s.getEnvelopeInternal();if(!u.contains(i)||!Fe.isPointInRing(i,s.getCoordinates()))return!1;for(var d=this._holes.iterator();d.hasNext();){var _=d.next();if(_.containsPoint(i))return!1}return!0};Oo.prototype.addHole=function(i){this._holes.add(i)};Oo.prototype.isShell=function(){return this._shell===null};Oo.prototype.getLabel=function(){return this._label};Oo.prototype.getEdges=function(){return this._edges};Oo.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Oo.prototype.getShell=function(){return this._shell};Oo.prototype.mergeLabel=function(){if(arguments.length===1){var i=arguments[0];this.mergeLabel(i,0),this.mergeLabel(i,1)}else if(arguments.length===2){var s=arguments[0],u=arguments[1],d=s.getLocation(u,be.RIGHT);if(d===Xt.NONE)return null;if(this._label.getLocation(u)===Xt.NONE)return this._label.setLocation(u,d),null}};Oo.prototype.setShell=function(i){this._shell=i,i!==null&&i.addHole(this)};Oo.prototype.toPolygon=function(i){for(var s=this,u=new Array(this._holes.size()).fill(null),d=0;d<this._holes.size();d++)u[d]=s._holes.get(d).getLinearRing();var _=i.createPolygon(this.getLinearRing(),u);return _};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};var hA=function(i){function s(){var u=arguments[0],d=arguments[1];i.call(this,u,d)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.setEdgeRing=function(u,d){u.setMinEdgeRing(d)},s.prototype.getNext=function(u){return u.getNextMin()},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Oo),pA=function(i){function s(){var u=arguments[0],d=arguments[1];i.call(this,u,d)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.buildMinimalRings=function(){var u=this,d=new Pe,_=this._startDe;do{if(_.getMinEdgeRing()===null){var b=new hA(_,u._geometryFactory);d.add(b)}_=_.getNext()}while(_!==this._startDe);return d},s.prototype.setEdgeRing=function(u,d){u.setEdgeRing(d)},s.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var u=this,d=this._startDe;do{var _=d.getNode();_.getEdges().linkMinimalDirectedEdges(u),d=d.getNext()}while(d!==this._startDe)},s.prototype.getNext=function(u){return u.getNext()},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Oo),Fl=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var i=arguments[0];this._label=i}};Fl.prototype.setVisited=function(i){this._isVisited=i};Fl.prototype.setInResult=function(i){this._isInResult=i};Fl.prototype.isCovered=function(){return this._isCovered};Fl.prototype.isCoveredSet=function(){return this._isCoveredSet};Fl.prototype.setLabel=function(i){this._label=i};Fl.prototype.getLabel=function(){return this._label};Fl.prototype.setCovered=function(i){this._isCovered=i,this._isCoveredSet=!0};Fl.prototype.updateIM=function(i){Nr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(i)};Fl.prototype.isInResult=function(){return this._isInResult};Fl.prototype.isVisited=function(){return this._isVisited};Fl.prototype.interfaces_=function(){return[]};Fl.prototype.getClass=function(){return Fl};var K0=function(i){function s(){i.call(this),this._coord=null,this._edges=null;var u=arguments[0],d=arguments[1];this._coord=u,this._edges=d,this._label=new Kn(0,Xt.NONE)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.isIncidentEdgeInResult=function(){for(var u=this.getEdges().getEdges().iterator();u.hasNext();){var d=u.next();if(d.getEdge().isInResult())return!0}return!1},s.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},s.prototype.getCoordinate=function(){return this._coord},s.prototype.print=function(u){u.println("node "+this._coord+" lbl: "+this._label)},s.prototype.computeIM=function(u){},s.prototype.computeMergedLocation=function(u,d){var _=Xt.NONE;if(_=this._label.getLocation(d),!u.isNull(d)){var b=u.getLocation(d);_!==Xt.BOUNDARY&&(_=b)}return _},s.prototype.setLabel=function(){if(arguments.length===2){var u=arguments[0],d=arguments[1];this._label===null?this._label=new Kn(u,d):this._label.setLocation(u,d)}else return i.prototype.setLabel.apply(this,arguments)},s.prototype.getEdges=function(){return this._edges},s.prototype.mergeLabel=function(){var u=this;if(arguments[0]instanceof s){var d=arguments[0];this.mergeLabel(d._label)}else if(arguments[0]instanceof Kn)for(var _=arguments[0],b=0;b<2;b++){var C=u.computeMergedLocation(_,b),l=u._label.getLocation(b);l===Xt.NONE&&u._label.setLocation(b,C)}},s.prototype.add=function(u){this._edges.insert(u),u.setNode(this)},s.prototype.setLabelBoundary=function(u){if(this._label===null)return null;var d=Xt.NONE;this._label!==null&&(d=this._label.getLocation(u));var _=null;switch(d){case Xt.BOUNDARY:_=Xt.INTERIOR;break;case Xt.INTERIOR:_=Xt.BOUNDARY;break;default:_=Xt.BOUNDARY;break}this._label.setLocation(u,_)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Fl),yc=function(){this.nodeMap=new ta,this.nodeFact=null;var i=arguments[0];this.nodeFact=i};yc.prototype.find=function(i){return this.nodeMap.get(i)};yc.prototype.addNode=function(){if(arguments[0]instanceof Vt){var i=arguments[0],s=this.nodeMap.get(i);return s===null&&(s=this.nodeFact.createNode(i),this.nodeMap.put(i,s)),s}else if(arguments[0]instanceof K0){var u=arguments[0],d=this.nodeMap.get(u.getCoordinate());return d===null?(this.nodeMap.put(u.getCoordinate(),u),u):(d.mergeLabel(u),d)}};yc.prototype.print=function(i){for(var s=this.iterator();s.hasNext();){var u=s.next();u.print(i)}};yc.prototype.iterator=function(){return this.nodeMap.values().iterator()};yc.prototype.values=function(){return this.nodeMap.values()};yc.prototype.getBoundaryNodes=function(i){for(var s=new Pe,u=this.iterator();u.hasNext();){var d=u.next();d.getLabel().getLocation(i)===Xt.BOUNDARY&&s.add(d)}return s};yc.prototype.add=function(i){var s=i.getCoordinate(),u=this.addNode(s);u.add(i)};yc.prototype.interfaces_=function(){return[]};yc.prototype.getClass=function(){return yc};var hi=function(){},Jy={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};hi.prototype.interfaces_=function(){return[]};hi.prototype.getClass=function(){return hi};hi.isNorthern=function(i){return i===hi.NE||i===hi.NW};hi.isOpposite=function(i,s){if(i===s)return!1;var u=(i-s+4)%4;return u===2};hi.commonHalfPlane=function(i,s){if(i===s)return i;var u=(i-s+4)%4;if(u===2)return-1;var d=i<s?i:s,_=i>s?i:s;return d===0&&_===3?3:d};hi.isInHalfPlane=function(i,s){return s===hi.SE?i===hi.SE||i===hi.SW:i===s||i===s+1};hi.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new $i("Cannot compute the quadrant for point ( "+i+", "+s+" )");return i>=0?s>=0?hi.NE:hi.SE:s>=0?hi.NW:hi.SW}else if(arguments[0]instanceof Vt&&arguments[1]instanceof Vt){var u=arguments[0],d=arguments[1];if(d.x===u.x&&d.y===u.y)throw new $i("Cannot compute the quadrant for two identical points "+u);return d.x>=u.x?d.y>=u.y?hi.NE:hi.SE:d.y>=u.y?hi.NW:hi.SW}};Jy.NE.get=function(){return 0};Jy.NW.get=function(){return 1};Jy.SW.get=function(){return 2};Jy.SE.get=function(){return 3};Object.defineProperties(hi,Jy);var ea=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var i=arguments[0];this._edge=i}else if(arguments.length===3){var s=arguments[0],u=arguments[1],d=arguments[2],_=null;this._edge=s,this.init(u,d),this._label=_}else if(arguments.length===4){var b=arguments[0],C=arguments[1],l=arguments[2],V=arguments[3];this._edge=b,this.init(C,l),this._label=V}};ea.prototype.compareDirection=function(i){return this._dx===i._dx&&this._dy===i._dy?0:this._quadrant>i._quadrant?1:this._quadrant<i._quadrant?-1:Fe.computeOrientation(i._p0,i._p1,this._p1)};ea.prototype.getDy=function(){return this._dy};ea.prototype.getCoordinate=function(){return this._p0};ea.prototype.setNode=function(i){this._node=i};ea.prototype.print=function(i){var s=Math.atan2(this._dy,this._dx),u=this.getClass().getName(),d=u.lastIndexOf("."),_=u.substring(d+1);i.print("  "+_+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label)};ea.prototype.compareTo=function(i){var s=i;return this.compareDirection(s)};ea.prototype.getDirectedCoordinate=function(){return this._p1};ea.prototype.getDx=function(){return this._dx};ea.prototype.getLabel=function(){return this._label};ea.prototype.getEdge=function(){return this._edge};ea.prototype.getQuadrant=function(){return this._quadrant};ea.prototype.getNode=function(){return this._node};ea.prototype.toString=function(){var i=Math.atan2(this._dy,this._dx),s=this.getClass().getName(),u=s.lastIndexOf("."),d=s.substring(u+1);return"  "+d+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label};ea.prototype.computeLabel=function(i){};ea.prototype.init=function(i,s){this._p0=i,this._p1=s,this._dx=s.x-i.x,this._dy=s.y-i.y,this._quadrant=hi.quadrant(this._dx,this._dy),Nr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};ea.prototype.interfaces_=function(){return[fu]};ea.prototype.getClass=function(){return ea};var wb=function(i){function s(){var u=arguments[0],d=arguments[1];if(i.call(this,u),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=d,d)this.init(u.getCoordinate(0),u.getCoordinate(1));else{var _=u.getNumPoints()-1;this.init(u.getCoordinate(_),u.getCoordinate(_-1))}this.computeDirectedLabel()}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.getNextMin=function(){return this._nextMin},s.prototype.getDepth=function(u){return this._depth[u]},s.prototype.setVisited=function(u){this._isVisited=u},s.prototype.computeDirectedLabel=function(){this._label=new Kn(this._edge.getLabel()),this._isForward||this._label.flip()},s.prototype.getNext=function(){return this._next},s.prototype.setDepth=function(u,d){if(this._depth[u]!==-999&&this._depth[u]!==d)throw new Jh("assigned depths do not match",this.getCoordinate());this._depth[u]=d},s.prototype.isInteriorAreaEdge=function(){for(var u=this,d=!0,_=0;_<2;_++)u._label.isArea(_)&&u._label.getLocation(_,be.LEFT)===Xt.INTERIOR&&u._label.getLocation(_,be.RIGHT)===Xt.INTERIOR||(d=!1);return d},s.prototype.setNextMin=function(u){this._nextMin=u},s.prototype.print=function(u){i.prototype.print.call(this,u),u.print(" "+this._depth[be.LEFT]+"/"+this._depth[be.RIGHT]),u.print(" ("+this.getDepthDelta()+")"),this._isInResult&&u.print(" inResult")},s.prototype.setMinEdgeRing=function(u){this._minEdgeRing=u},s.prototype.isLineEdge=function(){var u=this._label.isLine(0)||this._label.isLine(1),d=!this._label.isArea(0)||this._label.allPositionsEqual(0,Xt.EXTERIOR),_=!this._label.isArea(1)||this._label.allPositionsEqual(1,Xt.EXTERIOR);return u&&d&&_},s.prototype.setEdgeRing=function(u){this._edgeRing=u},s.prototype.getMinEdgeRing=function(){return this._minEdgeRing},s.prototype.getDepthDelta=function(){var u=this._edge.getDepthDelta();return this._isForward||(u=-u),u},s.prototype.setInResult=function(u){this._isInResult=u},s.prototype.getSym=function(){return this._sym},s.prototype.isForward=function(){return this._isForward},s.prototype.getEdge=function(){return this._edge},s.prototype.printEdge=function(u){this.print(u),u.print(" "),this._isForward?this._edge.print(u):this._edge.printReverse(u)},s.prototype.setSym=function(u){this._sym=u},s.prototype.setVisitedEdge=function(u){this.setVisited(u),this._sym.setVisited(u)},s.prototype.setEdgeDepths=function(u,d){var _=this.getEdge().getDepthDelta();this._isForward||(_=-_);var b=1;u===be.LEFT&&(b=-1);var C=be.opposite(u),l=_*b,V=d+l;this.setDepth(u,d),this.setDepth(C,V)},s.prototype.getEdgeRing=function(){return this._edgeRing},s.prototype.isInResult=function(){return this._isInResult},s.prototype.setNext=function(u){this._next=u},s.prototype.isVisited=function(){return this._isVisited},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.depthFactor=function(u,d){return u===Xt.EXTERIOR&&d===Xt.INTERIOR?1:u===Xt.INTERIOR&&d===Xt.EXTERIOR?-1:0},s}(ea),wm=function(){};wm.prototype.createNode=function(i){return new K0(i,null)};wm.prototype.interfaces_=function(){return[]};wm.prototype.getClass=function(){return wm};var io=function(){if(this._edges=new Pe,this._nodes=null,this._edgeEndList=new Pe,arguments.length===0)this._nodes=new yc(new wm);else if(arguments.length===1){var i=arguments[0];this._nodes=new yc(i)}};io.prototype.printEdges=function(i){var s=this;i.println("Edges:");for(var u=0;u<this._edges.size();u++){i.println("edge "+u+":");var d=s._edges.get(u);d.print(i),d.eiList.print(i)}};io.prototype.find=function(i){return this._nodes.find(i)};io.prototype.addNode=function(){if(arguments[0]instanceof K0){var i=arguments[0];return this._nodes.addNode(i)}else if(arguments[0]instanceof Vt){var s=arguments[0];return this._nodes.addNode(s)}};io.prototype.getNodeIterator=function(){return this._nodes.iterator()};io.prototype.linkResultDirectedEdges=function(){for(var i=this._nodes.iterator();i.hasNext();){var s=i.next();s.getEdges().linkResultDirectedEdges()}};io.prototype.debugPrintln=function(i){Ds.out.println(i)};io.prototype.isBoundaryNode=function(i,s){var u=this._nodes.find(s);if(u===null)return!1;var d=u.getLabel();return d!==null&&d.getLocation(i)===Xt.BOUNDARY};io.prototype.linkAllDirectedEdges=function(){for(var i=this._nodes.iterator();i.hasNext();){var s=i.next();s.getEdges().linkAllDirectedEdges()}};io.prototype.matchInSameDirection=function(i,s,u,d){return i.equals(u)?Fe.computeOrientation(i,s,d)===Fe.COLLINEAR&&hi.quadrant(i,s)===hi.quadrant(u,d):!1};io.prototype.getEdgeEnds=function(){return this._edgeEndList};io.prototype.debugPrint=function(i){Ds.out.print(i)};io.prototype.getEdgeIterator=function(){return this._edges.iterator()};io.prototype.findEdgeInSameDirection=function(i,s){for(var u=this,d=0;d<this._edges.size();d++){var _=u._edges.get(d),b=_.getCoordinates();if(u.matchInSameDirection(i,s,b[0],b[1])||u.matchInSameDirection(i,s,b[b.length-1],b[b.length-2]))return _}return null};io.prototype.insertEdge=function(i){this._edges.add(i)};io.prototype.findEdgeEnd=function(i){for(var s=this.getEdgeEnds().iterator();s.hasNext();){var u=s.next();if(u.getEdge()===i)return u}return null};io.prototype.addEdges=function(i){for(var s=this,u=i.iterator();u.hasNext();){var d=u.next();s._edges.add(d);var _=new wb(d,!0),b=new wb(d,!1);_.setSym(b),b.setSym(_),s.add(_),s.add(b)}};io.prototype.add=function(i){this._nodes.add(i),this._edgeEndList.add(i)};io.prototype.getNodes=function(){return this._nodes.values()};io.prototype.findEdge=function(i,s){for(var u=this,d=0;d<this._edges.size();d++){var _=u._edges.get(d),b=_.getCoordinates();if(i.equals(b[0])&&s.equals(b[1]))return _}return null};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};io.linkResultDirectedEdges=function(i){for(var s=i.iterator();s.hasNext();){var u=s.next();u.getEdges().linkResultDirectedEdges()}};var sl=function(){this._geometryFactory=null,this._shellList=new Pe;var i=arguments[0];this._geometryFactory=i};sl.prototype.sortShellsAndHoles=function(i,s,u){for(var d=i.iterator();d.hasNext();){var _=d.next();_.isHole()?u.add(_):s.add(_)}};sl.prototype.computePolygons=function(i){for(var s=this,u=new Pe,d=i.iterator();d.hasNext();){var _=d.next(),b=_.toPolygon(s._geometryFactory);u.add(b)}return u};sl.prototype.placeFreeHoles=function(i,s){for(var u=this,d=s.iterator();d.hasNext();){var _=d.next();if(_.getShell()===null){var b=u.findEdgeRingContaining(_,i);if(b===null)throw new Jh("unable to assign hole to a shell",_.getCoordinate(0));_.setShell(b)}}};sl.prototype.buildMinimalEdgeRings=function(i,s,u){for(var d=this,_=new Pe,b=i.iterator();b.hasNext();){var C=b.next();if(C.getMaxNodeDegree()>2){C.linkDirectedEdgesForMinimalEdgeRings();var l=C.buildMinimalRings(),V=d.findShell(l);V!==null?(d.placePolygonHoles(V,l),s.add(V)):u.addAll(l)}else _.add(C)}return _};sl.prototype.containsPoint=function(i){for(var s=this._shellList.iterator();s.hasNext();){var u=s.next();if(u.containsPoint(i))return!0}return!1};sl.prototype.buildMaximalEdgeRings=function(i){for(var s=this,u=new Pe,d=i.iterator();d.hasNext();){var _=d.next();if(_.isInResult()&&_.getLabel().isArea()&&_.getEdgeRing()===null){var b=new pA(_,s._geometryFactory);u.add(b),b.setInResult()}}return u};sl.prototype.placePolygonHoles=function(i,s){for(var u=s.iterator();u.hasNext();){var d=u.next();d.isHole()&&d.setShell(i)}};sl.prototype.getPolygons=function(){var i=this.computePolygons(this._shellList);return i};sl.prototype.findEdgeRingContaining=function(i,s){for(var u=i.getLinearRing(),d=u.getEnvelopeInternal(),_=u.getCoordinateN(0),b=null,C=null,l=s.iterator();l.hasNext();){var V=l.next(),R=V.getLinearRing(),et=R.getEnvelopeInternal();b!==null&&(C=b.getLinearRing().getEnvelopeInternal());var at=!1;et.contains(d)&&Fe.isPointInRing(_,R.getCoordinates())&&(at=!0),at&&(b===null||C.contains(et))&&(b=V)}return b};sl.prototype.findShell=function(i){for(var s=0,u=null,d=i.iterator();d.hasNext();){var _=d.next();_.isHole()||(u=_,s++)}return Nr.isTrue(s<=1,"found two shells in MinimalEdgeRing list"),u};sl.prototype.add=function(){if(arguments.length===1){var i=arguments[0];this.add(i.getEdgeEnds(),i.getNodes())}else if(arguments.length===2){var s=arguments[0],u=arguments[1];io.linkResultDirectedEdges(u);var d=this.buildMaximalEdgeRings(s),_=new Pe,b=this.buildMinimalEdgeRings(d,this._shellList,_);this.sortShellsAndHoles(b,this._shellList,_),this.placeFreeHoles(this._shellList,_)}};sl.prototype.interfaces_=function(){return[]};sl.prototype.getClass=function(){return sl};var Sm=function(){};Sm.prototype.getBounds=function(){};Sm.prototype.interfaces_=function(){return[]};Sm.prototype.getClass=function(){return Sm};var Zu=function(){this._bounds=null,this._item=null;var i=arguments[0],s=arguments[1];this._bounds=i,this._item=s};Zu.prototype.getItem=function(){return this._item};Zu.prototype.getBounds=function(){return this._bounds};Zu.prototype.interfaces_=function(){return[Sm,mu]};Zu.prototype.getClass=function(){return Zu};var Kh=function(){this._size=null,this._items=null,this._size=0,this._items=new Pe,this._items.add(null)};Kh.prototype.poll=function(){if(this.isEmpty())return null;var i=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),i};Kh.prototype.size=function(){return this._size};Kh.prototype.reorder=function(i){for(var s=this,u=null,d=this._items.get(i);i*2<=this._size&&(u=i*2,u!==s._size&&s._items.get(u+1).compareTo(s._items.get(u))<0&&u++,s._items.get(u).compareTo(d)<0);i=u)s._items.set(i,s._items.get(u));this._items.set(i,d)};Kh.prototype.clear=function(){this._size=0,this._items.clear()};Kh.prototype.isEmpty=function(){return this._size===0};Kh.prototype.add=function(i){var s=this;this._items.add(null),this._size+=1;var u=this._size;for(this._items.set(0,i);i.compareTo(this._items.get(Math.trunc(u/2)))<0;u/=2)s._items.set(u,s._items.get(Math.trunc(u/2)));this._items.set(u,i)};Kh.prototype.interfaces_=function(){return[]};Kh.prototype.getClass=function(){return Kh};var Vp=function(){};Vp.prototype.visitItem=function(i){};Vp.prototype.interfaces_=function(){return[]};Vp.prototype.getClass=function(){return Vp};var xf=function(){};xf.prototype.insert=function(i,s){};xf.prototype.remove=function(i,s){};xf.prototype.query=function(){};xf.prototype.interfaces_=function(){return[]};xf.prototype.getClass=function(){return xf};var Wo=function(){if(this._childBoundables=new Pe,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var i=arguments[0];this._level=i}},KE={serialVersionUID:{configurable:!0}};Wo.prototype.getLevel=function(){return this._level};Wo.prototype.size=function(){return this._childBoundables.size()};Wo.prototype.getChildBoundables=function(){return this._childBoundables};Wo.prototype.addChildBoundable=function(i){Nr.isTrue(this._bounds===null),this._childBoundables.add(i)};Wo.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Wo.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Wo.prototype.interfaces_=function(){return[Sm,mu]};Wo.prototype.getClass=function(){return Wo};KE.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Wo,KE);var Xu=function(){};Xu.reverseOrder=function(){return{compare:function(i,s){return s.compareTo(i)}}};Xu.min=function(i){return Xu.sort(i),i.get(0)};Xu.sort=function(i,s){var u=i.toArray();s?id.sort(u,s):id.sort(u);for(var d=i.iterator(),_=0,b=u.length;_<b;_++)d.next(),d.set(u[_])};Xu.singletonList=function(i){var s=new Pe;return s.add(i),s};var zo=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var i=arguments[0],s=arguments[1],u=arguments[2];this._boundable1=i,this._boundable2=s,this._itemDistance=u,this._distance=this.distance()};zo.prototype.expandToQueue=function(i,s){var u=zo.isComposite(this._boundable1),d=zo.isComposite(this._boundable2);if(u&&d)return zo.area(this._boundable1)>zo.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,i,s),null):(this.expand(this._boundable2,this._boundable1,i,s),null);if(u)return this.expand(this._boundable1,this._boundable2,i,s),null;if(d)return this.expand(this._boundable2,this._boundable1,i,s),null;throw new $i("neither boundable is composite")};zo.prototype.isLeaves=function(){return!(zo.isComposite(this._boundable1)||zo.isComposite(this._boundable2))};zo.prototype.compareTo=function(i){var s=i;return this._distance<s._distance?-1:this._distance>s._distance?1:0};zo.prototype.expand=function(i,s,u,d){for(var _=this,b=i.getChildBoundables(),C=b.iterator();C.hasNext();){var l=C.next(),V=new zo(l,s,_._itemDistance);V.getDistance()<d&&u.add(V)}};zo.prototype.getBoundable=function(i){return i===0?this._boundable1:this._boundable2};zo.prototype.getDistance=function(){return this._distance};zo.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};zo.prototype.interfaces_=function(){return[fu]};zo.prototype.getClass=function(){return zo};zo.area=function(i){return i.getBounds().getArea()};zo.isComposite=function(i){return i instanceof Wo};var xs=function i(){if(this._root=null,this._built=!1,this._itemBoundables=new Pe,this._nodeCapacity=null,arguments.length===0){var s=i.DEFAULT_NODE_CAPACITY;this._nodeCapacity=s}else if(arguments.length===1){var u=arguments[0];Nr.isTrue(u>1,"Node capacity must be greater than 1"),this._nodeCapacity=u}},Q0={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};xs.prototype.getNodeCapacity=function(){return this._nodeCapacity};xs.prototype.lastNode=function(i){return i.get(i.size()-1)};xs.prototype.size=function(){var i=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var s=arguments[0],u=0,d=s.getChildBoundables().iterator();d.hasNext();){var _=d.next();_ instanceof Wo?u+=i.size(_):_ instanceof Zu&&(u+=1)}return u}};xs.prototype.removeItem=function(i,s){for(var u=null,d=i.getChildBoundables().iterator();d.hasNext();){var _=d.next();_ instanceof Zu&&_.getItem()===s&&(u=_)}return u!==null?(i.getChildBoundables().remove(u),!0):!1};xs.prototype.itemsTree=function(){var i=this;if(arguments.length===0){this.build();var s=this.itemsTree(this._root);return s===null?new Pe:s}else if(arguments.length===1){for(var u=arguments[0],d=new Pe,_=u.getChildBoundables().iterator();_.hasNext();){var b=_.next();if(b instanceof Wo){var C=i.itemsTree(b);C!==null&&d.add(C)}else b instanceof Zu?d.add(b.getItem()):Nr.shouldNeverReachHere()}return d.size()<=0?null:d}};xs.prototype.insert=function(i,s){Nr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Zu(i,s))};xs.prototype.boundablesAtLevel=function(){var i=this;if(arguments.length===1){var s=arguments[0],u=new Pe;return this.boundablesAtLevel(s,this._root,u),u}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2];if(Nr.isTrue(d>-2),_.getLevel()===d)return b.add(_),null;for(var C=_.getChildBoundables().iterator();C.hasNext();){var l=C.next();l instanceof Wo?i.boundablesAtLevel(d,l,b):(Nr.isTrue(l instanceof Zu),d===-1&&b.add(l))}return null}};xs.prototype.query=function(){var i=this;if(arguments.length===1){var s=arguments[0];this.build();var u=new Pe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),s)&&this.query(s,this._root,u),u}else if(arguments.length===2){var d=arguments[0],_=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),d)&&this.query(d,this._root,_)}else if(arguments.length===3){if(xr(arguments[2],Vp)&&arguments[0]instanceof Object&&arguments[1]instanceof Wo)for(var b=arguments[0],C=arguments[1],l=arguments[2],V=C.getChildBoundables(),R=0;R<V.size();R++){var et=V.get(R);i.getIntersectsOp().intersects(et.getBounds(),b)&&(et instanceof Wo?i.query(b,et,l):et instanceof Zu?l.visitItem(et.getItem()):Nr.shouldNeverReachHere())}else if(xr(arguments[2],Gu)&&arguments[0]instanceof Object&&arguments[1]instanceof Wo)for(var at=arguments[0],st=arguments[1],yt=arguments[2],xt=st.getChildBoundables(),It=0;It<xt.size();It++){var Pt=xt.get(It);i.getIntersectsOp().intersects(Pt.getBounds(),at)&&(Pt instanceof Wo?i.query(at,Pt,yt):Pt instanceof Zu?yt.add(Pt.getItem()):Nr.shouldNeverReachHere())}}};xs.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};xs.prototype.getRoot=function(){return this.build(),this._root};xs.prototype.remove=function(){var i=this;if(arguments.length===2){var s=arguments[0],u=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),s)?this.remove(s,this._root,u):!1}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2],C=this.removeItem(_,b);if(C)return!0;for(var l=null,V=_.getChildBoundables().iterator();V.hasNext();){var R=V.next();if(i.getIntersectsOp().intersects(R.getBounds(),d)&&R instanceof Wo&&(C=i.remove(d,R,b),C)){l=R;break}}return l!==null&&l.getChildBoundables().isEmpty()&&_.getChildBoundables().remove(l),C}};xs.prototype.createHigherLevels=function(i,s){Nr.isTrue(!i.isEmpty());var u=this.createParentBoundables(i,s+1);return u.size()===1?u.get(0):this.createHigherLevels(u,s+1)};xs.prototype.depth=function(){var i=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var s=arguments[0],u=0,d=s.getChildBoundables().iterator();d.hasNext();){var _=d.next();if(_ instanceof Wo){var b=i.depth(_);b>u&&(u=b)}}return u+1}};xs.prototype.createParentBoundables=function(i,s){var u=this;Nr.isTrue(!i.isEmpty());var d=new Pe;d.add(this.createNode(s));var _=new Pe(i);Xu.sort(_,this.getComparator());for(var b=_.iterator();b.hasNext();){var C=b.next();u.lastNode(d).getChildBoundables().size()===u.getNodeCapacity()&&d.add(u.createNode(s)),u.lastNode(d).addChildBoundable(C)}return d};xs.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};xs.prototype.interfaces_=function(){return[mu]};xs.prototype.getClass=function(){return xs};xs.compareDoubles=function(i,s){return i>s?1:i<s?-1:0};Q0.IntersectsOp.get=function(){return dA};Q0.serialVersionUID.get=function(){return-3886435814360241e3};Q0.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(xs,Q0);var dA=function(){},Em=function(){};Em.prototype.distance=function(i,s){};Em.prototype.interfaces_=function(){return[]};Em.prototype.getClass=function(){return Em};var QE=function(i){function s(d){d=d||s.DEFAULT_NODE_CAPACITY,i.call(this,d)}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return s.prototype.createParentBoundablesFromVerticalSlices=function(d,_){var b=this;Nr.isTrue(d.length>0);for(var C=new Pe,l=0;l<d.length;l++)C.addAll(b.createParentBoundablesFromVerticalSlice(d[l],_));return C},s.prototype.createNode=function(d){return new UE(d)},s.prototype.size=function(){return arguments.length===0?i.prototype.size.call(this):i.prototype.size.apply(this,arguments)},s.prototype.insert=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];if(d.isNull())return null;i.prototype.insert.call(this,d,_)}else return i.prototype.insert.apply(this,arguments)},s.prototype.getIntersectsOp=function(){return s.intersectsOp},s.prototype.verticalSlices=function(d,_){for(var b=Math.trunc(Math.ceil(d.size()/_)),C=new Array(_).fill(null),l=d.iterator(),V=0;V<_;V++){C[V]=new Pe;for(var R=0;l.hasNext()&&R<b;){var et=l.next();C[V].add(et),R++}}return C},s.prototype.query=function(){if(arguments.length===1){var d=arguments[0];return i.prototype.query.call(this,d)}else if(arguments.length===2){var _=arguments[0],b=arguments[1];i.prototype.query.call(this,_,b)}else if(arguments.length===3){if(xr(arguments[2],Vp)&&arguments[0]instanceof Object&&arguments[1]instanceof Wo){var C=arguments[0],l=arguments[1],V=arguments[2];i.prototype.query.call(this,C,l,V)}else if(xr(arguments[2],Gu)&&arguments[0]instanceof Object&&arguments[1]instanceof Wo){var R=arguments[0],et=arguments[1],at=arguments[2];i.prototype.query.call(this,R,et,at)}}},s.prototype.getComparator=function(){return s.yComparator},s.prototype.createParentBoundablesFromVerticalSlice=function(d,_){return i.prototype.createParentBoundables.call(this,d,_)},s.prototype.remove=function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return i.prototype.remove.call(this,d,_)}else return i.prototype.remove.apply(this,arguments)},s.prototype.depth=function(){return arguments.length===0?i.prototype.depth.call(this):i.prototype.depth.apply(this,arguments)},s.prototype.createParentBoundables=function(d,_){Nr.isTrue(!d.isEmpty());var b=Math.trunc(Math.ceil(d.size()/this.getNodeCapacity())),C=new Pe(d);Xu.sort(C,s.xComparator);var l=this.verticalSlices(C,Math.trunc(Math.ceil(Math.sqrt(b))));return this.createParentBoundablesFromVerticalSlices(l,_)},s.prototype.nearestNeighbour=function(){if(arguments.length===1){if(xr(arguments[0],Em)){var d=arguments[0],_=new zo(this.getRoot(),this.getRoot(),d);return this.nearestNeighbour(_)}else if(arguments[0]instanceof zo){var b=arguments[0];return this.nearestNeighbour(b,Lr.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof s&&xr(arguments[1],Em)){var C=arguments[0],l=arguments[1],V=new zo(this.getRoot(),C.getRoot(),l);return this.nearestNeighbour(V)}else if(arguments[0]instanceof zo&&typeof arguments[1]=="number"){var R=arguments[0],et=arguments[1],at=et,st=null,yt=new Kh;for(yt.add(R);!yt.isEmpty()&&at>0;){var xt=yt.poll(),It=xt.getDistance();if(It>=at)break;xt.isLeaves()?(at=It,st=xt):xt.expandToQueue(yt,at)}return[st.getBoundable(0).getItem(),st.getBoundable(1).getItem()]}}else if(arguments.length===3){var Pt=arguments[0],qt=arguments[1],Qt=arguments[2],se=new Zu(Pt,qt),le=new zo(this.getRoot(),se,Qt);return this.nearestNeighbour(le)[0]}},s.prototype.interfaces_=function(){return[xf,mu]},s.prototype.getClass=function(){return s},s.centreX=function(d){return s.avg(d.getMinX(),d.getMaxX())},s.avg=function(d,_){return(d+_)/2},s.centreY=function(d){return s.avg(d.getMinY(),d.getMaxY())},u.STRtreeNode.get=function(){return UE},u.serialVersionUID.get=function(){return 0x39920f7d5f261e0},u.xComparator.get=function(){return{interfaces_:function(){return[fm]},compare:function(d,_){return i.compareDoubles(s.centreX(d.getBounds()),s.centreX(_.getBounds()))}}},u.yComparator.get=function(){return{interfaces_:function(){return[fm]},compare:function(d,_){return i.compareDoubles(s.centreY(d.getBounds()),s.centreY(_.getBounds()))}}},u.intersectsOp.get=function(){return{interfaces_:function(){return[i.IntersectsOp]},intersects:function(d,_){return d.intersects(_)}}},u.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(s,u),s}(xs),UE=function(i){function s(){var u=arguments[0];i.call(this,u)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.computeBounds=function(){for(var u=null,d=this.getChildBoundables().iterator();d.hasNext();){var _=d.next();u===null?u=new ir(_.getBounds()):u.expandToInclude(_.getBounds())}return u},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Wo),Ra=function(){};Ra.prototype.interfaces_=function(){return[]};Ra.prototype.getClass=function(){return Ra};Ra.relativeSign=function(i,s){return i<s?-1:i>s?1:0};Ra.compare=function(i,s,u){if(s.equals2D(u))return 0;var d=Ra.relativeSign(s.x,u.x),_=Ra.relativeSign(s.y,u.y);switch(i){case 0:return Ra.compareValue(d,_);case 1:return Ra.compareValue(_,d);case 2:return Ra.compareValue(_,-d);case 3:return Ra.compareValue(-d,_);case 4:return Ra.compareValue(-d,-_);case 5:return Ra.compareValue(-_,-d);case 6:return Ra.compareValue(-_,d);case 7:return Ra.compareValue(d,-_)}return Nr.shouldNeverReachHere("invalid octant value"),0};Ra.compareValue=function(i,s){return i<0?-1:i>0?1:s<0?-1:s>0?1:0};var Up=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var i=arguments[0],s=arguments[1],u=arguments[2],d=arguments[3];this._segString=i,this.coord=new Vt(s),this.segmentIndex=u,this._segmentOctant=d,this._isInterior=!s.equals2D(i.getCoordinate(u))};Up.prototype.getCoordinate=function(){return this.coord};Up.prototype.print=function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex)};Up.prototype.compareTo=function(i){var s=i;return this.segmentIndex<s.segmentIndex?-1:this.segmentIndex>s.segmentIndex?1:this.coord.equals2D(s.coord)?0:Ra.compare(this._segmentOctant,this.coord,s.coord)};Up.prototype.isEndPoint=function(i){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===i};Up.prototype.isInterior=function(){return this._isInterior};Up.prototype.interfaces_=function(){return[fu]};Up.prototype.getClass=function(){return Up};var va=function(){this._nodeMap=new ta,this._edge=null;var i=arguments[0];this._edge=i};va.prototype.getSplitCoordinates=function(){var i=this,s=new Yy;this.addEndpoints();for(var u=this.iterator(),d=u.next();u.hasNext();){var _=u.next();i.addEdgeCoordinates(d,_,s),d=_}return s.toCoordinateArray()};va.prototype.addCollapsedNodes=function(){var i=this,s=new Pe;this.findCollapsesFromInsertedNodes(s),this.findCollapsesFromExistingVertices(s);for(var u=s.iterator();u.hasNext();){var d=u.next().intValue();i.add(i._edge.getCoordinate(d),d)}};va.prototype.print=function(i){i.println("Intersections:");for(var s=this.iterator();s.hasNext();){var u=s.next();u.print(i)}};va.prototype.findCollapsesFromExistingVertices=function(i){for(var s=this,u=0;u<this._edge.size()-2;u++){var d=s._edge.getCoordinate(u),_=s._edge.getCoordinate(u+2);d.equals2D(_)&&i.add(new pc(u+1))}};va.prototype.addEdgeCoordinates=function(i,s,u){var d=this,_=this._edge.getCoordinate(s.segmentIndex),b=s.isInterior()||!s.coord.equals2D(_);u.add(new Vt(i.coord),!1);for(var C=i.segmentIndex+1;C<=s.segmentIndex;C++)u.add(d._edge.getCoordinate(C));b&&u.add(new Vt(s.coord))};va.prototype.iterator=function(){return this._nodeMap.values().iterator()};va.prototype.addSplitEdges=function(i){var s=this;this.addEndpoints(),this.addCollapsedNodes();for(var u=this.iterator(),d=u.next();u.hasNext();){var _=u.next(),b=s.createSplitEdge(d,_);i.add(b),d=_}};va.prototype.findCollapseIndex=function(i,s,u){if(!i.coord.equals2D(s.coord))return!1;var d=s.segmentIndex-i.segmentIndex;return s.isInterior()||d--,d===1?(u[0]=i.segmentIndex+1,!0):!1};va.prototype.findCollapsesFromInsertedNodes=function(i){for(var s=this,u=new Array(1).fill(null),d=this.iterator(),_=d.next();d.hasNext();){var b=d.next(),C=s.findCollapseIndex(_,b,u);C&&i.add(new pc(u[0])),_=b}};va.prototype.getEdge=function(){return this._edge};va.prototype.addEndpoints=function(){var i=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(i),i)};va.prototype.createSplitEdge=function(i,s){var u=this,d=s.segmentIndex-i.segmentIndex+2,_=this._edge.getCoordinate(s.segmentIndex),b=s.isInterior()||!s.coord.equals2D(_);b||d--;var C=new Array(d).fill(null),l=0;C[l++]=new Vt(i.coord);for(var V=i.segmentIndex+1;V<=s.segmentIndex;V++)C[l++]=u._edge.getCoordinate(V);return b&&(C[l]=new Vt(s.coord)),new Lo(C,this._edge.getData())};va.prototype.add=function(i,s){var u=new Up(this._edge,i,s,this._edge.getSegmentOctant(s)),d=this._nodeMap.get(u);return d!==null?(Nr.isTrue(d.coord.equals2D(i),"Found equal nodes with different coordinates"),d):(this._nodeMap.put(u,u),u)};va.prototype.checkSplitEdgesCorrectness=function(i){var s=this._edge.getCoordinates(),u=i.get(0),d=u.getCoordinate(0);if(!d.equals2D(s[0]))throw new Yh("bad split edge start point at "+d);var _=i.get(i.size()-1),b=_.getCoordinates(),C=b[b.length-1];if(!C.equals2D(s[s.length-1]))throw new Yh("bad split edge end point at "+C)};va.prototype.interfaces_=function(){return[]};va.prototype.getClass=function(){return va};var bf=function(){};bf.prototype.interfaces_=function(){return[]};bf.prototype.getClass=function(){return bf};bf.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new $i("Cannot compute the octant for point ( "+i+", "+s+" )");var u=Math.abs(i),d=Math.abs(s);return i>=0?s>=0?u>=d?0:1:u>=d?7:6:s>=0?u>=d?3:2:u>=d?4:5}else if(arguments[0]instanceof Vt&&arguments[1]instanceof Vt){var _=arguments[0],b=arguments[1],C=b.x-_.x,l=b.y-_.y;if(C===0&&l===0)throw new $i("Cannot compute the octant for two identical points "+_);return bf.octant(C,l)}};var wh=function(){};wh.prototype.getCoordinates=function(){};wh.prototype.size=function(){};wh.prototype.getCoordinate=function(i){};wh.prototype.isClosed=function(){};wh.prototype.setData=function(i){};wh.prototype.getData=function(){};wh.prototype.interfaces_=function(){return[]};wh.prototype.getClass=function(){return wh};var Uy=function(){};Uy.prototype.addIntersection=function(i,s){};Uy.prototype.interfaces_=function(){return[wh]};Uy.prototype.getClass=function(){return Uy};var Lo=function(){this._nodeList=new va(this),this._pts=null,this._data=null;var i=arguments[0],s=arguments[1];this._pts=i,this._data=s};Lo.prototype.getCoordinates=function(){return this._pts};Lo.prototype.size=function(){return this._pts.length};Lo.prototype.getCoordinate=function(i){return this._pts[i]};Lo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Lo.prototype.getSegmentOctant=function(i){return i===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(i),this.getCoordinate(i+1))};Lo.prototype.setData=function(i){this._data=i};Lo.prototype.safeOctant=function(i,s){return i.equals2D(s)?0:bf.octant(i,s)};Lo.prototype.getData=function(){return this._data};Lo.prototype.addIntersection=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.addIntersectionNode(i,s)}else if(arguments.length===4){var u=arguments[0],d=arguments[1],_=arguments[3],b=new Vt(u.getIntersection(_));this.addIntersection(b,d)}};Lo.prototype.toString=function(){return qu.toLineString(new Co(this._pts))};Lo.prototype.getNodeList=function(){return this._nodeList};Lo.prototype.addIntersectionNode=function(i,s){var u=s,d=u+1;if(d<this._pts.length){var _=this._pts[d];i.equals2D(_)&&(u=d)}var b=this._nodeList.add(i,u);return b};Lo.prototype.addIntersections=function(i,s,u){for(var d=this,_=0;_<i.getIntersectionNum();_++)d.addIntersection(i,s,u,_)};Lo.prototype.interfaces_=function(){return[Uy]};Lo.prototype.getClass=function(){return Lo};Lo.getNodedSubstrings=function(){if(arguments.length===1){var i=arguments[0],s=new Pe;return Lo.getNodedSubstrings(i,s),s}else if(arguments.length===2)for(var u=arguments[0],d=arguments[1],_=u.iterator();_.hasNext();){var b=_.next();b.getNodeList().addSplitEdges(d)}};var sr=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Vt,this.p1=new Vt;else if(arguments.length===1){var i=arguments[0];this.p0=new Vt(i.p0),this.p1=new Vt(i.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var s=arguments[0],u=arguments[1],d=arguments[2],_=arguments[3];this.p0=new Vt(s,u),this.p1=new Vt(d,_)}},tT={serialVersionUID:{configurable:!0}};sr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};sr.prototype.orientationIndex=function(){if(arguments[0]instanceof sr){var i=arguments[0],s=Fe.orientationIndex(this.p0,this.p1,i.p0),u=Fe.orientationIndex(this.p0,this.p1,i.p1);return s>=0&&u>=0||s<=0&&u<=0?Math.max(s,u):0}else if(arguments[0]instanceof Vt){var d=arguments[0];return Fe.orientationIndex(this.p0,this.p1,d)}};sr.prototype.toGeometry=function(i){return i.createLineString([this.p0,this.p1])};sr.prototype.isVertical=function(){return this.p0.x===this.p1.x};sr.prototype.equals=function(i){if(!(i instanceof sr))return!1;var s=i;return this.p0.equals(s.p0)&&this.p1.equals(s.p1)};sr.prototype.intersection=function(i){var s=new md;return s.computeIntersection(this.p0,this.p1,i.p0,i.p1),s.hasIntersection()?s.getIntersection(0):null};sr.prototype.project=function(){if(arguments[0]instanceof Vt){var i=arguments[0];if(i.equals(this.p0)||i.equals(this.p1))return new Vt(i);var s=this.projectionFactor(i),u=new Vt;return u.x=this.p0.x+s*(this.p1.x-this.p0.x),u.y=this.p0.y+s*(this.p1.y-this.p0.y),u}else if(arguments[0]instanceof sr){var d=arguments[0],_=this.projectionFactor(d.p0),b=this.projectionFactor(d.p1);if(_>=1&&b>=1||_<=0&&b<=0)return null;var C=this.project(d.p0);_<0&&(C=this.p0),_>1&&(C=this.p1);var l=this.project(d.p1);return b<0&&(l=this.p0),b>1&&(l=this.p1),new sr(C,l)}};sr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};sr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};sr.prototype.getCoordinate=function(i){return i===0?this.p0:this.p1};sr.prototype.distancePerpendicular=function(i){return Fe.distancePointLinePerpendicular(i,this.p0,this.p1)};sr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};sr.prototype.midPoint=function(){return sr.midPoint(this.p0,this.p1)};sr.prototype.projectionFactor=function(i){if(i.equals(this.p0))return 0;if(i.equals(this.p1))return 1;var s=this.p1.x-this.p0.x,u=this.p1.y-this.p0.y,d=s*s+u*u;if(d<=0)return Lr.NaN;var _=((i.x-this.p0.x)*s+(i.y-this.p0.y)*u)/d;return _};sr.prototype.closestPoints=function(i){var s=this.intersection(i);if(s!==null)return[s,s];var u=new Array(2).fill(null),d=Lr.MAX_VALUE,_=null,b=this.closestPoint(i.p0);d=b.distance(i.p0),u[0]=b,u[1]=i.p0;var C=this.closestPoint(i.p1);_=C.distance(i.p1),_<d&&(d=_,u[0]=C,u[1]=i.p1);var l=i.closestPoint(this.p0);_=l.distance(this.p0),_<d&&(d=_,u[0]=this.p0,u[1]=l);var V=i.closestPoint(this.p1);return _=V.distance(this.p1),_<d&&(d=_,u[0]=this.p1,u[1]=V),u};sr.prototype.closestPoint=function(i){var s=this.projectionFactor(i);if(s>0&&s<1)return this.project(i);var u=this.p0.distance(i),d=this.p1.distance(i);return u<d?this.p0:this.p1};sr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};sr.prototype.getLength=function(){return this.p0.distance(this.p1)};sr.prototype.compareTo=function(i){var s=i,u=this.p0.compareTo(s.p0);return u!==0?u:this.p1.compareTo(s.p1)};sr.prototype.reverse=function(){var i=this.p0;this.p0=this.p1,this.p1=i};sr.prototype.equalsTopo=function(i){return this.p0.equals(i.p0)&&(this.p1.equals(i.p1)||this.p0.equals(i.p1))&&this.p1.equals(i.p0)};sr.prototype.lineIntersection=function(i){try{var s=ju.intersection(this.p0,this.p1,i.p0,i.p1);return s}catch(u){if(!(u instanceof Dm))throw u}finally{}return null};sr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};sr.prototype.pointAlongOffset=function(i,s){var u=this.p0.x+i*(this.p1.x-this.p0.x),d=this.p0.y+i*(this.p1.y-this.p0.y),_=this.p1.x-this.p0.x,b=this.p1.y-this.p0.y,C=Math.sqrt(_*_+b*b),l=0,V=0;if(s!==0){if(C<=0)throw new Error("Cannot compute offset from zero-length line segment");l=s*_/C,V=s*b/C}var R=u-V,et=d+l,at=new Vt(R,et);return at};sr.prototype.setCoordinates=function(){if(arguments.length===1){var i=arguments[0];this.setCoordinates(i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];this.p0.x=s.x,this.p0.y=s.y,this.p1.x=u.x,this.p1.y=u.y}};sr.prototype.segmentFraction=function(i){var s=this.projectionFactor(i);return s<0?s=0:(s>1||Lr.isNaN(s))&&(s=1),s};sr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};sr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};sr.prototype.distance=function(){if(arguments[0]instanceof sr){var i=arguments[0];return Fe.distanceLineLine(this.p0,this.p1,i.p0,i.p1)}else if(arguments[0]instanceof Vt){var s=arguments[0];return Fe.distancePointLine(s,this.p0,this.p1)}};sr.prototype.pointAlong=function(i){var s=new Vt;return s.x=this.p0.x+i*(this.p1.x-this.p0.x),s.y=this.p0.y+i*(this.p1.y-this.p0.y),s};sr.prototype.hashCode=function(){var i=Lr.doubleToLongBits(this.p0.x);i^=Lr.doubleToLongBits(this.p0.y)*31;var s=Math.trunc(i)^Math.trunc(i>>32),u=Lr.doubleToLongBits(this.p1.x);u^=Lr.doubleToLongBits(this.p1.y)*31;var d=Math.trunc(u)^Math.trunc(u>>32);return s^d};sr.prototype.interfaces_=function(){return[fu,mu]};sr.prototype.getClass=function(){return sr};sr.midPoint=function(i,s){return new Vt((i.x+s.x)/2,(i.y+s.y)/2)};tT.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(sr,tT);var jy=function(){this.tempEnv1=new ir,this.tempEnv2=new ir,this._overlapSeg1=new sr,this._overlapSeg2=new sr};jy.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var i=arguments[0],s=arguments[1],u=arguments[2],d=arguments[3];i.getLineSegment(s,this._overlapSeg1),u.getLineSegment(d,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};jy.prototype.interfaces_=function(){return[]};jy.prototype.getClass=function(){return jy};var al=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var i=arguments[0],s=arguments[1],u=arguments[2],d=arguments[3];this._pts=i,this._start=s,this._end=u,this._context=d};al.prototype.getLineSegment=function(i,s){s.p0=this._pts[i],s.p1=this._pts[i+1]};al.prototype.computeSelect=function(i,s,u,d){var _=this._pts[s],b=this._pts[u];if(d.tempEnv1.init(_,b),u-s===1)return d.select(this,s),null;if(!i.intersects(d.tempEnv1))return null;var C=Math.trunc((s+u)/2);s<C&&this.computeSelect(i,s,C,d),C<u&&this.computeSelect(i,C,u,d)};al.prototype.getCoordinates=function(){for(var i=this,s=new Array(this._end-this._start+1).fill(null),u=0,d=this._start;d<=this._end;d++)s[u++]=i._pts[d];return s};al.prototype.computeOverlaps=function(i,s){this.computeOverlapsInternal(this._start,this._end,i,i._start,i._end,s)};al.prototype.setId=function(i){this._id=i};al.prototype.select=function(i,s){this.computeSelect(i,this._start,this._end,s)};al.prototype.getEnvelope=function(){if(this._env===null){var i=this._pts[this._start],s=this._pts[this._end];this._env=new ir(i,s)}return this._env};al.prototype.getEndIndex=function(){return this._end};al.prototype.getStartIndex=function(){return this._start};al.prototype.getContext=function(){return this._context};al.prototype.getId=function(){return this._id};al.prototype.computeOverlapsInternal=function(i,s,u,d,_,b){var C=this._pts[i],l=this._pts[s],V=u._pts[d],R=u._pts[_];if(s-i===1&&_-d===1)return b.overlap(this,i,u,d),null;if(b.tempEnv1.init(C,l),b.tempEnv2.init(V,R),!b.tempEnv1.intersects(b.tempEnv2))return null;var et=Math.trunc((i+s)/2),at=Math.trunc((d+_)/2);i<et&&(d<at&&this.computeOverlapsInternal(i,et,u,d,at,b),at<_&&this.computeOverlapsInternal(i,et,u,at,_,b)),et<s&&(d<at&&this.computeOverlapsInternal(et,s,u,d,at,b),at<_&&this.computeOverlapsInternal(et,s,u,at,_,b))};al.prototype.interfaces_=function(){return[]};al.prototype.getClass=function(){return al};var hc=function(){};hc.prototype.interfaces_=function(){return[]};hc.prototype.getClass=function(){return hc};hc.getChainStartIndices=function(i){var s=0,u=new Pe;u.add(new pc(s));do{var d=hc.findChainEnd(i,s);u.add(new pc(d)),s=d}while(s<i.length-1);var _=hc.toIntArray(u);return _};hc.findChainEnd=function(i,s){for(var u=s;u<i.length-1&&i[u].equals2D(i[u+1]);)u++;if(u>=i.length-1)return i.length-1;for(var d=hi.quadrant(i[u],i[u+1]),_=s+1;_<i.length;){if(!i[_-1].equals2D(i[_])){var b=hi.quadrant(i[_-1],i[_]);if(b!==d)break}_++}return _-1};hc.getChains=function(){if(arguments.length===1){var i=arguments[0];return hc.getChains(i,null)}else if(arguments.length===2){for(var s=arguments[0],u=arguments[1],d=new Pe,_=hc.getChainStartIndices(s),b=0;b<_.length-1;b++){var C=new al(s,_[b],_[b+1],u);d.add(C)}return d}};hc.toIntArray=function(i){for(var s=new Array(i.size()).fill(null),u=0;u<s.length;u++)s[u]=i.get(u).intValue();return s};var ad=function(){};ad.prototype.computeNodes=function(i){};ad.prototype.getNodedSubstrings=function(){};ad.prototype.interfaces_=function(){return[]};ad.prototype.getClass=function(){return ad};var Gy=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var i=arguments[0];this.setSegmentIntersector(i)}};Gy.prototype.setSegmentIntersector=function(i){this._segInt=i};Gy.prototype.interfaces_=function(){return[ad]};Gy.prototype.getClass=function(){return Gy};var Mb=function(i){function s(d){d?i.call(this,d):i.call(this),this._monoChains=new Pe,this._index=new QE,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s;var u={SegmentOverlapAction:{configurable:!0}};return s.prototype.getMonotoneChains=function(){return this._monoChains},s.prototype.getNodedSubstrings=function(){return Lo.getNodedSubstrings(this._nodedSegStrings)},s.prototype.getIndex=function(){return this._index},s.prototype.add=function(d){for(var _=this,b=hc.getChains(d.getCoordinates(),d),C=b.iterator();C.hasNext();){var l=C.next();l.setId(_._idCounter++),_._index.insert(l.getEnvelope(),l),_._monoChains.add(l)}},s.prototype.computeNodes=function(d){var _=this;this._nodedSegStrings=d;for(var b=d.iterator();b.hasNext();)_.add(b.next());this.intersectChains()},s.prototype.intersectChains=function(){for(var d=this,_=new jE(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var C=b.next(),l=d._index.query(C.getEnvelope()),V=l.iterator();V.hasNext();){var R=V.next();if(R.getId()>C.getId()&&(C.computeOverlaps(R,_),d._nOverlaps++),d._segInt.isDone())return null}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},u.SegmentOverlapAction.get=function(){return jE},Object.defineProperties(s,u),s}(Gy),jE=function(i){function s(){i.call(this),this._si=null;var u=arguments[0];this._si=u}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.overlap=function(){if(arguments.length===4){var u=arguments[0],d=arguments[1],_=arguments[2],b=arguments[3],C=u.getContext(),l=_.getContext();this._si.processIntersections(C,d,l,b)}else return i.prototype.overlap.apply(this,arguments)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(jy),Mn=function i(){if(this._quadrantSegments=i.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=i.CAP_ROUND,this._joinStyle=i.JOIN_ROUND,this._mitreLimit=i.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=i.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.setQuadrantSegments(s)}else if(arguments.length===2){var u=arguments[0],d=arguments[1];this.setQuadrantSegments(u),this.setEndCapStyle(d)}else if(arguments.length===4){var _=arguments[0],b=arguments[1],C=arguments[2],l=arguments[3];this.setQuadrantSegments(_),this.setEndCapStyle(b),this.setJoinStyle(C),this.setMitreLimit(l)}}},ep={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Mn.prototype.getEndCapStyle=function(){return this._endCapStyle};Mn.prototype.isSingleSided=function(){return this._isSingleSided};Mn.prototype.setQuadrantSegments=function(i){this._quadrantSegments=i,this._quadrantSegments===0&&(this._joinStyle=Mn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Mn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),i<=0&&(this._quadrantSegments=1),this._joinStyle!==Mn.JOIN_ROUND&&(this._quadrantSegments=Mn.DEFAULT_QUADRANT_SEGMENTS)};Mn.prototype.getJoinStyle=function(){return this._joinStyle};Mn.prototype.setJoinStyle=function(i){this._joinStyle=i};Mn.prototype.setSimplifyFactor=function(i){this._simplifyFactor=i<0?0:i};Mn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Mn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Mn.prototype.setEndCapStyle=function(i){this._endCapStyle=i};Mn.prototype.getMitreLimit=function(){return this._mitreLimit};Mn.prototype.setMitreLimit=function(i){this._mitreLimit=i};Mn.prototype.setSingleSided=function(i){this._isSingleSided=i};Mn.prototype.interfaces_=function(){return[]};Mn.prototype.getClass=function(){return Mn};Mn.bufferDistanceError=function(i){var s=Math.PI/2/i;return 1-Math.cos(s/2)};ep.CAP_ROUND.get=function(){return 1};ep.CAP_FLAT.get=function(){return 2};ep.CAP_SQUARE.get=function(){return 3};ep.JOIN_ROUND.get=function(){return 1};ep.JOIN_MITRE.get=function(){return 2};ep.JOIN_BEVEL.get=function(){return 3};ep.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};ep.DEFAULT_MITRE_LIMIT.get=function(){return 5};ep.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Mn,ep);var co=function(i){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Fe.COUNTERCLOCKWISE,this._inputLine=i||null},Ky={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};co.prototype.isDeletable=function(i,s,u,d){var _=this._inputLine[i],b=this._inputLine[s],C=this._inputLine[u];return!this.isConcave(_,b,C)||!this.isShallow(_,b,C,d)?!1:this.isShallowSampled(_,b,i,u,d)};co.prototype.deleteShallowConcavities=function(){for(var i=this,s=1,u=this.findNextNonDeletedIndex(s),d=this.findNextNonDeletedIndex(u),_=!1;d<this._inputLine.length;){var b=!1;i.isDeletable(s,u,d,i._distanceTol)&&(i._isDeleted[u]=co.DELETE,b=!0,_=!0),b?s=d:s=u,u=i.findNextNonDeletedIndex(s),d=i.findNextNonDeletedIndex(u)}return _};co.prototype.isShallowConcavity=function(i,s,u,d){var _=Fe.computeOrientation(i,s,u),b=_===this._angleOrientation;if(!b)return!1;var C=Fe.distancePointLine(s,i,u);return C<d};co.prototype.isShallowSampled=function(i,s,u,d,_){var b=this,C=Math.trunc((d-u)/co.NUM_PTS_TO_CHECK);C<=0&&(C=1);for(var l=u;l<d;l+=C)if(!b.isShallow(i,s,b._inputLine[l],_))return!1;return!0};co.prototype.isConcave=function(i,s,u){var d=Fe.computeOrientation(i,s,u),_=d===this._angleOrientation;return _};co.prototype.simplify=function(i){var s=this;this._distanceTol=Math.abs(i),i<0&&(this._angleOrientation=Fe.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var u=!1;do u=s.deleteShallowConcavities();while(u);return this.collapseLine()};co.prototype.findNextNonDeletedIndex=function(i){for(var s=i+1;s<this._inputLine.length&&this._isDeleted[s]===co.DELETE;)s++;return s};co.prototype.isShallow=function(i,s,u,d){var _=Fe.distancePointLine(s,i,u);return _<d};co.prototype.collapseLine=function(){for(var i=this,s=new Yy,u=0;u<this._inputLine.length;u++)i._isDeleted[u]!==co.DELETE&&s.add(i._inputLine[u]);return s.toCoordinateArray()};co.prototype.interfaces_=function(){return[]};co.prototype.getClass=function(){return co};co.simplify=function(i,s){var u=new co(i);return u.simplify(s)};Ky.INIT.get=function(){return 0};Ky.DELETE.get=function(){return 1};Ky.KEEP.get=function(){return 1};Ky.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(co,Ky);var Nl=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Pe},eT={COORDINATE_ARRAY_TYPE:{configurable:!0}};Nl.prototype.getCoordinates=function(){var i=this._ptList.toArray(Nl.COORDINATE_ARRAY_TYPE);return i};Nl.prototype.setPrecisionModel=function(i){this._precisionModel=i};Nl.prototype.addPt=function(i){var s=new Vt(i);if(this._precisionModel.makePrecise(s),this.isRedundant(s))return null;this._ptList.add(s)};Nl.prototype.revere=function(){};Nl.prototype.addPts=function(i,s){var u=this;if(s)for(var d=0;d<i.length;d++)u.addPt(i[d]);else for(var _=i.length-1;_>=0;_--)u.addPt(i[_])};Nl.prototype.isRedundant=function(i){if(this._ptList.size()<1)return!1;var s=this._ptList.get(this._ptList.size()-1),u=i.distance(s);return u<this._minimimVertexDistance};Nl.prototype.toString=function(){var i=new Wr,s=i.createLineString(this.getCoordinates());return s.toString()};Nl.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var i=new Vt(this._ptList.get(0)),s=this._ptList.get(this._ptList.size()-1);if(i.equals(s))return null;this._ptList.add(i)};Nl.prototype.setMinimumVertexDistance=function(i){this._minimimVertexDistance=i};Nl.prototype.interfaces_=function(){return[]};Nl.prototype.getClass=function(){return Nl};eT.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Nl,eT);var pn=function(){},zf={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};pn.prototype.interfaces_=function(){return[]};pn.prototype.getClass=function(){return pn};pn.toDegrees=function(i){return i*180/Math.PI};pn.normalize=function(i){for(;i>Math.PI;)i-=pn.PI_TIMES_2;for(;i<=-Math.PI;)i+=pn.PI_TIMES_2;return i};pn.angle=function(){if(arguments.length===1){var i=arguments[0];return Math.atan2(i.y,i.x)}else if(arguments.length===2){var s=arguments[0],u=arguments[1],d=u.x-s.x,_=u.y-s.y;return Math.atan2(_,d)}};pn.isAcute=function(i,s,u){var d=i.x-s.x,_=i.y-s.y,b=u.x-s.x,C=u.y-s.y,l=d*b+_*C;return l>0};pn.isObtuse=function(i,s,u){var d=i.x-s.x,_=i.y-s.y,b=u.x-s.x,C=u.y-s.y,l=d*b+_*C;return l<0};pn.interiorAngle=function(i,s,u){var d=pn.angle(s,i),_=pn.angle(s,u);return Math.abs(_-d)};pn.normalizePositive=function(i){if(i<0){for(;i<0;)i+=pn.PI_TIMES_2;i>=pn.PI_TIMES_2&&(i=0)}else{for(;i>=pn.PI_TIMES_2;)i-=pn.PI_TIMES_2;i<0&&(i=0)}return i};pn.angleBetween=function(i,s,u){var d=pn.angle(s,i),_=pn.angle(s,u);return pn.diff(d,_)};pn.diff=function(i,s){var u=null;return i<s?u=s-i:u=i-s,u>Math.PI&&(u=2*Math.PI-u),u};pn.toRadians=function(i){return i*Math.PI/180};pn.getTurn=function(i,s){var u=Math.sin(s-i);return u>0?pn.COUNTERCLOCKWISE:u<0?pn.CLOCKWISE:pn.NONE};pn.angleBetweenOriented=function(i,s,u){var d=pn.angle(s,i),_=pn.angle(s,u),b=_-d;return b<=-Math.PI?b+pn.PI_TIMES_2:b>Math.PI?b-pn.PI_TIMES_2:b};zf.PI_TIMES_2.get=function(){return 2*Math.PI};zf.PI_OVER_2.get=function(){return Math.PI/2};zf.PI_OVER_4.get=function(){return Math.PI/4};zf.COUNTERCLOCKWISE.get=function(){return Fe.COUNTERCLOCKWISE};zf.CLOCKWISE.get=function(){return Fe.CLOCKWISE};zf.NONE.get=function(){return Fe.COLLINEAR};Object.defineProperties(pn,zf);var Ui=function i(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new sr,this._seg1=new sr,this._offset0=new sr,this._offset1=new sr,this._side=0,this._hasNarrowConcaveAngle=!1;var s=arguments[0],u=arguments[1],d=arguments[2];this._precisionModel=s,this._bufParams=u,this._li=new md,this._filletAngleQuantum=Math.PI/2/u.getQuadrantSegments(),u.getQuadrantSegments()>=8&&u.getJoinStyle()===Mn.JOIN_ROUND&&(this._closingSegLengthFactor=i.MAX_CLOSING_SEG_LEN_FACTOR),this.init(d)},Qy={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ui.prototype.addNextSegment=function(i,s){if(this._s0=this._s1,this._s1=this._s2,this._s2=i,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var u=Fe.computeOrientation(this._s0,this._s1,this._s2),d=u===Fe.CLOCKWISE&&this._side===be.LEFT||u===Fe.COUNTERCLOCKWISE&&this._side===be.RIGHT;u===0?this.addCollinear(s):d?this.addOutsideTurn(u,s):this.addInsideTurn(u,s)};Ui.prototype.addLineEndCap=function(i,s){var u=new sr(i,s),d=new sr;this.computeOffsetSegment(u,be.LEFT,this._distance,d);var _=new sr;this.computeOffsetSegment(u,be.RIGHT,this._distance,_);var b=s.x-i.x,C=s.y-i.y,l=Math.atan2(C,b);switch(this._bufParams.getEndCapStyle()){case Mn.CAP_ROUND:this._segList.addPt(d.p1),this.addFilletArc(s,l+Math.PI/2,l-Math.PI/2,Fe.CLOCKWISE,this._distance),this._segList.addPt(_.p1);break;case Mn.CAP_FLAT:this._segList.addPt(d.p1),this._segList.addPt(_.p1);break;case Mn.CAP_SQUARE:var V=new Vt;V.x=Math.abs(this._distance)*Math.cos(l),V.y=Math.abs(this._distance)*Math.sin(l);var R=new Vt(d.p1.x+V.x,d.p1.y+V.y),et=new Vt(_.p1.x+V.x,_.p1.y+V.y);this._segList.addPt(R),this._segList.addPt(et);break}};Ui.prototype.getCoordinates=function(){var i=this._segList.getCoordinates();return i};Ui.prototype.addMitreJoin=function(i,s,u,d){var _=!0,b=null;try{b=ju.intersection(s.p0,s.p1,u.p0,u.p1);var C=d<=0?1:b.distance(i)/Math.abs(d);C>this._bufParams.getMitreLimit()&&(_=!1)}catch(l){if(l instanceof Dm)b=new Vt(0,0),_=!1;else throw l}finally{}_?this._segList.addPt(b):this.addLimitedMitreJoin(s,u,d,this._bufParams.getMitreLimit())};Ui.prototype.addFilletCorner=function(i,s,u,d,_){var b=s.x-i.x,C=s.y-i.y,l=Math.atan2(C,b),V=u.x-i.x,R=u.y-i.y,et=Math.atan2(R,V);d===Fe.CLOCKWISE?l<=et&&(l+=2*Math.PI):l>=et&&(l-=2*Math.PI),this._segList.addPt(s),this.addFilletArc(i,l,et,d,_),this._segList.addPt(u)};Ui.prototype.addOutsideTurn=function(i,s){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ui.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Mn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Mn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(s&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,i,this._distance),this._segList.addPt(this._offset1.p0))};Ui.prototype.createSquare=function(i){this._segList.addPt(new Vt(i.x+this._distance,i.y+this._distance)),this._segList.addPt(new Vt(i.x+this._distance,i.y-this._distance)),this._segList.addPt(new Vt(i.x-this._distance,i.y-this._distance)),this._segList.addPt(new Vt(i.x-this._distance,i.y+this._distance)),this._segList.closeRing()};Ui.prototype.addSegments=function(i,s){this._segList.addPts(i,s)};Ui.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Ui.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Ui.prototype.initSideSegments=function(i,s,u){this._s1=i,this._s2=s,this._side=u,this._seg1.setCoordinates(i,s),this.computeOffsetSegment(this._seg1,u,this._distance,this._offset1)};Ui.prototype.addLimitedMitreJoin=function(i,s,u,d){var _=this._seg0.p1,b=pn.angle(_,this._seg0.p0),C=pn.angleBetweenOriented(this._seg0.p0,_,this._seg1.p1),l=C/2,V=pn.normalize(b+l),R=pn.normalize(V+Math.PI),et=d*u,at=et*Math.abs(Math.sin(l)),st=u-at,yt=_.x+et*Math.cos(R),xt=_.y+et*Math.sin(R),It=new Vt(yt,xt),Pt=new sr(_,It),qt=Pt.pointAlongOffset(1,st),Qt=Pt.pointAlongOffset(1,-st);this._side===be.LEFT?(this._segList.addPt(qt),this._segList.addPt(Qt)):(this._segList.addPt(Qt),this._segList.addPt(qt))};Ui.prototype.computeOffsetSegment=function(i,s,u,d){var _=s===be.LEFT?1:-1,b=i.p1.x-i.p0.x,C=i.p1.y-i.p0.y,l=Math.sqrt(b*b+C*C),V=_*u*b/l,R=_*u*C/l;d.p0.x=i.p0.x-R,d.p0.y=i.p0.y+V,d.p1.x=i.p1.x-R,d.p1.y=i.p1.y+V};Ui.prototype.addFilletArc=function(i,s,u,d,_){var b=this,C=d===Fe.CLOCKWISE?-1:1,l=Math.abs(s-u),V=Math.trunc(l/this._filletAngleQuantum+.5);if(V<1)return null;for(var R=0,et=l/V,at=R,st=new Vt;at<l;){var yt=s+C*at;st.x=i.x+_*Math.cos(yt),st.y=i.y+_*Math.sin(yt),b._segList.addPt(st),at+=et}};Ui.prototype.addInsideTurn=function(i,s){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ui.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var u=new Vt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(u);var d=new Vt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(d)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Ui.prototype.createCircle=function(i){var s=new Vt(i.x+this._distance,i.y);this._segList.addPt(s),this.addFilletArc(i,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Ui.prototype.addBevelJoin=function(i,s){this._segList.addPt(i.p1),this._segList.addPt(s.p0)};Ui.prototype.init=function(i){this._distance=i,this._maxCurveSegmentError=i*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Nl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(i*Ui.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Ui.prototype.addCollinear=function(i){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var s=this._li.getIntersectionNum();s>=2&&(this._bufParams.getJoinStyle()===Mn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Mn.JOIN_MITRE?(i&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Fe.CLOCKWISE,this._distance))};Ui.prototype.closeRing=function(){this._segList.closeRing()};Ui.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};Qy.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Qy.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Qy.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Qy.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Ui,Qy);var Fa=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var i=arguments[0],s=arguments[1];this._precisionModel=i,this._bufParams=s};Fa.prototype.getOffsetCurve=function(i,s){if(this._distance=s,s===0)return null;var u=s<0,d=Math.abs(s),_=this.getSegGen(d);i.length<=1?this.computePointCurve(i[0],_):this.computeOffsetCurve(i,u,_);var b=_.getCoordinates();return u&&Jr.reverse(b),b};Fa.prototype.computeSingleSidedBufferCurve=function(i,s,u){var d=this.simplifyTolerance(this._distance);if(s){u.addSegments(i,!0);var _=co.simplify(i,-d),b=_.length-1;u.initSideSegments(_[b],_[b-1],be.LEFT),u.addFirstSegment();for(var C=b-2;C>=0;C--)u.addNextSegment(_[C],!0)}else{u.addSegments(i,!1);var l=co.simplify(i,d),V=l.length-1;u.initSideSegments(l[0],l[1],be.LEFT),u.addFirstSegment();for(var R=2;R<=V;R++)u.addNextSegment(l[R],!0)}u.addLastSegment(),u.closeRing()};Fa.prototype.computeRingBufferCurve=function(i,s,u){var d=this.simplifyTolerance(this._distance);s===be.RIGHT&&(d=-d);var _=co.simplify(i,d),b=_.length-1;u.initSideSegments(_[b-1],_[0],s);for(var C=1;C<=b;C++){var l=C!==1;u.addNextSegment(_[C],l)}u.closeRing()};Fa.prototype.computeLineBufferCurve=function(i,s){var u=this.simplifyTolerance(this._distance),d=co.simplify(i,u),_=d.length-1;s.initSideSegments(d[0],d[1],be.LEFT);for(var b=2;b<=_;b++)s.addNextSegment(d[b],!0);s.addLastSegment(),s.addLineEndCap(d[_-1],d[_]);var C=co.simplify(i,-u),l=C.length-1;s.initSideSegments(C[l],C[l-1],be.LEFT);for(var V=l-2;V>=0;V--)s.addNextSegment(C[V],!0);s.addLastSegment(),s.addLineEndCap(C[1],C[0]),s.closeRing()};Fa.prototype.computePointCurve=function(i,s){switch(this._bufParams.getEndCapStyle()){case Mn.CAP_ROUND:s.createCircle(i);break;case Mn.CAP_SQUARE:s.createSquare(i);break}};Fa.prototype.getLineCurve=function(i,s){if(this._distance=s,s<0&&!this._bufParams.isSingleSided()||s===0)return null;var u=Math.abs(s),d=this.getSegGen(u);if(i.length<=1)this.computePointCurve(i[0],d);else if(this._bufParams.isSingleSided()){var _=s<0;this.computeSingleSidedBufferCurve(i,_,d)}else this.computeLineBufferCurve(i,d);var b=d.getCoordinates();return b};Fa.prototype.getBufferParameters=function(){return this._bufParams};Fa.prototype.simplifyTolerance=function(i){return i*this._bufParams.getSimplifyFactor()};Fa.prototype.getRingCurve=function(i,s,u){if(this._distance=u,i.length<=2)return this.getLineCurve(i,u);if(u===0)return Fa.copyCoordinates(i);var d=this.getSegGen(u);return this.computeRingBufferCurve(i,s,d),d.getCoordinates()};Fa.prototype.computeOffsetCurve=function(i,s,u){var d=this.simplifyTolerance(this._distance);if(s){var _=co.simplify(i,-d),b=_.length-1;u.initSideSegments(_[b],_[b-1],be.LEFT),u.addFirstSegment();for(var C=b-2;C>=0;C--)u.addNextSegment(_[C],!0)}else{var l=co.simplify(i,d),V=l.length-1;u.initSideSegments(l[0],l[1],be.LEFT),u.addFirstSegment();for(var R=2;R<=V;R++)u.addNextSegment(l[R],!0)}u.addLastSegment()};Fa.prototype.getSegGen=function(i){return new Ui(this._precisionModel,this._bufParams,i)};Fa.prototype.interfaces_=function(){return[]};Fa.prototype.getClass=function(){return Fa};Fa.copyCoordinates=function(i){for(var s=new Array(i.length).fill(null),u=0;u<s.length;u++)s[u]=new Vt(i[u]);return s};var wf=function(){this._subgraphs=null,this._seg=new sr,this._cga=new Fe;var i=arguments[0];this._subgraphs=i},rT={DepthSegment:{configurable:!0}};wf.prototype.findStabbedSegments=function(){var i=this;if(arguments.length===1){for(var s=arguments[0],u=new Pe,d=this._subgraphs.iterator();d.hasNext();){var _=d.next(),b=_.getEnvelope();s.y<b.getMinY()||s.y>b.getMaxY()||i.findStabbedSegments(s,_.getDirectedEdges(),u)}return u}else if(arguments.length===3){if(xr(arguments[2],Gu)&&arguments[0]instanceof Vt&&arguments[1]instanceof wb)for(var C=arguments[0],l=arguments[1],V=arguments[2],R=l.getEdge().getCoordinates(),et=0;et<R.length-1;et++){i._seg.p0=R[et],i._seg.p1=R[et+1],i._seg.p0.y>i._seg.p1.y&&i._seg.reverse();var at=Math.max(i._seg.p0.x,i._seg.p1.x);if(!(at<C.x)&&!i._seg.isHorizontal()&&!(C.y<i._seg.p0.y||C.y>i._seg.p1.y)&&Fe.computeOrientation(i._seg.p0,i._seg.p1,C)!==Fe.RIGHT){var st=l.getDepth(be.LEFT);i._seg.p0.equals(R[et])||(st=l.getDepth(be.RIGHT));var yt=new ld(i._seg,st);V.add(yt)}}else if(xr(arguments[2],Gu)&&arguments[0]instanceof Vt&&xr(arguments[1],Gu))for(var xt=arguments[0],It=arguments[1],Pt=arguments[2],qt=It.iterator();qt.hasNext();){var Qt=qt.next();Qt.isForward()&&i.findStabbedSegments(xt,Qt,Pt)}}};wf.prototype.getDepth=function(i){var s=this.findStabbedSegments(i);if(s.size()===0)return 0;var u=Xu.min(s);return u._leftDepth};wf.prototype.interfaces_=function(){return[]};wf.prototype.getClass=function(){return wf};rT.DepthSegment.get=function(){return ld};Object.defineProperties(wf,rT);var ld=function(){this._upwardSeg=null,this._leftDepth=null;var i=arguments[0],s=arguments[1];this._upwardSeg=new sr(i),this._leftDepth=s};ld.prototype.compareTo=function(i){var s=i;if(this._upwardSeg.minX()>=s._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=s._upwardSeg.minX())return-1;var u=this._upwardSeg.orientationIndex(s._upwardSeg);return u!==0||(u=-1*s._upwardSeg.orientationIndex(this._upwardSeg),u!==0)?u:this._upwardSeg.compareTo(s._upwardSeg)};ld.prototype.compareX=function(i,s){var u=i.p0.compareTo(s.p0);return u!==0?u:i.p1.compareTo(s.p1)};ld.prototype.toString=function(){return this._upwardSeg.toString()};ld.prototype.interfaces_=function(){return[fu]};ld.prototype.getClass=function(){return ld};var kn=function(i,s,u){this.p0=i||null,this.p1=s||null,this.p2=u||null};kn.prototype.area=function(){return kn.area(this.p0,this.p1,this.p2)};kn.prototype.signedArea=function(){return kn.signedArea(this.p0,this.p1,this.p2)};kn.prototype.interpolateZ=function(i){if(i===null)throw new $i("Supplied point is null.");return kn.interpolateZ(i,this.p0,this.p1,this.p2)};kn.prototype.longestSideLength=function(){return kn.longestSideLength(this.p0,this.p1,this.p2)};kn.prototype.isAcute=function(){return kn.isAcute(this.p0,this.p1,this.p2)};kn.prototype.circumcentre=function(){return kn.circumcentre(this.p0,this.p1,this.p2)};kn.prototype.area3D=function(){return kn.area3D(this.p0,this.p1,this.p2)};kn.prototype.centroid=function(){return kn.centroid(this.p0,this.p1,this.p2)};kn.prototype.inCentre=function(){return kn.inCentre(this.p0,this.p1,this.p2)};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};kn.area=function(i,s,u){return Math.abs(((u.x-i.x)*(s.y-i.y)-(s.x-i.x)*(u.y-i.y))/2)};kn.signedArea=function(i,s,u){return((u.x-i.x)*(s.y-i.y)-(s.x-i.x)*(u.y-i.y))/2};kn.det=function(i,s,u,d){return i*d-s*u};kn.interpolateZ=function(i,s,u,d){var _=s.x,b=s.y,C=u.x-_,l=d.x-_,V=u.y-b,R=d.y-b,et=C*R-l*V,at=i.x-_,st=i.y-b,yt=(R*at-l*st)/et,xt=(-V*at+C*st)/et,It=s.z+yt*(u.z-s.z)+xt*(d.z-s.z);return It};kn.longestSideLength=function(i,s,u){var d=i.distance(s),_=s.distance(u),b=u.distance(i),C=d;return _>C&&(C=_),b>C&&(C=b),C};kn.isAcute=function(i,s,u){return!(!pn.isAcute(i,s,u)||!pn.isAcute(s,u,i)||!pn.isAcute(u,i,s))};kn.circumcentre=function(i,s,u){var d=u.x,_=u.y,b=i.x-d,C=i.y-_,l=s.x-d,V=s.y-_,R=2*kn.det(b,C,l,V),et=kn.det(C,b*b+C*C,V,l*l+V*V),at=kn.det(b,b*b+C*C,l,l*l+V*V),st=d-et/R,yt=_+at/R;return new Vt(st,yt)};kn.perpendicularBisector=function(i,s){var u=s.x-i.x,d=s.y-i.y,_=new ju(i.x+u/2,i.y+d/2,1),b=new ju(i.x-d+u/2,i.y+u+d/2,1);return new ju(_,b)};kn.angleBisector=function(i,s,u){var d=s.distance(i),_=s.distance(u),b=d/(d+_),C=u.x-i.x,l=u.y-i.y,V=new Vt(i.x+b*C,i.y+b*l);return V};kn.area3D=function(i,s,u){var d=s.x-i.x,_=s.y-i.y,b=s.z-i.z,C=u.x-i.x,l=u.y-i.y,V=u.z-i.z,R=_*V-b*l,et=b*C-d*V,at=d*l-_*C,st=R*R+et*et+at*at,yt=Math.sqrt(st)/2;return yt};kn.centroid=function(i,s,u){var d=(i.x+s.x+u.x)/3,_=(i.y+s.y+u.y)/3;return new Vt(d,_)};kn.inCentre=function(i,s,u){var d=s.distance(u),_=i.distance(u),b=i.distance(s),C=d+_+b,l=(d*i.x+_*s.x+b*u.x)/C,V=(d*i.y+_*s.y+b*u.y)/C;return new Vt(l,V)};var du=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Pe;var i=arguments[0],s=arguments[1],u=arguments[2];this._inputGeom=i,this._distance=s,this._curveBuilder=u};du.prototype.addPoint=function(i){if(this._distance<=0)return null;var s=i.getCoordinates(),u=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(u,Xt.EXTERIOR,Xt.INTERIOR)};du.prototype.addPolygon=function(i){var s=this,u=this._distance,d=be.LEFT;this._distance<0&&(u=-this._distance,d=be.RIGHT);var _=i.getExteriorRing(),b=Jr.removeRepeatedPoints(_.getCoordinates());if(this._distance<0&&this.isErodedCompletely(_,this._distance)||this._distance<=0&&b.length<3)return null;this.addPolygonRing(b,u,d,Xt.EXTERIOR,Xt.INTERIOR);for(var C=0;C<i.getNumInteriorRing();C++){var l=i.getInteriorRingN(C),V=Jr.removeRepeatedPoints(l.getCoordinates());s._distance>0&&s.isErodedCompletely(l,-s._distance)||s.addPolygonRing(V,u,be.opposite(d),Xt.INTERIOR,Xt.EXTERIOR)}};du.prototype.isTriangleErodedCompletely=function(i,s){var u=new kn(i[0],i[1],i[2]),d=u.inCentre(),_=Fe.distancePointLine(d,u.p0,u.p1);return _<Math.abs(s)};du.prototype.addLineString=function(i){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var s=Jr.removeRepeatedPoints(i.getCoordinates()),u=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(u,Xt.EXTERIOR,Xt.INTERIOR)};du.prototype.addCurve=function(i,s,u){if(i===null||i.length<2)return null;var d=new Lo(i,new Kn(0,Xt.BOUNDARY,s,u));this._curveList.add(d)};du.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};du.prototype.addPolygonRing=function(i,s,u,d,_){if(s===0&&i.length<xh.MINIMUM_VALID_SIZE)return null;var b=d,C=_;i.length>=xh.MINIMUM_VALID_SIZE&&Fe.isCCW(i)&&(b=_,C=d,u=be.opposite(u));var l=this._curveBuilder.getRingCurve(i,u,s);this.addCurve(l,b,C)};du.prototype.add=function(i){if(i.isEmpty())return null;i instanceof Jo?this.addPolygon(i):i instanceof uo?this.addLineString(i):i instanceof ol?this.addPoint(i):i instanceof bm?this.addCollection(i):i instanceof sd?this.addCollection(i):i instanceof yh?this.addCollection(i):i instanceof ya&&this.addCollection(i)};du.prototype.isErodedCompletely=function(i,s){var u=i.getCoordinates();if(u.length<4)return s<0;if(u.length===4)return this.isTriangleErodedCompletely(u,s);var d=i.getEnvelopeInternal(),_=Math.min(d.getHeight(),d.getWidth());return s<0&&2*Math.abs(s)>_};du.prototype.addCollection=function(i){for(var s=this,u=0;u<i.getNumGeometries();u++){var d=i.getGeometryN(u);s.add(d)}};du.prototype.interfaces_=function(){return[]};du.prototype.getClass=function(){return du};var Tm=function(){};Tm.prototype.locate=function(i){};Tm.prototype.interfaces_=function(){return[]};Tm.prototype.getClass=function(){return Tm};var _h=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var i=arguments[0];this._parent=i,this._atStart=!0,this._index=0,this._max=i.getNumGeometries()};_h.prototype.next=function(){if(this._atStart)return this._atStart=!1,_h.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new zm;var i=this._parent.getGeometryN(this._index++);return i instanceof ya?(this._subcollectionIterator=new _h(i),this._subcollectionIterator.next()):i};_h.prototype.remove=function(){throw new Error(this.getClass().getName())};_h.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};_h.prototype.interfaces_=function(){return[km]};_h.prototype.getClass=function(){return _h};_h.isAtomic=function(i){return!(i instanceof ya)};var Rl=function(){this._geom=null;var i=arguments[0];this._geom=i};Rl.prototype.locate=function(i){return Rl.locate(i,this._geom)};Rl.prototype.interfaces_=function(){return[Tm]};Rl.prototype.getClass=function(){return Rl};Rl.isPointInRing=function(i,s){return s.getEnvelopeInternal().intersects(i)?Fe.isPointInRing(i,s.getCoordinates()):!1};Rl.containsPointInPolygon=function(i,s){if(s.isEmpty())return!1;var u=s.getExteriorRing();if(!Rl.isPointInRing(i,u))return!1;for(var d=0;d<s.getNumInteriorRing();d++){var _=s.getInteriorRingN(d);if(Rl.isPointInRing(i,_))return!1}return!0};Rl.containsPoint=function(i,s){if(s instanceof Jo)return Rl.containsPointInPolygon(i,s);if(s instanceof ya)for(var u=new _h(s);u.hasNext();){var d=u.next();if(d!==s&&Rl.containsPoint(i,d))return!0}return!1};Rl.locate=function(i,s){return s.isEmpty()?Xt.EXTERIOR:Rl.containsPoint(i,s)?Xt.INTERIOR:Xt.EXTERIOR};var ra=function(){this._edgeMap=new ta,this._edgeList=null,this._ptInAreaLocation=[Xt.NONE,Xt.NONE]};ra.prototype.getNextCW=function(i){this.getEdges();var s=this._edgeList.indexOf(i),u=s-1;return s===0&&(u=this._edgeList.size()-1),this._edgeList.get(u)};ra.prototype.propagateSideLabels=function(i){for(var s=Xt.NONE,u=this.iterator();u.hasNext();){var d=u.next(),_=d.getLabel();_.isArea(i)&&_.getLocation(i,be.LEFT)!==Xt.NONE&&(s=_.getLocation(i,be.LEFT))}if(s===Xt.NONE)return null;for(var b=s,C=this.iterator();C.hasNext();){var l=C.next(),V=l.getLabel();if(V.getLocation(i,be.ON)===Xt.NONE&&V.setLocation(i,be.ON,b),V.isArea(i)){var R=V.getLocation(i,be.LEFT),et=V.getLocation(i,be.RIGHT);if(et!==Xt.NONE){if(et!==b)throw new Jh("side location conflict",l.getCoordinate());R===Xt.NONE&&Nr.shouldNeverReachHere("found single null side (at "+l.getCoordinate()+")"),b=R}else Nr.isTrue(V.getLocation(i,be.LEFT)===Xt.NONE,"found single null side"),V.setLocation(i,be.RIGHT,b),V.setLocation(i,be.LEFT,b)}}};ra.prototype.getCoordinate=function(){var i=this.iterator();if(!i.hasNext())return null;var s=i.next();return s.getCoordinate()};ra.prototype.print=function(i){Ds.out.println("EdgeEndStar:   "+this.getCoordinate());for(var s=this.iterator();s.hasNext();){var u=s.next();u.print(i)}};ra.prototype.isAreaLabelsConsistent=function(i){return this.computeEdgeEndLabels(i.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};ra.prototype.checkAreaLabelsConsistent=function(i){var s=this.getEdges();if(s.size()<=0)return!0;var u=s.size()-1,d=s.get(u).getLabel(),_=d.getLocation(i,be.LEFT);Nr.isTrue(_!==Xt.NONE,"Found unlabelled area edge");for(var b=_,C=this.iterator();C.hasNext();){var l=C.next(),V=l.getLabel();Nr.isTrue(V.isArea(i),"Found non-area edge");var R=V.getLocation(i,be.LEFT),et=V.getLocation(i,be.RIGHT);if(R===et||et!==b)return!1;b=R}return!0};ra.prototype.findIndex=function(i){var s=this;this.iterator();for(var u=0;u<this._edgeList.size();u++){var d=s._edgeList.get(u);if(d===i)return u}return-1};ra.prototype.iterator=function(){return this.getEdges().iterator()};ra.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new Pe(this._edgeMap.values())),this._edgeList};ra.prototype.getLocation=function(i,s,u){return this._ptInAreaLocation[i]===Xt.NONE&&(this._ptInAreaLocation[i]=Rl.locate(s,u[i].getGeometry())),this._ptInAreaLocation[i]};ra.prototype.toString=function(){var i=new wc;i.append("EdgeEndStar:   "+this.getCoordinate()),i.append(`
`);for(var s=this.iterator();s.hasNext();){var u=s.next();i.append(u),i.append(`
`)}return i.toString()};ra.prototype.computeEdgeEndLabels=function(i){for(var s=this.iterator();s.hasNext();){var u=s.next();u.computeLabel(i)}};ra.prototype.computeLabelling=function(i){var s=this;this.computeEdgeEndLabels(i[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var u=[!1,!1],d=this.iterator();d.hasNext();)for(var _=d.next(),b=_.getLabel(),C=0;C<2;C++)b.isLine(C)&&b.getLocation(C)===Xt.BOUNDARY&&(u[C]=!0);for(var l=this.iterator();l.hasNext();)for(var V=l.next(),R=V.getLabel(),et=0;et<2;et++)if(R.isAnyNull(et)){var at=Xt.NONE;if(u[et])at=Xt.EXTERIOR;else{var st=V.getCoordinate();at=s.getLocation(et,st,i)}R.setAllLocationsIfNull(et,at)}};ra.prototype.getDegree=function(){return this._edgeMap.size()};ra.prototype.insertEdgeEnd=function(i,s){this._edgeMap.put(i,s),this._edgeList=null};ra.prototype.interfaces_=function(){return[]};ra.prototype.getClass=function(){return ra};var fA=function(i){function s(){i.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.linkResultDirectedEdges=function(){var u=this;this.getResultAreaEdges();for(var d=null,_=null,b=this._SCANNING_FOR_INCOMING,C=0;C<this._resultAreaEdgeList.size();C++){var l=u._resultAreaEdgeList.get(C),V=l.getSym();if(l.getLabel().isArea())switch(d===null&&l.isInResult()&&(d=l),b){case u._SCANNING_FOR_INCOMING:if(!V.isInResult())continue;_=V,b=u._LINKING_TO_OUTGOING;break;case u._LINKING_TO_OUTGOING:if(!l.isInResult())continue;_.setNext(l),b=u._SCANNING_FOR_INCOMING;break}}if(b===this._LINKING_TO_OUTGOING){if(d===null)throw new Jh("no outgoing dirEdge found",this.getCoordinate());Nr.isTrue(d.isInResult(),"unable to link last incoming dirEdge"),_.setNext(d)}},s.prototype.insert=function(u){var d=u;this.insertEdgeEnd(d,d)},s.prototype.getRightmostEdge=function(){var u=this.getEdges(),d=u.size();if(d<1)return null;var _=u.get(0);if(d===1)return _;var b=u.get(d-1),C=_.getQuadrant(),l=b.getQuadrant();return hi.isNorthern(C)&&hi.isNorthern(l)?_:!hi.isNorthern(C)&&!hi.isNorthern(l)?b:_.getDy()!==0?_:b.getDy()!==0?b:(Nr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},s.prototype.print=function(u){Ds.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var d=this.iterator();d.hasNext();){var _=d.next();u.print("out "),_.print(u),u.println(),u.print("in "),_.getSym().print(u),u.println()}},s.prototype.getResultAreaEdges=function(){var u=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Pe;for(var d=this.iterator();d.hasNext();){var _=d.next();(_.isInResult()||_.getSym().isInResult())&&u._resultAreaEdgeList.add(_)}return this._resultAreaEdgeList},s.prototype.updateLabelling=function(u){for(var d=this.iterator();d.hasNext();){var _=d.next(),b=_.getLabel();b.setAllLocationsIfNull(0,u.getLocation(0)),b.setAllLocationsIfNull(1,u.getLocation(1))}},s.prototype.linkAllDirectedEdges=function(){var u=this;this.getEdges();for(var d=null,_=null,b=this._edgeList.size()-1;b>=0;b--){var C=u._edgeList.get(b),l=C.getSym();_===null&&(_=l),d!==null&&l.setNext(d),d=C}_.setNext(d)},s.prototype.computeDepths=function(){var u=this;if(arguments.length===1){var d=arguments[0],_=this.findIndex(d),b=d.getDepth(be.LEFT),C=d.getDepth(be.RIGHT),l=this.computeDepths(_+1,this._edgeList.size(),b),V=this.computeDepths(0,_,l);if(V!==C)throw new Jh("depth mismatch at "+d.getCoordinate())}else if(arguments.length===3){for(var R=arguments[0],et=arguments[1],at=arguments[2],st=at,yt=R;yt<et;yt++){var xt=u._edgeList.get(yt);xt.setEdgeDepths(be.RIGHT,st),st=xt.getDepth(be.LEFT)}return st}},s.prototype.mergeSymLabels=function(){for(var u=this.iterator();u.hasNext();){var d=u.next(),_=d.getLabel();_.merge(d.getSym().getLabel())}},s.prototype.linkMinimalDirectedEdges=function(u){for(var d=this,_=null,b=null,C=this._SCANNING_FOR_INCOMING,l=this._resultAreaEdgeList.size()-1;l>=0;l--){var V=d._resultAreaEdgeList.get(l),R=V.getSym();switch(_===null&&V.getEdgeRing()===u&&(_=V),C){case d._SCANNING_FOR_INCOMING:if(R.getEdgeRing()!==u)continue;b=R,C=d._LINKING_TO_OUTGOING;break;case d._LINKING_TO_OUTGOING:if(V.getEdgeRing()!==u)continue;b.setNextMin(V),C=d._SCANNING_FOR_INCOMING;break}}C===this._LINKING_TO_OUTGOING&&(Nr.isTrue(_!==null,"found null for first outgoing dirEdge"),Nr.isTrue(_.getEdgeRing()===u,"unable to link last incoming dirEdge"),b.setNextMin(_))},s.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var u=0,d=this.iterator();d.hasNext();){var _=d.next();_.isInResult()&&u++}return u}else if(arguments.length===1){for(var b=arguments[0],C=0,l=this.iterator();l.hasNext();){var V=l.next();V.getEdgeRing()===b&&C++}return C}},s.prototype.getLabel=function(){return this._label},s.prototype.findCoveredLineEdges=function(){for(var u=Xt.NONE,d=this.iterator();d.hasNext();){var _=d.next(),b=_.getSym();if(!_.isLineEdge()){if(_.isInResult()){u=Xt.INTERIOR;break}if(b.isInResult()){u=Xt.EXTERIOR;break}}}if(u===Xt.NONE)return null;for(var C=u,l=this.iterator();l.hasNext();){var V=l.next(),R=V.getSym();V.isLineEdge()?V.getEdge().setCovered(C===Xt.INTERIOR):(V.isInResult()&&(C=Xt.EXTERIOR),R.isInResult()&&(C=Xt.INTERIOR))}},s.prototype.computeLabelling=function(u){var d=this;i.prototype.computeLabelling.call(this,u),this._label=new Kn(Xt.NONE);for(var _=this.iterator();_.hasNext();)for(var b=_.next(),C=b.getEdge(),l=C.getLabel(),V=0;V<2;V++){var R=l.getLocation(V);(R===Xt.INTERIOR||R===Xt.BOUNDARY)&&d._label.setLocation(V,Xt.INTERIOR)}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(ra),nT=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.createNode=function(u){return new K0(u,new fA)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(wm),jp=function i(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=i.orientation(s)};jp.prototype.compareTo=function(i){var s=i,u=jp.compareOriented(this._pts,this._orientation,s._pts,s._orientation);return u};jp.prototype.interfaces_=function(){return[fu]};jp.prototype.getClass=function(){return jp};jp.orientation=function(i){return Jr.increasingDirection(i)===1};jp.compareOriented=function(i,s,u,d){for(var _=s?1:-1,b=d?1:-1,C=s?i.length:-1,l=d?u.length:-1,V=s?0:i.length-1,R=d?0:u.length-1;;){var et=i[V].compareTo(u[R]);if(et!==0)return et;V+=_,R+=b;var at=V===C,st=R===l;if(at&&!st)return-1;if(!at&&st)return 1;if(at&&st)return 0}};var Hu=function(){this._edges=new Pe,this._ocaMap=new ta};Hu.prototype.print=function(i){var s=this;i.print("MULTILINESTRING ( ");for(var u=0;u<this._edges.size();u++){var d=s._edges.get(u);u>0&&i.print(","),i.print("(");for(var _=d.getCoordinates(),b=0;b<_.length;b++)b>0&&i.print(","),i.print(_[b].x+" "+_[b].y);i.println(")")}i.print(")  ")};Hu.prototype.addAll=function(i){for(var s=this,u=i.iterator();u.hasNext();)s.add(u.next())};Hu.prototype.findEdgeIndex=function(i){for(var s=this,u=0;u<this._edges.size();u++)if(s._edges.get(u).equals(i))return u;return-1};Hu.prototype.iterator=function(){return this._edges.iterator()};Hu.prototype.getEdges=function(){return this._edges};Hu.prototype.get=function(i){return this._edges.get(i)};Hu.prototype.findEqualEdge=function(i){var s=new jp(i.getCoordinates()),u=this._ocaMap.get(s);return u};Hu.prototype.add=function(i){this._edges.add(i);var s=new jp(i.getCoordinates());this._ocaMap.put(s,i)};Hu.prototype.interfaces_=function(){return[]};Hu.prototype.getClass=function(){return Hu};var ud=function(){};ud.prototype.processIntersections=function(i,s,u,d){};ud.prototype.isDone=function(){};ud.prototype.interfaces_=function(){return[]};ud.prototype.getClass=function(){return ud};var Bl=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var i=arguments[0];this._li=i};Bl.prototype.isTrivialIntersection=function(i,s,u,d){if(i===u&&this._li.getIntersectionNum()===1){if(Bl.isAdjacentSegments(s,d))return!0;if(i.isClosed()){var _=i.size()-1;if(s===0&&d===_||d===0&&s===_)return!0}}return!1};Bl.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Bl.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Bl.prototype.getLineIntersector=function(){return this._li};Bl.prototype.hasProperIntersection=function(){return this._hasProper};Bl.prototype.processIntersections=function(i,s,u,d){if(i===u&&s===d)return null;this.numTests++;var _=i.getCoordinates()[s],b=i.getCoordinates()[s+1],C=u.getCoordinates()[d],l=u.getCoordinates()[d+1];this._li.computeIntersection(_,b,C,l),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(i,s,u,d)||(this._hasIntersection=!0,i.addIntersections(this._li,s,0),u.addIntersections(this._li,d,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Bl.prototype.hasIntersection=function(){return this._hasIntersection};Bl.prototype.isDone=function(){return!1};Bl.prototype.hasInteriorIntersection=function(){return this._hasInterior};Bl.prototype.interfaces_=function(){return[ud]};Bl.prototype.getClass=function(){return Bl};Bl.isAdjacentSegments=function(i,s){return Math.abs(i-s)===1};var _c=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var i=arguments[0],s=arguments[1],u=arguments[2];this.coord=new Vt(i),this.segmentIndex=s,this.dist=u};_c.prototype.getSegmentIndex=function(){return this.segmentIndex};_c.prototype.getCoordinate=function(){return this.coord};_c.prototype.print=function(i){i.print(this.coord),i.print(" seg # = "+this.segmentIndex),i.println(" dist = "+this.dist)};_c.prototype.compareTo=function(i){var s=i;return this.compare(s.segmentIndex,s.dist)};_c.prototype.isEndPoint=function(i){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===i};_c.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};_c.prototype.getDistance=function(){return this.dist};_c.prototype.compare=function(i,s){return this.segmentIndex<i?-1:this.segmentIndex>i?1:this.dist<s?-1:this.dist>s?1:0};_c.prototype.interfaces_=function(){return[fu]};_c.prototype.getClass=function(){return _c};var Sh=function(){this._nodeMap=new ta,this.edge=null;var i=arguments[0];this.edge=i};Sh.prototype.print=function(i){i.println("Intersections:");for(var s=this.iterator();s.hasNext();){var u=s.next();u.print(i)}};Sh.prototype.iterator=function(){return this._nodeMap.values().iterator()};Sh.prototype.addSplitEdges=function(i){var s=this;this.addEndpoints();for(var u=this.iterator(),d=u.next();u.hasNext();){var _=u.next(),b=s.createSplitEdge(d,_);i.add(b),d=_}};Sh.prototype.addEndpoints=function(){var i=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[i],i,0)};Sh.prototype.createSplitEdge=function(i,s){var u=this,d=s.segmentIndex-i.segmentIndex+2,_=this.edge.pts[s.segmentIndex],b=s.dist>0||!s.coord.equals2D(_);b||d--;var C=new Array(d).fill(null),l=0;C[l++]=new Vt(i.coord);for(var V=i.segmentIndex+1;V<=s.segmentIndex;V++)C[l++]=u.edge.pts[V];return b&&(C[l]=s.coord),new N0(C,new Kn(this.edge._label))};Sh.prototype.add=function(i,s,u){var d=new _c(i,s,u),_=this._nodeMap.get(d);return _!==null?_:(this._nodeMap.put(d,d),d)};Sh.prototype.isIntersection=function(i){for(var s=this.iterator();s.hasNext();){var u=s.next();if(u.coord.equals(i))return!0}return!1};Sh.prototype.interfaces_=function(){return[]};Sh.prototype.getClass=function(){return Sh};var cd=function(){};cd.prototype.getChainStartIndices=function(i){var s=this,u=0,d=new Pe;d.add(new pc(u));do{var _=s.findChainEnd(i,u);d.add(new pc(_)),u=_}while(u<i.length-1);var b=cd.toIntArray(d);return b};cd.prototype.findChainEnd=function(i,s){for(var u=hi.quadrant(i[s],i[s+1]),d=s+1;d<i.length;){var _=hi.quadrant(i[d-1],i[d]);if(_!==u)break;d++}return d-1};cd.prototype.interfaces_=function(){return[]};cd.prototype.getClass=function(){return cd};cd.toIntArray=function(i){for(var s=new Array(i.size()).fill(null),u=0;u<s.length;u++)s[u]=i.get(u).intValue();return s};var Qh=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ir,this.env2=new ir;var i=arguments[0];this.e=i,this.pts=i.getCoordinates();var s=new cd;this.startIndex=s.getChainStartIndices(this.pts)};Qh.prototype.getCoordinates=function(){return this.pts};Qh.prototype.getMaxX=function(i){var s=this.pts[this.startIndex[i]].x,u=this.pts[this.startIndex[i+1]].x;return s>u?s:u};Qh.prototype.getMinX=function(i){var s=this.pts[this.startIndex[i]].x,u=this.pts[this.startIndex[i+1]].x;return s<u?s:u};Qh.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var i=arguments[0],s=arguments[1],u=arguments[2],d=arguments[3];this.computeIntersectsForChain(this.startIndex[i],this.startIndex[i+1],s,s.startIndex[u],s.startIndex[u+1],d)}else if(arguments.length===6){var _=arguments[0],b=arguments[1],C=arguments[2],l=arguments[3],V=arguments[4],R=arguments[5],et=this.pts[_],at=this.pts[b],st=C.pts[l],yt=C.pts[V];if(b-_===1&&V-l===1)return R.addIntersections(this.e,_,C.e,l),null;if(this.env1.init(et,at),this.env2.init(st,yt),!this.env1.intersects(this.env2))return null;var xt=Math.trunc((_+b)/2),It=Math.trunc((l+V)/2);_<xt&&(l<It&&this.computeIntersectsForChain(_,xt,C,l,It,R),It<V&&this.computeIntersectsForChain(_,xt,C,It,V,R)),xt<b&&(l<It&&this.computeIntersectsForChain(xt,b,C,l,It,R),It<V&&this.computeIntersectsForChain(xt,b,C,It,V,R))}};Qh.prototype.getStartIndexes=function(){return this.startIndex};Qh.prototype.computeIntersects=function(i,s){for(var u=this,d=0;d<this.startIndex.length-1;d++)for(var _=0;_<i.startIndex.length-1;_++)u.computeIntersectsForChain(d,i,_,s)};Qh.prototype.interfaces_=function(){return[]};Qh.prototype.getClass=function(){return Qh};var Ms=function i(){var s=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var u=0;u<2;u++)for(var d=0;d<3;d++)s._depth[u][d]=i.NULL_VALUE},iT={NULL_VALUE:{configurable:!0}};Ms.prototype.getDepth=function(i,s){return this._depth[i][s]};Ms.prototype.setDepth=function(i,s,u){this._depth[i][s]=u};Ms.prototype.isNull=function(){var i=this;if(arguments.length===0){for(var s=0;s<2;s++)for(var u=0;u<3;u++)if(i._depth[s][u]!==Ms.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var d=arguments[0];return this._depth[d][1]===Ms.NULL_VALUE}else if(arguments.length===2){var _=arguments[0],b=arguments[1];return this._depth[_][b]===Ms.NULL_VALUE}};Ms.prototype.normalize=function(){for(var i=this,s=0;s<2;s++)if(!i.isNull(s)){var u=i._depth[s][1];i._depth[s][2]<u&&(u=i._depth[s][2]),u<0&&(u=0);for(var d=1;d<3;d++){var _=0;i._depth[s][d]>u&&(_=1),i._depth[s][d]=_}}};Ms.prototype.getDelta=function(i){return this._depth[i][be.RIGHT]-this._depth[i][be.LEFT]};Ms.prototype.getLocation=function(i,s){return this._depth[i][s]<=0?Xt.EXTERIOR:Xt.INTERIOR};Ms.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Ms.prototype.add=function(){var i=this;if(arguments.length===1)for(var s=arguments[0],u=0;u<2;u++)for(var d=1;d<3;d++){var _=s.getLocation(u,d);(_===Xt.EXTERIOR||_===Xt.INTERIOR)&&(i.isNull(u,d)?i._depth[u][d]=Ms.depthAtLocation(_):i._depth[u][d]+=Ms.depthAtLocation(_))}else if(arguments.length===3){var b=arguments[0],C=arguments[1],l=arguments[2];l===Xt.INTERIOR&&this._depth[b][C]++}};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};Ms.depthAtLocation=function(i){return i===Xt.EXTERIOR?0:i===Xt.INTERIOR?1:Ms.NULL_VALUE};iT.NULL_VALUE.get=function(){return-1};Object.defineProperties(Ms,iT);var N0=function(i){function s(){if(i.call(this),this.pts=null,this._env=null,this.eiList=new Sh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ms,this._depthDelta=0,arguments.length===1){var u=arguments[0];s.call(this,u,null)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.pts=d,this._label=_}}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.getDepth=function(){return this._depth},s.prototype.getCollapsedEdge=function(){var u=new Array(2).fill(null);u[0]=this.pts[0],u[1]=this.pts[1];var d=new s(u,Kn.toLineLabel(this._label));return d},s.prototype.isIsolated=function(){return this._isIsolated},s.prototype.getCoordinates=function(){return this.pts},s.prototype.setIsolated=function(u){this._isIsolated=u},s.prototype.setName=function(u){this._name=u},s.prototype.equals=function(u){var d=this;if(!(u instanceof s))return!1;var _=u;if(this.pts.length!==_.pts.length)return!1;for(var b=!0,C=!0,l=this.pts.length,V=0;V<this.pts.length;V++)if(d.pts[V].equals2D(_.pts[V])||(b=!1),d.pts[V].equals2D(_.pts[--l])||(C=!1),!b&&!C)return!1;return!0},s.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var u=arguments[0];return this.pts[u]}},s.prototype.print=function(u){var d=this;u.print("edge "+this._name+": "),u.print("LINESTRING (");for(var _=0;_<this.pts.length;_++)_>0&&u.print(","),u.print(d.pts[_].x+" "+d.pts[_].y);u.print(")  "+this._label+" "+this._depthDelta)},s.prototype.computeIM=function(u){s.updateIM(this._label,u)},s.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},s.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},s.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},s.prototype.getDepthDelta=function(){return this._depthDelta},s.prototype.getNumPoints=function(){return this.pts.length},s.prototype.printReverse=function(u){var d=this;u.print("edge "+this._name+": ");for(var _=this.pts.length-1;_>=0;_--)u.print(d.pts[_]+" ");u.println("")},s.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Qh(this)),this._mce},s.prototype.getEnvelope=function(){var u=this;if(this._env===null){this._env=new ir;for(var d=0;d<this.pts.length;d++)u._env.expandToInclude(u.pts[d])}return this._env},s.prototype.addIntersection=function(u,d,_,b){var C=new Vt(u.getIntersection(b)),l=d,V=u.getEdgeDistance(_,b),R=l+1;if(R<this.pts.length){var et=this.pts[R];C.equals2D(et)&&(l=R,V=0)}this.eiList.add(C,l,V)},s.prototype.toString=function(){var u=this,d=new wc;d.append("edge "+this._name+": "),d.append("LINESTRING (");for(var _=0;_<this.pts.length;_++)_>0&&d.append(","),d.append(u.pts[_].x+" "+u.pts[_].y);return d.append(")  "+this._label+" "+this._depthDelta),d.toString()},s.prototype.isPointwiseEqual=function(u){var d=this;if(this.pts.length!==u.pts.length)return!1;for(var _=0;_<this.pts.length;_++)if(!d.pts[_].equals2D(u.pts[_]))return!1;return!0},s.prototype.setDepthDelta=function(u){this._depthDelta=u},s.prototype.getEdgeIntersectionList=function(){return this.eiList},s.prototype.addIntersections=function(u,d,_){for(var b=this,C=0;C<u.getIntersectionNum();C++)b.addIntersection(u,d,_,C)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.updateIM=function(){if(arguments.length===2){var u=arguments[0],d=arguments[1];d.setAtLeastIfValid(u.getLocation(0,be.ON),u.getLocation(1,be.ON),1),u.isArea()&&(d.setAtLeastIfValid(u.getLocation(0,be.LEFT),u.getLocation(1,be.LEFT),2),d.setAtLeastIfValid(u.getLocation(0,be.RIGHT),u.getLocation(1,be.RIGHT),2))}else return i.prototype.updateIM.apply(this,arguments)},s}(Fl),ga=function(i){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Hu,this._bufParams=i||null};ga.prototype.setWorkingPrecisionModel=function(i){this._workingPrecisionModel=i};ga.prototype.insertUniqueEdge=function(i){var s=this._edgeList.findEqualEdge(i);if(s!==null){var u=s.getLabel(),d=i.getLabel();s.isPointwiseEqual(i)||(d=new Kn(i.getLabel()),d.flip()),u.merge(d);var _=ga.depthDelta(d),b=s.getDepthDelta(),C=b+_;s.setDepthDelta(C)}else this._edgeList.add(i),i.setDepthDelta(ga.depthDelta(i.getLabel()))};ga.prototype.buildSubgraphs=function(i,s){for(var u=new Pe,d=i.iterator();d.hasNext();){var _=d.next(),b=_.getRightmostCoordinate(),C=new wf(u),l=C.getDepth(b);_.computeDepth(l),_.findResultEdges(),u.add(_),s.add(_.getDirectedEdges(),_.getNodes())}};ga.prototype.createSubgraphs=function(i){for(var s=new Pe,u=i.getNodes().iterator();u.hasNext();){var d=u.next();if(!d.isVisited()){var _=new _a;_.create(d),s.add(_)}}return Xu.sort(s,Xu.reverseOrder()),s};ga.prototype.createEmptyResultGeometry=function(){var i=this._geomFact.createPolygon();return i};ga.prototype.getNoder=function(i){if(this._workingNoder!==null)return this._workingNoder;var s=new Mb,u=new md;return u.setPrecisionModel(i),s.setSegmentIntersector(new Bl(u)),s};ga.prototype.buffer=function(i,s){var u=this._workingPrecisionModel;u===null&&(u=i.getPrecisionModel()),this._geomFact=i.getFactory();var d=new Fa(u,this._bufParams),_=new du(i,s,d),b=_.getCurves();if(b.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(b,u),this._graph=new io(new nT),this._graph.addEdges(this._edgeList.getEdges());var C=this.createSubgraphs(this._graph),l=new sl(this._geomFact);this.buildSubgraphs(C,l);var V=l.getPolygons();if(V.size()<=0)return this.createEmptyResultGeometry();var R=this._geomFact.buildGeometry(V);return R};ga.prototype.computeNodedEdges=function(i,s){var u=this,d=this.getNoder(s);d.computeNodes(i);for(var _=d.getNodedSubstrings(),b=_.iterator();b.hasNext();){var C=b.next(),l=C.getCoordinates();if(!(l.length===2&&l[0].equals2D(l[1]))){var V=C.getData(),R=new N0(C.getCoordinates(),new Kn(V));u.insertUniqueEdge(R)}}};ga.prototype.setNoder=function(i){this._workingNoder=i};ga.prototype.interfaces_=function(){return[]};ga.prototype.getClass=function(){return ga};ga.depthDelta=function(i){var s=i.getLocation(0,be.LEFT),u=i.getLocation(0,be.RIGHT);return s===Xt.INTERIOR&&u===Xt.EXTERIOR?1:s===Xt.EXTERIOR&&u===Xt.INTERIOR?-1:0};ga.convertSegStrings=function(i){for(var s=new Wr,u=new Pe;i.hasNext();){var d=i.next(),_=s.createLineString(d.getCoordinates());u.add(_)}return s.buildGeometry(u)};var Gp=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var i=arguments[0],s=arguments[1];this._noder=i,this._scaleFactor=s,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var u=arguments[0],d=arguments[1],_=arguments[2],b=arguments[3];this._noder=u,this._scaleFactor=d,this._offsetX=_,this._offsetY=b,this._isScaled=!this.isIntegerPrecision()}};Gp.prototype.rescale=function(){var i=this;if(xr(arguments[0],Yo))for(var s=arguments[0],u=s.iterator();u.hasNext();){var d=u.next();i.rescale(d.getCoordinates())}else if(arguments[0]instanceof Array){for(var _=arguments[0],b=0;b<_.length;b++)_[b].x=_[b].x/i._scaleFactor+i._offsetX,_[b].y=_[b].y/i._scaleFactor+i._offsetY;_.length===2&&_[0].equals2D(_[1])&&Ds.out.println(_)}};Gp.prototype.scale=function(){var i=this;if(xr(arguments[0],Yo)){for(var s=arguments[0],u=new Pe,d=s.iterator();d.hasNext();){var _=d.next();u.add(new Lo(i.scale(_.getCoordinates()),_.getData()))}return u}else if(arguments[0]instanceof Array){for(var b=arguments[0],C=new Array(b.length).fill(null),l=0;l<b.length;l++)C[l]=new Vt(Math.round((b[l].x-i._offsetX)*i._scaleFactor),Math.round((b[l].y-i._offsetY)*i._scaleFactor),b[l].z);var V=Jr.removeRepeatedPoints(C);return V}};Gp.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Gp.prototype.getNodedSubstrings=function(){var i=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(i),i};Gp.prototype.computeNodes=function(i){var s=i;this._isScaled&&(s=this.scale(i)),this._noder.computeNodes(s)};Gp.prototype.interfaces_=function(){return[ad]};Gp.prototype.getClass=function(){return Gp};var vc=function(){this._li=new md,this._segStrings=null;var i=arguments[0];this._segStrings=i},oT={fact:{configurable:!0}};vc.prototype.checkEndPtVertexIntersections=function(){var i=this;if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var u=s.next(),d=u.getCoordinates();i.checkEndPtVertexIntersections(d[0],i._segStrings),i.checkEndPtVertexIntersections(d[d.length-1],i._segStrings)}else if(arguments.length===2){for(var _=arguments[0],b=arguments[1],C=b.iterator();C.hasNext();)for(var l=C.next(),V=l.getCoordinates(),R=1;R<V.length-1;R++)if(V[R].equals(_))throw new Yh("found endpt/interior pt intersection at index "+R+" :pt "+_)}};vc.prototype.checkInteriorIntersections=function(){var i=this;if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();)for(var u=s.next(),d=this._segStrings.iterator();d.hasNext();){var _=d.next();i.checkInteriorIntersections(u,_)}else if(arguments.length===2)for(var b=arguments[0],C=arguments[1],l=b.getCoordinates(),V=C.getCoordinates(),R=0;R<l.length-1;R++)for(var et=0;et<V.length-1;et++)i.checkInteriorIntersections(b,R,C,et);else if(arguments.length===4){var at=arguments[0],st=arguments[1],yt=arguments[2],xt=arguments[3];if(at===yt&&st===xt)return null;var It=at.getCoordinates()[st],Pt=at.getCoordinates()[st+1],qt=yt.getCoordinates()[xt],Qt=yt.getCoordinates()[xt+1];if(this._li.computeIntersection(It,Pt,qt,Qt),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,It,Pt)||this.hasInteriorIntersection(this._li,qt,Qt)))throw new Yh("found non-noded intersection at "+It+"-"+Pt+" and "+qt+"-"+Qt)}};vc.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};vc.prototype.checkCollapses=function(){var i=this;if(arguments.length===0)for(var s=this._segStrings.iterator();s.hasNext();){var u=s.next();i.checkCollapses(u)}else if(arguments.length===1)for(var d=arguments[0],_=d.getCoordinates(),b=0;b<_.length-2;b++)i.checkCollapse(_[b],_[b+1],_[b+2])};vc.prototype.hasInteriorIntersection=function(i,s,u){for(var d=0;d<i.getIntersectionNum();d++){var _=i.getIntersection(d);if(!(_.equals(s)||_.equals(u)))return!0}return!1};vc.prototype.checkCollapse=function(i,s,u){if(i.equals(u))throw new Yh("found non-noded collapse at "+vc.fact.createLineString([i,s,u]))};vc.prototype.interfaces_=function(){return[]};vc.prototype.getClass=function(){return vc};oT.fact.get=function(){return new Wr};Object.defineProperties(vc,oT);var Na=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var i=arguments[0],s=arguments[1],u=arguments[2];if(this._originalPt=i,this._pt=i,this._scaleFactor=s,this._li=u,s<=0)throw new $i("Scale factor must be non-zero");s!==1&&(this._pt=new Vt(this.scale(i.x),this.scale(i.y)),this._p0Scaled=new Vt,this._p1Scaled=new Vt),this.initCorners(this._pt)},sT={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Na.prototype.intersectsScaled=function(i,s){var u=Math.min(i.x,s.x),d=Math.max(i.x,s.x),_=Math.min(i.y,s.y),b=Math.max(i.y,s.y),C=this._maxx<u||this._minx>d||this._maxy<_||this._miny>b;if(C)return!1;var l=this.intersectsToleranceSquare(i,s);return Nr.isTrue(!(C&&l),"Found bad envelope test"),l};Na.prototype.initCorners=function(i){var s=.5;this._minx=i.x-s,this._maxx=i.x+s,this._miny=i.y-s,this._maxy=i.y+s,this._corner[0]=new Vt(this._maxx,this._maxy),this._corner[1]=new Vt(this._minx,this._maxy),this._corner[2]=new Vt(this._minx,this._miny),this._corner[3]=new Vt(this._maxx,this._miny)};Na.prototype.intersects=function(i,s){return this._scaleFactor===1?this.intersectsScaled(i,s):(this.copyScaled(i,this._p0Scaled),this.copyScaled(s,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Na.prototype.scale=function(i){return Math.round(i*this._scaleFactor)};Na.prototype.getCoordinate=function(){return this._originalPt};Na.prototype.copyScaled=function(i,s){s.x=this.scale(i.x),s.y=this.scale(i.y)};Na.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var i=Na.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ir(this._originalPt.x-i,this._originalPt.x+i,this._originalPt.y-i,this._originalPt.y+i)}return this._safeEnv};Na.prototype.intersectsPixelClosure=function(i,s){return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Na.prototype.intersectsToleranceSquare=function(i,s){var u=!1,d=!1;return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(u=!0),this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(d=!0),this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),this._li.isProper())||u&&d||i.equals(this._pt)||s.equals(this._pt))};Na.prototype.addSnappedNode=function(i,s){var u=i.getCoordinate(s),d=i.getCoordinate(s+1);return this.intersects(u,d)?(i.addIntersection(this.getCoordinate(),s),!0):!1};Na.prototype.interfaces_=function(){return[]};Na.prototype.getClass=function(){return Na};sT.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Na,sT);var qy=function(){this.tempEnv1=new ir,this.selectedSegment=new sr};qy.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var i=arguments[0],s=arguments[1];i.getLineSegment(s,this.selectedSegment),this.select(this.selectedSegment)}};qy.prototype.interfaces_=function(){return[]};qy.prototype.getClass=function(){return qy};var Im=function(){this._index=null;var i=arguments[0];this._index=i},aT={HotPixelSnapAction:{configurable:!0}};Im.prototype.snap=function(){if(arguments.length===1){var i=arguments[0];return this.snap(i,null,-1)}else if(arguments.length===3){var s=arguments[0],u=arguments[1],d=arguments[2],_=s.getSafeEnvelope(),b=new lT(s,u,d);return this._index.query(_,{interfaces_:function(){return[Vp]},visitItem:function(C){var l=C;l.select(_,b)}}),b.isNodeAdded()}};Im.prototype.interfaces_=function(){return[]};Im.prototype.getClass=function(){return Im};aT.HotPixelSnapAction.get=function(){return lT};Object.defineProperties(Im,aT);var lT=function(i){function s(){i.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var u=arguments[0],d=arguments[1],_=arguments[2];this._hotPixel=u,this._parentEdge=d,this._hotPixelVertexIndex=_}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.isNodeAdded=function(){return this._isNodeAdded},s.prototype.select=function(){if(arguments.length===2){var u=arguments[0],d=arguments[1],_=u.getContext();if(this._parentEdge!==null&&_===this._parentEdge&&d===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(_,d)}else return i.prototype.select.apply(this,arguments)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(qy),Sf=function(){this._li=null,this._interiorIntersections=null;var i=arguments[0];this._li=i,this._interiorIntersections=new Pe};Sf.prototype.processIntersections=function(i,s,u,d){var _=this;if(i===u&&s===d)return null;var b=i.getCoordinates()[s],C=i.getCoordinates()[s+1],l=u.getCoordinates()[d],V=u.getCoordinates()[d+1];if(this._li.computeIntersection(b,C,l,V),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var R=0;R<this._li.getIntersectionNum();R++)_._interiorIntersections.add(_._li.getIntersection(R));i.addIntersections(this._li,s,0),u.addIntersections(this._li,d,1)}};Sf.prototype.isDone=function(){return!1};Sf.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Sf.prototype.interfaces_=function(){return[ud]};Sf.prototype.getClass=function(){return Sf};var Eh=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var i=arguments[0];this._pm=i,this._li=new md,this._li.setPrecisionModel(i),this._scaleFactor=i.getScale()};Eh.prototype.checkCorrectness=function(i){var s=Lo.getNodedSubstrings(i),u=new vc(s);try{u.checkValid()}catch(d){if(d instanceof ZE)d.printStackTrace();else throw d}finally{}};Eh.prototype.getNodedSubstrings=function(){return Lo.getNodedSubstrings(this._nodedSegStrings)};Eh.prototype.snapRound=function(i,s){var u=this.findInteriorIntersections(i,s);this.computeIntersectionSnaps(u),this.computeVertexSnaps(i)};Eh.prototype.findInteriorIntersections=function(i,s){var u=new Sf(s);return this._noder.setSegmentIntersector(u),this._noder.computeNodes(i),u.getInteriorIntersections()};Eh.prototype.computeVertexSnaps=function(){var i=this;if(xr(arguments[0],Yo))for(var s=arguments[0],u=s.iterator();u.hasNext();){var d=u.next();i.computeVertexSnaps(d)}else if(arguments[0]instanceof Lo)for(var _=arguments[0],b=_.getCoordinates(),C=0;C<b.length;C++){var l=new Na(b[C],i._scaleFactor,i._li),V=i._pointSnapper.snap(l,_,C);V&&_.addIntersection(b[C],C)}};Eh.prototype.computeNodes=function(i){this._nodedSegStrings=i,this._noder=new Mb,this._pointSnapper=new Im(this._noder.getIndex()),this.snapRound(i,this._li)};Eh.prototype.computeIntersectionSnaps=function(i){for(var s=this,u=i.iterator();u.hasNext();){var d=u.next(),_=new Na(d,s._scaleFactor,s._li);s._pointSnapper.snap(_)}};Eh.prototype.interfaces_=function(){return[ad]};Eh.prototype.getClass=function(){return Eh};var vs=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Mn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var i=arguments[0];this._argGeom=i}else if(arguments.length===2){var s=arguments[0],u=arguments[1];this._argGeom=s,this._bufParams=u}},Rm={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};vs.prototype.bufferFixedPrecision=function(i){var s=new Gp(new Eh(new Dn(1)),i.getScale()),u=new ga(this._bufParams);u.setWorkingPrecisionModel(i),u.setNoder(s),this._resultGeometry=u.buffer(this._argGeom,this._distance)};vs.prototype.bufferReducedPrecision=function(){var i=this;if(arguments.length===0){for(var s=vs.MAX_PRECISION_DIGITS;s>=0;s--){try{i.bufferReducedPrecision(s)}catch(b){if(b instanceof Jh)i._saveException=b;else throw b}finally{}if(i._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var u=arguments[0],d=vs.precisionScaleFactor(this._argGeom,this._distance,u),_=new Dn(d);this.bufferFixedPrecision(_)}};vs.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var i=this._argGeom.getFactory().getPrecisionModel();i.getType()===Dn.FIXED?this.bufferFixedPrecision(i):this.bufferReducedPrecision()};vs.prototype.setQuadrantSegments=function(i){this._bufParams.setQuadrantSegments(i)};vs.prototype.bufferOriginalPrecision=function(){try{var i=new ga(this._bufParams);this._resultGeometry=i.buffer(this._argGeom,this._distance)}catch(s){if(s instanceof Yh)this._saveException=s;else throw s}finally{}};vs.prototype.getResultGeometry=function(i){return this._distance=i,this.computeGeometry(),this._resultGeometry};vs.prototype.setEndCapStyle=function(i){this._bufParams.setEndCapStyle(i)};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};vs.bufferOp=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1],u=new vs(i),d=u.getResultGeometry(s);return d}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof mr&&typeof arguments[1]=="number"){var _=arguments[0],b=arguments[1],C=arguments[2],l=new vs(_);l.setQuadrantSegments(C);var V=l.getResultGeometry(b);return V}else if(arguments[2]instanceof Mn&&arguments[0]instanceof mr&&typeof arguments[1]=="number"){var R=arguments[0],et=arguments[1],at=arguments[2],st=new vs(R,at),yt=st.getResultGeometry(et);return yt}}else if(arguments.length===4){var xt=arguments[0],It=arguments[1],Pt=arguments[2],qt=arguments[3],Qt=new vs(xt);Qt.setQuadrantSegments(Pt),Qt.setEndCapStyle(qt);var se=Qt.getResultGeometry(It);return se}};vs.precisionScaleFactor=function(i,s,u){var d=i.getEnvelopeInternal(),_=Ol.max(Math.abs(d.getMaxX()),Math.abs(d.getMaxY()),Math.abs(d.getMinX()),Math.abs(d.getMinY())),b=s>0?s:0,C=_+2*b,l=Math.trunc(Math.log(C)/Math.log(10)+1),V=u-l,R=Math.pow(10,V);return R};Rm.CAP_ROUND.get=function(){return Mn.CAP_ROUND};Rm.CAP_BUTT.get=function(){return Mn.CAP_FLAT};Rm.CAP_FLAT.get=function(){return Mn.CAP_FLAT};Rm.CAP_SQUARE.get=function(){return Mn.CAP_SQUARE};Rm.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(vs,Rm);var fa=function(){this._pt=[new Vt,new Vt],this._distance=Lr.NaN,this._isNull=!0};fa.prototype.getCoordinates=function(){return this._pt};fa.prototype.getCoordinate=function(i){return this._pt[i]};fa.prototype.setMinimum=function(){if(arguments.length===1){var i=arguments[0];this.setMinimum(i._pt[0],i._pt[1])}else if(arguments.length===2){var s=arguments[0],u=arguments[1];if(this._isNull)return this.initialize(s,u),null;var d=s.distance(u);d<this._distance&&this.initialize(s,u,d)}};fa.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var i=arguments[0],s=arguments[1];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(s),this._distance=i.distance(s),this._isNull=!1}else if(arguments.length===3){var u=arguments[0],d=arguments[1],_=arguments[2];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(d),this._distance=_,this._isNull=!1}};fa.prototype.getDistance=function(){return this._distance};fa.prototype.setMaximum=function(){if(arguments.length===1){var i=arguments[0];this.setMaximum(i._pt[0],i._pt[1])}else if(arguments.length===2){var s=arguments[0],u=arguments[1];if(this._isNull)return this.initialize(s,u),null;var d=s.distance(u);d>this._distance&&this.initialize(s,u,d)}};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};var gh=function(){};gh.prototype.interfaces_=function(){return[]};gh.prototype.getClass=function(){return gh};gh.computeDistance=function(){if(arguments[2]instanceof fa&&arguments[0]instanceof uo&&arguments[1]instanceof Vt)for(var i=arguments[0],s=arguments[1],u=arguments[2],d=i.getCoordinates(),_=new sr,b=0;b<d.length-1;b++){_.setCoordinates(d[b],d[b+1]);var C=_.closestPoint(s);u.setMinimum(C,s)}else if(arguments[2]instanceof fa&&arguments[0]instanceof Jo&&arguments[1]instanceof Vt){var l=arguments[0],V=arguments[1],R=arguments[2];gh.computeDistance(l.getExteriorRing(),V,R);for(var et=0;et<l.getNumInteriorRing();et++)gh.computeDistance(l.getInteriorRingN(et),V,R)}else if(arguments[2]instanceof fa&&arguments[0]instanceof mr&&arguments[1]instanceof Vt){var at=arguments[0],st=arguments[1],yt=arguments[2];if(at instanceof uo)gh.computeDistance(at,st,yt);else if(at instanceof Jo)gh.computeDistance(at,st,yt);else if(at instanceof ya)for(var xt=at,It=0;It<xt.getNumGeometries();It++){var Pt=xt.getGeometryN(It);gh.computeDistance(Pt,st,yt)}else yt.setMinimum(at.getCoordinate(),st)}else if(arguments[2]instanceof fa&&arguments[0]instanceof sr&&arguments[1]instanceof Vt){var qt=arguments[0],Qt=arguments[1],se=arguments[2],le=qt.closestPoint(Qt);se.setMinimum(le,Qt)}};var hd=function(i){this._maxPtDist=new fa,this._inputGeom=i||null},Db={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};hd.prototype.computeMaxMidpointDistance=function(i){var s=new qp(this._inputGeom);i.apply(s),this._maxPtDist.setMaximum(s.getMaxPointDistance())};hd.prototype.computeMaxVertexDistance=function(i){var s=new Ef(this._inputGeom);i.apply(s),this._maxPtDist.setMaximum(s.getMaxPointDistance())};hd.prototype.findDistance=function(i){return this.computeMaxVertexDistance(i),this.computeMaxMidpointDistance(i),this._maxPtDist.getDistance()};hd.prototype.getDistancePoints=function(){return this._maxPtDist};hd.prototype.interfaces_=function(){return[]};hd.prototype.getClass=function(){return hd};Db.MaxPointDistanceFilter.get=function(){return Ef};Db.MaxMidpointDistanceFilter.get=function(){return qp};Object.defineProperties(hd,Db);var Ef=function(i){this._maxPtDist=new fa,this._minPtDist=new fa,this._geom=i||null};Ef.prototype.filter=function(i){this._minPtDist.initialize(),gh.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ef.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ef.prototype.interfaces_=function(){return[vh]};Ef.prototype.getClass=function(){return Ef};var qp=function(i){this._maxPtDist=new fa,this._minPtDist=new fa,this._geom=i||null};qp.prototype.filter=function(i,s){if(s===0)return null;var u=i.getCoordinate(s-1),d=i.getCoordinate(s),_=new Vt((u.x+d.x)/2,(u.y+d.y)/2);this._minPtDist.initialize(),gh.computeDistance(this._geom,_,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};qp.prototype.isDone=function(){return!1};qp.prototype.isGeometryChanged=function(){return!1};qp.prototype.getMaxPointDistance=function(){return this._maxPtDist};qp.prototype.interfaces_=function(){return[$u]};qp.prototype.getClass=function(){return qp};var Hh=function(i){this._comps=i||null};Hh.prototype.filter=function(i){i instanceof Jo&&this._comps.add(i)};Hh.prototype.interfaces_=function(){return[fc]};Hh.prototype.getClass=function(){return Hh};Hh.getPolygons=function(){if(arguments.length===1){var i=arguments[0];return Hh.getPolygons(i,new Pe)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];return s instanceof Jo?u.add(s):s instanceof ya&&s.apply(new Hh(u)),u}};var Ls=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var i=arguments[0];this._lines=i}else if(arguments.length===2){var s=arguments[0],u=arguments[1];this._lines=s,this._isForcedToLineString=u}};Ls.prototype.filter=function(i){if(this._isForcedToLineString&&i instanceof xh){var s=i.getFactory().createLineString(i.getCoordinateSequence());return this._lines.add(s),null}i instanceof uo&&this._lines.add(i)};Ls.prototype.setForceToLineString=function(i){this._isForcedToLineString=i};Ls.prototype.interfaces_=function(){return[Wh]};Ls.prototype.getClass=function(){return Ls};Ls.getGeometry=function(){if(arguments.length===1){var i=arguments[0];return i.getFactory().buildGeometry(Ls.getLines(i))}else if(arguments.length===2){var s=arguments[0],u=arguments[1];return s.getFactory().buildGeometry(Ls.getLines(s,u))}};Ls.getLines=function(){if(arguments.length===1){var i=arguments[0];return Ls.getLines(i,!1)}else if(arguments.length===2){if(xr(arguments[0],Yo)&&xr(arguments[1],Yo)){for(var s=arguments[0],u=arguments[1],d=s.iterator();d.hasNext();){var _=d.next();Ls.getLines(_,u)}return u}else if(arguments[0]instanceof mr&&typeof arguments[1]=="boolean"){var b=arguments[0],C=arguments[1],l=new Pe;return b.apply(new Ls(l,C)),l}else if(arguments[0]instanceof mr&&xr(arguments[1],Yo)){var V=arguments[0],R=arguments[1];return V instanceof uo?R.add(V):V.apply(new Ls(R)),R}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&xr(arguments[0],Yo)&&xr(arguments[1],Yo)){for(var et=arguments[0],at=arguments[1],st=arguments[2],yt=et.iterator();yt.hasNext();){var xt=yt.next();Ls.getLines(xt,at,st)}return at}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof mr&&xr(arguments[1],Yo)){var It=arguments[0],Pt=arguments[1],qt=arguments[2];return It.apply(new Ls(Pt,qt)),Pt}}};var Yu=function(){if(this._boundaryRule=hu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var i=arguments[0];if(i===null)throw new $i("Rule must be non-null");this._boundaryRule=i}};Yu.prototype.locateInternal=function(){var i=this;if(arguments[0]instanceof Vt&&arguments[1]instanceof Jo){var s=arguments[0],u=arguments[1];if(u.isEmpty())return Xt.EXTERIOR;var d=u.getExteriorRing(),_=this.locateInPolygonRing(s,d);if(_===Xt.EXTERIOR)return Xt.EXTERIOR;if(_===Xt.BOUNDARY)return Xt.BOUNDARY;for(var b=0;b<u.getNumInteriorRing();b++){var C=u.getInteriorRingN(b),l=i.locateInPolygonRing(s,C);if(l===Xt.INTERIOR)return Xt.EXTERIOR;if(l===Xt.BOUNDARY)return Xt.BOUNDARY}return Xt.INTERIOR}else if(arguments[0]instanceof Vt&&arguments[1]instanceof uo){var V=arguments[0],R=arguments[1];if(!R.getEnvelopeInternal().intersects(V))return Xt.EXTERIOR;var et=R.getCoordinates();return!R.isClosed()&&(V.equals(et[0])||V.equals(et[et.length-1]))?Xt.BOUNDARY:Fe.isOnLine(V,et)?Xt.INTERIOR:Xt.EXTERIOR}else if(arguments[0]instanceof Vt&&arguments[1]instanceof ol){var at=arguments[0],st=arguments[1],yt=st.getCoordinate();return yt.equals2D(at)?Xt.INTERIOR:Xt.EXTERIOR}};Yu.prototype.locateInPolygonRing=function(i,s){return s.getEnvelopeInternal().intersects(i)?Fe.locatePointInRing(i,s.getCoordinates()):Xt.EXTERIOR};Yu.prototype.intersects=function(i,s){return this.locate(i,s)!==Xt.EXTERIOR};Yu.prototype.updateLocationInfo=function(i){i===Xt.INTERIOR&&(this._isIn=!0),i===Xt.BOUNDARY&&this._numBoundaries++};Yu.prototype.computeLocation=function(i,s){var u=this;if(s instanceof ol&&this.updateLocationInfo(this.locateInternal(i,s)),s instanceof uo)this.updateLocationInfo(this.locateInternal(i,s));else if(s instanceof Jo)this.updateLocationInfo(this.locateInternal(i,s));else if(s instanceof sd)for(var d=s,_=0;_<d.getNumGeometries();_++){var b=d.getGeometryN(_);u.updateLocationInfo(u.locateInternal(i,b))}else if(s instanceof yh)for(var C=s,l=0;l<C.getNumGeometries();l++){var V=C.getGeometryN(l);u.updateLocationInfo(u.locateInternal(i,V))}else if(s instanceof ya)for(var R=new _h(s);R.hasNext();){var et=R.next();et!==s&&u.computeLocation(i,et)}};Yu.prototype.locate=function(i,s){return s.isEmpty()?Xt.EXTERIOR:s instanceof uo?this.locateInternal(i,s):s instanceof Jo?this.locateInternal(i,s):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(i,s),this._boundaryRule.isInBoundary(this._numBoundaries)?Xt.BOUNDARY:this._numBoundaries>0||this._isIn?Xt.INTERIOR:Xt.EXTERIOR)};Yu.prototype.interfaces_=function(){return[]};Yu.prototype.getClass=function(){return Yu};var ma=function i(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var s=arguments[0],u=arguments[1];i.call(this,s,i.INSIDE_AREA,u)}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2];this._component=d,this._segIndex=_,this._pt=b}},uT={INSIDE_AREA:{configurable:!0}};ma.prototype.isInsideArea=function(){return this._segIndex===ma.INSIDE_AREA};ma.prototype.getCoordinate=function(){return this._pt};ma.prototype.getGeometryComponent=function(){return this._component};ma.prototype.getSegmentIndex=function(){return this._segIndex};ma.prototype.interfaces_=function(){return[]};ma.prototype.getClass=function(){return ma};uT.INSIDE_AREA.get=function(){return-1};Object.defineProperties(ma,uT);var Fp=function(i){this._pts=i||null};Fp.prototype.filter=function(i){i instanceof ol&&this._pts.add(i)};Fp.prototype.interfaces_=function(){return[fc]};Fp.prototype.getClass=function(){return Fp};Fp.getPoints=function(){if(arguments.length===1){var i=arguments[0];return i instanceof ol?Xu.singletonList(i):Fp.getPoints(i,new Pe)}else if(arguments.length===2){var s=arguments[0],u=arguments[1];return s instanceof ol?u.add(s):s instanceof ya&&s.apply(new Fp(u)),u}};var Tf=function(){this._locations=null;var i=arguments[0];this._locations=i};Tf.prototype.filter=function(i){(i instanceof ol||i instanceof uo||i instanceof Jo)&&this._locations.add(new ma(i,0,i.getCoordinate()))};Tf.prototype.interfaces_=function(){return[fc]};Tf.prototype.getClass=function(){return Tf};Tf.getLocations=function(i){var s=new Pe;return i.apply(new Tf(s)),s};var ks=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Yu,this._minDistanceLocation=null,this._minDistance=Lr.MAX_VALUE,arguments.length===2){var i=arguments[0],s=arguments[1];this._geom=[i,s],this._terminateDistance=0}else if(arguments.length===3){var u=arguments[0],d=arguments[1],_=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=u,this._geom[1]=d,this._terminateDistance=_}};ks.prototype.computeContainmentDistance=function(){var i=this;if(arguments.length===0){var s=new Array(2).fill(null);if(this.computeContainmentDistance(0,s),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,s)}else if(arguments.length===2){var u=arguments[0],d=arguments[1],_=1-u,b=Hh.getPolygons(this._geom[u]);if(b.size()>0){var C=Tf.getLocations(this._geom[_]);if(this.computeContainmentDistance(C,b,d),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[_]=d[0],this._minDistanceLocation[u]=d[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&xr(arguments[0],Gu)&&xr(arguments[1],Gu)){for(var l=arguments[0],V=arguments[1],R=arguments[2],et=0;et<l.size();et++)for(var at=l.get(et),st=0;st<V.size();st++)if(i.computeContainmentDistance(at,V.get(st),R),i._minDistance<=i._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof ma&&arguments[1]instanceof Jo){var yt=arguments[0],xt=arguments[1],It=arguments[2],Pt=yt.getCoordinate();if(Xt.EXTERIOR!==this._ptLocator.locate(Pt,xt))return this._minDistance=0,It[0]=yt,It[1]=new ma(xt,Pt),null}}};ks.prototype.computeMinDistanceLinesPoints=function(i,s,u){for(var d=this,_=0;_<i.size();_++)for(var b=i.get(_),C=0;C<s.size();C++){var l=s.get(C);if(d.computeMinDistance(b,l,u),d._minDistance<=d._terminateDistance)return null}};ks.prototype.computeFacetDistance=function(){var i=new Array(2).fill(null),s=Ls.getLines(this._geom[0]),u=Ls.getLines(this._geom[1]),d=Fp.getPoints(this._geom[0]),_=Fp.getPoints(this._geom[1]);if(this.computeMinDistanceLines(s,u,i),this.updateMinDistance(i,!1),this._minDistance<=this._terminateDistance||(i[0]=null,i[1]=null,this.computeMinDistanceLinesPoints(s,_,i),this.updateMinDistance(i,!1),this._minDistance<=this._terminateDistance)||(i[0]=null,i[1]=null,this.computeMinDistanceLinesPoints(u,d,i),this.updateMinDistance(i,!0),this._minDistance<=this._terminateDistance))return null;i[0]=null,i[1]=null,this.computeMinDistancePoints(d,_,i),this.updateMinDistance(i,!1)};ks.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ks.prototype.updateMinDistance=function(i,s){if(i[0]===null)return null;s?(this._minDistanceLocation[0]=i[1],this._minDistanceLocation[1]=i[0]):(this._minDistanceLocation[0]=i[0],this._minDistanceLocation[1]=i[1])};ks.prototype.nearestPoints=function(){this.computeMinDistance();var i=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return i};ks.prototype.computeMinDistance=function(){var i=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof uo&&arguments[1]instanceof ol){var s=arguments[0],u=arguments[1],d=arguments[2];if(s.getEnvelopeInternal().distance(u.getEnvelopeInternal())>this._minDistance)return null;for(var _=s.getCoordinates(),b=u.getCoordinate(),C=0;C<_.length-1;C++){var l=Fe.distancePointLine(b,_[C],_[C+1]);if(l<i._minDistance){i._minDistance=l;var V=new sr(_[C],_[C+1]),R=V.closestPoint(b);d[0]=new ma(s,C,R),d[1]=new ma(u,0,b)}if(i._minDistance<=i._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof uo&&arguments[1]instanceof uo){var et=arguments[0],at=arguments[1],st=arguments[2];if(et.getEnvelopeInternal().distance(at.getEnvelopeInternal())>this._minDistance)return null;for(var yt=et.getCoordinates(),xt=at.getCoordinates(),It=0;It<yt.length-1;It++)for(var Pt=0;Pt<xt.length-1;Pt++){var qt=Fe.distanceLineLine(yt[It],yt[It+1],xt[Pt],xt[Pt+1]);if(qt<i._minDistance){i._minDistance=qt;var Qt=new sr(yt[It],yt[It+1]),se=new sr(xt[Pt],xt[Pt+1]),le=Qt.closestPoints(se);st[0]=new ma(et,It,le[0]),st[1]=new ma(at,Pt,le[1])}if(i._minDistance<=i._terminateDistance)return null}}}};ks.prototype.computeMinDistancePoints=function(i,s,u){for(var d=this,_=0;_<i.size();_++)for(var b=i.get(_),C=0;C<s.size();C++){var l=s.get(C),V=b.getCoordinate().distance(l.getCoordinate());if(V<d._minDistance&&(d._minDistance=V,u[0]=new ma(b,0,b.getCoordinate()),u[1]=new ma(l,0,l.getCoordinate())),d._minDistance<=d._terminateDistance)return null}};ks.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new $i("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ks.prototype.computeMinDistanceLines=function(i,s,u){for(var d=this,_=0;_<i.size();_++)for(var b=i.get(_),C=0;C<s.size();C++){var l=s.get(C);if(d.computeMinDistance(b,l,u),d._minDistance<=d._terminateDistance)return null}};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};ks.distance=function(i,s){var u=new ks(i,s);return u.distance()};ks.isWithinDistance=function(i,s,u){var d=new ks(i,s,u);return d.distance()<=u};ks.nearestPoints=function(i,s){var u=new ks(i,s);return u.nearestPoints()};var Qs=function(){this._pt=[new Vt,new Vt],this._distance=Lr.NaN,this._isNull=!0};Qs.prototype.getCoordinates=function(){return this._pt};Qs.prototype.getCoordinate=function(i){return this._pt[i]};Qs.prototype.setMinimum=function(){if(arguments.length===1){var i=arguments[0];this.setMinimum(i._pt[0],i._pt[1])}else if(arguments.length===2){var s=arguments[0],u=arguments[1];if(this._isNull)return this.initialize(s,u),null;var d=s.distance(u);d<this._distance&&this.initialize(s,u,d)}};Qs.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var i=arguments[0],s=arguments[1];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(s),this._distance=i.distance(s),this._isNull=!1}else if(arguments.length===3){var u=arguments[0],d=arguments[1],_=arguments[2];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(d),this._distance=_,this._isNull=!1}};Qs.prototype.toString=function(){return qu.toLineString(this._pt[0],this._pt[1])};Qs.prototype.getDistance=function(){return this._distance};Qs.prototype.setMaximum=function(){if(arguments.length===1){var i=arguments[0];this.setMaximum(i._pt[0],i._pt[1])}else if(arguments.length===2){var s=arguments[0],u=arguments[1];if(this._isNull)return this.initialize(s,u),null;var d=s.distance(u);d>this._distance&&this.initialize(s,u,d)}};Qs.prototype.interfaces_=function(){return[]};Qs.prototype.getClass=function(){return Qs};var uc=function(){};uc.prototype.interfaces_=function(){return[]};uc.prototype.getClass=function(){return uc};uc.computeDistance=function(){if(arguments[2]instanceof Qs&&arguments[0]instanceof uo&&arguments[1]instanceof Vt)for(var i=arguments[0],s=arguments[1],u=arguments[2],d=new sr,_=i.getCoordinates(),b=0;b<_.length-1;b++){d.setCoordinates(_[b],_[b+1]);var C=d.closestPoint(s);u.setMinimum(C,s)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof Jo&&arguments[1]instanceof Vt){var l=arguments[0],V=arguments[1],R=arguments[2];uc.computeDistance(l.getExteriorRing(),V,R);for(var et=0;et<l.getNumInteriorRing();et++)uc.computeDistance(l.getInteriorRingN(et),V,R)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof mr&&arguments[1]instanceof Vt){var at=arguments[0],st=arguments[1],yt=arguments[2];if(at instanceof uo)uc.computeDistance(at,st,yt);else if(at instanceof Jo)uc.computeDistance(at,st,yt);else if(at instanceof ya)for(var xt=at,It=0;It<xt.getNumGeometries();It++){var Pt=xt.getGeometryN(It);uc.computeDistance(Pt,st,yt)}else yt.setMinimum(at.getCoordinate(),st)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof sr&&arguments[1]instanceof Vt){var qt=arguments[0],Qt=arguments[1],se=arguments[2],le=qt.closestPoint(Qt);se.setMinimum(le,Qt)}};var cu=function(){this._g0=null,this._g1=null,this._ptDist=new Qs,this._densifyFrac=0;var i=arguments[0],s=arguments[1];this._g0=i,this._g1=s},kb={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};cu.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};cu.prototype.setDensifyFraction=function(i){if(i>1||i<=0)throw new $i("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=i};cu.prototype.compute=function(i,s){this.computeOrientedDistance(i,s,this._ptDist),this.computeOrientedDistance(s,i,this._ptDist)};cu.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};cu.prototype.computeOrientedDistance=function(i,s,u){var d=new If(s);if(i.apply(d),u.setMaximum(d.getMaxPointDistance()),this._densifyFrac>0){var _=new $p(s,this._densifyFrac);i.apply(_),u.setMaximum(_.getMaxPointDistance())}};cu.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};cu.prototype.interfaces_=function(){return[]};cu.prototype.getClass=function(){return cu};cu.distance=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1],u=new cu(i,s);return u.distance()}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2],C=new cu(d,_);return C.setDensifyFraction(b),C.distance()}};kb.MaxPointDistanceFilter.get=function(){return If};kb.MaxDensifiedByFractionDistanceFilter.get=function(){return $p};Object.defineProperties(cu,kb);var If=function(){this._maxPtDist=new Qs,this._minPtDist=new Qs,this._euclideanDist=new uc,this._geom=null;var i=arguments[0];this._geom=i};If.prototype.filter=function(i){this._minPtDist.initialize(),uc.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};If.prototype.getMaxPointDistance=function(){return this._maxPtDist};If.prototype.interfaces_=function(){return[vh]};If.prototype.getClass=function(){return If};var $p=function(){this._maxPtDist=new Qs,this._minPtDist=new Qs,this._geom=null,this._numSubSegs=0;var i=arguments[0],s=arguments[1];this._geom=i,this._numSubSegs=Math.trunc(Math.round(1/s))};$p.prototype.filter=function(i,s){var u=this;if(s===0)return null;for(var d=i.getCoordinate(s-1),_=i.getCoordinate(s),b=(_.x-d.x)/this._numSubSegs,C=(_.y-d.y)/this._numSubSegs,l=0;l<this._numSubSegs;l++){var V=d.x+l*b,R=d.y+l*C,et=new Vt(V,R);u._minPtDist.initialize(),uc.computeDistance(u._geom,et,u._minPtDist),u._maxPtDist.setMaximum(u._minPtDist)}};$p.prototype.isDone=function(){return!1};$p.prototype.isGeometryChanged=function(){return!1};$p.prototype.getMaxPointDistance=function(){return this._maxPtDist};$p.prototype.interfaces_=function(){return[$u]};$p.prototype.getClass=function(){return $p};var il=function(i,s,u){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=i||null,this._bufDistance=s||null,this._result=u||null},zb={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};il.prototype.checkMaximumDistance=function(i,s,u){var d=new cu(s,i);if(d.setDensifyFraction(.25),this._maxDistanceFound=d.orientedDistance(),this._maxDistanceFound>u){this._isValid=!1;var _=d.getCoordinates();this._errorLocation=_[1],this._errorIndicator=i.getFactory().createLineString(_),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+qu.toLineString(_[0],_[1])+")"}};il.prototype.isValid=function(){var i=Math.abs(this._bufDistance),s=il.MAX_DISTANCE_DIFF_FRAC*i;return this._minValidDistance=i-s,this._maxValidDistance=i+s,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),il.VERBOSE&&Ds.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};il.prototype.checkNegativeValid=function(){if(!(this._input instanceof Jo||this._input instanceof yh||this._input instanceof ya))return null;var i=this.getPolygonLines(this._input);if(this.checkMinimumDistance(i,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(i,this._result,this._maxValidDistance)};il.prototype.getErrorIndicator=function(){return this._errorIndicator};il.prototype.checkMinimumDistance=function(i,s,u){var d=new ks(i,s,u);if(this._minDistanceFound=d.distance(),this._minDistanceFound<u){this._isValid=!1;var _=d.nearestPoints();this._errorLocation=d.nearestPoints()[1],this._errorIndicator=i.getFactory().createLineString(_),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+qu.toLineString(_[0],_[1])+" )"}};il.prototype.checkPositiveValid=function(){var i=this._result.getBoundary();if(this.checkMinimumDistance(this._input,i,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,i,this._maxValidDistance)};il.prototype.getErrorLocation=function(){return this._errorLocation};il.prototype.getPolygonLines=function(i){for(var s=new Pe,u=new Ls(s),d=Hh.getPolygons(i),_=d.iterator();_.hasNext();){var b=_.next();b.apply(u)}return i.getFactory().buildGeometry(s)};il.prototype.getErrorMessage=function(){return this._errMsg};il.prototype.interfaces_=function(){return[]};il.prototype.getClass=function(){return il};zb.VERBOSE.get=function(){return!1};zb.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(il,zb);var zs=function(i,s,u){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=i||null,this._distance=s||null,this._result=u||null},Rb={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};zs.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};zs.prototype.checkEnvelope=function(){if(this._distance<0)return null;var i=this._distance*zs.MAX_ENV_DIFF_FRAC;i===0&&(i=.001);var s=new ir(this._input.getEnvelopeInternal());s.expandBy(this._distance);var u=new ir(this._result.getEnvelopeInternal());u.expandBy(i),u.contains(s)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(u)),this.report("Envelope")};zs.prototype.checkDistance=function(){var i=new il(this._input,this._distance,this._result);i.isValid()||(this._isValid=!1,this._errorMsg=i.getErrorMessage(),this._errorLocation=i.getErrorLocation(),this._errorIndicator=i.getErrorIndicator()),this.report("Distance")};zs.prototype.checkArea=function(){var i=this._input.getArea(),s=this._result.getArea();this._distance>0&&i>s&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&i<s&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};zs.prototype.checkPolygonal=function(){this._result instanceof Jo||this._result instanceof yh||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};zs.prototype.getErrorIndicator=function(){return this._errorIndicator};zs.prototype.getErrorLocation=function(){return this._errorLocation};zs.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};zs.prototype.report=function(i){if(!zs.VERBOSE)return null;Ds.out.println("Check "+i+": "+(this._isValid?"passed":"FAILED"))};zs.prototype.getErrorMessage=function(){return this._errorMsg};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};zs.isValidMsg=function(i,s,u){var d=new zs(i,s,u);return d.isValid()?null:d.getErrorMessage()};zs.isValid=function(i,s,u){var d=new zs(i,s,u);return!!d.isValid()};Rb.VERBOSE.get=function(){return!1};Rb.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(zs,Rb);var xc=function(){this._pts=null,this._data=null;var i=arguments[0],s=arguments[1];this._pts=i,this._data=s};xc.prototype.getCoordinates=function(){return this._pts};xc.prototype.size=function(){return this._pts.length};xc.prototype.getCoordinate=function(i){return this._pts[i]};xc.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};xc.prototype.getSegmentOctant=function(i){return i===this._pts.length-1?-1:bf.octant(this.getCoordinate(i),this.getCoordinate(i+1))};xc.prototype.setData=function(i){this._data=i};xc.prototype.getData=function(){return this._data};xc.prototype.toString=function(){return qu.toLineString(new Co(this._pts))};xc.prototype.interfaces_=function(){return[wh]};xc.prototype.getClass=function(){return xc};var bs=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Pe,this._intersectionCount=0,this._keepIntersections=!0;var i=arguments[0];this._li=i,this._interiorIntersection=null};bs.prototype.getInteriorIntersection=function(){return this._interiorIntersection};bs.prototype.setCheckEndSegmentsOnly=function(i){this._isCheckEndSegmentsOnly=i};bs.prototype.getIntersectionSegments=function(){return this._intSegments};bs.prototype.count=function(){return this._intersectionCount};bs.prototype.getIntersections=function(){return this._intersections};bs.prototype.setFindAllIntersections=function(i){this._findAllIntersections=i};bs.prototype.setKeepIntersections=function(i){this._keepIntersections=i};bs.prototype.processIntersections=function(i,s,u,d){if(!this._findAllIntersections&&this.hasIntersection()||i===u&&s===d)return null;if(this._isCheckEndSegmentsOnly){var _=this.isEndSegment(i,s)||this.isEndSegment(u,d);if(!_)return null}var b=i.getCoordinates()[s],C=i.getCoordinates()[s+1],l=u.getCoordinates()[d],V=u.getCoordinates()[d+1];this._li.computeIntersection(b,C,l,V),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=b,this._intSegments[1]=C,this._intSegments[2]=l,this._intSegments[3]=V,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};bs.prototype.isEndSegment=function(i,s){return s===0||s>=i.size()-2};bs.prototype.hasIntersection=function(){return this._interiorIntersection!==null};bs.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};bs.prototype.interfaces_=function(){return[ud]};bs.prototype.getClass=function(){return bs};bs.createAllIntersectionsFinder=function(i){var s=new bs(i);return s.setFindAllIntersections(!0),s};bs.createAnyIntersectionFinder=function(i){return new bs(i)};bs.createIntersectionCounter=function(i){var s=new bs(i);return s.setFindAllIntersections(!0),s.setKeepIntersections(!1),s};var Wu=function(){this._li=new md,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var i=arguments[0];this._segStrings=i};Wu.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Wu.prototype.getIntersections=function(){return this._segInt.getIntersections()};Wu.prototype.isValid=function(){return this.execute(),this._isValid};Wu.prototype.setFindAllIntersections=function(i){this._findAllIntersections=i};Wu.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new bs(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var i=new Mb;if(i.setSegmentIntersector(this._segInt),i.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Wu.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Jh(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Wu.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var i=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+qu.toLineString(i[0],i[1])+" and "+qu.toLineString(i[2],i[3])};Wu.prototype.interfaces_=function(){return[]};Wu.prototype.getClass=function(){return Wu};Wu.computeIntersections=function(i){var s=new Wu(i);return s.setFindAllIntersections(!0),s.isValid(),s.getIntersections()};var pd=function i(){this._nv=null;var s=arguments[0];this._nv=new Wu(i.toSegmentStrings(s))};pd.prototype.checkValid=function(){this._nv.checkValid()};pd.prototype.interfaces_=function(){return[]};pd.prototype.getClass=function(){return pd};pd.toSegmentStrings=function(i){for(var s=new Pe,u=i.iterator();u.hasNext();){var d=u.next();s.add(new xc(d.getCoordinates(),d))}return s};pd.checkValid=function(i){var s=new pd(i);s.checkValid()};var Cf=function(i){this._mapOp=i};Cf.prototype.map=function(i){for(var s=this,u=new Pe,d=0;d<i.getNumGeometries();d++){var _=s._mapOp.map(i.getGeometryN(d));_.isEmpty()||u.add(_)}return i.getFactory().createGeometryCollection(Wr.toGeometryArray(u))};Cf.prototype.interfaces_=function(){return[]};Cf.prototype.getClass=function(){return Cf};Cf.map=function(i,s){var u=new Cf(s);return u.map(i)};var bc=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Pe,this._resultLineList=new Pe;var i=arguments[0],s=arguments[1],u=arguments[2];this._op=i,this._geometryFactory=s,this._ptLocator=u};bc.prototype.collectLines=function(i){for(var s=this,u=this._op.getGraph().getEdgeEnds().iterator();u.hasNext();){var d=u.next();s.collectLineEdge(d,i,s._lineEdgesList),s.collectBoundaryTouchEdge(d,i,s._lineEdgesList)}};bc.prototype.labelIsolatedLine=function(i,s){var u=this._ptLocator.locate(i.getCoordinate(),this._op.getArgGeometry(s));i.getLabel().setLocation(s,u)};bc.prototype.build=function(i){return this.findCoveredLineEdges(),this.collectLines(i),this.buildLines(i),this._resultLineList};bc.prototype.collectLineEdge=function(i,s,u){var d=i.getLabel(),_=i.getEdge();i.isLineEdge()&&!i.isVisited()&&kr.isResultOfOp(d,s)&&!_.isCovered()&&(u.add(_),i.setVisitedEdge(!0))};bc.prototype.findCoveredLineEdges=function(){for(var i=this,s=this._op.getGraph().getNodes().iterator();s.hasNext();){var u=s.next();u.getEdges().findCoveredLineEdges()}for(var d=this._op.getGraph().getEdgeEnds().iterator();d.hasNext();){var _=d.next(),b=_.getEdge();if(_.isLineEdge()&&!b.isCoveredSet()){var C=i._op.isCoveredByA(_.getCoordinate());b.setCovered(C)}}};bc.prototype.labelIsolatedLines=function(i){for(var s=this,u=i.iterator();u.hasNext();){var d=u.next(),_=d.getLabel();d.isIsolated()&&(_.isNull(0)?s.labelIsolatedLine(d,0):s.labelIsolatedLine(d,1))}};bc.prototype.buildLines=function(i){for(var s=this,u=this._lineEdgesList.iterator();u.hasNext();){var d=u.next(),_=s._geometryFactory.createLineString(d.getCoordinates());s._resultLineList.add(_),d.setInResult(!0)}};bc.prototype.collectBoundaryTouchEdge=function(i,s,u){var d=i.getLabel();if(i.isLineEdge()||i.isVisited()||i.isInteriorAreaEdge()||i.getEdge().isInResult())return null;Nr.isTrue(!(i.isInResult()||i.getSym().isInResult())||!i.getEdge().isInResult()),kr.isResultOfOp(d,s)&&s===kr.INTERSECTION&&(u.add(i.getEdge()),i.setVisitedEdge(!0))};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};var Pf=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Pe;var i=arguments[0],s=arguments[1];this._op=i,this._geometryFactory=s};Pf.prototype.filterCoveredNodeToPoint=function(i){var s=i.getCoordinate();if(!this._op.isCoveredByLA(s)){var u=this._geometryFactory.createPoint(s);this._resultPointList.add(u)}};Pf.prototype.extractNonCoveredResultNodes=function(i){for(var s=this,u=this._op.getGraph().getNodes().iterator();u.hasNext();){var d=u.next();if(!d.isInResult()&&!d.isIncidentEdgeInResult()&&(d.getEdges().getDegree()===0||i===kr.INTERSECTION)){var _=d.getLabel();kr.isResultOfOp(_,i)&&s.filterCoveredNodeToPoint(d)}}};Pf.prototype.build=function(i){return this.extractNonCoveredResultNodes(i),this._resultPointList};Pf.prototype.interfaces_=function(){return[]};Pf.prototype.getClass=function(){return Pf};var Ba=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Ba.prototype.transformPoint=function(i,s){return this._factory.createPoint(this.transformCoordinates(i.getCoordinateSequence(),i))};Ba.prototype.transformPolygon=function(i,s){var u=this,d=!0,_=this.transformLinearRing(i.getExteriorRing(),i);(_===null||!(_ instanceof xh)||_.isEmpty())&&(d=!1);for(var b=new Pe,C=0;C<i.getNumInteriorRing();C++){var l=u.transformLinearRing(i.getInteriorRingN(C),i);l===null||l.isEmpty()||(l instanceof xh||(d=!1),b.add(l))}if(d)return this._factory.createPolygon(_,b.toArray([]));var V=new Pe;return _!==null&&V.add(_),V.addAll(b),this._factory.buildGeometry(V)};Ba.prototype.createCoordinateSequence=function(i){return this._factory.getCoordinateSequenceFactory().create(i)};Ba.prototype.getInputGeometry=function(){return this._inputGeom};Ba.prototype.transformMultiLineString=function(i,s){for(var u=this,d=new Pe,_=0;_<i.getNumGeometries();_++){var b=u.transformLineString(i.getGeometryN(_),i);b!==null&&(b.isEmpty()||d.add(b))}return this._factory.buildGeometry(d)};Ba.prototype.transformCoordinates=function(i,s){return this.copy(i)};Ba.prototype.transformLineString=function(i,s){return this._factory.createLineString(this.transformCoordinates(i.getCoordinateSequence(),i))};Ba.prototype.transformMultiPoint=function(i,s){for(var u=this,d=new Pe,_=0;_<i.getNumGeometries();_++){var b=u.transformPoint(i.getGeometryN(_),i);b!==null&&(b.isEmpty()||d.add(b))}return this._factory.buildGeometry(d)};Ba.prototype.transformMultiPolygon=function(i,s){for(var u=this,d=new Pe,_=0;_<i.getNumGeometries();_++){var b=u.transformPolygon(i.getGeometryN(_),i);b!==null&&(b.isEmpty()||d.add(b))}return this._factory.buildGeometry(d)};Ba.prototype.copy=function(i){return i.copy()};Ba.prototype.transformGeometryCollection=function(i,s){for(var u=this,d=new Pe,_=0;_<i.getNumGeometries();_++){var b=u.transform(i.getGeometryN(_));b!==null&&(u._pruneEmptyGeometry&&b.isEmpty()||d.add(b))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Wr.toGeometryArray(d)):this._factory.buildGeometry(d)};Ba.prototype.transform=function(i){if(this._inputGeom=i,this._factory=i.getFactory(),i instanceof ol)return this.transformPoint(i,null);if(i instanceof bm)return this.transformMultiPoint(i,null);if(i instanceof xh)return this.transformLinearRing(i,null);if(i instanceof uo)return this.transformLineString(i,null);if(i instanceof sd)return this.transformMultiLineString(i,null);if(i instanceof Jo)return this.transformPolygon(i,null);if(i instanceof yh)return this.transformMultiPolygon(i,null);if(i instanceof ya)return this.transformGeometryCollection(i,null);throw new $i("Unknown Geometry subtype: "+i.getClass().getName())};Ba.prototype.transformLinearRing=function(i,s){var u=this.transformCoordinates(i.getCoordinateSequence(),i);if(u===null)return this._factory.createLinearRing(null);var d=u.size();return d>0&&d<4&&!this._preserveType?this._factory.createLineString(u):this._factory.createLinearRing(u)};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};var Th=function i(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new sr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof uo&&typeof arguments[1]=="number"){var s=arguments[0],u=arguments[1];i.call(this,s.getCoordinates(),u)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var d=arguments[0],_=arguments[1];this._srcPts=d,this._isClosed=i.isClosed(d),this._snapTolerance=_}};Th.prototype.snapVertices=function(i,s){for(var u=this,d=this._isClosed?i.size()-1:i.size(),_=0;_<d;_++){var b=i.get(_),C=u.findSnapForVertex(b,s);C!==null&&(i.set(_,new Vt(C)),_===0&&u._isClosed&&i.set(i.size()-1,new Vt(C)))}};Th.prototype.findSnapForVertex=function(i,s){for(var u=this,d=0;d<s.length;d++){if(i.equals2D(s[d]))return null;if(i.distance(s[d])<u._snapTolerance)return s[d]}return null};Th.prototype.snapTo=function(i){var s=new Yy(this._srcPts);this.snapVertices(s,i),this.snapSegments(s,i);var u=s.toCoordinateArray();return u};Th.prototype.snapSegments=function(i,s){var u=this;if(s.length===0)return null;var d=s.length;s[0].equals2D(s[s.length-1])&&(d=s.length-1);for(var _=0;_<d;_++){var b=s[_],C=u.findSegmentIndexToSnap(b,i);C>=0&&i.add(C+1,new Vt(b),!1)}};Th.prototype.findSegmentIndexToSnap=function(i,s){for(var u=this,d=Lr.MAX_VALUE,_=-1,b=0;b<s.size()-1;b++){if(u._seg.p0=s.get(b),u._seg.p1=s.get(b+1),u._seg.p0.equals2D(i)||u._seg.p1.equals2D(i)){if(u._allowSnappingToSourceVertices)continue;return-1}var C=u._seg.distance(i);C<u._snapTolerance&&C<d&&(d=C,_=b)}return _};Th.prototype.setAllowSnappingToSourceVertices=function(i){this._allowSnappingToSourceVertices=i};Th.prototype.interfaces_=function(){return[]};Th.prototype.getClass=function(){return Th};Th.isClosed=function(i){return i.length<=1?!1:i[0].equals2D(i[i.length-1])};var Po=function(i){this._srcGeom=i||null},cT={SNAP_PRECISION_FACTOR:{configurable:!0}};Po.prototype.snapTo=function(i,s){var u=this.extractTargetCoordinates(i),d=new hT(s,u);return d.transform(this._srcGeom)};Po.prototype.snapToSelf=function(i,s){var u=this.extractTargetCoordinates(this._srcGeom),d=new hT(i,u,!0),_=d.transform(this._srcGeom),b=_;return s&&xr(b,Bp)&&(b=_.buffer(0)),b};Po.prototype.computeSnapTolerance=function(i){var s=this.computeMinimumSegmentLength(i),u=s/10;return u};Po.prototype.extractTargetCoordinates=function(i){for(var s=new dc,u=i.getCoordinates(),d=0;d<u.length;d++)s.add(u[d]);return s.toArray(new Array(0).fill(null))};Po.prototype.computeMinimumSegmentLength=function(i){for(var s=Lr.MAX_VALUE,u=0;u<i.length-1;u++){var d=i[u].distance(i[u+1]);d<s&&(s=d)}return s};Po.prototype.interfaces_=function(){return[]};Po.prototype.getClass=function(){return Po};Po.snap=function(i,s,u){var d=new Array(2).fill(null),_=new Po(i);d[0]=_.snapTo(s,u);var b=new Po(s);return d[1]=b.snapTo(d[0],u),d};Po.computeOverlaySnapTolerance=function(){if(arguments.length===1){var i=arguments[0],s=Po.computeSizeBasedSnapTolerance(i),u=i.getPrecisionModel();if(u.getType()===Dn.FIXED){var d=1/u.getScale()*2/1.415;d>s&&(s=d)}return s}else if(arguments.length===2){var _=arguments[0],b=arguments[1];return Math.min(Po.computeOverlaySnapTolerance(_),Po.computeOverlaySnapTolerance(b))}};Po.computeSizeBasedSnapTolerance=function(i){var s=i.getEnvelopeInternal(),u=Math.min(s.getHeight(),s.getWidth()),d=u*Po.SNAP_PRECISION_FACTOR;return d};Po.snapToSelf=function(i,s,u){var d=new Po(i);return d.snapToSelf(s,u)};cT.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Po,cT);var hT=function(i){function s(u,d,_){i.call(this),this._snapTolerance=u||null,this._snapPts=d||null,this._isSelfSnap=_!==void 0?_:!1}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.snapLine=function(u,d){var _=new Th(u,this._snapTolerance);return _.setAllowSnappingToSourceVertices(this._isSelfSnap),_.snapTo(d)},s.prototype.transformCoordinates=function(u,d){var _=u.toCoordinateArray(),b=this.snapLine(_,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(b)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Ba),da=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};da.prototype.getCommon=function(){return Lr.longBitsToDouble(this._commonBits)};da.prototype.add=function(i){var s=Lr.doubleToLongBits(i);if(this._isFirst)return this._commonBits=s,this._commonSignExp=da.signExpBits(this._commonBits),this._isFirst=!1,null;var u=da.signExpBits(s);if(u!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=da.numCommonMostSigMantissaBits(this._commonBits,s),this._commonBits=da.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};da.prototype.toString=function(){if(arguments.length===1){var i=arguments[0],s=Lr.longBitsToDouble(i),u=Lr.toBinaryString(i),d="0000000000000000000000000000000000000000000000000000000000000000"+u,_=d.substring(d.length-64),b=_.substring(0,1)+"  "+_.substring(1,12)+"(exp) "+_.substring(12)+" [ "+s+" ]";return b}};da.prototype.interfaces_=function(){return[]};da.prototype.getClass=function(){return da};da.getBit=function(i,s){var u=1<<s;return i&u?1:0};da.signExpBits=function(i){return i>>52};da.zeroLowerBits=function(i,s){var u=(1<<s)-1,d=~u,_=i&d;return _};da.numCommonMostSigMantissaBits=function(i,s){for(var u=0,d=52;d>=0;d--){if(da.getBit(i,d)!==da.getBit(s,d))return u;u++}return 52};var Zp=function(){this._commonCoord=null,this._ccFilter=new Af},Ob={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Zp.prototype.addCommonBits=function(i){var s=new Xp(this._commonCoord);i.apply(s),i.geometryChanged()};Zp.prototype.removeCommonBits=function(i){if(this._commonCoord.x===0&&this._commonCoord.y===0)return i;var s=new Vt(this._commonCoord);s.x=-s.x,s.y=-s.y;var u=new Xp(s);return i.apply(u),i.geometryChanged(),i};Zp.prototype.getCommonCoordinate=function(){return this._commonCoord};Zp.prototype.add=function(i){i.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Zp.prototype.interfaces_=function(){return[]};Zp.prototype.getClass=function(){return Zp};Ob.CommonCoordinateFilter.get=function(){return Af};Ob.Translater.get=function(){return Xp};Object.defineProperties(Zp,Ob);var Af=function(){this._commonBitsX=new da,this._commonBitsY=new da};Af.prototype.filter=function(i){this._commonBitsX.add(i.x),this._commonBitsY.add(i.y)};Af.prototype.getCommonCoordinate=function(){return new Vt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Af.prototype.interfaces_=function(){return[vh]};Af.prototype.getClass=function(){return Af};var Xp=function(){this.trans=null;var i=arguments[0];this.trans=i};Xp.prototype.filter=function(i,s){var u=i.getOrdinate(s,0)+this.trans.x,d=i.getOrdinate(s,1)+this.trans.y;i.setOrdinate(s,0,u),i.setOrdinate(s,1,d)};Xp.prototype.isDone=function(){return!1};Xp.prototype.isGeometryChanged=function(){return!0};Xp.prototype.interfaces_=function(){return[$u]};Xp.prototype.getClass=function(){return Xp};var ws=function(i,s){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=i,this._geom[1]=s,this.computeSnapTolerance()};ws.prototype.selfSnap=function(i){var s=new Po(i),u=s.snapTo(i,this._snapTolerance);return u};ws.prototype.removeCommonBits=function(i){this._cbr=new Zp,this._cbr.add(i[0]),this._cbr.add(i[1]);var s=new Array(2).fill(null);return s[0]=this._cbr.removeCommonBits(i[0].copy()),s[1]=this._cbr.removeCommonBits(i[1].copy()),s};ws.prototype.prepareResult=function(i){return this._cbr.addCommonBits(i),i};ws.prototype.getResultGeometry=function(i){var s=this.snap(this._geom),u=kr.overlayOp(s[0],s[1],i);return this.prepareResult(u)};ws.prototype.checkValid=function(i){i.isValid()||Ds.out.println("Snapped geometry is invalid")};ws.prototype.computeSnapTolerance=function(){this._snapTolerance=Po.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};ws.prototype.snap=function(i){var s=this.removeCommonBits(i),u=Po.snap(s[0],s[1],this._snapTolerance);return u};ws.prototype.interfaces_=function(){return[]};ws.prototype.getClass=function(){return ws};ws.overlayOp=function(i,s,u){var d=new ws(i,s);return d.getResultGeometry(u)};ws.union=function(i,s){return ws.overlayOp(i,s,kr.UNION)};ws.intersection=function(i,s){return ws.overlayOp(i,s,kr.INTERSECTION)};ws.symDifference=function(i,s){return ws.overlayOp(i,s,kr.SYMDIFFERENCE)};ws.difference=function(i,s){return ws.overlayOp(i,s,kr.DIFFERENCE)};var xa=function(i,s){this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=s};xa.prototype.getResultGeometry=function(i){var s=null,u=!1,d=null;try{s=kr.overlayOp(this._geom[0],this._geom[1],i);var _=!0;_&&(u=!0)}catch(b){if(b instanceof Yh)d=b;else throw b}finally{}if(!u)try{s=ws.overlayOp(this._geom[0],this._geom[1],i)}catch(b){throw b instanceof Yh?d:b}finally{}return s};xa.prototype.interfaces_=function(){return[]};xa.prototype.getClass=function(){return xa};xa.overlayOp=function(i,s,u){var d=new xa(i,s);return d.getResultGeometry(u)};xa.union=function(i,s){return xa.overlayOp(i,s,kr.UNION)};xa.intersection=function(i,s){return xa.overlayOp(i,s,kr.INTERSECTION)};xa.symDifference=function(i,s){return xa.overlayOp(i,s,kr.SYMDIFFERENCE)};xa.difference=function(i,s){return xa.overlayOp(i,s,kr.DIFFERENCE)};var $y=function(){this.mce=null,this.chainIndex=null;var i=arguments[0],s=arguments[1];this.mce=i,this.chainIndex=s};$y.prototype.computeIntersections=function(i,s){this.mce.computeIntersectsForChain(this.chainIndex,i.mce,i.chainIndex,s)};$y.prototype.interfaces_=function(){return[]};$y.prototype.getClass=function(){return $y};var ll=function i(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var s=arguments[0],u=arguments[1];this._eventType=i.DELETE,this._xValue=s,this._insertEvent=u}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2];this._eventType=i.INSERT,this._label=d,this._xValue=_,this._obj=b}},Fb={INSERT:{configurable:!0},DELETE:{configurable:!0}};ll.prototype.isDelete=function(){return this._eventType===ll.DELETE};ll.prototype.setDeleteEventIndex=function(i){this._deleteEventIndex=i};ll.prototype.getObject=function(){return this._obj};ll.prototype.compareTo=function(i){var s=i;return this._xValue<s._xValue?-1:this._xValue>s._xValue?1:this._eventType<s._eventType?-1:this._eventType>s._eventType?1:0};ll.prototype.getInsertEvent=function(){return this._insertEvent};ll.prototype.isInsert=function(){return this._eventType===ll.INSERT};ll.prototype.isSameLabel=function(i){return this._label===null?!1:this._label===i._label};ll.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ll.prototype.interfaces_=function(){return[fu]};ll.prototype.getClass=function(){return ll};Fb.INSERT.get=function(){return 1};Fb.DELETE.get=function(){return 2};Object.defineProperties(ll,Fb);var B0=function(){};B0.prototype.interfaces_=function(){return[]};B0.prototype.getClass=function(){return B0};var Rs=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var i=arguments[0],s=arguments[1],u=arguments[2];this._li=i,this._includeProper=s,this._recordIsolated=u};Rs.prototype.isTrivialIntersection=function(i,s,u,d){if(i===u&&this._li.getIntersectionNum()===1){if(Rs.isAdjacentSegments(s,d))return!0;if(i.isClosed()){var _=i.getNumPoints()-1;if(s===0&&d===_||d===0&&s===_)return!0}}return!1};Rs.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Rs.prototype.setIsDoneIfProperInt=function(i){this._isDoneWhenProperInt=i};Rs.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Rs.prototype.isBoundaryPointInternal=function(i,s){for(var u=s.iterator();u.hasNext();){var d=u.next(),_=d.getCoordinate();if(i.isIntersection(_))return!0}return!1};Rs.prototype.hasProperIntersection=function(){return this._hasProper};Rs.prototype.hasIntersection=function(){return this._hasIntersection};Rs.prototype.isDone=function(){return this._isDone};Rs.prototype.isBoundaryPoint=function(i,s){return s===null?!1:!!(this.isBoundaryPointInternal(i,s[0])||this.isBoundaryPointInternal(i,s[1]))};Rs.prototype.setBoundaryNodes=function(i,s){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=i,this._bdyNodes[1]=s};Rs.prototype.addIntersections=function(i,s,u,d){if(i===u&&s===d)return null;this.numTests++;var _=i.getCoordinates()[s],b=i.getCoordinates()[s+1],C=u.getCoordinates()[d],l=u.getCoordinates()[d+1];this._li.computeIntersection(_,b,C,l),this._li.hasIntersection()&&(this._recordIsolated&&(i.setIsolated(!1),u.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(i,s,u,d)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(i.addIntersections(this._li,s,0),u.addIntersections(this._li,d,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Rs.prototype.interfaces_=function(){return[]};Rs.prototype.getClass=function(){return Rs};Rs.isAdjacentSegments=function(i,s){return Math.abs(i-s)===1};var mA=function(i){function s(){i.call(this),this.events=new Pe,this.nOverlaps=null}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.prepareEvents=function(){var u=this;Xu.sort(this.events);for(var d=0;d<this.events.size();d++){var _=u.events.get(d);_.isDelete()&&_.getInsertEvent().setDeleteEventIndex(d)}},s.prototype.computeIntersections=function(){var u=this;if(arguments.length===1){var d=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var _=0;_<this.events.size();_++){var b=u.events.get(_);if(b.isInsert()&&u.processOverlaps(_,b.getDeleteEventIndex(),b,d),d.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Rs&&xr(arguments[0],Gu)&&xr(arguments[1],Gu)){var C=arguments[0],l=arguments[1],V=arguments[2];this.addEdges(C,C),this.addEdges(l,l),this.computeIntersections(V)}else if(typeof arguments[2]=="boolean"&&xr(arguments[0],Gu)&&arguments[1]instanceof Rs){var R=arguments[0],et=arguments[1],at=arguments[2];at?this.addEdges(R,null):this.addEdges(R),this.computeIntersections(et)}}},s.prototype.addEdge=function(u,d){for(var _=this,b=u.getMonotoneChainEdge(),C=b.getStartIndexes(),l=0;l<C.length-1;l++){var V=new $y(b,l),R=new ll(d,b.getMinX(l),V);_.events.add(R),_.events.add(new ll(b.getMaxX(l),R))}},s.prototype.processOverlaps=function(u,d,_,b){for(var C=this,l=_.getObject(),V=u;V<d;V++){var R=C.events.get(V);if(R.isInsert()){var et=R.getObject();_.isSameLabel(R)||(l.computeIntersections(et,b),C.nOverlaps++)}}},s.prototype.addEdges=function(){var u=this;if(arguments.length===1)for(var d=arguments[0],_=d.iterator();_.hasNext();){var b=_.next();u.addEdge(b,b)}else if(arguments.length===2)for(var C=arguments[0],l=arguments[1],V=C.iterator();V.hasNext();){var R=V.next();u.addEdge(R,l)}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(B0),Ih=function(){this._min=Lr.POSITIVE_INFINITY,this._max=Lr.NEGATIVE_INFINITY},pT={NodeComparator:{configurable:!0}};Ih.prototype.getMin=function(){return this._min};Ih.prototype.intersects=function(i,s){return!(this._min>s||this._max<i)};Ih.prototype.getMax=function(){return this._max};Ih.prototype.toString=function(){return qu.toLineString(new Vt(this._min,0),new Vt(this._max,0))};Ih.prototype.interfaces_=function(){return[]};Ih.prototype.getClass=function(){return Ih};pT.NodeComparator.get=function(){return Zy};Object.defineProperties(Ih,pT);var Zy=function(){};Zy.prototype.compare=function(i,s){var u=i,d=s,_=(u._min+u._max)/2,b=(d._min+d._max)/2;return _<b?-1:_>b?1:0};Zy.prototype.interfaces_=function(){return[fm]};Zy.prototype.getClass=function(){return Zy};var gA=function(i){function s(){i.call(this),this._item=null;var u=arguments[0],d=arguments[1],_=arguments[2];this._min=u,this._max=d,this._item=_}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.query=function(u,d,_){if(!this.intersects(u,d))return null;_.visitItem(this._item)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Ih),yA=function(i){function s(){i.call(this),this._node1=null,this._node2=null;var u=arguments[0],d=arguments[1];this._node1=u,this._node2=d,this.buildExtent(this._node1,this._node2)}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.buildExtent=function(u,d){this._min=Math.min(u._min,d._min),this._max=Math.max(u._max,d._max)},s.prototype.query=function(u,d,_){if(!this.intersects(u,d))return null;this._node1!==null&&this._node1.query(u,d,_),this._node2!==null&&this._node2.query(u,d,_)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Ih),Ch=function(){this._leaves=new Pe,this._root=null,this._level=0};Ch.prototype.buildTree=function(){var i=this;Xu.sort(this._leaves,new Ih.NodeComparator);for(var s=this._leaves,u=null,d=new Pe;;){if(i.buildLevel(s,d),d.size()===1)return d.get(0);u=s,s=d,d=u}};Ch.prototype.insert=function(i,s,u){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new gA(i,s,u))};Ch.prototype.query=function(i,s,u){this.init(),this._root.query(i,s,u)};Ch.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Ch.prototype.printNode=function(i){Ds.out.println(qu.toLineString(new Vt(i._min,this._level),new Vt(i._max,this._level)))};Ch.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Ch.prototype.buildLevel=function(i,s){this._level++,s.clear();for(var u=0;u<i.size();u+=2){var d=i.get(u),_=u+1<i.size()?i.get(u):null;if(_===null)s.add(d);else{var b=new yA(i.get(u),i.get(u+1));s.add(b)}}};Ch.prototype.interfaces_=function(){return[]};Ch.prototype.getClass=function(){return Ch};var Cm=function(){this._items=new Pe};Cm.prototype.visitItem=function(i){this._items.add(i)};Cm.prototype.getItems=function(){return this._items};Cm.prototype.interfaces_=function(){return[Vp]};Cm.prototype.getClass=function(){return Cm};var Pm=function(){this._index=null;var i=arguments[0];if(!xr(i,Bp))throw new $i("Argument must be Polygonal");this._index=new dd(i)},Nb={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Pm.prototype.locate=function(i){var s=new cc(i),u=new Am(s);return this._index.query(i.y,i.y,u),s.getLocation()};Pm.prototype.interfaces_=function(){return[Tm]};Pm.prototype.getClass=function(){return Pm};Nb.SegmentVisitor.get=function(){return Am};Nb.IntervalIndexedGeometry.get=function(){return dd};Object.defineProperties(Pm,Nb);var Am=function(){this._counter=null;var i=arguments[0];this._counter=i};Am.prototype.visitItem=function(i){var s=i;this._counter.countSegment(s.getCoordinate(0),s.getCoordinate(1))};Am.prototype.interfaces_=function(){return[Vp]};Am.prototype.getClass=function(){return Am};var dd=function(){this._index=new Ch;var i=arguments[0];this.init(i)};dd.prototype.init=function(i){for(var s=this,u=Ls.getLines(i),d=u.iterator();d.hasNext();){var _=d.next(),b=_.getCoordinates();s.addLine(b)}};dd.prototype.addLine=function(i){for(var s=this,u=1;u<i.length;u++){var d=new sr(i[u-1],i[u]),_=Math.min(d.p0.y,d.p1.y),b=Math.max(d.p0.y,d.p1.y);s._index.insert(_,b,d)}};dd.prototype.query=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1],u=new Cm;return this._index.query(i,s,u),u.getItems()}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2];this._index.query(d,_,b)}};dd.prototype.interfaces_=function(){return[]};dd.prototype.getClass=function(){return dd};var ky=function(i){function s(){if(i.call(this),this._parentGeom=null,this._lineEdgeMap=new WE,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Yu,arguments.length===2){var u=arguments[0],d=arguments[1],_=hu.OGC_SFS_BOUNDARY_RULE;this._argIndex=u,this._parentGeom=d,this._boundaryNodeRule=_,d!==null&&this.add(d)}else if(arguments.length===3){var b=arguments[0],C=arguments[1],l=arguments[2];this._argIndex=b,this._parentGeom=C,this._boundaryNodeRule=l,C!==null&&this.add(C)}}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.insertBoundaryPoint=function(u,d){var _=this._nodes.addNode(d),b=_.getLabel(),C=1,l=Xt.NONE;l=b.getLocation(u,be.ON),l===Xt.BOUNDARY&&C++;var V=s.determineBoundary(this._boundaryNodeRule,C);b.setLocation(u,V)},s.prototype.computeSelfNodes=function(){if(arguments.length===2){var u=arguments[0],d=arguments[1];return this.computeSelfNodes(u,d,!1)}else if(arguments.length===3){var _=arguments[0],b=arguments[1],C=arguments[2],l=new Rs(_,!0,!1);l.setIsDoneIfProperInt(C);var V=this.createEdgeSetIntersector(),R=this._parentGeom instanceof xh||this._parentGeom instanceof Jo||this._parentGeom instanceof yh,et=b||!R;return V.computeIntersections(this._edges,l,et),this.addSelfIntersectionNodes(this._argIndex),l}},s.prototype.computeSplitEdges=function(u){for(var d=this._edges.iterator();d.hasNext();){var _=d.next();_.eiList.addSplitEdges(u)}},s.prototype.computeEdgeIntersections=function(u,d,_){var b=new Rs(d,_,!0);b.setBoundaryNodes(this.getBoundaryNodes(),u.getBoundaryNodes());var C=this.createEdgeSetIntersector();return C.computeIntersections(this._edges,u._edges,b),b},s.prototype.getGeometry=function(){return this._parentGeom},s.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},s.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},s.prototype.addPoint=function(){if(arguments[0]instanceof ol){var u=arguments[0],d=u.getCoordinate();this.insertPoint(this._argIndex,d,Xt.INTERIOR)}else if(arguments[0]instanceof Vt){var _=arguments[0];this.insertPoint(this._argIndex,_,Xt.INTERIOR)}},s.prototype.addPolygon=function(u){var d=this;this.addPolygonRing(u.getExteriorRing(),Xt.EXTERIOR,Xt.INTERIOR);for(var _=0;_<u.getNumInteriorRing();_++){var b=u.getInteriorRingN(_);d.addPolygonRing(b,Xt.INTERIOR,Xt.EXTERIOR)}},s.prototype.addEdge=function(u){this.insertEdge(u);var d=u.getCoordinates();this.insertPoint(this._argIndex,d[0],Xt.BOUNDARY),this.insertPoint(this._argIndex,d[d.length-1],Xt.BOUNDARY)},s.prototype.addLineString=function(u){var d=Jr.removeRepeatedPoints(u.getCoordinates());if(d.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=d[0],null;var _=new N0(d,new Kn(this._argIndex,Xt.INTERIOR));this._lineEdgeMap.put(u,_),this.insertEdge(_),Nr.isTrue(d.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,d[0]),this.insertBoundaryPoint(this._argIndex,d[d.length-1])},s.prototype.getInvalidPoint=function(){return this._invalidPoint},s.prototype.getBoundaryPoints=function(){for(var u=this.getBoundaryNodes(),d=new Array(u.size()).fill(null),_=0,b=u.iterator();b.hasNext();){var C=b.next();d[_++]=C.getCoordinate().copy()}return d},s.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},s.prototype.addSelfIntersectionNode=function(u,d,_){if(this.isBoundaryNode(u,d))return null;_===Xt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(u,d):this.insertPoint(u,d,_)},s.prototype.addPolygonRing=function(u,d,_){if(u.isEmpty())return null;var b=Jr.removeRepeatedPoints(u.getCoordinates());if(b.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=b[0],null;var C=d,l=_;Fe.isCCW(b)&&(C=_,l=d);var V=new N0(b,new Kn(this._argIndex,Xt.BOUNDARY,C,l));this._lineEdgeMap.put(u,V),this.insertEdge(V),this.insertPoint(this._argIndex,b[0],Xt.BOUNDARY)},s.prototype.insertPoint=function(u,d,_){var b=this._nodes.addNode(d),C=b.getLabel();C===null?b._label=new Kn(u,_):C.setLocation(u,_)},s.prototype.createEdgeSetIntersector=function(){return new mA},s.prototype.addSelfIntersectionNodes=function(u){for(var d=this,_=this._edges.iterator();_.hasNext();)for(var b=_.next(),C=b.getLabel().getLocation(u),l=b.eiList.iterator();l.hasNext();){var V=l.next();d.addSelfIntersectionNode(u,V.coord,C)}},s.prototype.add=function(){if(arguments.length===1){var u=arguments[0];if(u.isEmpty())return null;if(u instanceof yh&&(this._useBoundaryDeterminationRule=!1),u instanceof Jo)this.addPolygon(u);else if(u instanceof uo)this.addLineString(u);else if(u instanceof ol)this.addPoint(u);else if(u instanceof bm)this.addCollection(u);else if(u instanceof sd)this.addCollection(u);else if(u instanceof yh)this.addCollection(u);else if(u instanceof ya)this.addCollection(u);else throw new Error(u.getClass().getName())}else return i.prototype.add.apply(this,arguments)},s.prototype.addCollection=function(u){for(var d=this,_=0;_<u.getNumGeometries();_++){var b=u.getGeometryN(_);d.add(b)}},s.prototype.locate=function(u){return xr(this._parentGeom,Bp)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Pm(this._parentGeom)),this._areaPtLocator.locate(u)):this._ptLocator.locate(u,this._parentGeom)},s.prototype.findEdge=function(){if(arguments.length===1){var u=arguments[0];return this._lineEdgeMap.get(u)}else return i.prototype.findEdge.apply(this,arguments)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.determineBoundary=function(u,d){return u.isInBoundary(d)?Xt.BOUNDARY:Xt.INTERIOR},s}(io),Lm=function(){if(this._li=new md,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var i=arguments[0];this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new ky(0,i)}else if(arguments.length===2){var s=arguments[0],u=arguments[1],d=hu.OGC_SFS_BOUNDARY_RULE;s.getPrecisionModel().compareTo(u.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new ky(0,s,d),this._arg[1]=new ky(1,u,d)}else if(arguments.length===3){var _=arguments[0],b=arguments[1],C=arguments[2];_.getPrecisionModel().compareTo(b.getPrecisionModel())>=0?this.setComputationPrecision(_.getPrecisionModel()):this.setComputationPrecision(b.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new ky(0,_,C),this._arg[1]=new ky(1,b,C)}};Lm.prototype.getArgGeometry=function(i){return this._arg[i].getGeometry()};Lm.prototype.setComputationPrecision=function(i){this._resultPrecisionModel=i,this._li.setPrecisionModel(this._resultPrecisionModel)};Lm.prototype.interfaces_=function(){return[]};Lm.prototype.getClass=function(){return Lm};var od=function(){};od.prototype.interfaces_=function(){return[]};od.prototype.getClass=function(){return od};od.map=function(){if(arguments[0]instanceof mr&&xr(arguments[1],od.MapOp)){for(var i=arguments[0],s=arguments[1],u=new Pe,d=0;d<i.getNumGeometries();d++){var _=s.map(i.getGeometryN(d));_!==null&&u.add(_)}return i.getFactory().buildGeometry(u)}else if(xr(arguments[0],Yo)&&xr(arguments[1],od.MapOp)){for(var b=arguments[0],C=arguments[1],l=new Pe,V=b.iterator();V.hasNext();){var R=V.next(),et=C.map(R);et!==null&&l.add(et)}return l}};od.MapOp=function(){};var kr=function(i){function s(){var u=arguments[0],d=arguments[1];i.call(this,u,d),this._ptLocator=new Yu,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Hu,this._resultPolyList=new Pe,this._resultLineList=new Pe,this._resultPointList=new Pe,this._graph=new io(new nT),this._geomFact=u.getFactory()}return i&&(s.__proto__=i),s.prototype=Object.create(i&&i.prototype),s.prototype.constructor=s,s.prototype.insertUniqueEdge=function(u){var d=this._edgeList.findEqualEdge(u);if(d!==null){var _=d.getLabel(),b=u.getLabel();d.isPointwiseEqual(u)||(b=new Kn(u.getLabel()),b.flip());var C=d.getDepth();C.isNull()&&C.add(_),C.add(b),_.merge(b)}else this._edgeList.add(u)},s.prototype.getGraph=function(){return this._graph},s.prototype.cancelDuplicateResultEdges=function(){for(var u=this._graph.getEdgeEnds().iterator();u.hasNext();){var d=u.next(),_=d.getSym();d.isInResult()&&_.isInResult()&&(d.setInResult(!1),_.setInResult(!1))}},s.prototype.isCoveredByLA=function(u){return!!(this.isCovered(u,this._resultLineList)||this.isCovered(u,this._resultPolyList))},s.prototype.computeGeometry=function(u,d,_,b){var C=new Pe;return C.addAll(u),C.addAll(d),C.addAll(_),C.isEmpty()?s.createEmptyResult(b,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(C)},s.prototype.mergeSymLabels=function(){for(var u=this._graph.getNodes().iterator();u.hasNext();){var d=u.next();d.getEdges().mergeSymLabels()}},s.prototype.isCovered=function(u,d){for(var _=this,b=d.iterator();b.hasNext();){var C=b.next(),l=_._ptLocator.locate(u,C);if(l!==Xt.EXTERIOR)return!0}return!1},s.prototype.replaceCollapsedEdges=function(){for(var u=new Pe,d=this._edgeList.iterator();d.hasNext();){var _=d.next();_.isCollapsed()&&(d.remove(),u.add(_.getCollapsedEdge()))}this._edgeList.addAll(u)},s.prototype.updateNodeLabelling=function(){for(var u=this._graph.getNodes().iterator();u.hasNext();){var d=u.next(),_=d.getEdges().getLabel();d.getLabel().merge(_)}},s.prototype.getResultGeometry=function(u){return this.computeOverlay(u),this._resultGeom},s.prototype.insertUniqueEdges=function(u){for(var d=this,_=u.iterator();_.hasNext();){var b=_.next();d.insertUniqueEdge(b)}},s.prototype.computeOverlay=function(u){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var d=new Pe;this._arg[0].computeSplitEdges(d),this._arg[1].computeSplitEdges(d),this.insertUniqueEdges(d),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),pd.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(u),this.cancelDuplicateResultEdges();var _=new sl(this._geomFact);_.add(this._graph),this._resultPolyList=_.getPolygons();var b=new bc(this,this._geomFact,this._ptLocator);this._resultLineList=b.build(u);var C=new Pf(this,this._geomFact,this._ptLocator);this._resultPointList=C.build(u),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,u)},s.prototype.labelIncompleteNode=function(u,d){var _=this._ptLocator.locate(u.getCoordinate(),this._arg[d].getGeometry());u.getLabel().setLocation(d,_)},s.prototype.copyPoints=function(u){for(var d=this,_=this._arg[u].getNodeIterator();_.hasNext();){var b=_.next(),C=d._graph.addNode(b.getCoordinate());C.setLabel(u,b.getLabel().getLocation(u))}},s.prototype.findResultAreaEdges=function(u){for(var d=this._graph.getEdgeEnds().iterator();d.hasNext();){var _=d.next(),b=_.getLabel();b.isArea()&&!_.isInteriorAreaEdge()&&s.isResultOfOp(b.getLocation(0,be.RIGHT),b.getLocation(1,be.RIGHT),u)&&_.setInResult(!0)}},s.prototype.computeLabelsFromDepths=function(){for(var u=this._edgeList.iterator();u.hasNext();){var d=u.next(),_=d.getLabel(),b=d.getDepth();if(!b.isNull()){b.normalize();for(var C=0;C<2;C++)!_.isNull(C)&&_.isArea()&&!b.isNull(C)&&(b.getDelta(C)===0?_.toLine(C):(Nr.isTrue(!b.isNull(C,be.LEFT),"depth of LEFT side has not been initialized"),_.setLocation(C,be.LEFT,b.getLocation(C,be.LEFT)),Nr.isTrue(!b.isNull(C,be.RIGHT),"depth of RIGHT side has not been initialized"),_.setLocation(C,be.RIGHT,b.getLocation(C,be.RIGHT))))}}},s.prototype.computeLabelling=function(){for(var u=this,d=this._graph.getNodes().iterator();d.hasNext();){var _=d.next();_.getEdges().computeLabelling(u._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},s.prototype.labelIncompleteNodes=function(){for(var u=this,d=this._graph.getNodes().iterator();d.hasNext();){var _=d.next(),b=_.getLabel();_.isIsolated()&&(b.isNull(0)?u.labelIncompleteNode(_,0):u.labelIncompleteNode(_,1)),_.getEdges().updateLabelling(b)}},s.prototype.isCoveredByA=function(u){return!!this.isCovered(u,this._resultPolyList)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Lm);kr.overlayOp=function(i,s,u){var d=new kr(i,s),_=d.getResultGeometry(u);return _};kr.intersection=function(i,s){if(i.isEmpty()||s.isEmpty())return kr.createEmptyResult(kr.INTERSECTION,i,s,i.getFactory());if(i.isGeometryCollection()){var u=s;return Cf.map(i,{interfaces_:function(){return[od.MapOp]},map:function(d){return d.intersection(u)}})}return i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(s),xa.overlayOp(i,s,kr.INTERSECTION)};kr.symDifference=function(i,s){if(i.isEmpty()||s.isEmpty()){if(i.isEmpty()&&s.isEmpty())return kr.createEmptyResult(kr.SYMDIFFERENCE,i,s,i.getFactory());if(i.isEmpty())return s.copy();if(s.isEmpty())return i.copy()}return i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(s),xa.overlayOp(i,s,kr.SYMDIFFERENCE)};kr.resultDimension=function(i,s,u){var d=s.getDimension(),_=u.getDimension(),b=-1;switch(i){case kr.INTERSECTION:b=Math.min(d,_);break;case kr.UNION:b=Math.max(d,_);break;case kr.DIFFERENCE:b=d;break;case kr.SYMDIFFERENCE:b=Math.max(d,_);break}return b};kr.createEmptyResult=function(i,s,u,d){var _=null;switch(kr.resultDimension(i,s,u)){case-1:_=d.createGeometryCollection(new Array(0).fill(null));break;case 0:_=d.createPoint();break;case 1:_=d.createLineString();break;case 2:_=d.createPolygon();break}return _};kr.difference=function(i,s){return i.isEmpty()?kr.createEmptyResult(kr.DIFFERENCE,i,s,i.getFactory()):s.isEmpty()?i.copy():(i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(s),xa.overlayOp(i,s,kr.DIFFERENCE))};kr.isResultOfOp=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1],u=i.getLocation(0),d=i.getLocation(1);return kr.isResultOfOp(u,d,s)}else if(arguments.length===3){var _=arguments[0],b=arguments[1],C=arguments[2];switch(_===Xt.BOUNDARY&&(_=Xt.INTERIOR),b===Xt.BOUNDARY&&(b=Xt.INTERIOR),C){case kr.INTERSECTION:return _===Xt.INTERIOR&&b===Xt.INTERIOR;case kr.UNION:return _===Xt.INTERIOR||b===Xt.INTERIOR;case kr.DIFFERENCE:return _===Xt.INTERIOR&&b!==Xt.INTERIOR;case kr.SYMDIFFERENCE:return _===Xt.INTERIOR&&b!==Xt.INTERIOR||_!==Xt.INTERIOR&&b===Xt.INTERIOR}return!1}};kr.INTERSECTION=1;kr.UNION=2;kr.DIFFERENCE=3;kr.SYMDIFFERENCE=4;var Np=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Yu,this._seg=new sr;var i=arguments[0],s=arguments[1];this._g=i,this._boundaryDistanceTolerance=s,this._linework=this.extractLinework(i)};Np.prototype.isWithinToleranceOfBoundary=function(i){for(var s=this,u=0;u<this._linework.getNumGeometries();u++)for(var d=s._linework.getGeometryN(u),_=d.getCoordinateSequence(),b=0;b<_.size()-1;b++){_.getCoordinate(b,s._seg.p0),_.getCoordinate(b+1,s._seg.p1);var C=s._seg.distance(i);if(C<=s._boundaryDistanceTolerance)return!0}return!1};Np.prototype.getLocation=function(i){return this.isWithinToleranceOfBoundary(i)?Xt.BOUNDARY:this._ptLocator.locate(i,this._g)};Np.prototype.extractLinework=function(i){var s=new Mm;i.apply(s);var u=s.getLinework(),d=Wr.toLineStringArray(u);return i.getFactory().createMultiLineString(d)};Np.prototype.interfaces_=function(){return[]};Np.prototype.getClass=function(){return Np};var Mm=function(){this._linework=null,this._linework=new Pe};Mm.prototype.getLinework=function(){return this._linework};Mm.prototype.filter=function(i){var s=this;if(i instanceof Jo){var u=i;this._linework.add(u.getExteriorRing());for(var d=0;d<u.getNumInteriorRing();d++)s._linework.add(u.getInteriorRingN(d))}};Mm.prototype.interfaces_=function(){return[fc]};Mm.prototype.getClass=function(){return Mm};var fd=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var i=arguments[0];this._g=i};fd.prototype.extractPoints=function(i,s,u){for(var d=this,_=i.getCoordinates(),b=0;b<_.length-1;b++)d.computeOffsetPoints(_[b],_[b+1],s,u)};fd.prototype.setSidesToGenerate=function(i,s){this._doLeft=i,this._doRight=s};fd.prototype.getPoints=function(i){for(var s=this,u=new Pe,d=Ls.getLines(this._g),_=d.iterator();_.hasNext();){var b=_.next();s.extractPoints(b,i,u)}return u};fd.prototype.computeOffsetPoints=function(i,s,u,d){var _=s.x-i.x,b=s.y-i.y,C=Math.sqrt(_*_+b*b),l=u*_/C,V=u*b/C,R=(s.x+i.x)/2,et=(s.y+i.y)/2;if(this._doLeft){var at=new Vt(R-V,et+l);d.add(at)}if(this._doRight){var st=new Vt(R+V,et-l);d.add(st)}};fd.prototype.interfaces_=function(){return[]};fd.prototype.getClass=function(){return fd};var Vl=function i(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=i.TOLERANCE,this._testCoords=new Pe;var s=arguments[0],u=arguments[1],d=arguments[2];this._boundaryDistanceTolerance=i.computeBoundaryDistanceTolerance(s,u),this._geom=[s,u,d],this._locFinder=[new Np(this._geom[0],this._boundaryDistanceTolerance),new Np(this._geom[1],this._boundaryDistanceTolerance),new Np(this._geom[2],this._boundaryDistanceTolerance)]},dT={TOLERANCE:{configurable:!0}};Vl.prototype.reportResult=function(i,s,u){Ds.out.println("Overlay result invalid - A:"+Xt.toLocationSymbol(s[0])+" B:"+Xt.toLocationSymbol(s[1])+" expected:"+(u?"i":"e")+" actual:"+Xt.toLocationSymbol(s[2]))};Vl.prototype.isValid=function(i){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var s=this.checkValid(i);return s};Vl.prototype.checkValid=function(){var i=this;if(arguments.length===1){for(var s=arguments[0],u=0;u<this._testCoords.size();u++){var d=i._testCoords.get(u);if(!i.checkValid(s,d))return i._invalidLocation=d,!1}return!0}else if(arguments.length===2){var _=arguments[0],b=arguments[1];return this._location[0]=this._locFinder[0].getLocation(b),this._location[1]=this._locFinder[1].getLocation(b),this._location[2]=this._locFinder[2].getLocation(b),Vl.hasLocation(this._location,Xt.BOUNDARY)?!0:this.isValidResult(_,this._location)}};Vl.prototype.addTestPts=function(i){var s=new fd(i);this._testCoords.addAll(s.getPoints(5*this._boundaryDistanceTolerance))};Vl.prototype.isValidResult=function(i,s){var u=kr.isResultOfOp(s[0],s[1],i),d=s[2]===Xt.INTERIOR,_=!(u^d);return _||this.reportResult(i,s,u),_};Vl.prototype.getInvalidLocation=function(){return this._invalidLocation};Vl.prototype.interfaces_=function(){return[]};Vl.prototype.getClass=function(){return Vl};Vl.hasLocation=function(i,s){for(var u=0;u<3;u++)if(i[u]===s)return!0;return!1};Vl.computeBoundaryDistanceTolerance=function(i,s){return Math.min(Po.computeSizeBasedSnapTolerance(i),Po.computeSizeBasedSnapTolerance(s))};Vl.isValid=function(i,s,u,d){var _=new Vl(i,s,d);return _.isValid(u)};dT.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Vl,dT);var zl=function i(s){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=i.extractFactory(s),this._inputGeoms=s};zl.prototype.extractElements=function(i,s){var u=this;if(i===null)return null;for(var d=0;d<i.getNumGeometries();d++){var _=i.getGeometryN(d);u._skipEmpty&&_.isEmpty()||s.add(_)}};zl.prototype.combine=function(){for(var i=this,s=new Pe,u=this._inputGeoms.iterator();u.hasNext();){var d=u.next();i.extractElements(d,s)}return s.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(s)};zl.prototype.interfaces_=function(){return[]};zl.prototype.getClass=function(){return zl};zl.combine=function(){if(arguments.length===1){var i=arguments[0],s=new zl(i);return s.combine()}else if(arguments.length===2){var u=arguments[0],d=arguments[1],_=new zl(zl.createList(u,d));return _.combine()}else if(arguments.length===3){var b=arguments[0],C=arguments[1],l=arguments[2],V=new zl(zl.createList(b,C,l));return V.combine()}};zl.extractFactory=function(i){return i.isEmpty()?null:i.iterator().next().getFactory()};zl.createList=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1],u=new Pe;return u.add(i),u.add(s),u}else if(arguments.length===3){var d=arguments[0],_=arguments[1],b=arguments[2],C=new Pe;return C.add(d),C.add(_),C.add(b),C}};var Ro=function(){this._inputPolys=null,this._geomFactory=null;var i=arguments[0];this._inputPolys=i,this._inputPolys===null&&(this._inputPolys=new Pe)},fT={STRTREE_NODE_CAPACITY:{configurable:!0}};Ro.prototype.reduceToGeometries=function(i){for(var s=this,u=new Pe,d=i.iterator();d.hasNext();){var _=d.next(),b=null;xr(_,Gu)?b=s.unionTree(_):_ instanceof mr&&(b=_),u.add(b)}return u};Ro.prototype.extractByEnvelope=function(i,s,u){for(var d=new Pe,_=0;_<s.getNumGeometries();_++){var b=s.getGeometryN(_);b.getEnvelopeInternal().intersects(i)?d.add(b):u.add(b)}return this._geomFactory.buildGeometry(d)};Ro.prototype.unionOptimized=function(i,s){var u=i.getEnvelopeInternal(),d=s.getEnvelopeInternal();if(!u.intersects(d)){var _=zl.combine(i,s);return _}if(i.getNumGeometries()<=1&&s.getNumGeometries()<=1)return this.unionActual(i,s);var b=u.intersection(d);return this.unionUsingEnvelopeIntersection(i,s,b)};Ro.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var i=new QE(Ro.STRTREE_NODE_CAPACITY),s=this._inputPolys.iterator();s.hasNext();){var u=s.next();i.insert(u.getEnvelopeInternal(),u)}this._inputPolys=null;var d=i.itemsTree(),_=this.unionTree(d);return _};Ro.prototype.binaryUnion=function(){if(arguments.length===1){var i=arguments[0];return this.binaryUnion(i,0,i.size())}else if(arguments.length===3){var s=arguments[0],u=arguments[1],d=arguments[2];if(d-u<=1){var _=Ro.getGeometry(s,u);return this.unionSafe(_,null)}else{if(d-u===2)return this.unionSafe(Ro.getGeometry(s,u),Ro.getGeometry(s,u+1));var b=Math.trunc((d+u)/2),C=this.binaryUnion(s,u,b),l=this.binaryUnion(s,b,d);return this.unionSafe(C,l)}}};Ro.prototype.repeatedUnion=function(i){for(var s=null,u=i.iterator();u.hasNext();){var d=u.next();s===null?s=d.copy():s=s.union(d)}return s};Ro.prototype.unionSafe=function(i,s){return i===null&&s===null?null:i===null?s.copy():s===null?i.copy():this.unionOptimized(i,s)};Ro.prototype.unionActual=function(i,s){return Ro.restrictToPolygons(i.union(s))};Ro.prototype.unionTree=function(i){var s=this.reduceToGeometries(i),u=this.binaryUnion(s);return u};Ro.prototype.unionUsingEnvelopeIntersection=function(i,s,u){var d=new Pe,_=this.extractByEnvelope(u,i,d),b=this.extractByEnvelope(u,s,d),C=this.unionActual(_,b);d.add(C);var l=zl.combine(d);return l};Ro.prototype.bufferUnion=function(){if(arguments.length===1){var i=arguments[0],s=i.get(0).getFactory(),u=s.buildGeometry(i),d=u.buffer(0);return d}else if(arguments.length===2){var _=arguments[0],b=arguments[1],C=_.getFactory(),l=C.createGeometryCollection([_,b]),V=l.buffer(0);return V}};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.restrictToPolygons=function(i){if(xr(i,Bp))return i;var s=Hh.getPolygons(i);return s.size()===1?s.get(0):i.getFactory().createMultiPolygon(Wr.toPolygonArray(s))};Ro.getGeometry=function(i,s){return s>=i.size()?null:i.get(s)};Ro.union=function(i){var s=new Ro(i);return s.union()};fT.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Ro,fT);var V0=function(){};V0.prototype.interfaces_=function(){return[]};V0.prototype.getClass=function(){return V0};V0.union=function(i,s){if(i.isEmpty()||s.isEmpty()){if(i.isEmpty()&&s.isEmpty())return kr.createEmptyResult(kr.UNION,i,s,i.getFactory());if(i.isEmpty())return s.copy();if(s.isEmpty())return i.copy()}return i.checkNotGeometryCollection(i),i.checkNotGeometryCollection(s),xa.overlayOp(i,s,kr.UNION)};function gu(){return new ev}function ev(){this.reset()}ev.prototype={constructor:ev,reset:function(){this.s=this.t=0},add:function(i){mT(tv,i,this.t),mT(this,tv.s,this.s),this.s?this.t+=tv.t:this.s=tv.t},valueOf:function(){return this.s}};var tv=new ev;function mT(i,s,u){var d=i.s=s+u,_=d-s,b=d-_;i.t=s-b+(u-_)}gu();gu();gu();function rv(i,s){function u(d,_){return d=i(d,_),s(d[0],d[1])}return i.invert&&s.invert&&(u.invert=function(d,_){return d=s.invert(d,_),d&&i.invert(d[0],d[1])}),u}var ei=1e-6,Bn=Math.PI,Ec=Bn/2,Bb=Bn/4,Qu=Bn*2,Hp=180/Bn,yu=Bn/180,Ko=Math.abs,gT=Math.atan,Ah=Math.atan2,Ii=Math.cos,zi=Math.sin,Tc=Math.sqrt;function nv(i){return i>1?0:i<-1?Bn:Math.acos(i)}function tc(i){return i>1?Ec:i<-1?-Ec:Math.asin(i)}function Vb(i,s){return[i>Bn?i-Qu:i<-Bn?i+Qu:i,s]}Vb.invert=Vb;function xT(i,s,u){return(i%=Qu)?s||u?rv(_T(i),vT(s,u)):_T(i):s||u?vT(s,u):Vb}function yT(i){return function(s,u){return s+=i,[s>Bn?s-Qu:s<-Bn?s+Qu:s,u]}}function _T(i){var s=yT(i);return s.invert=yT(-i),s}function vT(i,s){var u=Ii(i),d=zi(i),_=Ii(s),b=zi(s);function C(l,V){var R=Ii(V),et=Ii(l)*R,at=zi(l)*R,st=zi(V),yt=st*u+et*d;return[Ah(at*_-yt*b,et*u-st*d),tc(yt*_+at*b)]}return C.invert=function(l,V){var R=Ii(V),et=Ii(l)*R,at=zi(l)*R,st=zi(V),yt=st*_-at*b;return[Ah(at*_+st*b,et*u+yt*d),tc(yt*u-et*d)]},C}function iv(i,s){return i<s?-1:i>s?1:i>=s?0:NaN}function bT(i){return i.length===1&&(i=_A(i)),{left:function(s,u,d,_){for(d==null&&(d=0),_==null&&(_=s.length);d<_;){var b=d+_>>>1;i(s[b],u)<0?d=b+1:_=b}return d},right:function(s,u,d,_){for(d==null&&(d=0),_==null&&(_=s.length);d<_;){var b=d+_>>>1;i(s[b],u)>0?_=b:d=b+1}return d}}}function _A(i){return function(s,u){return iv(i(s),u)}}bT(iv);function t_(i){return[Ah(i[1],i[0]),tc(i[2])]}function rp(i){var s=i[0],u=i[1],d=Ii(u);return[d*Ii(s),d*zi(s),zi(u)]}function e_(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]}function Om(i,s){return[i[1]*s[2]-i[2]*s[1],i[2]*s[0]-i[0]*s[2],i[0]*s[1]-i[1]*s[0]]}function ov(i,s){i[0]+=s[0],i[1]+=s[1],i[2]+=s[2]}function r_(i,s){return[i[0]*s,i[1]*s,i[2]*s]}function n_(i){var s=Tc(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]/=s,i[1]/=s,i[2]/=s}var Ub=gu();function wT(i,s){var u=s[0],d=s[1],_=[zi(u),-Ii(u),0],b=0,C=0;Ub.reset();for(var l=0,V=i.length;l<V;++l)if(et=(R=i[l]).length)for(var R,et,at=R[et-1],st=at[0],yt=at[1]/2+Bb,xt=zi(yt),It=Ii(yt),Pt=0;Pt<et;++Pt,st=Qt,xt=le,It=Ue,at=qt){var qt=R[Pt],Qt=qt[0],se=qt[1]/2+Bb,le=zi(se),Ue=Ii(se),ke=Qt-st,er=ke>=0?1:-1,Le=er*ke,lr=Le>Bn,je=xt*le;if(Ub.add(Ah(je*er*zi(Le),It*Ue+je*Ii(Le))),b+=lr?ke+er*Qu:ke,lr^st>=u^Qt>=u){var zr=Om(rp(at),rp(qt));n_(zr);var nr=Om(_,zr);n_(nr);var fn=(lr^ke>=0?-1:1)*tc(nr[2]);(d>fn||d===fn&&(zr[0]||zr[1]))&&(C+=lr^ke>=0?1:-1)}}return(b<-ei||b<ei&&Ub<-ei)^C&1}gu();gu();gu();gu();function sv(i){return function(s){var u=new jb;for(var d in i)u[d]=i[d];return u.stream=s,u}}function jb(){}jb.prototype={constructor:jb,point:function(i,s){this.stream.point(i,s)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function av(i){return function(s,u){var d=Ii(s),_=Ii(u),b=i(d*_);return[b*_*zi(s),b*zi(u)]}}function lv(i){return function(s,u){var d=Tc(s*s+u*u),_=i(d),b=zi(_),C=Ii(_);return[Ah(s*b,d*C),tc(d&&u*b/d)]}}var vA=av(function(i){return Tc(2/(1+i))});vA.invert=lv(function(i){return 2*tc(i/2)});function Rf(){}function uv(){var i=[],s;return{point:function(u,d){s.push([u,d])},lineStart:function(){i.push(s=[])},lineEnd:Rf,rejoin:function(){i.length>1&&i.push(i.pop().concat(i.shift()))},result:function(){var u=i;return i=[],s=null,u}}}function Fm(i,s){return Ko(i[0]-s[0])<ei&&Ko(i[1]-s[1])<ei}function cv(i,s,u,d){this.x=i,this.z=s,this.o=u,this.e=d,this.v=!1,this.n=this.p=null}function hv(i,s,u,d,_){var b=[],C=[],l,V;if(i.forEach(function(xt){if(!((It=xt.length-1)<=0)){var It,Pt=xt[0],qt=xt[It],Qt;if(Fm(Pt,qt)){for(_.lineStart(),l=0;l<It;++l)_.point((Pt=xt[l])[0],Pt[1]);_.lineEnd();return}b.push(Qt=new cv(Pt,xt,null,!0)),C.push(Qt.o=new cv(Pt,null,Qt,!1)),b.push(Qt=new cv(qt,xt,null,!1)),C.push(Qt.o=new cv(qt,null,Qt,!0))}}),!!b.length){for(C.sort(s),ST(b),ST(C),l=0,V=C.length;l<V;++l)C[l].e=u=!u;for(var R=b[0],et,at;;){for(var st=R,yt=!0;st.v;)if((st=st.n)===R)return;et=st.z,_.lineStart();do{if(st.v=st.o.v=!0,st.e){if(yt)for(l=0,V=et.length;l<V;++l)_.point((at=et[l])[0],at[1]);else d(st.x,st.n.x,1,_);st=st.n}else{if(yt)for(et=st.p.z,l=et.length-1;l>=0;--l)_.point((at=et[l])[0],at[1]);else d(st.x,st.p.x,-1,_);st=st.p}st=st.o,et=st.z,yt=!yt}while(!st.v);_.lineEnd()}}}function ST(i){if(s=i.length){for(var s,u=0,d=i[0],_;++u<s;)d.n=_=i[u],_.p=d,d=_;d.n=_=i[0],_.p=d}}function pv(i){for(var s=i.length,u,d=-1,_=0,b,C;++d<s;)_+=i[d].length;for(b=new Array(_);--s>=0;)for(C=i[s],u=C.length;--u>=0;)b[--_]=C[u];return b}function dv(i,s,u,d){return function(_,b){var C=s(b),l=_.invert(d[0],d[1]),V=uv(),R=s(V),et=!1,at,st,yt,xt={point:It,lineStart:qt,lineEnd:Qt,polygonStart:function(){xt.point=se,xt.lineStart=le,xt.lineEnd=Ue,st=[],at=[]},polygonEnd:function(){xt.point=It,xt.lineStart=qt,xt.lineEnd=Qt,st=pv(st);var ke=wT(at,l);st.length?(et||(b.polygonStart(),et=!0),hv(st,bA,ke,u,b)):ke&&(et||(b.polygonStart(),et=!0),b.lineStart(),u(null,null,1,b),b.lineEnd()),et&&(b.polygonEnd(),et=!1),st=at=null},sphere:function(){b.polygonStart(),b.lineStart(),u(null,null,1,b),b.lineEnd(),b.polygonEnd()}};function It(ke,er){var Le=_(ke,er);i(ke=Le[0],er=Le[1])&&b.point(ke,er)}function Pt(ke,er){var Le=_(ke,er);C.point(Le[0],Le[1])}function qt(){xt.point=Pt,C.lineStart()}function Qt(){xt.point=It,C.lineEnd()}function se(ke,er){yt.push([ke,er]);var Le=_(ke,er);R.point(Le[0],Le[1])}function le(){R.lineStart(),yt=[]}function Ue(){se(yt[0][0],yt[0][1]),R.lineEnd();var ke=R.clean(),er=V.result(),Le,lr=er.length,je,zr,nr;if(yt.pop(),at.push(yt),yt=null,!!lr){if(ke&1){if(zr=er[0],(je=zr.length-1)>0){for(et||(b.polygonStart(),et=!0),b.lineStart(),Le=0;Le<je;++Le)b.point((nr=zr[Le])[0],nr[1]);b.lineEnd()}return}lr>1&&ke&2&&er.push(er.pop().concat(er.shift())),st.push(er.filter(xA))}}return xt}}function xA(i){return i.length>1}function bA(i,s){return((i=i.x)[0]<0?i[1]-Ec-ei:Ec-i[1])-((s=s.x)[0]<0?s[1]-Ec-ei:Ec-s[1])}var Gb=dv(function(){return!0},wA,EA,[-Bn,-Ec]);function wA(i){var s=NaN,u=NaN,d=NaN,_;return{lineStart:function(){i.lineStart(),_=1},point:function(b,C){var l=b>0?Bn:-Bn,V=Ko(b-s);Ko(V-Bn)<ei?(i.point(s,u=(u+C)/2>0?Ec:-Ec),i.point(d,u),i.lineEnd(),i.lineStart(),i.point(l,u),i.point(b,u),_=0):d!==l&&V>=Bn&&(Ko(s-d)<ei&&(s-=d*ei),Ko(b-l)<ei&&(b-=l*ei),u=SA(s,u,b,C),i.point(d,u),i.lineEnd(),i.lineStart(),i.point(l,u),_=0),i.point(s=b,u=C),d=l},lineEnd:function(){i.lineEnd(),s=u=NaN},clean:function(){return 2-_}}}function SA(i,s,u,d){var _,b,C=zi(i-u);return Ko(C)>ei?gT((zi(s)*(b=Ii(d))*zi(u)-zi(d)*(_=Ii(s))*zi(i))/(_*b*C)):(s+d)/2}function EA(i,s,u,d){var _;if(i==null)_=u*Ec,d.point(-Bn,_),d.point(0,_),d.point(Bn,_),d.point(Bn,0),d.point(Bn,-_),d.point(0,-_),d.point(-Bn,-_),d.point(-Bn,0),d.point(-Bn,_);else if(Ko(i[0]-s[0])>ei){var b=i[0]<s[0]?Bn:-Bn;_=u*b/2,d.point(-b,_),d.point(0,_),d.point(b,_)}else d.point(s[0],s[1])}function TT(i,s,u,d,_,b){if(u){var C=Ii(s),l=zi(s),V=d*u;_==null?(_=s+d*Qu,b=s-V/2):(_=ET(C,_),b=ET(C,b),(d>0?_<b:_>b)&&(_+=d*Qu));for(var R,et=_;d>0?et>b:et<b;et-=V)R=t_([C,-l*Ii(et),-l*zi(et)]),i.point(R[0],R[1])}}function ET(i,s){s=rp(s),s[0]-=i,n_(s);var u=nv(-s[1]);return((-s[2]<0?-u:u)+Qu-ei)%Qu}function IT(i,s){var u=Ii(i),d=u>0,_=Ko(u)>ei;function b(et,at,st,yt){TT(yt,i,s,st,et,at)}function C(et,at){return Ii(et)*Ii(at)>u}function l(et){var at,st,yt,xt,It;return{lineStart:function(){xt=yt=!1,It=1},point:function(Pt,qt){var Qt=[Pt,qt],se,le=C(Pt,qt),Ue=d?le?0:R(Pt,qt):le?R(Pt+(Pt<0?Bn:-Bn),qt):0;if(!at&&(xt=yt=le)&&et.lineStart(),le!==yt&&(se=V(at,Qt),(!se||Fm(at,se)||Fm(Qt,se))&&(Qt[0]+=ei,Qt[1]+=ei,le=C(Qt[0],Qt[1]))),le!==yt)It=0,le?(et.lineStart(),se=V(Qt,at),et.point(se[0],se[1])):(se=V(at,Qt),et.point(se[0],se[1]),et.lineEnd()),at=se;else if(_&&at&&d^le){var ke;!(Ue&st)&&(ke=V(Qt,at,!0))&&(It=0,d?(et.lineStart(),et.point(ke[0][0],ke[0][1]),et.point(ke[1][0],ke[1][1]),et.lineEnd()):(et.point(ke[1][0],ke[1][1]),et.lineEnd(),et.lineStart(),et.point(ke[0][0],ke[0][1])))}le&&(!at||!Fm(at,Qt))&&et.point(Qt[0],Qt[1]),at=Qt,yt=le,st=Ue},lineEnd:function(){yt&&et.lineEnd(),at=null},clean:function(){return It|(xt&&yt)<<1}}}function V(et,at,st){var yt=rp(et),xt=rp(at),It=[1,0,0],Pt=Om(yt,xt),qt=e_(Pt,Pt),Qt=Pt[0],se=qt-Qt*Qt;if(!se)return!st&&et;var le=u*qt/se,Ue=-u*Qt/se,ke=Om(It,Pt),er=r_(It,le),Le=r_(Pt,Ue);ov(er,Le);var lr=ke,je=e_(er,lr),zr=e_(lr,lr),nr=je*je-zr*(e_(er,er)-1);if(!(nr<0)){var fn=Tc(nr),de=r_(lr,(-je-fn)/zr);if(ov(de,er),de=t_(de),!st)return de;var Ke=et[0],Er=at[0],Ar=et[1],xn=at[1],pi;Er<Ke&&(pi=Ke,Ke=Er,Er=pi);var Qo=Er-Ke,Ri=Ko(Qo-Bn)<ei,Sn=Ri||Qo<ei;if(!Ri&&xn<Ar&&(pi=Ar,Ar=xn,xn=pi),Sn?Ri?Ar+xn>0^de[1]<(Ko(de[0]-Ke)<ei?Ar:xn):Ar<=de[1]&&de[1]<=xn:Qo>Bn^(Ke<=de[0]&&de[0]<=Er)){var Ne=r_(lr,(-je+fn)/zr);return ov(Ne,er),[de,t_(Ne)]}}}function R(et,at){var st=d?i:Bn-i,yt=0;return et<-st?yt|=1:et>st&&(yt|=2),at<-st?yt|=4:at>st&&(yt|=8),yt}return dv(C,l,b,d?[0,-i]:[-Bn,i-Bn])}function CT(i,s,u,d,_,b){var C=i[0],l=i[1],V=s[0],R=s[1],et=0,at=1,st=V-C,yt=R-l,xt;if(xt=u-C,!(!st&&xt>0)){if(xt/=st,st<0){if(xt<et)return;xt<at&&(at=xt)}else if(st>0){if(xt>at)return;xt>et&&(et=xt)}if(xt=_-C,!(!st&&xt<0)){if(xt/=st,st<0){if(xt>at)return;xt>et&&(et=xt)}else if(st>0){if(xt<et)return;xt<at&&(at=xt)}if(xt=d-l,!(!yt&&xt>0)){if(xt/=yt,yt<0){if(xt<et)return;xt<at&&(at=xt)}else if(yt>0){if(xt>at)return;xt>et&&(et=xt)}if(xt=b-l,!(!yt&&xt<0)){if(xt/=yt,yt<0){if(xt>at)return;xt>et&&(et=xt)}else if(yt>0){if(xt<et)return;xt<at&&(at=xt)}return et>0&&(i[0]=C+et*st,i[1]=l+et*yt),at<1&&(s[0]=C+at*st,s[1]=l+at*yt),!0}}}}}var i_=1e9,fv=-i_;function PT(i,s,u,d){function _(R,et){return i<=R&&R<=u&&s<=et&&et<=d}function b(R,et,at,st){var yt=0,xt=0;if(R==null||(yt=C(R,at))!==(xt=C(et,at))||V(R,et)<0^at>0)do st.point(yt===0||yt===3?i:u,yt>1?d:s);while((yt=(yt+at+4)%4)!==xt);else st.point(et[0],et[1])}function C(R,et){return Ko(R[0]-i)<ei?et>0?0:3:Ko(R[0]-u)<ei?et>0?2:1:Ko(R[1]-s)<ei?et>0?1:0:et>0?3:2}function l(R,et){return V(R.x,et.x)}function V(R,et){var at=C(R,1),st=C(et,1);return at!==st?at-st:at===0?et[1]-R[1]:at===1?R[0]-et[0]:at===2?R[1]-et[1]:et[0]-R[0]}return function(R){var et=R,at=uv(),st,yt,xt,It,Pt,qt,Qt,se,le,Ue,ke,er={point:Le,lineStart:nr,lineEnd:fn,polygonStart:je,polygonEnd:zr};function Le(Ke,Er){_(Ke,Er)&&et.point(Ke,Er)}function lr(){for(var Ke=0,Er=0,Ar=yt.length;Er<Ar;++Er)for(var xn=yt[Er],pi=1,Qo=xn.length,Ri=xn[0],Sn,Ne,qr=Ri[0],zn=Ri[1];pi<Qo;++pi)Sn=qr,Ne=zn,Ri=xn[pi],qr=Ri[0],zn=Ri[1],Ne<=d?zn>d&&(qr-Sn)*(d-Ne)>(zn-Ne)*(i-Sn)&&++Ke:zn<=d&&(qr-Sn)*(d-Ne)<(zn-Ne)*(i-Sn)&&--Ke;return Ke}function je(){et=at,st=[],yt=[],ke=!0}function zr(){var Ke=lr(),Er=ke&&Ke,Ar=(st=pv(st)).length;(Er||Ar)&&(R.polygonStart(),Er&&(R.lineStart(),b(null,null,1,R),R.lineEnd()),Ar&&hv(st,l,Ke,b,R),R.polygonEnd()),et=R,st=yt=xt=null}function nr(){er.point=de,yt&&yt.push(xt=[]),Ue=!0,le=!1,Qt=se=NaN}function fn(){st&&(de(It,Pt),qt&&le&&at.rejoin(),st.push(at.result())),er.point=Le,le&&et.lineEnd()}function de(Ke,Er){var Ar=_(Ke,Er);if(yt&&xt.push([Ke,Er]),Ue)It=Ke,Pt=Er,qt=Ar,Ue=!1,Ar&&(et.lineStart(),et.point(Ke,Er));else if(Ar&&le)et.point(Ke,Er);else{var xn=[Qt=Math.max(fv,Math.min(i_,Qt)),se=Math.max(fv,Math.min(i_,se))],pi=[Ke=Math.max(fv,Math.min(i_,Ke)),Er=Math.max(fv,Math.min(i_,Er))];CT(xn,pi,i,s,u,d)?(le||(et.lineStart(),et.point(xn[0],xn[1])),et.point(pi[0],pi[1]),Ar||et.lineEnd(),ke=!1):Ar&&(et.lineStart(),et.point(Ke,Er),ke=!1)}Qt=Ke,se=Er,le=Ar}return er}}function qb(i){return i}function mv(i,s){i&&LT.hasOwnProperty(i.type)&&LT[i.type](i,s)}var AT={Feature:function(i,s){mv(i.geometry,s)},FeatureCollection:function(i,s){for(var u=i.features,d=-1,_=u.length;++d<_;)mv(u[d].geometry,s)}},LT={Sphere:function(i,s){s.sphere()},Point:function(i,s){i=i.coordinates,s.point(i[0],i[1],i[2])},MultiPoint:function(i,s){for(var u=i.coordinates,d=-1,_=u.length;++d<_;)i=u[d],s.point(i[0],i[1],i[2])},LineString:function(i,s){$b(i.coordinates,s,0)},MultiLineString:function(i,s){for(var u=i.coordinates,d=-1,_=u.length;++d<_;)$b(u[d],s,0)},Polygon:function(i,s){MT(i.coordinates,s)},MultiPolygon:function(i,s){for(var u=i.coordinates,d=-1,_=u.length;++d<_;)MT(u[d],s)},GeometryCollection:function(i,s){for(var u=i.geometries,d=-1,_=u.length;++d<_;)mv(u[d],s)}};function $b(i,s,u){var d=-1,_=i.length-u,b;for(s.lineStart();++d<_;)b=i[d],s.point(b[0],b[1],b[2]);s.lineEnd()}function MT(i,s){var u=-1,d=i.length;for(s.polygonStart();++u<d;)$b(i[u],s,1);s.polygonEnd()}function DT(i,s){i&&AT.hasOwnProperty(i.type)?AT[i.type](i,s):mv(i,s)}var Nm=1/0,gv=Nm,o_=-Nm,yv=o_,Zb={point:TA,lineStart:Rf,lineEnd:Rf,polygonStart:Rf,polygonEnd:Rf,result:function(){var i=[[Nm,gv],[o_,yv]];return o_=yv=-(gv=Nm=1/0),i}};function TA(i,s){i<Nm&&(Nm=i),i>o_&&(o_=i),s<gv&&(gv=s),s>yv&&(yv=s)}function Xb(i,s,u){var d=s[1][0]-s[0][0],_=s[1][1]-s[0][1],b=i.clipExtent&&i.clipExtent();i.scale(150).translate([0,0]),b!=null&&i.clipExtent(null),DT(u,i.stream(Zb));var C=Zb.result(),l=Math.min(d/(C[1][0]-C[0][0]),_/(C[1][1]-C[0][1])),V=+s[0][0]+(d-l*(C[1][0]+C[0][0]))/2,R=+s[0][1]+(_-l*(C[1][1]+C[0][1]))/2;return b!=null&&i.clipExtent(b),i.scale(l*150).translate([V,R])}function kT(i,s,u){return Xb(i,[[0,0],s],u)}var zT=16,IA=Ii(30*yu);function Hb(i,s){return+s?PA(i,s):CA(i)}function CA(i){return sv({point:function(s,u){s=i(s,u),this.stream.point(s[0],s[1])}})}function PA(i,s){function u(d,_,b,C,l,V,R,et,at,st,yt,xt,It,Pt){var qt=R-d,Qt=et-_,se=qt*qt+Qt*Qt;if(se>4*s&&It--){var le=C+st,Ue=l+yt,ke=V+xt,er=Tc(le*le+Ue*Ue+ke*ke),Le=tc(ke/=er),lr=Ko(Ko(ke)-1)<ei||Ko(b-at)<ei?(b+at)/2:Ah(Ue,le),je=i(lr,Le),zr=je[0],nr=je[1],fn=zr-d,de=nr-_,Ke=Qt*fn-qt*de;(Ke*Ke/se>s||Ko((qt*fn+Qt*de)/se-.5)>.3||C*st+l*yt+V*xt<IA)&&(u(d,_,b,C,l,V,zr,nr,lr,le/=er,Ue/=er,ke,It,Pt),Pt.point(zr,nr),u(zr,nr,lr,le,Ue,ke,R,et,at,st,yt,xt,It,Pt))}}return function(d){var _,b,C,l,V,R,et,at,st,yt,xt,It,Pt={point:qt,lineStart:Qt,lineEnd:le,polygonStart:function(){d.polygonStart(),Pt.lineStart=Ue},polygonEnd:function(){d.polygonEnd(),Pt.lineStart=Qt}};function qt(Le,lr){Le=i(Le,lr),d.point(Le[0],Le[1])}function Qt(){at=NaN,Pt.point=se,d.lineStart()}function se(Le,lr){var je=rp([Le,lr]),zr=i(Le,lr);u(at,st,et,yt,xt,It,at=zr[0],st=zr[1],et=Le,yt=je[0],xt=je[1],It=je[2],zT,d),d.point(at,st)}function le(){Pt.point=qt,d.lineEnd()}function Ue(){Qt(),Pt.point=ke,Pt.lineEnd=er}function ke(Le,lr){se(_=Le,lr),b=at,C=st,l=yt,V=xt,R=It,Pt.point=se}function er(){u(at,st,et,yt,xt,It,b,C,_,l,V,R,zT,d),Pt.lineEnd=le,le()}return Pt}}var AA=sv({point:function(i,s){this.stream.point(i*yu,s*yu)}});function RT(i){return LA(function(){return i})()}function LA(i){var s,u=150,d=480,_=250,b,C,l=0,V=0,R=0,et=0,at=0,st,yt,xt=null,It=Gb,Pt=null,qt,Qt,se,le=qb,Ue=.5,ke=Hb(zr,Ue),er,Le;function lr(de){return de=yt(de[0]*yu,de[1]*yu),[de[0]*u+b,C-de[1]*u]}function je(de){return de=yt.invert((de[0]-b)/u,(C-de[1])/u),de&&[de[0]*Hp,de[1]*Hp]}function zr(de,Ke){return de=s(de,Ke),[de[0]*u+b,C-de[1]*u]}lr.stream=function(de){return er&&Le===de?er:er=AA(It(st,ke(le(Le=de))))},lr.clipAngle=function(de){return arguments.length?(It=+de?IT(xt=de*yu,6*yu):(xt=null,Gb),fn()):xt*Hp},lr.clipExtent=function(de){return arguments.length?(le=de==null?(Pt=qt=Qt=se=null,qb):PT(Pt=+de[0][0],qt=+de[0][1],Qt=+de[1][0],se=+de[1][1]),fn()):Pt==null?null:[[Pt,qt],[Qt,se]]},lr.scale=function(de){return arguments.length?(u=+de,nr()):u},lr.translate=function(de){return arguments.length?(d=+de[0],_=+de[1],nr()):[d,_]},lr.center=function(de){return arguments.length?(l=de[0]%360*yu,V=de[1]%360*yu,nr()):[l*Hp,V*Hp]},lr.rotate=function(de){return arguments.length?(R=de[0]%360*yu,et=de[1]%360*yu,at=de.length>2?de[2]%360*yu:0,nr()):[R*Hp,et*Hp,at*Hp]},lr.precision=function(de){return arguments.length?(ke=Hb(zr,Ue=de*de),fn()):Tc(Ue)},lr.fitExtent=function(de,Ke){return Xb(lr,de,Ke)},lr.fitSize=function(de,Ke){return kT(lr,de,Ke)};function nr(){yt=rv(st=xT(R,et,at),s);var de=s(l,V);return b=d-de[0]*u,C=_+de[1]*u,fn()}function fn(){return er=Le=null,lr}return function(){return s=i.apply(this,arguments),lr.invert=s.invert&&je,nr()}}var OT=av(function(i){return(i=nv(i))&&i/zi(i)});OT.invert=lv(function(i){return i});function FT(){return RT(OT).scale(79.4188).clipAngle(180-.001)}function NT(i,s){return[i,s]}NT.invert=NT;function BT(i,s,u){u=u||{};var d=u.units||"kilometers",_=u.steps||8;if(!i)throw new Error("geojson is required");if(typeof u!="object")throw new Error("options must be an object");if(typeof _!="number")throw new Error("steps must be an number");if(s===void 0)throw new Error("radius is required");if(_<=0)throw new Error("steps must be greater than 0");var b=[];switch(i.type){case"GeometryCollection":return xb(i,function(C){var l=_v(C,s,d,_);l&&b.push(l)}),R0(b);case"FeatureCollection":return vb(i,function(C){var l=_v(C,s,d,_);l&&vb(l,function(V){V&&b.push(V)})}),R0(b)}return _v(i,s,d,_)}function _v(i,s,u,d){var _=i.properties||{},b=i.type==="Feature"?i.geometry:i;if(b.type==="GeometryCollection"){var C=[];return xb(i,function(It){var Pt=_v(It,s,u,d);Pt&&C.push(Pt)}),R0(C)}var l=MA(b),V={type:b.type,coordinates:UT(b.coordinates,l)},R=new H0,et=R.read(V),at=RE(OE(s,u),"meters"),st=vs.bufferOp(et,at,d),yt=new Lb;if(st=yt.write(st),!VT(st.coordinates)){var xt={type:st.type,coordinates:jT(st.coordinates,l)};return pm(xt,_)}}function VT(i){return Array.isArray(i[0])?VT(i[0]):isNaN(i[0])}function UT(i,s){return typeof i[0]!="object"?s(i):i.map(function(u){return UT(u,s)})}function jT(i,s){return typeof i[0]!="object"?s.invert(i):i.map(function(u){return jT(u,s)})}function MA(i){var s=NE(i).geometry.coordinates,u=[-s[0],-s[1]];return FT().rotate(u).scale(nl)}var DA=(i,s=null)=>{let u=yf(i),d=FE(u),_;return s?_=BT(d,s,{units:"miles"}):_=d,yf(_)},s_={getBoundingBox:DA};var kA=2,qT=i=>{let s=Uu();return(0,GT.useEffect)(()=>{if(s&&i.data){let u=s_.getBoundingBox(i.data,i.buffer);s.fitBounds(u)}},[s,i.buffer,i.data]),Xo.jsxs(Xo.Fragment,{children:[Xo.jsx(yb,{id:"current",data:i.data}),Xo.jsx(fb,{id:"current",data:i.data,fillStyle:i.fillStyle,strokeStyle:i.strokeStyle,pointStyle:i.pointStyle})]})};qT.defaultProps={buffer:kA,fillStyle:AE,pointStyle:PE,strokeStyle:LE};var Lh=_e(Ee(),1);Ff.constants.classes.CONTROL_BASE="maplibregl-ctrl";Ff.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";Ff.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var zA=2,RA=1e3,OA={geometryCollection:"GeometryCollection",point:"Point"},vv=i=>{let[s,u]=(0,Lh.useState)(!1),d=(0,Lh.useRef)(),_=(0,Lh.useRef)(),b=(0,Lh.useCallback)(()=>{i.onChange(d.current.getAll())},[i.onChange]),C=(0,Lh.useMemo)(()=>({height:500,width:"100%",...i.style||{}}),[i.style]);return(0,Lh.useEffect)(()=>{if(s&&i.data){let l=s_.getBoundingBox(i.data,i.buffer);if(tl.every(l,tl.isFinite)){let[V,R,et,at]=l,st=[[V,R],[et,at]];_.current.fitBounds(st,{duration:i.zoomDuration})}i.data.type===OA.geometryCollection?tl.each(i.data.geometries,V=>{d.current.add(pm(V))}):d.current.add(i.data)}},[s,i.data]),Xo.jsxs(vw,{attributionControl:!1,onLoad:()=>u(!0),mapLib:J2,ref:_,style:C,mapStyle:i.mapStyle,children:[Xo.jsx(S1,{ref:d,controls:{line_string:!0,point:!0,polygon:!0,trash:!0},displayControlsDefault:!1,onCreate:b,onUpdate:b,onDelete:b,position:"bottom-left"}),i.children]})};vv.defaultProps={buffer:zA,zoomDuration:RA};var oW=_e(Ee(),1);var $T=i=>Xo.jsx(w1,{tileSize:i.tileSize,tiles:[i.url],type:"raster",children:Xo.jsx(b1,{type:"raster",paint:{"raster-opacity":i.opacity},minzoom:i.minzoom,maxzoom:i.maxzoom})});$T.defaultProps={maxzoom:22,minzoom:0,opacity:.7,tileSize:256};var ZT={name:"SapeloPOI",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[-81.234475,31.443465]},properties:{Island:"Sapelo",Location:"Fossils in Progress",Description:"Despite whatever lamentations are made about the 'incompleteness' of the fossil record, fossils are actually quite common. This truism is brought home even more so whenever trace fossils - tracks, burrows, and other evidence of organismal behavior...",URL:"fossils-in-progress.html",Loc_type:"article",Longitude:-81.234475,Latitude:31.443465}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.238634,31.433713]},properties:{Island:"Sapelo",Location:"The Lost Barrier Islands of Georgia",Description:"The Georgia coast is well known for its historic role in the development of modern ecology, starting in the 1950s and ongoing today. But what about geologists? Fortunately, they were not long behind the ecologists, starting their research projects on Sapelo Island and other Georgia barrier islands...",URL:"lost-barrier-islands-of-georgia.html",Loc_type:"article",Longitude:-81.238634,Latitude:31.433713}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.235913,31.448899]},properties:{Island:"Sapelo",Location:"Cabretta Panorama",Description:"This panorama shows the diverse and dynamic environments on and around Cabretta Island (a northeastern part of Sapelo Island) and Blackbeard Island.",URL:"cabretta_360.html",Loc_type:"panorama",Longitude:-81.235913,Latitude:31.448899}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.235346,31.447028]},properties:{Island:"Sapelo",Location:"Cabretta Aerial",Description:"This aerial view shows the eastern (seaward) edge of Cabretta Island and its complex blend of extant and past environments.",URL:"cabretta_aerial.html",Loc_type:"panorama",Longitude:-81.235346,Latitude:31.447028}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.251975,31.465634]},properties:{Island:"Sapelo",Location:"Sapelo 1976",URL:"sapelo1976.html",Loc_type:"panorama",Longitude:-81.251975,Latitude:31.465634}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27856,31.39793]},properties:{Island:"Sapelo",Location:"Alligator Pond Video",video_id:"160131561",Loc_type:"video",Longitude:-81.27856,Latitude:31.39793}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.275418,31.436491]},properties:{Island:"Sapelo",Location:"Borrow Pit Video",video_id:"160131723",Loc_type:"video",Longitude:-81.275418,Latitude:31.436491}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.235062,31.444522]},properties:{Island:"Sapelo",Location:"Cabretta Beach Tree Boneyard video",Loc_type:"video",video_id:"160132035",Longitude:-81.235062,Latitude:31.444522}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.237552,31.43958]},properties:{Island:"Sapelo",Location:"Cabretta Beach Relict Marsh Video",video_id:"160132294",Loc_type:"video",Longitude:-81.237552,Latitude:31.43958}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.233886,31.441161]},properties:{Island:"Sapelo",Location:"Cabretta Beach Tide Timelapse Video",video_id:"160132499",Loc_type:"video",Longitude:-81.233886,Latitude:31.441161}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.254634,31.501003]},properties:{Island:"Sapelo",Location:"Chocolate Plantation Video",video_id:"160132764",Loc_type:"video",Longitude:-81.254634,Latitude:31.501003}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.229721,31.496933]},properties:{Island:"Sapelo",Location:"First African Baptist Church Video",Loc_type:"video",video_id:"160132905",Longitude:-81.229721,Latitude:31.496933}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.26437,31.39048]},properties:{Island:"Sapelo",Location:"Ghost Shrimp on Nannygoat Beach Video",Loc_type:"video",video_id:"160133306",Longitude:-81.26437,Latitude:31.39048}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.269276,31.384358]},properties:{Island:"Sapelo",Location:"Runnels on Nannygoat Beach Video",Loc_type:"video",video_id:"160133801",Longitude:-81.269276,Latitude:31.384358}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.269262,31.387273]},properties:{Island:"Sapelo",Location:"Back Dune Meadows Video",Loc_type:"video",video_id:"160133995",Longitude:-81.269262,Latitude:31.387273}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27087,31.39461]},properties:{Island:"Sapelo",Location:"Periwinkles in the Nature Trail Video",Loc_type:"video",video_id:"160134092",Longitude:-81.27087,Latitude:31.39461}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27002,31.39306]},properties:{Island:"Sapelo",Location:"Relict Dunes Video",Loc_type:"video",video_id:"160134265",Longitude:-81.27002,Latitude:31.39306}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.26988,31.39472]},properties:{Island:"Sapelo",Location:"Nature Trail Tidal Creek Video",Loc_type:"video",video_id:"160134546",Longitude:-81.26988,Latitude:31.39472}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.272254,31.397075]},properties:{Island:"Sapelo",Location:"Video",Loc_type:"video",video_id:"160134430",Longitude:-81.272254,Latitude:31.397075}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.244701,31.514824]},properties:{Island:"Sapelo",Location:"Shell Ring Video",Loc_type:"video",video_id:"160134749",Longitude:-81.244701,Latitude:31.514824}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.229506,31.499082]},properties:{Island:"Sapelo",Location:"Raccoon Bluff Outcrop Video",Loc_type:"video",video_id:"160135378",Longitude:-81.229506,Latitude:31.499082}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.229219,31.498983]},properties:{Island:"Sapelo",Location:"Raccoon Bluff Video",Loc_type:"video",video_id:"160135531",Longitude:-81.229219,Latitude:31.498983}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.244476,31.514815]},properties:{Island:"Sapelo",Location:"Shell Ring Gallery",Loc_type:"photo-gallery",Longitude:-81.244476,Latitude:31.514815},images:[{url:"images/shell_ring/shell_1.jpg",caption:"This is a caption"},{url:"images/shell_ring/shell_2.jpg",caption:"This is a caption"},{url:"images/shell_ring/shell_3.jpg",caption:"This is a caption"},{url:"images/shell_ring/shell_4.jpg",caption:"This is a caption"},{url:"images/shell_ring/shell_5.jpg",caption:"This is a caption"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.229529,31.499258]},properties:{Island:"Sapelo",Location:"Raccoon Bluff Gallery",Loc_type:"photo-gallery",Longitude:-81.229529,Latitude:31.499258},images:[{url:"images/raccoon_bluff/raccoon_1.jpg"},{url:"images/raccoon_bluff/raccoon_2.jpg"},{url:"images/raccoon_bluff/raccoon_3.jpg"},{url:"images/raccoon_bluff/raccoon_4.jpg"},{url:"images/raccoon_bluff/raccoon_5.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.265159,31.3895]},properties:{Island:"Sapelo",Location:"Nannygoat Beach Gallery",Loc_type:"photo-gallery",Longitude:-81.265159,Latitude:31.3895},images:[{url:"images/nannygoat/img_1.jpg"},{url:"images/nannygoat/img_2.jpg"},{url:"images/nannygoat/img_3.jpg"},{url:"images/nannygoat/img_4.jpg"},{url:"images/nannygoat/img_5.jpg"},{url:"images/nannygoat/img_6.jpg"},{url:"images/nannygoat/img_7.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.28568,31.39126]},properties:{Island:"Sapelo",Location:"Sapelo Island Lighthouse",Loc_type:"photo-gallery",Longitude:-81.28568,Latitude:31.39126},images:[{url:"images/lighthouse/lighthouse_1.jpg"},{url:"images/lighthouse/lighthouse_2.jpg"},{url:"images/lighthouse/lighthouse_3.jpg"},{url:"images/lighthouse/lighthouse_4.jpg"},{url:"images/lighthouse/lighthouse_5.jpg"},{url:"images/lighthouse/lighthouse_6.jpg"},{url:"images/lighthouse/lighthouse_7.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27986,31.39734]},properties:{Island:"Sapelo",Location:"Marine Institute Gallery",Loc_type:"photo-gallery",Longitude:-81.27986,Latitude:31.39734},images:[{url:"images/marine_institute/mi_1.jpg"},{url:"images/marine_institute/mi_2.jpg"},{url:"images/marine_institute/mi_3.jpg"},{url:"images/marine_institute/mi_4.jpg"},{url:"images/marine_institute/mi_5.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.275273,31.43637]},properties:{Island:"Sapelo",Location:"Borrow Pit Gallery",Loc_type:"photo-gallery",Longitude:-81.275273,Latitude:31.43637},images:[{url:"images/borrow_pit/borrow_pit_1.jpg"},{url:"images/borrow_pit/borrow_pit_2.jpg"},{url:"images/borrow_pit/borrow_pit_3.jpg"},{url:"images/borrow_pit/borrow_pit_4.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.229693,31.496891]},properties:{Island:"Sapelo",Location:"First African Baptist Church Gallery",Loc_type:"photo-gallery",Longitude:-81.229693,Latitude:31.496891},images:[{url:"images/church/img_1.jpg",caption:"Images of the reconstruction of the First African Baptist Church by SCAD",credit:"Photo courtesy of SCAD"},{url:"images/church/img_2.jpg",caption:"",credit:"Photo courtesy of SCAD"},{url:"images/church/img_3.jpg",caption:"",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_1.jpg",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_2.jpg",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_3.jpg",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_4.jpg",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_5.jpg",credit:"Photo courtesy of SCAD"},{url:"images/church/scad_6.jpg",credit:"Photo courtesy of SCAD"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27396,31.39756]},properties:{Island:"Sapelo",Location:"Greenhouse Gallery",Loc_type:"photo-gallery",Longitude:-81.27396,Latitude:31.39756},images:[{url:"images/greenhouse/greenhouse_1.jpg"},{url:"images/greenhouse/greenhouse_2.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.278431,31.397869]},properties:{Island:"Sapelo",Location:"Alligator Pond Gallery",Loc_type:"photo-gallery",Longitude:-81.278431,Latitude:31.397869},images:[{url:"images/alligator_pond/img_1.jpg"},{url:"images/alligator_pond/img_2.jpg"},{url:"images/alligator_pond/img_3.jpg"},{url:"images/alligator_pond/img_4.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.270047,31.394498]},properties:{Island:"Sapelo",Location:"Nature Trail Gallery",Loc_type:"photo-gallery",Longitude:-81.270047,Latitude:31.394498},images:[{url:"images/nature_trail/nature_1.jpg"},{url:"images/nature_trail/nature_2.jpg"},{url:"images/nature_trail/nature_3.jpg"},{url:"images/nature_trail/nature_4.jpg"},{url:"images/nature_trail/nature_5.jpg"},{url:"images/nature_trail/nature_6.jpg"}]},{type:"Feature",geometry:{type:"Point",coordinates:[-81.234212,31.514568]},properties:{Island:"Sapelo",Location:"Reynolds Duck Pond",Loc_type:"point-of-interest",Longitude:-81.234212,Latitude:31.514568}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.250615,31.429754]},properties:{Island:"Sapelo",Location:"Hog Hammock Beach Road",Loc_type:"point-of-interest",Longitude:-81.250615,Latitude:31.429754}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.29559,31.41778]},properties:{Island:"Sapelo",Location:"Marsh Landing",Loc_type:"point-of-interest",Longitude:-81.29559,Latitude:31.41778}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.2868,31.40016]},properties:{Island:"Sapelo",Location:"Shell Hammock",Loc_type:"point-of-interest",Longitude:-81.2868,Latitude:31.40016}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.258496,31.4062]},properties:{Island:"Sapelo",Location:"Old Beach Road Access",Loc_type:"point-of-interest",Longitude:-81.258496,Latitude:31.4062}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.263909,31.396613]},properties:{Island:"Sapelo",Location:"Nature Trail Maritime Forest Observation Deck",Loc_type:"point-of-interest",Longitude:-81.263909,Latitude:31.396613}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.261617,31.395847]},properties:{Island:"Sapelo",Location:"Nature Trail Beach Access",Loc_type:"point-of-interest",Longitude:-81.261617,Latitude:31.395847}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.27702,31.39708]},properties:{Island:"Sapelo",Location:"Reynolds Mansion",Loc_type:"point-of-interest",Longitude:-81.27702,Latitude:31.39708}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.273568,31.395159]},properties:{Island:"Sapelo",Location:"Nature Trail Entry",Loc_type:"point-of-interest",Longitude:-81.273568,Latitude:31.395159}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.236453,31.438]},properties:{Island:"Sapelo",Location:"Cabretta Inlet",Loc_type:"point-of-interest",Longitude:-81.236453,Latitude:31.438}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.235684,31.436647]},properties:{Island:"Sapelo",Location:"Cabretta Beach",Loc_type:"point-of-interest",Longitude:-81.235684,Latitude:31.436647}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.077708,31.766349]},properties:{Island:"Ossabaw",Location:"Storm Washover Fan",video_id:"240009410",Loc_type:"video",Longitude:-81.077708,Latitude:31.766349}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.064644,31.780884]},properties:{Island:"Ossabaw",Location:"Sea Turtles",video_id:"240009204",Loc_type:"video",Longitude:-81.064644,Latitude:31.780884}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.064857,31.779597]},properties:{Island:"Ossabaw",Location:"Sand Flats",video_id:"240009016",Loc_type:"video",Longitude:-81.064857,Latitude:31.779597}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.112536,31.801063]},properties:{Island:"Ossabaw",Location:"Hurricane Matthew Damage",video_id:"240008761",Loc_type:"video",Longitude:-81.112536,Latitude:31.801063}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.096637,31.772628]},properties:{Island:"Ossabaw",Location:"Dead Cababge Palm Trees",video_id:"240008644",Loc_type:"video",Longitude:-81.096637,Latitude:31.772628}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.123802,31.731265]},properties:{Island:"Ossabaw",Location:"Boneyard Beach",video_id:"240008266",Loc_type:"video",Longitude:-81.123802,Latitude:31.731265}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.404965,31.107193]},properties:{Island:"Jekyll",Location:"North End",video_id:"289333552",Loc_type:"video",Longitude:-81.404965,Latitude:31.107193}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.406045,31.106678]},properties:{Island:"Jekyll",Location:"Bike Path Closed on North End",video_id:"289333683",Loc_type:"video",Longitude:-81.406045,Latitude:31.106678}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.40557,31.106951]},properties:{Island:"Jekyll",Location:"Hurricane Irma Damage",video_id:"289333854",Loc_type:"video",Longitude:-81.40557,Latitude:31.106951}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.42544,31.020407]},properties:{Island:"Jekyll",Location:"South End Nature Trail",video_id:"289334041",Loc_type:"video",Longitude:-81.42544,Latitude:31.020407}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.425284,31.02052]},properties:{Island:"Jekyll",Location:"South End Phone Video",video_id:"289334206",Loc_type:"video",Longitude:-81.425284,Latitude:31.02052}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.283454,31.290815]},properties:{Island:"LittleSimon",Location:"Altamaha River",video_id:"289344820",Loc_type:"video",Longitude:-81.283454,Latitude:31.290815}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.283809,31.290678]},properties:{Island:"LittleSimon",Location:"Armadillo Tracks",video_id:"289344957",Loc_type:"video",Longitude:-81.283809,Latitude:31.290678}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.396425,31.134032]},properties:{Island:"Simon",Location:"Sea Wall",video_id:"289344957",Loc_type:"video",Longitude:-81.396425,Latitude:31.134032}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.396162,31.133975]},properties:{Island:"Simon",Location:"Sea Wall Rocks",video_id:"289345612",Loc_type:"video",Longitude:-81.396162,Latitude:31.133975}},{type:"Feature",geometry:{type:"Point",coordinates:[-81.365688,31.15465]},properties:{Island:"Simon",Location:"Sea Wall Rocks",video_id:"289345700",Loc_type:"video",Longitude:-81.365688,Latitude:31.15465}}]};var HT=_e(a_(),1),NA=()=>(0,HT.jsx)(vv,{data:ZT,mapStyle:"https://api.maptiler.com/maps/dataviz/style.json?key=uXfXuebPlkoPXiY3TPcv",onChange:(()=>{})("onChange"),style:{height:"100vh"}}),XT=NA;var Yp=_e(a_(),1);var BA=()=>{let i=Yb(),s=Wb(i);return(0,Yp.jsxs)("div",{className:"flex flex-row overflow-hidden h-[calc(100vh-5rem)]",children:[(0,Yp.jsxs)("div",{className:"basis-1/2 overflow-scroll",children:[(0,Yp.jsx)("h1",{className:"text-2xl my-2 p-4 sticky top-0 bg-white z-10",children:s.title.rendered}),(0,Yp.jsx)("div",{className:"relative p-4",dangerouslySetInnerHTML:{__html:s.content.rendered}})]}),(0,Yp.jsx)("div",{className:"basis-1/2",children:(0,Yp.jsx)(Qb,{children:()=>(0,Yp.jsx)(XT,{})})})]})},VA=BA;export{VA as default};
/*! Bundled license information:

@performant-software/geospatial/dist/index.es53.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@peripleo/maplibre/dist/peripleo-maplibre.es31.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@peripleo/maplibre/dist/peripleo-maplibre.es32.js:
  (**
   * @license React
   * react-jsx-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@peripleo/peripleo/dist/peripleo.es20.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

@peripleo/peripleo/dist/peripleo.es21.js:
  (**
   * @license React
   * react-jsx-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
